var CA=n=>{throw TypeError(n)};var Iv=(n,e,t)=>e.has(n)||CA("Cannot "+t);var B=(n,e,t)=>(Iv(n,e,"read from private field"),t?t.call(n):e.get(n)),Me=(n,e,t)=>e.has(n)?CA("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),ye=(n,e,t,s)=>(Iv(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t),nt=(n,e,t)=>(Iv(n,e,"access private method"),t);var $m=(n,e,t,s)=>({set _(r){ye(n,e,r,t)},get _(){return B(n,e,s)}});function h6(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in n)){const i=Object.getOwnPropertyDescriptor(s,r);i&&Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();function lL(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var cL={exports:{}},q0={},uL={exports:{}},Qe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qf=Symbol.for("react.element"),f6=Symbol.for("react.portal"),m6=Symbol.for("react.fragment"),p6=Symbol.for("react.strict_mode"),g6=Symbol.for("react.profiler"),y6=Symbol.for("react.provider"),v6=Symbol.for("react.context"),x6=Symbol.for("react.forward_ref"),E6=Symbol.for("react.suspense"),w6=Symbol.for("react.memo"),T6=Symbol.for("react.lazy"),PA=Symbol.iterator;function b6(n){return n===null||typeof n!="object"?null:(n=PA&&n[PA]||n["@@iterator"],typeof n=="function"?n:null)}var dL={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},hL=Object.assign,fL={};function fd(n,e,t){this.props=n,this.context=e,this.refs=fL,this.updater=t||dL}fd.prototype.isReactComponent={};fd.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};fd.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function mL(){}mL.prototype=fd.prototype;function nb(n,e,t){this.props=n,this.context=e,this.refs=fL,this.updater=t||dL}var sb=nb.prototype=new mL;sb.constructor=nb;hL(sb,fd.prototype);sb.isPureReactComponent=!0;var kA=Array.isArray,pL=Object.prototype.hasOwnProperty,rb={current:null},gL={key:!0,ref:!0,__self:!0,__source:!0};function yL(n,e,t){var s,r={},i=null,o=null;if(e!=null)for(s in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)pL.call(e,s)&&!gL.hasOwnProperty(s)&&(r[s]=e[s]);var a=arguments.length-2;if(a===1)r.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];r.children=l}if(n&&n.defaultProps)for(s in a=n.defaultProps,a)r[s]===void 0&&(r[s]=a[s]);return{$$typeof:Qf,type:n,key:i,ref:o,props:r,_owner:rb.current}}function S6(n,e){return{$$typeof:Qf,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function ib(n){return typeof n=="object"&&n!==null&&n.$$typeof===Qf}function _6(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var NA=/\/+/g;function Rv(n,e){return typeof n=="object"&&n!==null&&n.key!=null?_6(""+n.key):e.toString(36)}function Vp(n,e,t,s,r){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case Qf:case f6:o=!0}}if(o)return o=n,r=r(o),n=s===""?"."+Rv(o,0):s,kA(r)?(t="",n!=null&&(t=n.replace(NA,"$&/")+"/"),Vp(r,e,t,"",function(c){return c})):r!=null&&(ib(r)&&(r=S6(r,t+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(NA,"$&/")+"/")+n)),e.push(r)),1;if(o=0,s=s===""?".":s+":",kA(n))for(var a=0;a<n.length;a++){i=n[a];var l=s+Rv(i,a);o+=Vp(i,e,t,l,r)}else if(l=b6(n),typeof l=="function")for(n=l.call(n),a=0;!(i=n.next()).done;)i=i.value,l=s+Rv(i,a++),o+=Vp(i,e,t,l,r);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Bm(n,e,t){if(n==null)return n;var s=[],r=0;return Vp(n,s,"","",function(i){return e.call(t,i,r++)}),s}function A6(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var ms={current:null},$p={transition:null},I6={ReactCurrentDispatcher:ms,ReactCurrentBatchConfig:$p,ReactCurrentOwner:rb};function vL(){throw Error("act(...) is not supported in production builds of React.")}Qe.Children={map:Bm,forEach:function(n,e,t){Bm(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Bm(n,function(){e++}),e},toArray:function(n){return Bm(n,function(e){return e})||[]},only:function(n){if(!ib(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Qe.Component=fd;Qe.Fragment=m6;Qe.Profiler=g6;Qe.PureComponent=nb;Qe.StrictMode=p6;Qe.Suspense=E6;Qe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=I6;Qe.act=vL;Qe.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var s=hL({},n.props),r=n.key,i=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=rb.current),e.key!==void 0&&(r=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)pL.call(e,l)&&!gL.hasOwnProperty(l)&&(s[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)s.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];s.children=a}return{$$typeof:Qf,type:n.type,key:r,ref:i,props:s,_owner:o}};Qe.createContext=function(n){return n={$$typeof:v6,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:y6,_context:n},n.Consumer=n};Qe.createElement=yL;Qe.createFactory=function(n){var e=yL.bind(null,n);return e.type=n,e};Qe.createRef=function(){return{current:null}};Qe.forwardRef=function(n){return{$$typeof:x6,render:n}};Qe.isValidElement=ib;Qe.lazy=function(n){return{$$typeof:T6,_payload:{_status:-1,_result:n},_init:A6}};Qe.memo=function(n,e){return{$$typeof:w6,type:n,compare:e===void 0?null:e}};Qe.startTransition=function(n){var e=$p.transition;$p.transition={};try{n()}finally{$p.transition=e}};Qe.unstable_act=vL;Qe.useCallback=function(n,e){return ms.current.useCallback(n,e)};Qe.useContext=function(n){return ms.current.useContext(n)};Qe.useDebugValue=function(){};Qe.useDeferredValue=function(n){return ms.current.useDeferredValue(n)};Qe.useEffect=function(n,e){return ms.current.useEffect(n,e)};Qe.useId=function(){return ms.current.useId()};Qe.useImperativeHandle=function(n,e,t){return ms.current.useImperativeHandle(n,e,t)};Qe.useInsertionEffect=function(n,e){return ms.current.useInsertionEffect(n,e)};Qe.useLayoutEffect=function(n,e){return ms.current.useLayoutEffect(n,e)};Qe.useMemo=function(n,e){return ms.current.useMemo(n,e)};Qe.useReducer=function(n,e,t){return ms.current.useReducer(n,e,t)};Qe.useRef=function(n){return ms.current.useRef(n)};Qe.useState=function(n){return ms.current.useState(n)};Qe.useSyncExternalStore=function(n,e,t){return ms.current.useSyncExternalStore(n,e,t)};Qe.useTransition=function(){return ms.current.useTransition()};Qe.version="18.3.1";uL.exports=Qe;var T=uL.exports;const vt=lL(T),xL=h6({__proto__:null,default:vt},[T]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var R6=T,C6=Symbol.for("react.element"),P6=Symbol.for("react.fragment"),k6=Object.prototype.hasOwnProperty,N6=R6.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,L6={key:!0,ref:!0,__self:!0,__source:!0};function EL(n,e,t){var s,r={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)k6.call(e,s)&&!L6.hasOwnProperty(s)&&(r[s]=e[s]);if(n&&n.defaultProps)for(s in e=n.defaultProps,e)r[s]===void 0&&(r[s]=e[s]);return{$$typeof:C6,type:n,key:i,ref:o,props:r,_owner:N6.current}}q0.Fragment=P6;q0.jsx=EL;q0.jsxs=EL;cL.exports=q0;var u=cL.exports;function D6(n,e){if(n instanceof RegExp)return{keys:!1,pattern:n};var t,s,r,i,o=[],a="",l=n.split("/");for(l[0]||l.shift();r=l.shift();)t=r[0],t==="*"?(o.push(t),a+=r[1]==="?"?"(?:/(.*))?":"/(.*)"):t===":"?(s=r.indexOf("?",1),i=r.indexOf(".",1),o.push(r.substring(1,~s?s:~i?i:r.length)),a+=~s&&!~i?"(?:/([^/]+?))?":"/([^/]+?)",~i&&(a+=(~s?"?":"")+"\\"+r.substring(i))):a+="/"+r;return{keys:o,pattern:new RegExp("^"+a+(e?"(?=$|/)":"/?$"),"i")}}var wL={exports:{}},TL={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $u=T;function M6(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var O6=typeof Object.is=="function"?Object.is:M6,j6=$u.useState,F6=$u.useEffect,U6=$u.useLayoutEffect,V6=$u.useDebugValue;function $6(n,e){var t=e(),s=j6({inst:{value:t,getSnapshot:e}}),r=s[0].inst,i=s[1];return U6(function(){r.value=t,r.getSnapshot=e,Cv(r)&&i({inst:r})},[n,t,e]),F6(function(){return Cv(r)&&i({inst:r}),n(function(){Cv(r)&&i({inst:r})})},[n]),V6(t),t}function Cv(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!O6(n,t)}catch{return!0}}function B6(n,e){return e()}var G6=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?B6:$6;TL.useSyncExternalStore=$u.useSyncExternalStore!==void 0?$u.useSyncExternalStore:G6;wL.exports=TL;var K6=wL.exports;const H6=xL.useInsertionEffect,W6=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",z6=W6?T.useLayoutEffect:T.useEffect,q6=H6||z6,bL=n=>{const e=T.useRef([n,(...t)=>e[0](...t)]).current;return q6(()=>{e[0]=n}),e[1]},Y6="popstate",ob="pushState",ab="replaceState",Q6="hashchange",LA=[Y6,ob,ab,Q6],X6=n=>{for(const e of LA)addEventListener(e,n);return()=>{for(const e of LA)removeEventListener(e,n)}},SL=(n,e)=>K6.useSyncExternalStore(X6,n,e),J6=()=>location.search,Z6=({ssrSearch:n=""}={})=>SL(J6,()=>n),DA=()=>location.pathname,e8=({ssrPath:n}={})=>SL(DA,n?()=>n:DA),t8=(n,{replace:e=!1,state:t=null}={})=>history[e?ab:ob](t,"",n),n8=(n={})=>[e8(n),t8],MA=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[MA]>"u"){for(const n of[ob,ab]){const e=history[n];history[n]=function(){const t=e.apply(this,arguments),s=new Event(n);return s.arguments=arguments,dispatchEvent(s),t}}Object.defineProperty(window,MA,{value:!0})}const s8=(n,e)=>e.toLowerCase().indexOf(n.toLowerCase())?"~"+e:e.slice(n.length)||"/",_L=(n="")=>n==="/"?"":n,r8=(n,e)=>n[0]==="~"?n.slice(1):_L(e)+n,i8=(n="",e)=>s8(mE(_L(n)),mE(e)),o8=n=>n[0]==="?"?n.slice(1):n,mE=n=>{try{return decodeURI(n)}catch{return n}},a8=n=>mE(o8(n)),AL={hook:n8,searchHook:Z6,parser:D6,base:"",ssrPath:void 0,ssrSearch:void 0,hrefs:n=>n},IL=T.createContext(AL),md=()=>T.useContext(IL),RL={},CL=T.createContext(RL),pd=()=>T.useContext(CL),Y0=n=>{const[e,t]=n.hook(n);return[i8(n.base,e),bL((s,r)=>t(r8(s,n.base),r))]},Ls=()=>Y0(md()),l8=()=>{const n=md();return a8(n.searchHook(n))},PL=(n,e,t,s)=>{const{pattern:r,keys:i}=e instanceof RegExp?{keys:!1,pattern:e}:n(e||"*",s),o=r.exec(t)||[],[a,...l]=o;return a!==void 0?[!0,(()=>{const c=i!==!1?Object.fromEntries(i.map((h,f)=>[h,l[f]])):o.groups;let d={...l};return c&&Object.assign(d,c),d})(),...s?[a]:[]]:[!1,null]},c8=({children:n,...e})=>{var d,h;const t=md(),s=e.hook?AL:t;let r=s;const[i,o]=((d=e.ssrPath)==null?void 0:d.split("?"))??[];o&&(e.ssrSearch=o,e.ssrPath=i),e.hrefs=e.hrefs??((h=e.hook)==null?void 0:h.hrefs);let a=T.useRef({}),l=a.current,c=l;for(let f in s){const m=f==="base"?s[f]+(e[f]||""):e[f]||s[f];l===c&&m!==c[f]&&(a.current=c={...c}),c[f]=m,m!==s[f]&&(r=c)}return T.createElement(IL.Provider,{value:r,children:n})},OA=({children:n,component:e},t)=>e?T.createElement(e,{params:t}):typeof n=="function"?n(t):n,u8=n=>{let e=T.useRef(RL),t=e.current;for(const s in n)n[s]!==t[s]&&(t=n);return Object.keys(n).length===0&&(t=n),e.current=t},It=({path:n,nest:e,match:t,...s})=>{const r=md(),[i]=Y0(r),[o,a,l]=t??PL(r.parser,n,i,e),c=u8({...pd(),...a});if(!o)return null;const d=l?T.createElement(c8,{base:l},OA(s,c)):OA(s,c);return T.createElement(CL.Provider,{value:c,children:d})},be=T.forwardRef((n,e)=>{const t=md(),[s,r]=Y0(t),{to:i="",href:o=i,onClick:a,asChild:l,children:c,className:d,replace:h,state:f,...m}=n,p=bL(v=>{v.ctrlKey||v.metaKey||v.altKey||v.shiftKey||v.button!==0||(a==null||a(v),v.defaultPrevented||(v.preventDefault(),r(o,n)))}),y=t.hrefs(o[0]==="~"?o.slice(1):t.base+o,t);return l&&T.isValidElement(c)?T.cloneElement(c,{onClick:p,href:y}):T.createElement("a",{...m,onClick:p,href:y,className:d!=null&&d.call?d(s===o):d,children:c,ref:e})}),kL=n=>Array.isArray(n)?n.flatMap(e=>kL(e&&e.type===T.Fragment?e.props.children:e)):[n],d8=({children:n,location:e})=>{const t=md(),[s]=Y0(t);for(const r of kL(n)){let i=0;if(T.isValidElement(r)&&(i=PL(t.parser,r.props.path,e||s,r.props.nest))[0])return T.cloneElement(r,{match:i})}return null};var Xf=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(n){return this.listeners.add(n),this.onSubscribe(),()=>{this.listeners.delete(n),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Kl=typeof window>"u"||"Deno"in globalThis;function ar(){}function h8(n,e){return typeof n=="function"?n(e):n}function pE(n){return typeof n=="number"&&n>=0&&n!==1/0}function NL(n,e){return Math.max(n+(e||0)-Date.now(),0)}function cu(n,e){return typeof n=="function"?n(e):n}function Mr(n,e){return typeof n=="function"?n(e):n}function jA(n,e){const{type:t="all",exact:s,fetchStatus:r,predicate:i,queryKey:o,stale:a}=n;if(o){if(s){if(e.queryHash!==lb(o,e.options))return!1}else if(!nf(e.queryKey,o))return!1}if(t!=="all"){const l=e.isActive();if(t==="active"&&!l||t==="inactive"&&l)return!1}return!(typeof a=="boolean"&&e.isStale()!==a||r&&r!==e.state.fetchStatus||i&&!i(e))}function FA(n,e){const{exact:t,status:s,predicate:r,mutationKey:i}=n;if(i){if(!e.options.mutationKey)return!1;if(t){if(tf(e.options.mutationKey)!==tf(i))return!1}else if(!nf(e.options.mutationKey,i))return!1}return!(s&&e.state.status!==s||r&&!r(e))}function lb(n,e){return((e==null?void 0:e.queryKeyHashFn)||tf)(n)}function tf(n){return JSON.stringify(n,(e,t)=>yE(t)?Object.keys(t).sort().reduce((s,r)=>(s[r]=t[r],s),{}):t)}function nf(n,e){return n===e?!0:typeof n!=typeof e?!1:n&&e&&typeof n=="object"&&typeof e=="object"?!Object.keys(e).some(t=>!nf(n[t],e[t])):!1}function LL(n,e){if(n===e)return n;const t=UA(n)&&UA(e);if(t||yE(n)&&yE(e)){const s=t?n:Object.keys(n),r=s.length,i=t?e:Object.keys(e),o=i.length,a=t?[]:{};let l=0;for(let c=0;c<o;c++){const d=t?c:i[c];(!t&&s.includes(d)||t)&&n[d]===void 0&&e[d]===void 0?(a[d]=void 0,l++):(a[d]=LL(n[d],e[d]),a[d]===n[d]&&n[d]!==void 0&&l++)}return r===o&&l===r?n:a}return e}function gE(n,e){if(!e||Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(n[t]!==e[t])return!1;return!0}function UA(n){return Array.isArray(n)&&n.length===Object.keys(n).length}function yE(n){if(!VA(n))return!1;const e=n.constructor;if(e===void 0)return!0;const t=e.prototype;return!(!VA(t)||!t.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(n)!==Object.prototype)}function VA(n){return Object.prototype.toString.call(n)==="[object Object]"}function f8(n){return new Promise(e=>{setTimeout(e,n)})}function vE(n,e,t){return typeof t.structuralSharing=="function"?t.structuralSharing(n,e):t.structuralSharing!==!1?LL(n,e):e}function m8(n,e,t=0){const s=[...n,e];return t&&s.length>t?s.slice(1):s}function p8(n,e,t=0){const s=[e,...n];return t&&s.length>t?s.slice(0,-1):s}var cb=Symbol();function DL(n,e){return!n.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!n.queryFn||n.queryFn===cb?()=>Promise.reject(new Error(`Missing queryFn: '${n.queryHash}'`)):n.queryFn}var kl,ca,Ru,ZN,g8=(ZN=class extends Xf{constructor(){super();Me(this,kl);Me(this,ca);Me(this,Ru);ye(this,Ru,e=>{if(!Kl&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){B(this,ca)||this.setEventListener(B(this,Ru))}onUnsubscribe(){var e;this.hasListeners()||((e=B(this,ca))==null||e.call(this),ye(this,ca,void 0))}setEventListener(e){var t;ye(this,Ru,e),(t=B(this,ca))==null||t.call(this),ye(this,ca,e(s=>{typeof s=="boolean"?this.setFocused(s):this.onFocus()}))}setFocused(e){B(this,kl)!==e&&(ye(this,kl,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){var e;return typeof B(this,kl)=="boolean"?B(this,kl):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},kl=new WeakMap,ca=new WeakMap,Ru=new WeakMap,ZN),ub=new g8,Cu,ua,Pu,eL,y8=(eL=class extends Xf{constructor(){super();Me(this,Cu,!0);Me(this,ua);Me(this,Pu);ye(this,Pu,e=>{if(!Kl&&window.addEventListener){const t=()=>e(!0),s=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",s,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",s)}}})}onSubscribe(){B(this,ua)||this.setEventListener(B(this,Pu))}onUnsubscribe(){var e;this.hasListeners()||((e=B(this,ua))==null||e.call(this),ye(this,ua,void 0))}setEventListener(e){var t;ye(this,Pu,e),(t=B(this,ua))==null||t.call(this),ye(this,ua,e(this.setOnline.bind(this)))}setOnline(e){B(this,Cu)!==e&&(ye(this,Cu,e),this.listeners.forEach(s=>{s(e)}))}isOnline(){return B(this,Cu)}},Cu=new WeakMap,ua=new WeakMap,Pu=new WeakMap,eL),Ag=new y8;function xE(){let n,e;const t=new Promise((r,i)=>{n=r,e=i});t.status="pending",t.catch(()=>{});function s(r){Object.assign(t,r),delete t.resolve,delete t.reject}return t.resolve=r=>{s({status:"fulfilled",value:r}),n(r)},t.reject=r=>{s({status:"rejected",reason:r}),e(r)},t}function v8(n){return Math.min(1e3*2**n,3e4)}function ML(n){return(n??"online")==="online"?Ag.isOnline():!0}var OL=class extends Error{constructor(n){super("CancelledError"),this.revert=n==null?void 0:n.revert,this.silent=n==null?void 0:n.silent}};function Pv(n){return n instanceof OL}function jL(n){let e=!1,t=0,s=!1,r;const i=xE(),o=y=>{var v;s||(f(new OL(y)),(v=n.abort)==null||v.call(n))},a=()=>{e=!0},l=()=>{e=!1},c=()=>ub.isFocused()&&(n.networkMode==="always"||Ag.isOnline())&&n.canRun(),d=()=>ML(n.networkMode)&&n.canRun(),h=y=>{var v;s||(s=!0,(v=n.onSuccess)==null||v.call(n,y),r==null||r(),i.resolve(y))},f=y=>{var v;s||(s=!0,(v=n.onError)==null||v.call(n,y),r==null||r(),i.reject(y))},m=()=>new Promise(y=>{var v;r=x=>{(s||c())&&y(x)},(v=n.onPause)==null||v.call(n)}).then(()=>{var y;r=void 0,s||(y=n.onContinue)==null||y.call(n)}),p=()=>{if(s)return;let y;const v=t===0?n.initialPromise:void 0;try{y=v??n.fn()}catch(x){y=Promise.reject(x)}Promise.resolve(y).then(h).catch(x=>{var D;if(s)return;const E=n.retry??(Kl?0:3),w=n.retryDelay??v8,b=typeof w=="function"?w(t,x):w,C=E===!0||typeof E=="number"&&t<E||typeof E=="function"&&E(t,x);if(e||!C){f(x);return}t++,(D=n.onFail)==null||D.call(n,t,x),f8(b).then(()=>c()?void 0:m()).then(()=>{e?f(x):p()})})};return{promise:i,cancel:o,continue:()=>(r==null||r(),i),cancelRetry:a,continueRetry:l,canStart:d,start:()=>(d()?p():m().then(p),i)}}function x8(){let n=[],e=0,t=a=>{a()},s=a=>{a()},r=a=>setTimeout(a,0);const i=a=>{e?n.push(a):r(()=>{t(a)})},o=()=>{const a=n;n=[],a.length&&r(()=>{s(()=>{a.forEach(l=>{t(l)})})})};return{batch:a=>{let l;e++;try{l=a()}finally{e--,e||o()}return l},batchCalls:a=>(...l)=>{i(()=>{a(...l)})},schedule:i,setNotifyFunction:a=>{t=a},setBatchNotifyFunction:a=>{s=a},setScheduler:a=>{r=a}}}var On=x8(),Nl,tL,FL=(tL=class{constructor(){Me(this,Nl)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),pE(this.gcTime)&&ye(this,Nl,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(n){this.gcTime=Math.max(this.gcTime||0,n??(Kl?1/0:5*60*1e3))}clearGcTimeout(){B(this,Nl)&&(clearTimeout(B(this,Nl)),ye(this,Nl,void 0))}},Nl=new WeakMap,tL),ku,Nu,or,qn,Wf,Ll,Lr,Ui,nL,E8=(nL=class extends FL{constructor(t){super();Me(this,Lr);Me(this,ku);Me(this,Nu);Me(this,or);Me(this,qn);Me(this,Wf);Me(this,Ll);ye(this,Ll,!1),ye(this,Wf,t.defaultOptions),this.setOptions(t.options),this.observers=[],ye(this,or,t.cache),this.queryKey=t.queryKey,this.queryHash=t.queryHash,ye(this,ku,w8(this.options)),this.state=t.state??B(this,ku),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=B(this,qn))==null?void 0:t.promise}setOptions(t){this.options={...B(this,Wf),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&B(this,or).remove(this)}setData(t,s){const r=vE(this.state.data,t,this.options);return nt(this,Lr,Ui).call(this,{data:r,type:"success",dataUpdatedAt:s==null?void 0:s.updatedAt,manual:s==null?void 0:s.manual}),r}setState(t,s){nt(this,Lr,Ui).call(this,{type:"setState",state:t,setStateOptions:s})}cancel(t){var r,i;const s=(r=B(this,qn))==null?void 0:r.promise;return(i=B(this,qn))==null||i.cancel(t),s?s.then(ar).catch(ar):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(B(this,ku))}isActive(){return this.observers.some(t=>Mr(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===cb||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(t=0){return this.state.isInvalidated||this.state.data===void 0||!NL(this.state.dataUpdatedAt,t)}onFocus(){var s;const t=this.observers.find(r=>r.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(s=B(this,qn))==null||s.continue()}onOnline(){var s;const t=this.observers.find(r=>r.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(s=B(this,qn))==null||s.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),B(this,or).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(s=>s!==t),this.observers.length||(B(this,qn)&&(B(this,Ll)?B(this,qn).cancel({revert:!0}):B(this,qn).cancelRetry()),this.scheduleGc()),B(this,or).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||nt(this,Lr,Ui).call(this,{type:"invalidate"})}fetch(t,s){var c,d,h;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(s!=null&&s.cancelRefetch))this.cancel({silent:!0});else if(B(this,qn))return B(this,qn).continueRetry(),B(this,qn).promise}if(t&&this.setOptions(t),!this.options.queryFn){const f=this.observers.find(m=>m.options.queryFn);f&&this.setOptions(f.options)}const r=new AbortController,i=f=>{Object.defineProperty(f,"signal",{enumerable:!0,get:()=>(ye(this,Ll,!0),r.signal)})},o=()=>{const f=DL(this.options,s),m={queryKey:this.queryKey,meta:this.meta};return i(m),ye(this,Ll,!1),this.options.persister?this.options.persister(f,m,this):f(m)},a={fetchOptions:s,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:o};i(a),(c=this.options.behavior)==null||c.onFetch(a,this),ye(this,Nu,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((d=a.fetchOptions)==null?void 0:d.meta))&&nt(this,Lr,Ui).call(this,{type:"fetch",meta:(h=a.fetchOptions)==null?void 0:h.meta});const l=f=>{var m,p,y,v;Pv(f)&&f.silent||nt(this,Lr,Ui).call(this,{type:"error",error:f}),Pv(f)||((p=(m=B(this,or).config).onError)==null||p.call(m,f,this),(v=(y=B(this,or).config).onSettled)==null||v.call(y,this.state.data,f,this)),this.scheduleGc()};return ye(this,qn,jL({initialPromise:s==null?void 0:s.initialPromise,fn:a.fetchFn,abort:r.abort.bind(r),onSuccess:f=>{var m,p,y,v;if(f===void 0){l(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(f)}catch(x){l(x);return}(p=(m=B(this,or).config).onSuccess)==null||p.call(m,f,this),(v=(y=B(this,or).config).onSettled)==null||v.call(y,f,this.state.error,this),this.scheduleGc()},onError:l,onFail:(f,m)=>{nt(this,Lr,Ui).call(this,{type:"failed",failureCount:f,error:m})},onPause:()=>{nt(this,Lr,Ui).call(this,{type:"pause"})},onContinue:()=>{nt(this,Lr,Ui).call(this,{type:"continue"})},retry:a.options.retry,retryDelay:a.options.retryDelay,networkMode:a.options.networkMode,canRun:()=>!0})),B(this,qn).start()}},ku=new WeakMap,Nu=new WeakMap,or=new WeakMap,qn=new WeakMap,Wf=new WeakMap,Ll=new WeakMap,Lr=new WeakSet,Ui=function(t){const s=r=>{switch(t.type){case"failed":return{...r,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...UL(r.data,this.options),fetchMeta:t.meta??null};case"success":return{...r,data:t.data,dataUpdateCount:r.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const i=t.error;return Pv(i)&&i.revert&&B(this,Nu)?{...B(this,Nu),fetchStatus:"idle"}:{...r,error:i,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:i,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...t.state}}};this.state=s(this.state),On.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),B(this,or).notify({query:this,type:"updated",action:t})})},nL);function UL(n,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:ML(e.networkMode)?"fetching":"paused",...n===void 0&&{error:null,status:"pending"}}}function w8(n){const e=typeof n.initialData=="function"?n.initialData():n.initialData,t=e!==void 0,s=t?typeof n.initialDataUpdatedAt=="function"?n.initialDataUpdatedAt():n.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:t?s??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:t?"success":"pending",fetchStatus:"idle"}}var ti,sL,T8=(sL=class extends Xf{constructor(e={}){super();Me(this,ti);this.config=e,ye(this,ti,new Map)}build(e,t,s){const r=t.queryKey,i=t.queryHash??lb(r,t);let o=this.get(i);return o||(o=new E8({cache:this,queryKey:r,queryHash:i,options:e.defaultQueryOptions(t),state:s,defaultOptions:e.getQueryDefaults(r)}),this.add(o)),o}add(e){B(this,ti).has(e.queryHash)||(B(this,ti).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=B(this,ti).get(e.queryHash);t&&(e.destroy(),t===e&&B(this,ti).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){On.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return B(this,ti).get(e)}getAll(){return[...B(this,ti).values()]}find(e){const t={exact:!0,...e};return this.getAll().find(s=>jA(t,s))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(s=>jA(e,s)):t}notify(e){On.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){On.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){On.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},ti=new WeakMap,sL),ni,is,Dl,si,qo,rL,b8=(rL=class extends FL{constructor(t){super();Me(this,si);Me(this,ni);Me(this,is);Me(this,Dl);this.mutationId=t.mutationId,ye(this,is,t.mutationCache),ye(this,ni,[]),this.state=t.state||S8(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){B(this,ni).includes(t)||(B(this,ni).push(t),this.clearGcTimeout(),B(this,is).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){ye(this,ni,B(this,ni).filter(s=>s!==t)),this.scheduleGc(),B(this,is).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){B(this,ni).length||(this.state.status==="pending"?this.scheduleGc():B(this,is).remove(this))}continue(){var t;return((t=B(this,Dl))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var i,o,a,l,c,d,h,f,m,p,y,v,x,E,w,b,C,D,_,S;ye(this,Dl,jL({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(I,R)=>{nt(this,si,qo).call(this,{type:"failed",failureCount:I,error:R})},onPause:()=>{nt(this,si,qo).call(this,{type:"pause"})},onContinue:()=>{nt(this,si,qo).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>B(this,is).canRun(this)}));const s=this.state.status==="pending",r=!B(this,Dl).canStart();try{if(!s){nt(this,si,qo).call(this,{type:"pending",variables:t,isPaused:r}),await((o=(i=B(this,is).config).onMutate)==null?void 0:o.call(i,t,this));const R=await((l=(a=this.options).onMutate)==null?void 0:l.call(a,t));R!==this.state.context&&nt(this,si,qo).call(this,{type:"pending",context:R,variables:t,isPaused:r})}const I=await B(this,Dl).start();return await((d=(c=B(this,is).config).onSuccess)==null?void 0:d.call(c,I,t,this.state.context,this)),await((f=(h=this.options).onSuccess)==null?void 0:f.call(h,I,t,this.state.context)),await((p=(m=B(this,is).config).onSettled)==null?void 0:p.call(m,I,null,this.state.variables,this.state.context,this)),await((v=(y=this.options).onSettled)==null?void 0:v.call(y,I,null,t,this.state.context)),nt(this,si,qo).call(this,{type:"success",data:I}),I}catch(I){try{throw await((E=(x=B(this,is).config).onError)==null?void 0:E.call(x,I,t,this.state.context,this)),await((b=(w=this.options).onError)==null?void 0:b.call(w,I,t,this.state.context)),await((D=(C=B(this,is).config).onSettled)==null?void 0:D.call(C,void 0,I,this.state.variables,this.state.context,this)),await((S=(_=this.options).onSettled)==null?void 0:S.call(_,void 0,I,t,this.state.context)),I}finally{nt(this,si,qo).call(this,{type:"error",error:I})}}finally{B(this,is).runNext(this)}}},ni=new WeakMap,is=new WeakMap,Dl=new WeakMap,si=new WeakSet,qo=function(t){const s=r=>{switch(t.type){case"failed":return{...r,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...r,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:t.error,failureCount:r.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=s(this.state),On.batch(()=>{B(this,ni).forEach(r=>{r.onMutationUpdate(t)}),B(this,is).notify({mutation:this,type:"updated",action:t})})},rL);function S8(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var $s,zf,iL,_8=(iL=class extends Xf{constructor(e={}){super();Me(this,$s);Me(this,zf);this.config=e,ye(this,$s,new Map),ye(this,zf,Date.now())}build(e,t,s){const r=new b8({mutationCache:this,mutationId:++$m(this,zf)._,options:e.defaultMutationOptions(t),state:s});return this.add(r),r}add(e){const t=Gm(e),s=B(this,$s).get(t)??[];s.push(e),B(this,$s).set(t,s),this.notify({type:"added",mutation:e})}remove(e){var s;const t=Gm(e);if(B(this,$s).has(t)){const r=(s=B(this,$s).get(t))==null?void 0:s.filter(i=>i!==e);r&&(r.length===0?B(this,$s).delete(t):B(this,$s).set(t,r))}this.notify({type:"removed",mutation:e})}canRun(e){var s;const t=(s=B(this,$s).get(Gm(e)))==null?void 0:s.find(r=>r.state.status==="pending");return!t||t===e}runNext(e){var s;const t=(s=B(this,$s).get(Gm(e)))==null?void 0:s.find(r=>r!==e&&r.state.isPaused);return(t==null?void 0:t.continue())??Promise.resolve()}clear(){On.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}getAll(){return[...B(this,$s).values()].flat()}find(e){const t={exact:!0,...e};return this.getAll().find(s=>FA(t,s))}findAll(e={}){return this.getAll().filter(t=>FA(e,t))}notify(e){On.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return On.batch(()=>Promise.all(e.map(t=>t.continue().catch(ar))))}},$s=new WeakMap,zf=new WeakMap,iL);function Gm(n){var e;return((e=n.options.scope)==null?void 0:e.id)??String(n.mutationId)}function $A(n){return{onFetch:(e,t)=>{var d,h,f,m,p;const s=e.options,r=(f=(h=(d=e.fetchOptions)==null?void 0:d.meta)==null?void 0:h.fetchMore)==null?void 0:f.direction,i=((m=e.state.data)==null?void 0:m.pages)||[],o=((p=e.state.data)==null?void 0:p.pageParams)||[];let a={pages:[],pageParams:[]},l=0;const c=async()=>{let y=!1;const v=w=>{Object.defineProperty(w,"signal",{enumerable:!0,get:()=>(e.signal.aborted?y=!0:e.signal.addEventListener("abort",()=>{y=!0}),e.signal)})},x=DL(e.options,e.fetchOptions),E=async(w,b,C)=>{if(y)return Promise.reject();if(b==null&&w.pages.length)return Promise.resolve(w);const D={queryKey:e.queryKey,pageParam:b,direction:C?"backward":"forward",meta:e.options.meta};v(D);const _=await x(D),{maxPages:S}=e.options,I=C?p8:m8;return{pages:I(w.pages,_,S),pageParams:I(w.pageParams,b,S)}};if(r&&i.length){const w=r==="backward",b=w?A8:BA,C={pages:i,pageParams:o},D=b(s,C);a=await E(C,D,w)}else{const w=n??i.length;do{const b=l===0?o[0]??s.initialPageParam:BA(s,a);if(l>0&&b==null)break;a=await E(a,b),l++}while(l<w)}return a};e.options.persister?e.fetchFn=()=>{var y,v;return(v=(y=e.options).persister)==null?void 0:v.call(y,c,{queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t)}:e.fetchFn=c}}}function BA(n,{pages:e,pageParams:t}){const s=e.length-1;return e.length>0?n.getNextPageParam(e[s],e,t[s],t):void 0}function A8(n,{pages:e,pageParams:t}){var s;return e.length>0?(s=n.getPreviousPageParam)==null?void 0:s.call(n,e[0],e,t[0],t):void 0}var zt,da,ha,Lu,Du,fa,Mu,Ou,oL,VL=(oL=class{constructor(n={}){Me(this,zt);Me(this,da);Me(this,ha);Me(this,Lu);Me(this,Du);Me(this,fa);Me(this,Mu);Me(this,Ou);ye(this,zt,n.queryCache||new T8),ye(this,da,n.mutationCache||new _8),ye(this,ha,n.defaultOptions||{}),ye(this,Lu,new Map),ye(this,Du,new Map),ye(this,fa,0)}mount(){$m(this,fa)._++,B(this,fa)===1&&(ye(this,Mu,ub.subscribe(async n=>{n&&(await this.resumePausedMutations(),B(this,zt).onFocus())})),ye(this,Ou,Ag.subscribe(async n=>{n&&(await this.resumePausedMutations(),B(this,zt).onOnline())})))}unmount(){var n,e;$m(this,fa)._--,B(this,fa)===0&&((n=B(this,Mu))==null||n.call(this),ye(this,Mu,void 0),(e=B(this,Ou))==null||e.call(this),ye(this,Ou,void 0))}isFetching(n){return B(this,zt).findAll({...n,fetchStatus:"fetching"}).length}isMutating(n){return B(this,da).findAll({...n,status:"pending"}).length}getQueryData(n){var t;const e=this.defaultQueryOptions({queryKey:n});return(t=B(this,zt).get(e.queryHash))==null?void 0:t.state.data}ensureQueryData(n){const e=this.getQueryData(n.queryKey);if(e===void 0)return this.fetchQuery(n);{const t=this.defaultQueryOptions(n),s=B(this,zt).build(this,t);return n.revalidateIfStale&&s.isStaleByTime(cu(t.staleTime,s))&&this.prefetchQuery(t),Promise.resolve(e)}}getQueriesData(n){return B(this,zt).findAll(n).map(({queryKey:e,state:t})=>{const s=t.data;return[e,s]})}setQueryData(n,e,t){const s=this.defaultQueryOptions({queryKey:n}),r=B(this,zt).get(s.queryHash),i=r==null?void 0:r.state.data,o=h8(e,i);if(o!==void 0)return B(this,zt).build(this,s).setData(o,{...t,manual:!0})}setQueriesData(n,e,t){return On.batch(()=>B(this,zt).findAll(n).map(({queryKey:s})=>[s,this.setQueryData(s,e,t)]))}getQueryState(n){var t;const e=this.defaultQueryOptions({queryKey:n});return(t=B(this,zt).get(e.queryHash))==null?void 0:t.state}removeQueries(n){const e=B(this,zt);On.batch(()=>{e.findAll(n).forEach(t=>{e.remove(t)})})}resetQueries(n,e){const t=B(this,zt),s={type:"active",...n};return On.batch(()=>(t.findAll(n).forEach(r=>{r.reset()}),this.refetchQueries(s,e)))}cancelQueries(n={},e={}){const t={revert:!0,...e},s=On.batch(()=>B(this,zt).findAll(n).map(r=>r.cancel(t)));return Promise.all(s).then(ar).catch(ar)}invalidateQueries(n={},e={}){return On.batch(()=>{if(B(this,zt).findAll(n).forEach(s=>{s.invalidate()}),n.refetchType==="none")return Promise.resolve();const t={...n,type:n.refetchType??n.type??"active"};return this.refetchQueries(t,e)})}refetchQueries(n={},e){const t={...e,cancelRefetch:(e==null?void 0:e.cancelRefetch)??!0},s=On.batch(()=>B(this,zt).findAll(n).filter(r=>!r.isDisabled()).map(r=>{let i=r.fetch(void 0,t);return t.throwOnError||(i=i.catch(ar)),r.state.fetchStatus==="paused"?Promise.resolve():i}));return Promise.all(s).then(ar)}fetchQuery(n){const e=this.defaultQueryOptions(n);e.retry===void 0&&(e.retry=!1);const t=B(this,zt).build(this,e);return t.isStaleByTime(cu(e.staleTime,t))?t.fetch(e):Promise.resolve(t.state.data)}prefetchQuery(n){return this.fetchQuery(n).then(ar).catch(ar)}fetchInfiniteQuery(n){return n.behavior=$A(n.pages),this.fetchQuery(n)}prefetchInfiniteQuery(n){return this.fetchInfiniteQuery(n).then(ar).catch(ar)}ensureInfiniteQueryData(n){return n.behavior=$A(n.pages),this.ensureQueryData(n)}resumePausedMutations(){return Ag.isOnline()?B(this,da).resumePausedMutations():Promise.resolve()}getQueryCache(){return B(this,zt)}getMutationCache(){return B(this,da)}getDefaultOptions(){return B(this,ha)}setDefaultOptions(n){ye(this,ha,n)}setQueryDefaults(n,e){B(this,Lu).set(tf(n),{queryKey:n,defaultOptions:e})}getQueryDefaults(n){const e=[...B(this,Lu).values()];let t={};return e.forEach(s=>{nf(n,s.queryKey)&&(t={...t,...s.defaultOptions})}),t}setMutationDefaults(n,e){B(this,Du).set(tf(n),{mutationKey:n,defaultOptions:e})}getMutationDefaults(n){const e=[...B(this,Du).values()];let t={};return e.forEach(s=>{nf(n,s.mutationKey)&&(t={...t,...s.defaultOptions})}),t}defaultQueryOptions(n){if(n._defaulted)return n;const e={...B(this,ha).queries,...this.getQueryDefaults(n.queryKey),...n,_defaulted:!0};return e.queryHash||(e.queryHash=lb(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.enabled!==!0&&e.queryFn===cb&&(e.enabled=!1),e}defaultMutationOptions(n){return n!=null&&n._defaulted?n:{...B(this,ha).mutations,...(n==null?void 0:n.mutationKey)&&this.getMutationDefaults(n.mutationKey),...n,_defaulted:!0}}clear(){B(this,zt).clear(),B(this,da).clear()}},zt=new WeakMap,da=new WeakMap,ha=new WeakMap,Lu=new WeakMap,Du=new WeakMap,fa=new WeakMap,Mu=new WeakMap,Ou=new WeakMap,oL),Es,st,qf,os,Ml,ju,ma,ri,Yf,Fu,Uu,Ol,jl,pa,Vu,dt,yh,EE,wE,TE,bE,SE,_E,AE,$L,aL,I8=(aL=class extends Xf{constructor(e,t){super();Me(this,dt);Me(this,Es);Me(this,st);Me(this,qf);Me(this,os);Me(this,Ml);Me(this,ju);Me(this,ma);Me(this,ri);Me(this,Yf);Me(this,Fu);Me(this,Uu);Me(this,Ol);Me(this,jl);Me(this,pa);Me(this,Vu,new Set);this.options=t,ye(this,Es,e),ye(this,ri,null),ye(this,ma,xE()),this.options.experimental_prefetchInRender||B(this,ma).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(t)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(B(this,st).addObserver(this),GA(B(this,st),this.options)?nt(this,dt,yh).call(this):this.updateResult(),nt(this,dt,bE).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return IE(B(this,st),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return IE(B(this,st),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,nt(this,dt,SE).call(this),nt(this,dt,_E).call(this),B(this,st).removeObserver(this)}setOptions(e,t){const s=this.options,r=B(this,st);if(this.options=B(this,Es).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Mr(this.options.enabled,B(this,st))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");nt(this,dt,AE).call(this),B(this,st).setOptions(this.options),s._defaulted&&!gE(this.options,s)&&B(this,Es).getQueryCache().notify({type:"observerOptionsUpdated",query:B(this,st),observer:this});const i=this.hasListeners();i&&KA(B(this,st),r,this.options,s)&&nt(this,dt,yh).call(this),this.updateResult(t),i&&(B(this,st)!==r||Mr(this.options.enabled,B(this,st))!==Mr(s.enabled,B(this,st))||cu(this.options.staleTime,B(this,st))!==cu(s.staleTime,B(this,st)))&&nt(this,dt,EE).call(this);const o=nt(this,dt,wE).call(this);i&&(B(this,st)!==r||Mr(this.options.enabled,B(this,st))!==Mr(s.enabled,B(this,st))||o!==B(this,pa))&&nt(this,dt,TE).call(this,o)}getOptimisticResult(e){const t=B(this,Es).getQueryCache().build(B(this,Es),e),s=this.createResult(t,e);return C8(this,s)&&(ye(this,os,s),ye(this,ju,this.options),ye(this,Ml,B(this,st).state)),s}getCurrentResult(){return B(this,os)}trackResult(e,t){const s={};return Object.keys(e).forEach(r=>{Object.defineProperty(s,r,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(r),t==null||t(r),e[r])})}),s}trackProp(e){B(this,Vu).add(e)}getCurrentQuery(){return B(this,st)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=B(this,Es).defaultQueryOptions(e),s=B(this,Es).getQueryCache().build(B(this,Es),t);return s.fetch().then(()=>this.createResult(s,t))}fetch(e){return nt(this,dt,yh).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),B(this,os)))}createResult(e,t){var S;const s=B(this,st),r=this.options,i=B(this,os),o=B(this,Ml),a=B(this,ju),c=e!==s?e.state:B(this,qf),{state:d}=e;let h={...d},f=!1,m;if(t._optimisticResults){const I=this.hasListeners(),R=!I&&GA(e,t),N=I&&KA(e,s,t,r);(R||N)&&(h={...h,...UL(d.data,e.options)}),t._optimisticResults==="isRestoring"&&(h.fetchStatus="idle")}let{error:p,errorUpdatedAt:y,status:v}=h;if(t.select&&h.data!==void 0)if(i&&h.data===(o==null?void 0:o.data)&&t.select===B(this,Yf))m=B(this,Fu);else try{ye(this,Yf,t.select),m=t.select(h.data),m=vE(i==null?void 0:i.data,m,t),ye(this,Fu,m),ye(this,ri,null)}catch(I){ye(this,ri,I)}else m=h.data;if(t.placeholderData!==void 0&&m===void 0&&v==="pending"){let I;if(i!=null&&i.isPlaceholderData&&t.placeholderData===(a==null?void 0:a.placeholderData))I=i.data;else if(I=typeof t.placeholderData=="function"?t.placeholderData((S=B(this,Uu))==null?void 0:S.state.data,B(this,Uu)):t.placeholderData,t.select&&I!==void 0)try{I=t.select(I),ye(this,ri,null)}catch(R){ye(this,ri,R)}I!==void 0&&(v="success",m=vE(i==null?void 0:i.data,I,t),f=!0)}B(this,ri)&&(p=B(this,ri),m=B(this,Fu),y=Date.now(),v="error");const x=h.fetchStatus==="fetching",E=v==="pending",w=v==="error",b=E&&x,C=m!==void 0,_={status:v,fetchStatus:h.fetchStatus,isPending:E,isSuccess:v==="success",isError:w,isInitialLoading:b,isLoading:b,data:m,dataUpdatedAt:h.dataUpdatedAt,error:p,errorUpdatedAt:y,failureCount:h.fetchFailureCount,failureReason:h.fetchFailureReason,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>c.dataUpdateCount||h.errorUpdateCount>c.errorUpdateCount,isFetching:x,isRefetching:x&&!E,isLoadingError:w&&!C,isPaused:h.fetchStatus==="paused",isPlaceholderData:f,isRefetchError:w&&C,isStale:db(e,t),refetch:this.refetch,promise:B(this,ma)};if(this.options.experimental_prefetchInRender){const I=L=>{_.status==="error"?L.reject(_.error):_.data!==void 0&&L.resolve(_.data)},R=()=>{const L=ye(this,ma,_.promise=xE());I(L)},N=B(this,ma);switch(N.status){case"pending":e.queryHash===s.queryHash&&I(N);break;case"fulfilled":(_.status==="error"||_.data!==N.value)&&R();break;case"rejected":(_.status!=="error"||_.error!==N.reason)&&R();break}}return _}updateResult(e){const t=B(this,os),s=this.createResult(B(this,st),this.options);if(ye(this,Ml,B(this,st).state),ye(this,ju,this.options),B(this,Ml).data!==void 0&&ye(this,Uu,B(this,st)),gE(s,t))return;ye(this,os,s);const r={},i=()=>{if(!t)return!0;const{notifyOnChangeProps:o}=this.options,a=typeof o=="function"?o():o;if(a==="all"||!a&&!B(this,Vu).size)return!0;const l=new Set(a??B(this,Vu));return this.options.throwOnError&&l.add("error"),Object.keys(B(this,os)).some(c=>{const d=c;return B(this,os)[d]!==t[d]&&l.has(d)})};(e==null?void 0:e.listeners)!==!1&&i()&&(r.listeners=!0),nt(this,dt,$L).call(this,{...r,...e})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&nt(this,dt,bE).call(this)}},Es=new WeakMap,st=new WeakMap,qf=new WeakMap,os=new WeakMap,Ml=new WeakMap,ju=new WeakMap,ma=new WeakMap,ri=new WeakMap,Yf=new WeakMap,Fu=new WeakMap,Uu=new WeakMap,Ol=new WeakMap,jl=new WeakMap,pa=new WeakMap,Vu=new WeakMap,dt=new WeakSet,yh=function(e){nt(this,dt,AE).call(this);let t=B(this,st).fetch(this.options,e);return e!=null&&e.throwOnError||(t=t.catch(ar)),t},EE=function(){nt(this,dt,SE).call(this);const e=cu(this.options.staleTime,B(this,st));if(Kl||B(this,os).isStale||!pE(e))return;const s=NL(B(this,os).dataUpdatedAt,e)+1;ye(this,Ol,setTimeout(()=>{B(this,os).isStale||this.updateResult()},s))},wE=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(B(this,st)):this.options.refetchInterval)??!1},TE=function(e){nt(this,dt,_E).call(this),ye(this,pa,e),!(Kl||Mr(this.options.enabled,B(this,st))===!1||!pE(B(this,pa))||B(this,pa)===0)&&ye(this,jl,setInterval(()=>{(this.options.refetchIntervalInBackground||ub.isFocused())&&nt(this,dt,yh).call(this)},B(this,pa)))},bE=function(){nt(this,dt,EE).call(this),nt(this,dt,TE).call(this,nt(this,dt,wE).call(this))},SE=function(){B(this,Ol)&&(clearTimeout(B(this,Ol)),ye(this,Ol,void 0))},_E=function(){B(this,jl)&&(clearInterval(B(this,jl)),ye(this,jl,void 0))},AE=function(){const e=B(this,Es).getQueryCache().build(B(this,Es),this.options);if(e===B(this,st))return;const t=B(this,st);ye(this,st,e),ye(this,qf,e.state),this.hasListeners()&&(t==null||t.removeObserver(this),e.addObserver(this))},$L=function(e){On.batch(()=>{e.listeners&&this.listeners.forEach(t=>{t(B(this,os))}),B(this,Es).getQueryCache().notify({query:B(this,st),type:"observerResultsUpdated"})})},aL);function R8(n,e){return Mr(e.enabled,n)!==!1&&n.state.data===void 0&&!(n.state.status==="error"&&e.retryOnMount===!1)}function GA(n,e){return R8(n,e)||n.state.data!==void 0&&IE(n,e,e.refetchOnMount)}function IE(n,e,t){if(Mr(e.enabled,n)!==!1){const s=typeof t=="function"?t(n):t;return s==="always"||s!==!1&&db(n,e)}return!1}function KA(n,e,t,s){return(n!==e||Mr(s.enabled,n)===!1)&&(!t.suspense||n.state.status!=="error")&&db(n,t)}function db(n,e){return Mr(e.enabled,n)!==!1&&n.isStaleByTime(cu(e.staleTime,n))}function C8(n,e){return!gE(n.getCurrentResult(),e)}var BL=T.createContext(void 0),P8=n=>{const e=T.useContext(BL);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},GL=({client:n,children:e})=>(T.useEffect(()=>(n.mount(),()=>{n.unmount()}),[n]),u.jsx(BL.Provider,{value:n,children:e})),KL=T.createContext(!1),k8=()=>T.useContext(KL);KL.Provider;function N8(){let n=!1;return{clearReset:()=>{n=!1},reset:()=>{n=!0},isReset:()=>n}}var L8=T.createContext(N8()),D8=()=>T.useContext(L8);function M8(n,e){return typeof n=="function"?n(...e):!!n}function HA(){}var O8=(n,e)=>{(n.suspense||n.throwOnError||n.experimental_prefetchInRender)&&(e.isReset()||(n.retryOnMount=!1))},j8=n=>{T.useEffect(()=>{n.clearReset()},[n])},F8=({result:n,errorResetBoundary:e,throwOnError:t,query:s})=>n.isError&&!e.isReset()&&!n.isFetching&&s&&M8(t,[n.error,s]),U8=n=>{n.suspense&&(n.staleTime===void 0&&(n.staleTime=1e3),typeof n.gcTime=="number"&&(n.gcTime=Math.max(n.gcTime,1e3)))},V8=(n,e)=>n.isLoading&&n.isFetching&&!e,$8=(n,e)=>(n==null?void 0:n.suspense)&&e.isPending,WA=(n,e,t)=>e.fetchOptimistic(n).catch(()=>{t.clearReset()});function B8(n,e,t){var d,h,f,m,p;const s=P8(),r=k8(),i=D8(),o=s.defaultQueryOptions(n);(h=(d=s.getDefaultOptions().queries)==null?void 0:d._experimental_beforeQuery)==null||h.call(d,o),o._optimisticResults=r?"isRestoring":"optimistic",U8(o),O8(o,i),j8(i);const a=!s.getQueryCache().get(o.queryHash),[l]=T.useState(()=>new e(s,o)),c=l.getOptimisticResult(o);if(T.useSyncExternalStore(T.useCallback(y=>{const v=r?HA:l.subscribe(On.batchCalls(y));return l.updateResult(),v},[l,r]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),T.useEffect(()=>{l.setOptions(o,{listeners:!1})},[o,l]),$8(o,c))throw WA(o,l,i);if(F8({result:c,errorResetBoundary:i,throwOnError:o.throwOnError,query:s.getQueryCache().get(o.queryHash)}))throw c.error;if((m=(f=s.getDefaultOptions().queries)==null?void 0:f._experimental_afterQuery)==null||m.call(f,o,c),o.experimental_prefetchInRender&&!Kl&&V8(c,r)){const y=a?WA(o,l,i):(p=s.getQueryCache().get(o.queryHash))==null?void 0:p.promise;y==null||y.catch(HA).finally(()=>{l.updateResult()})}return o.notifyOnChangeProps?c:l.trackResult(c)}function Zn(n,e){return B8(n,I8)}async function G8(n){if(!n.ok){const e=await n.text()||n.statusText;throw new Error(`${n.status}: ${e}`)}}const K8=({on401:n})=>async({queryKey:e})=>{const t=await fetch(e.join("/"),{credentials:"include"});return n==="returnNull"&&t.status===401?null:(await G8(t),await t.json())},H8=new VL({defaultOptions:{queries:{queryFn:K8({on401:"throw"}),refetchInterval:!1,refetchOnWindowFocus:!1,staleTime:1/0,retry:!1},mutations:{retry:!1}}}),W8=1,z8=1e6;let kv=0;function q8(){return kv=(kv+1)%Number.MAX_SAFE_INTEGER,kv.toString()}const Nv=new Map,zA=n=>{if(Nv.has(n))return;const e=setTimeout(()=>{Nv.delete(n),Lh({type:"REMOVE_TOAST",toastId:n})},z8);Nv.set(n,e)},Y8=(n,e)=>{switch(e.type){case"ADD_TOAST":return{...n,toasts:[e.toast,...n.toasts].slice(0,W8)};case"UPDATE_TOAST":return{...n,toasts:n.toasts.map(t=>t.id===e.toast.id?{...t,...e.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=e;return t?zA(t):n.toasts.forEach(s=>{zA(s.id)}),{...n,toasts:n.toasts.map(s=>s.id===t||t===void 0?{...s,open:!1}:s)}}case"REMOVE_TOAST":return e.toastId===void 0?{...n,toasts:[]}:{...n,toasts:n.toasts.filter(t=>t.id!==e.toastId)}}},Bp=[];let Gp={toasts:[]};function Lh(n){Gp=Y8(Gp,n),Bp.forEach(e=>{e(Gp)})}function Q8({...n}){const e=q8(),t=r=>Lh({type:"UPDATE_TOAST",toast:{...r,id:e}}),s=()=>Lh({type:"DISMISS_TOAST",toastId:e});return Lh({type:"ADD_TOAST",toast:{...n,id:e,open:!0,onOpenChange:r=>{r||s()}}}),{id:e,dismiss:s,update:t}}function hb(){const[n,e]=T.useState(Gp);return T.useEffect(()=>(Bp.push(e),()=>{const t=Bp.indexOf(e);t>-1&&Bp.splice(t,1)}),[n]),{...n,toast:Q8,dismiss:t=>Lh({type:"DISMISS_TOAST",toastId:t})}}var HL={exports:{}},nr={},WL={exports:{}},zL={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(j,U){var X=j.length;j.push(U);e:for(;0<X;){var Y=X-1>>>1,J=j[Y];if(0<r(J,U))j[Y]=U,j[X]=J,X=Y;else break e}}function t(j){return j.length===0?null:j[0]}function s(j){if(j.length===0)return null;var U=j[0],X=j.pop();if(X!==U){j[0]=X;e:for(var Y=0,J=j.length,ae=J>>>1;Y<ae;){var he=2*(Y+1)-1,ve=j[he],ge=he+1,re=j[ge];if(0>r(ve,X))ge<J&&0>r(re,ve)?(j[Y]=re,j[ge]=X,Y=ge):(j[Y]=ve,j[he]=X,Y=he);else if(ge<J&&0>r(re,X))j[Y]=re,j[ge]=X,Y=ge;else break e}}return U}function r(j,U){var X=j.sortIndex-U.sortIndex;return X!==0?X:j.id-U.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],c=[],d=1,h=null,f=3,m=!1,p=!1,y=!1,v=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,E=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(j){for(var U=t(c);U!==null;){if(U.callback===null)s(c);else if(U.startTime<=j)s(c),U.sortIndex=U.expirationTime,e(l,U);else break;U=t(c)}}function b(j){if(y=!1,w(j),!p)if(t(l)!==null)p=!0,$(C);else{var U=t(c);U!==null&&F(b,U.startTime-j)}}function C(j,U){p=!1,y&&(y=!1,x(S),S=-1),m=!0;var X=f;try{for(w(U),h=t(l);h!==null&&(!(h.expirationTime>U)||j&&!N());){var Y=h.callback;if(typeof Y=="function"){h.callback=null,f=h.priorityLevel;var J=Y(h.expirationTime<=U);U=n.unstable_now(),typeof J=="function"?h.callback=J:h===t(l)&&s(l),w(U)}else s(l);h=t(l)}if(h!==null)var ae=!0;else{var he=t(c);he!==null&&F(b,he.startTime-U),ae=!1}return ae}finally{h=null,f=X,m=!1}}var D=!1,_=null,S=-1,I=5,R=-1;function N(){return!(n.unstable_now()-R<I)}function L(){if(_!==null){var j=n.unstable_now();R=j;var U=!0;try{U=_(!0,j)}finally{U?M():(D=!1,_=null)}}else D=!1}var M;if(typeof E=="function")M=function(){E(L)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,V=G.port2;G.port1.onmessage=L,M=function(){V.postMessage(null)}}else M=function(){v(L,0)};function $(j){_=j,D||(D=!0,M())}function F(j,U){S=v(function(){j(n.unstable_now())},U)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(j){j.callback=null},n.unstable_continueExecution=function(){p||m||(p=!0,$(C))},n.unstable_forceFrameRate=function(j){0>j||125<j?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<j?Math.floor(1e3/j):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(j){switch(f){case 1:case 2:case 3:var U=3;break;default:U=f}var X=f;f=U;try{return j()}finally{f=X}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(j,U){switch(j){case 1:case 2:case 3:case 4:case 5:break;default:j=3}var X=f;f=j;try{return U()}finally{f=X}},n.unstable_scheduleCallback=function(j,U,X){var Y=n.unstable_now();switch(typeof X=="object"&&X!==null?(X=X.delay,X=typeof X=="number"&&0<X?Y+X:Y):X=Y,j){case 1:var J=-1;break;case 2:J=250;break;case 5:J=1073741823;break;case 4:J=1e4;break;default:J=5e3}return J=X+J,j={id:d++,callback:U,priorityLevel:j,startTime:X,expirationTime:J,sortIndex:-1},X>Y?(j.sortIndex=X,e(c,j),t(l)===null&&j===t(c)&&(y?(x(S),S=-1):y=!0,F(b,X-Y))):(j.sortIndex=J,e(l,j),p||m||(p=!0,$(C))),j},n.unstable_shouldYield=N,n.unstable_wrapCallback=function(j){var U=f;return function(){var X=f;f=U;try{return j.apply(this,arguments)}finally{f=X}}}})(zL);WL.exports=zL;var X8=WL.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var J8=T,er=X8;function se(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var qL=new Set,sf={};function oc(n,e){Bu(n,e),Bu(n+"Capture",e)}function Bu(n,e){for(sf[n]=e,n=0;n<e.length;n++)qL.add(e[n])}var oo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),RE=Object.prototype.hasOwnProperty,Z8=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,qA={},YA={};function e9(n){return RE.call(YA,n)?!0:RE.call(qA,n)?!1:Z8.test(n)?YA[n]=!0:(qA[n]=!0,!1)}function t9(n,e,t,s){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function n9(n,e,t,s){if(e===null||typeof e>"u"||t9(n,e,t,s))return!0;if(s)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ps(n,e,t,s,r,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var $n={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){$n[n]=new ps(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];$n[e]=new ps(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){$n[n]=new ps(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){$n[n]=new ps(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){$n[n]=new ps(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){$n[n]=new ps(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){$n[n]=new ps(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){$n[n]=new ps(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){$n[n]=new ps(n,5,!1,n.toLowerCase(),null,!1,!1)});var fb=/[\-:]([a-z])/g;function mb(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(fb,mb);$n[e]=new ps(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(fb,mb);$n[e]=new ps(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(fb,mb);$n[e]=new ps(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){$n[n]=new ps(n,1,!1,n.toLowerCase(),null,!1,!1)});$n.xlinkHref=new ps("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){$n[n]=new ps(n,1,!1,n.toLowerCase(),null,!0,!0)});function pb(n,e,t,s){var r=$n.hasOwnProperty(e)?$n[e]:null;(r!==null?r.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(n9(e,t,r,s)&&(t=null),s||r===null?e9(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):r.mustUseProperty?n[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,s=r.attributeNamespace,t===null?n.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,s?n.setAttributeNS(s,e,t):n.setAttribute(e,t))))}var To=J8.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Km=Symbol.for("react.element"),Kc=Symbol.for("react.portal"),Hc=Symbol.for("react.fragment"),gb=Symbol.for("react.strict_mode"),CE=Symbol.for("react.profiler"),YL=Symbol.for("react.provider"),QL=Symbol.for("react.context"),yb=Symbol.for("react.forward_ref"),PE=Symbol.for("react.suspense"),kE=Symbol.for("react.suspense_list"),vb=Symbol.for("react.memo"),Xo=Symbol.for("react.lazy"),XL=Symbol.for("react.offscreen"),QA=Symbol.iterator;function sh(n){return n===null||typeof n!="object"?null:(n=QA&&n[QA]||n["@@iterator"],typeof n=="function"?n:null)}var $t=Object.assign,Lv;function vh(n){if(Lv===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Lv=e&&e[1]||""}return`
`+Lv+n}var Dv=!1;function Mv(n,e){if(!n||Dv)return"";Dv=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var s=c}Reflect.construct(n,[],e)}else{try{e.call()}catch(c){s=c}n.call(e.prototype)}else{try{throw Error()}catch(c){s=c}n()}}catch(c){if(c&&s&&typeof c.stack=="string"){for(var r=c.stack.split(`
`),i=s.stack.split(`
`),o=r.length-1,a=i.length-1;1<=o&&0<=a&&r[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==i[a]){var l=`
`+r[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{Dv=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?vh(n):""}function s9(n){switch(n.tag){case 5:return vh(n.type);case 16:return vh("Lazy");case 13:return vh("Suspense");case 19:return vh("SuspenseList");case 0:case 2:case 15:return n=Mv(n.type,!1),n;case 11:return n=Mv(n.type.render,!1),n;case 1:return n=Mv(n.type,!0),n;default:return""}}function NE(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Hc:return"Fragment";case Kc:return"Portal";case CE:return"Profiler";case gb:return"StrictMode";case PE:return"Suspense";case kE:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case QL:return(n.displayName||"Context")+".Consumer";case YL:return(n._context.displayName||"Context")+".Provider";case yb:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case vb:return e=n.displayName||null,e!==null?e:NE(n.type)||"Memo";case Xo:e=n._payload,n=n._init;try{return NE(n(e))}catch{}}return null}function r9(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return NE(e);case 8:return e===gb?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ma(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function JL(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function i9(n){var e=JL(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),s=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){s=""+o,i.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return s},setValue:function(o){s=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Hm(n){n._valueTracker||(n._valueTracker=i9(n))}function ZL(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),s="";return n&&(s=JL(n)?n.checked?"true":"false":n.value),n=s,n!==t?(e.setValue(n),!0):!1}function Ig(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function LE(n,e){var t=e.checked;return $t({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function XA(n,e){var t=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;t=Ma(e.value!=null?e.value:t),n._wrapperState={initialChecked:s,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function eD(n,e){e=e.checked,e!=null&&pb(n,"checked",e,!1)}function DE(n,e){eD(n,e);var t=Ma(e.value),s=e.type;if(t!=null)s==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(s==="submit"||s==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?ME(n,e.type,t):e.hasOwnProperty("defaultValue")&&ME(n,e.type,Ma(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function JA(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function ME(n,e,t){(e!=="number"||Ig(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var xh=Array.isArray;function uu(n,e,t,s){if(n=n.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<n.length;t++)r=e.hasOwnProperty("$"+n[t].value),n[t].selected!==r&&(n[t].selected=r),r&&s&&(n[t].defaultSelected=!0)}else{for(t=""+Ma(t),e=null,r=0;r<n.length;r++){if(n[r].value===t){n[r].selected=!0,s&&(n[r].defaultSelected=!0);return}e!==null||n[r].disabled||(e=n[r])}e!==null&&(e.selected=!0)}}function OE(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(se(91));return $t({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function ZA(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(se(92));if(xh(t)){if(1<t.length)throw Error(se(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Ma(t)}}function tD(n,e){var t=Ma(e.value),s=Ma(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),s!=null&&(n.defaultValue=""+s)}function eI(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function nD(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function jE(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?nD(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Wm,sD=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,s,r){MSApp.execUnsafeLocalFunction(function(){return n(e,t,s,r)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(Wm=Wm||document.createElement("div"),Wm.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Wm.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function rf(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Dh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},o9=["Webkit","ms","Moz","O"];Object.keys(Dh).forEach(function(n){o9.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Dh[e]=Dh[n]})});function rD(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Dh.hasOwnProperty(n)&&Dh[n]?(""+e).trim():e+"px"}function iD(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var s=t.indexOf("--")===0,r=rD(t,e[t],s);t==="float"&&(t="cssFloat"),s?n.setProperty(t,r):n[t]=r}}var a9=$t({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function FE(n,e){if(e){if(a9[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(se(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(se(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(se(61))}if(e.style!=null&&typeof e.style!="object")throw Error(se(62))}}function UE(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var VE=null;function xb(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var $E=null,du=null,hu=null;function tI(n){if(n=em(n)){if(typeof $E!="function")throw Error(se(280));var e=n.stateNode;e&&(e=ey(e),$E(n.stateNode,n.type,e))}}function oD(n){du?hu?hu.push(n):hu=[n]:du=n}function aD(){if(du){var n=du,e=hu;if(hu=du=null,tI(n),e)for(n=0;n<e.length;n++)tI(e[n])}}function lD(n,e){return n(e)}function cD(){}var Ov=!1;function uD(n,e,t){if(Ov)return n(e,t);Ov=!0;try{return lD(n,e,t)}finally{Ov=!1,(du!==null||hu!==null)&&(cD(),aD())}}function of(n,e){var t=n.stateNode;if(t===null)return null;var s=ey(t);if(s===null)return null;t=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(n=n.type,s=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!s;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(se(231,e,typeof t));return t}var BE=!1;if(oo)try{var rh={};Object.defineProperty(rh,"passive",{get:function(){BE=!0}}),window.addEventListener("test",rh,rh),window.removeEventListener("test",rh,rh)}catch{BE=!1}function l9(n,e,t,s,r,i,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(d){this.onError(d)}}var Mh=!1,Rg=null,Cg=!1,GE=null,c9={onError:function(n){Mh=!0,Rg=n}};function u9(n,e,t,s,r,i,o,a,l){Mh=!1,Rg=null,l9.apply(c9,arguments)}function d9(n,e,t,s,r,i,o,a,l){if(u9.apply(this,arguments),Mh){if(Mh){var c=Rg;Mh=!1,Rg=null}else throw Error(se(198));Cg||(Cg=!0,GE=c)}}function ac(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function dD(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function nI(n){if(ac(n)!==n)throw Error(se(188))}function h9(n){var e=n.alternate;if(!e){if(e=ac(n),e===null)throw Error(se(188));return e!==n?null:n}for(var t=n,s=e;;){var r=t.return;if(r===null)break;var i=r.alternate;if(i===null){if(s=r.return,s!==null){t=s;continue}break}if(r.child===i.child){for(i=r.child;i;){if(i===t)return nI(r),n;if(i===s)return nI(r),e;i=i.sibling}throw Error(se(188))}if(t.return!==s.return)t=r,s=i;else{for(var o=!1,a=r.child;a;){if(a===t){o=!0,t=r,s=i;break}if(a===s){o=!0,s=r,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,s=r;break}if(a===s){o=!0,s=i,t=r;break}a=a.sibling}if(!o)throw Error(se(189))}}if(t.alternate!==s)throw Error(se(190))}if(t.tag!==3)throw Error(se(188));return t.stateNode.current===t?n:e}function hD(n){return n=h9(n),n!==null?fD(n):null}function fD(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=fD(n);if(e!==null)return e;n=n.sibling}return null}var mD=er.unstable_scheduleCallback,sI=er.unstable_cancelCallback,f9=er.unstable_shouldYield,m9=er.unstable_requestPaint,nn=er.unstable_now,p9=er.unstable_getCurrentPriorityLevel,Eb=er.unstable_ImmediatePriority,pD=er.unstable_UserBlockingPriority,Pg=er.unstable_NormalPriority,g9=er.unstable_LowPriority,gD=er.unstable_IdlePriority,Q0=null,di=null;function y9(n){if(di&&typeof di.onCommitFiberRoot=="function")try{di.onCommitFiberRoot(Q0,n,void 0,(n.current.flags&128)===128)}catch{}}var Fr=Math.clz32?Math.clz32:E9,v9=Math.log,x9=Math.LN2;function E9(n){return n>>>=0,n===0?32:31-(v9(n)/x9|0)|0}var zm=64,qm=4194304;function Eh(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function kg(n,e){var t=n.pendingLanes;if(t===0)return 0;var s=0,r=n.suspendedLanes,i=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~r;a!==0?s=Eh(a):(i&=o,i!==0&&(s=Eh(i)))}else o=t&~r,o!==0?s=Eh(o):i!==0&&(s=Eh(i));if(s===0)return 0;if(e!==0&&e!==s&&!(e&r)&&(r=s&-s,i=e&-e,r>=i||r===16&&(i&4194240)!==0))return e;if(s&4&&(s|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=s;0<e;)t=31-Fr(e),r=1<<t,s|=n[t],e&=~r;return s}function w9(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function T9(n,e){for(var t=n.suspendedLanes,s=n.pingedLanes,r=n.expirationTimes,i=n.pendingLanes;0<i;){var o=31-Fr(i),a=1<<o,l=r[o];l===-1?(!(a&t)||a&s)&&(r[o]=w9(a,e)):l<=e&&(n.expiredLanes|=a),i&=~a}}function KE(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function yD(){var n=zm;return zm<<=1,!(zm&4194240)&&(zm=64),n}function jv(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Jf(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Fr(e),n[e]=t}function b9(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var s=n.eventTimes;for(n=n.expirationTimes;0<t;){var r=31-Fr(t),i=1<<r;e[r]=0,s[r]=-1,n[r]=-1,t&=~i}}function wb(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var s=31-Fr(t),r=1<<s;r&e|n[s]&e&&(n[s]|=e),t&=~r}}var pt=0;function vD(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var xD,Tb,ED,wD,TD,HE=!1,Ym=[],xa=null,Ea=null,wa=null,af=new Map,lf=new Map,ra=[],S9="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function rI(n,e){switch(n){case"focusin":case"focusout":xa=null;break;case"dragenter":case"dragleave":Ea=null;break;case"mouseover":case"mouseout":wa=null;break;case"pointerover":case"pointerout":af.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":lf.delete(e.pointerId)}}function ih(n,e,t,s,r,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:s,nativeEvent:i,targetContainers:[r]},e!==null&&(e=em(e),e!==null&&Tb(e)),n):(n.eventSystemFlags|=s,e=n.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),n)}function _9(n,e,t,s,r){switch(e){case"focusin":return xa=ih(xa,n,e,t,s,r),!0;case"dragenter":return Ea=ih(Ea,n,e,t,s,r),!0;case"mouseover":return wa=ih(wa,n,e,t,s,r),!0;case"pointerover":var i=r.pointerId;return af.set(i,ih(af.get(i)||null,n,e,t,s,r)),!0;case"gotpointercapture":return i=r.pointerId,lf.set(i,ih(lf.get(i)||null,n,e,t,s,r)),!0}return!1}function bD(n){var e=bl(n.target);if(e!==null){var t=ac(e);if(t!==null){if(e=t.tag,e===13){if(e=dD(t),e!==null){n.blockedOn=e,TD(n.priority,function(){ED(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Kp(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=WE(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var s=new t.constructor(t.type,t);VE=s,t.target.dispatchEvent(s),VE=null}else return e=em(t),e!==null&&Tb(e),n.blockedOn=t,!1;e.shift()}return!0}function iI(n,e,t){Kp(n)&&t.delete(e)}function A9(){HE=!1,xa!==null&&Kp(xa)&&(xa=null),Ea!==null&&Kp(Ea)&&(Ea=null),wa!==null&&Kp(wa)&&(wa=null),af.forEach(iI),lf.forEach(iI)}function oh(n,e){n.blockedOn===e&&(n.blockedOn=null,HE||(HE=!0,er.unstable_scheduleCallback(er.unstable_NormalPriority,A9)))}function cf(n){function e(r){return oh(r,n)}if(0<Ym.length){oh(Ym[0],n);for(var t=1;t<Ym.length;t++){var s=Ym[t];s.blockedOn===n&&(s.blockedOn=null)}}for(xa!==null&&oh(xa,n),Ea!==null&&oh(Ea,n),wa!==null&&oh(wa,n),af.forEach(e),lf.forEach(e),t=0;t<ra.length;t++)s=ra[t],s.blockedOn===n&&(s.blockedOn=null);for(;0<ra.length&&(t=ra[0],t.blockedOn===null);)bD(t),t.blockedOn===null&&ra.shift()}var fu=To.ReactCurrentBatchConfig,Ng=!0;function I9(n,e,t,s){var r=pt,i=fu.transition;fu.transition=null;try{pt=1,bb(n,e,t,s)}finally{pt=r,fu.transition=i}}function R9(n,e,t,s){var r=pt,i=fu.transition;fu.transition=null;try{pt=4,bb(n,e,t,s)}finally{pt=r,fu.transition=i}}function bb(n,e,t,s){if(Ng){var r=WE(n,e,t,s);if(r===null)zv(n,e,s,Lg,t),rI(n,s);else if(_9(r,n,e,t,s))s.stopPropagation();else if(rI(n,s),e&4&&-1<S9.indexOf(n)){for(;r!==null;){var i=em(r);if(i!==null&&xD(i),i=WE(n,e,t,s),i===null&&zv(n,e,s,Lg,t),i===r)break;r=i}r!==null&&s.stopPropagation()}else zv(n,e,s,null,t)}}var Lg=null;function WE(n,e,t,s){if(Lg=null,n=xb(s),n=bl(n),n!==null)if(e=ac(n),e===null)n=null;else if(t=e.tag,t===13){if(n=dD(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Lg=n,null}function SD(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(p9()){case Eb:return 1;case pD:return 4;case Pg:case g9:return 16;case gD:return 536870912;default:return 16}default:return 16}}var ga=null,Sb=null,Hp=null;function _D(){if(Hp)return Hp;var n,e=Sb,t=e.length,s,r="value"in ga?ga.value:ga.textContent,i=r.length;for(n=0;n<t&&e[n]===r[n];n++);var o=t-n;for(s=1;s<=o&&e[t-s]===r[i-s];s++);return Hp=r.slice(n,1<s?1-s:void 0)}function Wp(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Qm(){return!0}function oI(){return!1}function sr(n){function e(t,s,r,i,o){this._reactName=t,this._targetInst=r,this.type=s,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Qm:oI,this.isPropagationStopped=oI,this}return $t(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Qm)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Qm)},persist:function(){},isPersistent:Qm}),e}var gd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},_b=sr(gd),Zf=$t({},gd,{view:0,detail:0}),C9=sr(Zf),Fv,Uv,ah,X0=$t({},Zf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ab,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==ah&&(ah&&n.type==="mousemove"?(Fv=n.screenX-ah.screenX,Uv=n.screenY-ah.screenY):Uv=Fv=0,ah=n),Fv)},movementY:function(n){return"movementY"in n?n.movementY:Uv}}),aI=sr(X0),P9=$t({},X0,{dataTransfer:0}),k9=sr(P9),N9=$t({},Zf,{relatedTarget:0}),Vv=sr(N9),L9=$t({},gd,{animationName:0,elapsedTime:0,pseudoElement:0}),D9=sr(L9),M9=$t({},gd,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),O9=sr(M9),j9=$t({},gd,{data:0}),lI=sr(j9),F9={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},U9={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},V9={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $9(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=V9[n])?!!e[n]:!1}function Ab(){return $9}var B9=$t({},Zf,{key:function(n){if(n.key){var e=F9[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Wp(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?U9[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ab,charCode:function(n){return n.type==="keypress"?Wp(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Wp(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),G9=sr(B9),K9=$t({},X0,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cI=sr(K9),H9=$t({},Zf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ab}),W9=sr(H9),z9=$t({},gd,{propertyName:0,elapsedTime:0,pseudoElement:0}),q9=sr(z9),Y9=$t({},X0,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Q9=sr(Y9),X9=[9,13,27,32],Ib=oo&&"CompositionEvent"in window,Oh=null;oo&&"documentMode"in document&&(Oh=document.documentMode);var J9=oo&&"TextEvent"in window&&!Oh,AD=oo&&(!Ib||Oh&&8<Oh&&11>=Oh),uI=" ",dI=!1;function ID(n,e){switch(n){case"keyup":return X9.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function RD(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Wc=!1;function Z9(n,e){switch(n){case"compositionend":return RD(e);case"keypress":return e.which!==32?null:(dI=!0,uI);case"textInput":return n=e.data,n===uI&&dI?null:n;default:return null}}function e7(n,e){if(Wc)return n==="compositionend"||!Ib&&ID(n,e)?(n=_D(),Hp=Sb=ga=null,Wc=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return AD&&e.locale!=="ko"?null:e.data;default:return null}}var t7={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function hI(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!t7[n.type]:e==="textarea"}function CD(n,e,t,s){oD(s),e=Dg(e,"onChange"),0<e.length&&(t=new _b("onChange","change",null,t,s),n.push({event:t,listeners:e}))}var jh=null,uf=null;function n7(n){VD(n,0)}function J0(n){var e=Yc(n);if(ZL(e))return n}function s7(n,e){if(n==="change")return e}var PD=!1;if(oo){var $v;if(oo){var Bv="oninput"in document;if(!Bv){var fI=document.createElement("div");fI.setAttribute("oninput","return;"),Bv=typeof fI.oninput=="function"}$v=Bv}else $v=!1;PD=$v&&(!document.documentMode||9<document.documentMode)}function mI(){jh&&(jh.detachEvent("onpropertychange",kD),uf=jh=null)}function kD(n){if(n.propertyName==="value"&&J0(uf)){var e=[];CD(e,uf,n,xb(n)),uD(n7,e)}}function r7(n,e,t){n==="focusin"?(mI(),jh=e,uf=t,jh.attachEvent("onpropertychange",kD)):n==="focusout"&&mI()}function i7(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return J0(uf)}function o7(n,e){if(n==="click")return J0(e)}function a7(n,e){if(n==="input"||n==="change")return J0(e)}function l7(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var $r=typeof Object.is=="function"?Object.is:l7;function df(n,e){if($r(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),s=Object.keys(e);if(t.length!==s.length)return!1;for(s=0;s<t.length;s++){var r=t[s];if(!RE.call(e,r)||!$r(n[r],e[r]))return!1}return!0}function pI(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function gI(n,e){var t=pI(n);n=0;for(var s;t;){if(t.nodeType===3){if(s=n+t.textContent.length,n<=e&&s>=e)return{node:t,offset:e-n};n=s}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=pI(t)}}function ND(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?ND(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function LD(){for(var n=window,e=Ig();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=Ig(n.document)}return e}function Rb(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function c7(n){var e=LD(),t=n.focusedElem,s=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&ND(t.ownerDocument.documentElement,t)){if(s!==null&&Rb(t)){if(e=s.start,n=s.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var r=t.textContent.length,i=Math.min(s.start,r);s=s.end===void 0?i:Math.min(s.end,r),!n.extend&&i>s&&(r=s,s=i,i=r),r=gI(t,i);var o=gI(t,s);r&&o&&(n.rangeCount!==1||n.anchorNode!==r.node||n.anchorOffset!==r.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),n.removeAllRanges(),i>s?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var u7=oo&&"documentMode"in document&&11>=document.documentMode,zc=null,zE=null,Fh=null,qE=!1;function yI(n,e,t){var s=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;qE||zc==null||zc!==Ig(s)||(s=zc,"selectionStart"in s&&Rb(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Fh&&df(Fh,s)||(Fh=s,s=Dg(zE,"onSelect"),0<s.length&&(e=new _b("onSelect","select",null,e,t),n.push({event:e,listeners:s}),e.target=zc)))}function Xm(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var qc={animationend:Xm("Animation","AnimationEnd"),animationiteration:Xm("Animation","AnimationIteration"),animationstart:Xm("Animation","AnimationStart"),transitionend:Xm("Transition","TransitionEnd")},Gv={},DD={};oo&&(DD=document.createElement("div").style,"AnimationEvent"in window||(delete qc.animationend.animation,delete qc.animationiteration.animation,delete qc.animationstart.animation),"TransitionEvent"in window||delete qc.transitionend.transition);function Z0(n){if(Gv[n])return Gv[n];if(!qc[n])return n;var e=qc[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in DD)return Gv[n]=e[t];return n}var MD=Z0("animationend"),OD=Z0("animationiteration"),jD=Z0("animationstart"),FD=Z0("transitionend"),UD=new Map,vI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Xa(n,e){UD.set(n,e),oc(e,[n])}for(var Kv=0;Kv<vI.length;Kv++){var Hv=vI[Kv],d7=Hv.toLowerCase(),h7=Hv[0].toUpperCase()+Hv.slice(1);Xa(d7,"on"+h7)}Xa(MD,"onAnimationEnd");Xa(OD,"onAnimationIteration");Xa(jD,"onAnimationStart");Xa("dblclick","onDoubleClick");Xa("focusin","onFocus");Xa("focusout","onBlur");Xa(FD,"onTransitionEnd");Bu("onMouseEnter",["mouseout","mouseover"]);Bu("onMouseLeave",["mouseout","mouseover"]);Bu("onPointerEnter",["pointerout","pointerover"]);Bu("onPointerLeave",["pointerout","pointerover"]);oc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));oc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));oc("onBeforeInput",["compositionend","keypress","textInput","paste"]);oc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));oc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));oc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),f7=new Set("cancel close invalid load scroll toggle".split(" ").concat(wh));function xI(n,e,t){var s=n.type||"unknown-event";n.currentTarget=t,d9(s,e,void 0,n),n.currentTarget=null}function VD(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var s=n[t],r=s.event;s=s.listeners;e:{var i=void 0;if(e)for(var o=s.length-1;0<=o;o--){var a=s[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==i&&r.isPropagationStopped())break e;xI(r,a,c),i=l}else for(o=0;o<s.length;o++){if(a=s[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==i&&r.isPropagationStopped())break e;xI(r,a,c),i=l}}}if(Cg)throw n=GE,Cg=!1,GE=null,n}function Ct(n,e){var t=e[ZE];t===void 0&&(t=e[ZE]=new Set);var s=n+"__bubble";t.has(s)||($D(e,n,2,!1),t.add(s))}function Wv(n,e,t){var s=0;e&&(s|=4),$D(t,n,s,e)}var Jm="_reactListening"+Math.random().toString(36).slice(2);function hf(n){if(!n[Jm]){n[Jm]=!0,qL.forEach(function(t){t!=="selectionchange"&&(f7.has(t)||Wv(t,!1,n),Wv(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Jm]||(e[Jm]=!0,Wv("selectionchange",!1,e))}}function $D(n,e,t,s){switch(SD(e)){case 1:var r=I9;break;case 4:r=R9;break;default:r=bb}t=r.bind(null,e,t,n),r=void 0,!BE||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),s?r!==void 0?n.addEventListener(e,t,{capture:!0,passive:r}):n.addEventListener(e,t,!0):r!==void 0?n.addEventListener(e,t,{passive:r}):n.addEventListener(e,t,!1)}function zv(n,e,t,s,r){var i=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var o=s.tag;if(o===3||o===4){var a=s.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=s.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=bl(a),o===null)return;if(l=o.tag,l===5||l===6){s=i=o;continue e}a=a.parentNode}}s=s.return}uD(function(){var c=i,d=xb(t),h=[];e:{var f=UD.get(n);if(f!==void 0){var m=_b,p=n;switch(n){case"keypress":if(Wp(t)===0)break e;case"keydown":case"keyup":m=G9;break;case"focusin":p="focus",m=Vv;break;case"focusout":p="blur",m=Vv;break;case"beforeblur":case"afterblur":m=Vv;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=aI;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=k9;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=W9;break;case MD:case OD:case jD:m=D9;break;case FD:m=q9;break;case"scroll":m=C9;break;case"wheel":m=Q9;break;case"copy":case"cut":case"paste":m=O9;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=cI}var y=(e&4)!==0,v=!y&&n==="scroll",x=y?f!==null?f+"Capture":null:f;y=[];for(var E=c,w;E!==null;){w=E;var b=w.stateNode;if(w.tag===5&&b!==null&&(w=b,x!==null&&(b=of(E,x),b!=null&&y.push(ff(E,b,w)))),v)break;E=E.return}0<y.length&&(f=new m(f,p,null,t,d),h.push({event:f,listeners:y}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",m=n==="mouseout"||n==="pointerout",f&&t!==VE&&(p=t.relatedTarget||t.fromElement)&&(bl(p)||p[ao]))break e;if((m||f)&&(f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window,m?(p=t.relatedTarget||t.toElement,m=c,p=p?bl(p):null,p!==null&&(v=ac(p),p!==v||p.tag!==5&&p.tag!==6)&&(p=null)):(m=null,p=c),m!==p)){if(y=aI,b="onMouseLeave",x="onMouseEnter",E="mouse",(n==="pointerout"||n==="pointerover")&&(y=cI,b="onPointerLeave",x="onPointerEnter",E="pointer"),v=m==null?f:Yc(m),w=p==null?f:Yc(p),f=new y(b,E+"leave",m,t,d),f.target=v,f.relatedTarget=w,b=null,bl(d)===c&&(y=new y(x,E+"enter",p,t,d),y.target=w,y.relatedTarget=v,b=y),v=b,m&&p)t:{for(y=m,x=p,E=0,w=y;w;w=Cc(w))E++;for(w=0,b=x;b;b=Cc(b))w++;for(;0<E-w;)y=Cc(y),E--;for(;0<w-E;)x=Cc(x),w--;for(;E--;){if(y===x||x!==null&&y===x.alternate)break t;y=Cc(y),x=Cc(x)}y=null}else y=null;m!==null&&EI(h,f,m,y,!1),p!==null&&v!==null&&EI(h,v,p,y,!0)}}e:{if(f=c?Yc(c):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var C=s7;else if(hI(f))if(PD)C=a7;else{C=i7;var D=r7}else(m=f.nodeName)&&m.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(C=o7);if(C&&(C=C(n,c))){CD(h,C,t,d);break e}D&&D(n,f,c),n==="focusout"&&(D=f._wrapperState)&&D.controlled&&f.type==="number"&&ME(f,"number",f.value)}switch(D=c?Yc(c):window,n){case"focusin":(hI(D)||D.contentEditable==="true")&&(zc=D,zE=c,Fh=null);break;case"focusout":Fh=zE=zc=null;break;case"mousedown":qE=!0;break;case"contextmenu":case"mouseup":case"dragend":qE=!1,yI(h,t,d);break;case"selectionchange":if(u7)break;case"keydown":case"keyup":yI(h,t,d)}var _;if(Ib)e:{switch(n){case"compositionstart":var S="onCompositionStart";break e;case"compositionend":S="onCompositionEnd";break e;case"compositionupdate":S="onCompositionUpdate";break e}S=void 0}else Wc?ID(n,t)&&(S="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(S="onCompositionStart");S&&(AD&&t.locale!=="ko"&&(Wc||S!=="onCompositionStart"?S==="onCompositionEnd"&&Wc&&(_=_D()):(ga=d,Sb="value"in ga?ga.value:ga.textContent,Wc=!0)),D=Dg(c,S),0<D.length&&(S=new lI(S,n,null,t,d),h.push({event:S,listeners:D}),_?S.data=_:(_=RD(t),_!==null&&(S.data=_)))),(_=J9?Z9(n,t):e7(n,t))&&(c=Dg(c,"onBeforeInput"),0<c.length&&(d=new lI("onBeforeInput","beforeinput",null,t,d),h.push({event:d,listeners:c}),d.data=_))}VD(h,e)})}function ff(n,e,t){return{instance:n,listener:e,currentTarget:t}}function Dg(n,e){for(var t=e+"Capture",s=[];n!==null;){var r=n,i=r.stateNode;r.tag===5&&i!==null&&(r=i,i=of(n,t),i!=null&&s.unshift(ff(n,i,r)),i=of(n,e),i!=null&&s.push(ff(n,i,r))),n=n.return}return s}function Cc(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function EI(n,e,t,s,r){for(var i=e._reactName,o=[];t!==null&&t!==s;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===s)break;a.tag===5&&c!==null&&(a=c,r?(l=of(t,i),l!=null&&o.unshift(ff(t,l,a))):r||(l=of(t,i),l!=null&&o.push(ff(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var m7=/\r\n?/g,p7=/\u0000|\uFFFD/g;function wI(n){return(typeof n=="string"?n:""+n).replace(m7,`
`).replace(p7,"")}function Zm(n,e,t){if(e=wI(e),wI(n)!==e&&t)throw Error(se(425))}function Mg(){}var YE=null,QE=null;function XE(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var JE=typeof setTimeout=="function"?setTimeout:void 0,g7=typeof clearTimeout=="function"?clearTimeout:void 0,TI=typeof Promise=="function"?Promise:void 0,y7=typeof queueMicrotask=="function"?queueMicrotask:typeof TI<"u"?function(n){return TI.resolve(null).then(n).catch(v7)}:JE;function v7(n){setTimeout(function(){throw n})}function qv(n,e){var t=e,s=0;do{var r=t.nextSibling;if(n.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(s===0){n.removeChild(r),cf(e);return}s--}else t!=="$"&&t!=="$?"&&t!=="$!"||s++;t=r}while(t);cf(e)}function Ta(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function bI(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var yd=Math.random().toString(36).slice(2),oi="__reactFiber$"+yd,mf="__reactProps$"+yd,ao="__reactContainer$"+yd,ZE="__reactEvents$"+yd,x7="__reactListeners$"+yd,E7="__reactHandles$"+yd;function bl(n){var e=n[oi];if(e)return e;for(var t=n.parentNode;t;){if(e=t[ao]||t[oi]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=bI(n);n!==null;){if(t=n[oi])return t;n=bI(n)}return e}n=t,t=n.parentNode}return null}function em(n){return n=n[oi]||n[ao],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Yc(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(se(33))}function ey(n){return n[mf]||null}var ew=[],Qc=-1;function Ja(n){return{current:n}}function kt(n){0>Qc||(n.current=ew[Qc],ew[Qc]=null,Qc--)}function At(n,e){Qc++,ew[Qc]=n.current,n.current=e}var Oa={},ns=Ja(Oa),As=Ja(!1),Hl=Oa;function Gu(n,e){var t=n.type.contextTypes;if(!t)return Oa;var s=n.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var r={},i;for(i in t)r[i]=e[i];return s&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=r),r}function Is(n){return n=n.childContextTypes,n!=null}function Og(){kt(As),kt(ns)}function SI(n,e,t){if(ns.current!==Oa)throw Error(se(168));At(ns,e),At(As,t)}function BD(n,e,t){var s=n.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return t;s=s.getChildContext();for(var r in s)if(!(r in e))throw Error(se(108,r9(n)||"Unknown",r));return $t({},t,s)}function jg(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Oa,Hl=ns.current,At(ns,n),At(As,As.current),!0}function _I(n,e,t){var s=n.stateNode;if(!s)throw Error(se(169));t?(n=BD(n,e,Hl),s.__reactInternalMemoizedMergedChildContext=n,kt(As),kt(ns),At(ns,n)):kt(As),At(As,t)}var Wi=null,ty=!1,Yv=!1;function GD(n){Wi===null?Wi=[n]:Wi.push(n)}function w7(n){ty=!0,GD(n)}function Za(){if(!Yv&&Wi!==null){Yv=!0;var n=0,e=pt;try{var t=Wi;for(pt=1;n<t.length;n++){var s=t[n];do s=s(!0);while(s!==null)}Wi=null,ty=!1}catch(r){throw Wi!==null&&(Wi=Wi.slice(n+1)),mD(Eb,Za),r}finally{pt=e,Yv=!1}}return null}var Xc=[],Jc=0,Fg=null,Ug=0,cr=[],ur=0,Wl=null,qi=1,Yi="";function gl(n,e){Xc[Jc++]=Ug,Xc[Jc++]=Fg,Fg=n,Ug=e}function KD(n,e,t){cr[ur++]=qi,cr[ur++]=Yi,cr[ur++]=Wl,Wl=n;var s=qi;n=Yi;var r=32-Fr(s)-1;s&=~(1<<r),t+=1;var i=32-Fr(e)+r;if(30<i){var o=r-r%5;i=(s&(1<<o)-1).toString(32),s>>=o,r-=o,qi=1<<32-Fr(e)+r|t<<r|s,Yi=i+n}else qi=1<<i|t<<r|s,Yi=n}function Cb(n){n.return!==null&&(gl(n,1),KD(n,1,0))}function Pb(n){for(;n===Fg;)Fg=Xc[--Jc],Xc[Jc]=null,Ug=Xc[--Jc],Xc[Jc]=null;for(;n===Wl;)Wl=cr[--ur],cr[ur]=null,Yi=cr[--ur],cr[ur]=null,qi=cr[--ur],cr[ur]=null}var Xs=null,qs=null,Nt=!1,Or=null;function HD(n,e){var t=hr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function AI(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Xs=n,qs=Ta(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Xs=n,qs=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Wl!==null?{id:qi,overflow:Yi}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=hr(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Xs=n,qs=null,!0):!1;default:return!1}}function tw(n){return(n.mode&1)!==0&&(n.flags&128)===0}function nw(n){if(Nt){var e=qs;if(e){var t=e;if(!AI(n,e)){if(tw(n))throw Error(se(418));e=Ta(t.nextSibling);var s=Xs;e&&AI(n,e)?HD(s,t):(n.flags=n.flags&-4097|2,Nt=!1,Xs=n)}}else{if(tw(n))throw Error(se(418));n.flags=n.flags&-4097|2,Nt=!1,Xs=n}}}function II(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Xs=n}function ep(n){if(n!==Xs)return!1;if(!Nt)return II(n),Nt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!XE(n.type,n.memoizedProps)),e&&(e=qs)){if(tw(n))throw WD(),Error(se(418));for(;e;)HD(n,e),e=Ta(e.nextSibling)}if(II(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(se(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){qs=Ta(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}qs=null}}else qs=Xs?Ta(n.stateNode.nextSibling):null;return!0}function WD(){for(var n=qs;n;)n=Ta(n.nextSibling)}function Ku(){qs=Xs=null,Nt=!1}function kb(n){Or===null?Or=[n]:Or.push(n)}var T7=To.ReactCurrentBatchConfig;function lh(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(se(309));var s=t.stateNode}if(!s)throw Error(se(147,n));var r=s,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=r.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof n!="string")throw Error(se(284));if(!t._owner)throw Error(se(290,n))}return n}function tp(n,e){throw n=Object.prototype.toString.call(e),Error(se(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function RI(n){var e=n._init;return e(n._payload)}function zD(n){function e(x,E){if(n){var w=x.deletions;w===null?(x.deletions=[E],x.flags|=16):w.push(E)}}function t(x,E){if(!n)return null;for(;E!==null;)e(x,E),E=E.sibling;return null}function s(x,E){for(x=new Map;E!==null;)E.key!==null?x.set(E.key,E):x.set(E.index,E),E=E.sibling;return x}function r(x,E){return x=Aa(x,E),x.index=0,x.sibling=null,x}function i(x,E,w){return x.index=w,n?(w=x.alternate,w!==null?(w=w.index,w<E?(x.flags|=2,E):w):(x.flags|=2,E)):(x.flags|=1048576,E)}function o(x){return n&&x.alternate===null&&(x.flags|=2),x}function a(x,E,w,b){return E===null||E.tag!==6?(E=nx(w,x.mode,b),E.return=x,E):(E=r(E,w),E.return=x,E)}function l(x,E,w,b){var C=w.type;return C===Hc?d(x,E,w.props.children,b,w.key):E!==null&&(E.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Xo&&RI(C)===E.type)?(b=r(E,w.props),b.ref=lh(x,E,w),b.return=x,b):(b=Zp(w.type,w.key,w.props,null,x.mode,b),b.ref=lh(x,E,w),b.return=x,b)}function c(x,E,w,b){return E===null||E.tag!==4||E.stateNode.containerInfo!==w.containerInfo||E.stateNode.implementation!==w.implementation?(E=sx(w,x.mode,b),E.return=x,E):(E=r(E,w.children||[]),E.return=x,E)}function d(x,E,w,b,C){return E===null||E.tag!==7?(E=Ul(w,x.mode,b,C),E.return=x,E):(E=r(E,w),E.return=x,E)}function h(x,E,w){if(typeof E=="string"&&E!==""||typeof E=="number")return E=nx(""+E,x.mode,w),E.return=x,E;if(typeof E=="object"&&E!==null){switch(E.$$typeof){case Km:return w=Zp(E.type,E.key,E.props,null,x.mode,w),w.ref=lh(x,null,E),w.return=x,w;case Kc:return E=sx(E,x.mode,w),E.return=x,E;case Xo:var b=E._init;return h(x,b(E._payload),w)}if(xh(E)||sh(E))return E=Ul(E,x.mode,w,null),E.return=x,E;tp(x,E)}return null}function f(x,E,w,b){var C=E!==null?E.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return C!==null?null:a(x,E,""+w,b);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Km:return w.key===C?l(x,E,w,b):null;case Kc:return w.key===C?c(x,E,w,b):null;case Xo:return C=w._init,f(x,E,C(w._payload),b)}if(xh(w)||sh(w))return C!==null?null:d(x,E,w,b,null);tp(x,w)}return null}function m(x,E,w,b,C){if(typeof b=="string"&&b!==""||typeof b=="number")return x=x.get(w)||null,a(E,x,""+b,C);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Km:return x=x.get(b.key===null?w:b.key)||null,l(E,x,b,C);case Kc:return x=x.get(b.key===null?w:b.key)||null,c(E,x,b,C);case Xo:var D=b._init;return m(x,E,w,D(b._payload),C)}if(xh(b)||sh(b))return x=x.get(w)||null,d(E,x,b,C,null);tp(E,b)}return null}function p(x,E,w,b){for(var C=null,D=null,_=E,S=E=0,I=null;_!==null&&S<w.length;S++){_.index>S?(I=_,_=null):I=_.sibling;var R=f(x,_,w[S],b);if(R===null){_===null&&(_=I);break}n&&_&&R.alternate===null&&e(x,_),E=i(R,E,S),D===null?C=R:D.sibling=R,D=R,_=I}if(S===w.length)return t(x,_),Nt&&gl(x,S),C;if(_===null){for(;S<w.length;S++)_=h(x,w[S],b),_!==null&&(E=i(_,E,S),D===null?C=_:D.sibling=_,D=_);return Nt&&gl(x,S),C}for(_=s(x,_);S<w.length;S++)I=m(_,x,S,w[S],b),I!==null&&(n&&I.alternate!==null&&_.delete(I.key===null?S:I.key),E=i(I,E,S),D===null?C=I:D.sibling=I,D=I);return n&&_.forEach(function(N){return e(x,N)}),Nt&&gl(x,S),C}function y(x,E,w,b){var C=sh(w);if(typeof C!="function")throw Error(se(150));if(w=C.call(w),w==null)throw Error(se(151));for(var D=C=null,_=E,S=E=0,I=null,R=w.next();_!==null&&!R.done;S++,R=w.next()){_.index>S?(I=_,_=null):I=_.sibling;var N=f(x,_,R.value,b);if(N===null){_===null&&(_=I);break}n&&_&&N.alternate===null&&e(x,_),E=i(N,E,S),D===null?C=N:D.sibling=N,D=N,_=I}if(R.done)return t(x,_),Nt&&gl(x,S),C;if(_===null){for(;!R.done;S++,R=w.next())R=h(x,R.value,b),R!==null&&(E=i(R,E,S),D===null?C=R:D.sibling=R,D=R);return Nt&&gl(x,S),C}for(_=s(x,_);!R.done;S++,R=w.next())R=m(_,x,S,R.value,b),R!==null&&(n&&R.alternate!==null&&_.delete(R.key===null?S:R.key),E=i(R,E,S),D===null?C=R:D.sibling=R,D=R);return n&&_.forEach(function(L){return e(x,L)}),Nt&&gl(x,S),C}function v(x,E,w,b){if(typeof w=="object"&&w!==null&&w.type===Hc&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case Km:e:{for(var C=w.key,D=E;D!==null;){if(D.key===C){if(C=w.type,C===Hc){if(D.tag===7){t(x,D.sibling),E=r(D,w.props.children),E.return=x,x=E;break e}}else if(D.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Xo&&RI(C)===D.type){t(x,D.sibling),E=r(D,w.props),E.ref=lh(x,D,w),E.return=x,x=E;break e}t(x,D);break}else e(x,D);D=D.sibling}w.type===Hc?(E=Ul(w.props.children,x.mode,b,w.key),E.return=x,x=E):(b=Zp(w.type,w.key,w.props,null,x.mode,b),b.ref=lh(x,E,w),b.return=x,x=b)}return o(x);case Kc:e:{for(D=w.key;E!==null;){if(E.key===D)if(E.tag===4&&E.stateNode.containerInfo===w.containerInfo&&E.stateNode.implementation===w.implementation){t(x,E.sibling),E=r(E,w.children||[]),E.return=x,x=E;break e}else{t(x,E);break}else e(x,E);E=E.sibling}E=sx(w,x.mode,b),E.return=x,x=E}return o(x);case Xo:return D=w._init,v(x,E,D(w._payload),b)}if(xh(w))return p(x,E,w,b);if(sh(w))return y(x,E,w,b);tp(x,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,E!==null&&E.tag===6?(t(x,E.sibling),E=r(E,w),E.return=x,x=E):(t(x,E),E=nx(w,x.mode,b),E.return=x,x=E),o(x)):t(x,E)}return v}var Hu=zD(!0),qD=zD(!1),Vg=Ja(null),$g=null,Zc=null,Nb=null;function Lb(){Nb=Zc=$g=null}function Db(n){var e=Vg.current;kt(Vg),n._currentValue=e}function sw(n,e,t){for(;n!==null;){var s=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),n===t)break;n=n.return}}function mu(n,e){$g=n,Nb=Zc=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Ss=!0),n.firstContext=null)}function yr(n){var e=n._currentValue;if(Nb!==n)if(n={context:n,memoizedValue:e,next:null},Zc===null){if($g===null)throw Error(se(308));Zc=n,$g.dependencies={lanes:0,firstContext:n}}else Zc=Zc.next=n;return e}var Sl=null;function Mb(n){Sl===null?Sl=[n]:Sl.push(n)}function YD(n,e,t,s){var r=e.interleaved;return r===null?(t.next=t,Mb(e)):(t.next=r.next,r.next=t),e.interleaved=t,lo(n,s)}function lo(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Jo=!1;function Ob(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function QD(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Zi(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function ba(n,e,t){var s=n.updateQueue;if(s===null)return null;if(s=s.shared,lt&2){var r=s.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),s.pending=e,lo(n,t)}return r=s.interleaved,r===null?(e.next=e,Mb(s)):(e.next=r.next,r.next=e),s.interleaved=e,lo(n,t)}function zp(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var s=e.lanes;s&=n.pendingLanes,t|=s,e.lanes=t,wb(n,t)}}function CI(n,e){var t=n.updateQueue,s=n.alternate;if(s!==null&&(s=s.updateQueue,t===s)){var r=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?r=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?r=i=e:i=i.next=e}else r=i=e;t={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:i,shared:s.shared,effects:s.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Bg(n,e,t,s){var r=n.updateQueue;Jo=!1;var i=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?i=c:o.next=c,o=l;var d=n.alternate;d!==null&&(d=d.updateQueue,a=d.lastBaseUpdate,a!==o&&(a===null?d.firstBaseUpdate=c:a.next=c,d.lastBaseUpdate=l))}if(i!==null){var h=r.baseState;o=0,d=c=l=null,a=i;do{var f=a.lane,m=a.eventTime;if((s&f)===f){d!==null&&(d=d.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=n,y=a;switch(f=e,m=t,y.tag){case 1:if(p=y.payload,typeof p=="function"){h=p.call(m,h,f);break e}h=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=y.payload,f=typeof p=="function"?p.call(m,h,f):p,f==null)break e;h=$t({},h,f);break e;case 2:Jo=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,f=r.effects,f===null?r.effects=[a]:f.push(a))}else m={eventTime:m,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},d===null?(c=d=m,l=h):d=d.next=m,o|=f;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;f=a,a=f.next,f.next=null,r.lastBaseUpdate=f,r.shared.pending=null}}while(!0);if(d===null&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=d,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else i===null&&(r.shared.lanes=0);ql|=o,n.lanes=o,n.memoizedState=h}}function PI(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var s=n[e],r=s.callback;if(r!==null){if(s.callback=null,s=t,typeof r!="function")throw Error(se(191,r));r.call(s)}}}var tm={},hi=Ja(tm),pf=Ja(tm),gf=Ja(tm);function _l(n){if(n===tm)throw Error(se(174));return n}function jb(n,e){switch(At(gf,e),At(pf,n),At(hi,tm),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:jE(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=jE(e,n)}kt(hi),At(hi,e)}function Wu(){kt(hi),kt(pf),kt(gf)}function XD(n){_l(gf.current);var e=_l(hi.current),t=jE(e,n.type);e!==t&&(At(pf,n),At(hi,t))}function Fb(n){pf.current===n&&(kt(hi),kt(pf))}var Ot=Ja(0);function Gg(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Qv=[];function Ub(){for(var n=0;n<Qv.length;n++)Qv[n]._workInProgressVersionPrimary=null;Qv.length=0}var qp=To.ReactCurrentDispatcher,Xv=To.ReactCurrentBatchConfig,zl=0,Vt=null,vn=null,In=null,Kg=!1,Uh=!1,yf=0,b7=0;function Hn(){throw Error(se(321))}function Vb(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!$r(n[t],e[t]))return!1;return!0}function $b(n,e,t,s,r,i){if(zl=i,Vt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,qp.current=n===null||n.memoizedState===null?I7:R7,n=t(s,r),Uh){i=0;do{if(Uh=!1,yf=0,25<=i)throw Error(se(301));i+=1,In=vn=null,e.updateQueue=null,qp.current=C7,n=t(s,r)}while(Uh)}if(qp.current=Hg,e=vn!==null&&vn.next!==null,zl=0,In=vn=Vt=null,Kg=!1,e)throw Error(se(300));return n}function Bb(){var n=yf!==0;return yf=0,n}function Jr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return In===null?Vt.memoizedState=In=n:In=In.next=n,In}function vr(){if(vn===null){var n=Vt.alternate;n=n!==null?n.memoizedState:null}else n=vn.next;var e=In===null?Vt.memoizedState:In.next;if(e!==null)In=e,vn=n;else{if(n===null)throw Error(se(310));vn=n,n={memoizedState:vn.memoizedState,baseState:vn.baseState,baseQueue:vn.baseQueue,queue:vn.queue,next:null},In===null?Vt.memoizedState=In=n:In=In.next=n}return In}function vf(n,e){return typeof e=="function"?e(n):e}function Jv(n){var e=vr(),t=e.queue;if(t===null)throw Error(se(311));t.lastRenderedReducer=n;var s=vn,r=s.baseQueue,i=t.pending;if(i!==null){if(r!==null){var o=r.next;r.next=i.next,i.next=o}s.baseQueue=r=i,t.pending=null}if(r!==null){i=r.next,s=s.baseState;var a=o=null,l=null,c=i;do{var d=c.lane;if((zl&d)===d)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),s=c.hasEagerState?c.eagerState:n(s,c.action);else{var h={lane:d,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=h,o=s):l=l.next=h,Vt.lanes|=d,ql|=d}c=c.next}while(c!==null&&c!==i);l===null?o=s:l.next=a,$r(s,e.memoizedState)||(Ss=!0),e.memoizedState=s,e.baseState=o,e.baseQueue=l,t.lastRenderedState=s}if(n=t.interleaved,n!==null){r=n;do i=r.lane,Vt.lanes|=i,ql|=i,r=r.next;while(r!==n)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Zv(n){var e=vr(),t=e.queue;if(t===null)throw Error(se(311));t.lastRenderedReducer=n;var s=t.dispatch,r=t.pending,i=e.memoizedState;if(r!==null){t.pending=null;var o=r=r.next;do i=n(i,o.action),o=o.next;while(o!==r);$r(i,e.memoizedState)||(Ss=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,s]}function JD(){}function ZD(n,e){var t=Vt,s=vr(),r=e(),i=!$r(s.memoizedState,r);if(i&&(s.memoizedState=r,Ss=!0),s=s.queue,Gb(n2.bind(null,t,s,n),[n]),s.getSnapshot!==e||i||In!==null&&In.memoizedState.tag&1){if(t.flags|=2048,xf(9,t2.bind(null,t,s,r,e),void 0,null),Rn===null)throw Error(se(349));zl&30||e2(t,e,r)}return r}function e2(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Vt.updateQueue,e===null?(e={lastEffect:null,stores:null},Vt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function t2(n,e,t,s){e.value=t,e.getSnapshot=s,s2(e)&&r2(n)}function n2(n,e,t){return t(function(){s2(e)&&r2(n)})}function s2(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!$r(n,t)}catch{return!0}}function r2(n){var e=lo(n,1);e!==null&&Ur(e,n,1,-1)}function kI(n){var e=Jr();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:vf,lastRenderedState:n},e.queue=n,n=n.dispatch=A7.bind(null,Vt,n),[e.memoizedState,n]}function xf(n,e,t,s){return n={tag:n,create:e,destroy:t,deps:s,next:null},e=Vt.updateQueue,e===null?(e={lastEffect:null,stores:null},Vt.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(s=t.next,t.next=n,n.next=s,e.lastEffect=n)),n}function i2(){return vr().memoizedState}function Yp(n,e,t,s){var r=Jr();Vt.flags|=n,r.memoizedState=xf(1|e,t,void 0,s===void 0?null:s)}function ny(n,e,t,s){var r=vr();s=s===void 0?null:s;var i=void 0;if(vn!==null){var o=vn.memoizedState;if(i=o.destroy,s!==null&&Vb(s,o.deps)){r.memoizedState=xf(e,t,i,s);return}}Vt.flags|=n,r.memoizedState=xf(1|e,t,i,s)}function NI(n,e){return Yp(8390656,8,n,e)}function Gb(n,e){return ny(2048,8,n,e)}function o2(n,e){return ny(4,2,n,e)}function a2(n,e){return ny(4,4,n,e)}function l2(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function c2(n,e,t){return t=t!=null?t.concat([n]):null,ny(4,4,l2.bind(null,e,n),t)}function Kb(){}function u2(n,e){var t=vr();e=e===void 0?null:e;var s=t.memoizedState;return s!==null&&e!==null&&Vb(e,s[1])?s[0]:(t.memoizedState=[n,e],n)}function d2(n,e){var t=vr();e=e===void 0?null:e;var s=t.memoizedState;return s!==null&&e!==null&&Vb(e,s[1])?s[0]:(n=n(),t.memoizedState=[n,e],n)}function h2(n,e,t){return zl&21?($r(t,e)||(t=yD(),Vt.lanes|=t,ql|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Ss=!0),n.memoizedState=t)}function S7(n,e){var t=pt;pt=t!==0&&4>t?t:4,n(!0);var s=Xv.transition;Xv.transition={};try{n(!1),e()}finally{pt=t,Xv.transition=s}}function f2(){return vr().memoizedState}function _7(n,e,t){var s=_a(n);if(t={lane:s,action:t,hasEagerState:!1,eagerState:null,next:null},m2(n))p2(e,t);else if(t=YD(n,e,t,s),t!==null){var r=hs();Ur(t,n,s,r),g2(t,e,s)}}function A7(n,e,t){var s=_a(n),r={lane:s,action:t,hasEagerState:!1,eagerState:null,next:null};if(m2(n))p2(e,r);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(r.hasEagerState=!0,r.eagerState=a,$r(a,o)){var l=e.interleaved;l===null?(r.next=r,Mb(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}t=YD(n,e,r,s),t!==null&&(r=hs(),Ur(t,n,s,r),g2(t,e,s))}}function m2(n){var e=n.alternate;return n===Vt||e!==null&&e===Vt}function p2(n,e){Uh=Kg=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function g2(n,e,t){if(t&4194240){var s=e.lanes;s&=n.pendingLanes,t|=s,e.lanes=t,wb(n,t)}}var Hg={readContext:yr,useCallback:Hn,useContext:Hn,useEffect:Hn,useImperativeHandle:Hn,useInsertionEffect:Hn,useLayoutEffect:Hn,useMemo:Hn,useReducer:Hn,useRef:Hn,useState:Hn,useDebugValue:Hn,useDeferredValue:Hn,useTransition:Hn,useMutableSource:Hn,useSyncExternalStore:Hn,useId:Hn,unstable_isNewReconciler:!1},I7={readContext:yr,useCallback:function(n,e){return Jr().memoizedState=[n,e===void 0?null:e],n},useContext:yr,useEffect:NI,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Yp(4194308,4,l2.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Yp(4194308,4,n,e)},useInsertionEffect:function(n,e){return Yp(4,2,n,e)},useMemo:function(n,e){var t=Jr();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var s=Jr();return e=t!==void 0?t(e):e,s.memoizedState=s.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},s.queue=n,n=n.dispatch=_7.bind(null,Vt,n),[s.memoizedState,n]},useRef:function(n){var e=Jr();return n={current:n},e.memoizedState=n},useState:kI,useDebugValue:Kb,useDeferredValue:function(n){return Jr().memoizedState=n},useTransition:function(){var n=kI(!1),e=n[0];return n=S7.bind(null,n[1]),Jr().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var s=Vt,r=Jr();if(Nt){if(t===void 0)throw Error(se(407));t=t()}else{if(t=e(),Rn===null)throw Error(se(349));zl&30||e2(s,e,t)}r.memoizedState=t;var i={value:t,getSnapshot:e};return r.queue=i,NI(n2.bind(null,s,i,n),[n]),s.flags|=2048,xf(9,t2.bind(null,s,i,t,e),void 0,null),t},useId:function(){var n=Jr(),e=Rn.identifierPrefix;if(Nt){var t=Yi,s=qi;t=(s&~(1<<32-Fr(s)-1)).toString(32)+t,e=":"+e+"R"+t,t=yf++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=b7++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},R7={readContext:yr,useCallback:u2,useContext:yr,useEffect:Gb,useImperativeHandle:c2,useInsertionEffect:o2,useLayoutEffect:a2,useMemo:d2,useReducer:Jv,useRef:i2,useState:function(){return Jv(vf)},useDebugValue:Kb,useDeferredValue:function(n){var e=vr();return h2(e,vn.memoizedState,n)},useTransition:function(){var n=Jv(vf)[0],e=vr().memoizedState;return[n,e]},useMutableSource:JD,useSyncExternalStore:ZD,useId:f2,unstable_isNewReconciler:!1},C7={readContext:yr,useCallback:u2,useContext:yr,useEffect:Gb,useImperativeHandle:c2,useInsertionEffect:o2,useLayoutEffect:a2,useMemo:d2,useReducer:Zv,useRef:i2,useState:function(){return Zv(vf)},useDebugValue:Kb,useDeferredValue:function(n){var e=vr();return vn===null?e.memoizedState=n:h2(e,vn.memoizedState,n)},useTransition:function(){var n=Zv(vf)[0],e=vr().memoizedState;return[n,e]},useMutableSource:JD,useSyncExternalStore:ZD,useId:f2,unstable_isNewReconciler:!1};function kr(n,e){if(n&&n.defaultProps){e=$t({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function rw(n,e,t,s){e=n.memoizedState,t=t(s,e),t=t==null?e:$t({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var sy={isMounted:function(n){return(n=n._reactInternals)?ac(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var s=hs(),r=_a(n),i=Zi(s,r);i.payload=e,t!=null&&(i.callback=t),e=ba(n,i,r),e!==null&&(Ur(e,n,r,s),zp(e,n,r))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var s=hs(),r=_a(n),i=Zi(s,r);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=ba(n,i,r),e!==null&&(Ur(e,n,r,s),zp(e,n,r))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=hs(),s=_a(n),r=Zi(t,s);r.tag=2,e!=null&&(r.callback=e),e=ba(n,r,s),e!==null&&(Ur(e,n,s,t),zp(e,n,s))}};function LI(n,e,t,s,r,i,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(s,i,o):e.prototype&&e.prototype.isPureReactComponent?!df(t,s)||!df(r,i):!0}function y2(n,e,t){var s=!1,r=Oa,i=e.contextType;return typeof i=="object"&&i!==null?i=yr(i):(r=Is(e)?Hl:ns.current,s=e.contextTypes,i=(s=s!=null)?Gu(n,r):Oa),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=sy,n.stateNode=e,e._reactInternals=n,s&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=i),e}function DI(n,e,t,s){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,s),e.state!==n&&sy.enqueueReplaceState(e,e.state,null)}function iw(n,e,t,s){var r=n.stateNode;r.props=t,r.state=n.memoizedState,r.refs={},Ob(n);var i=e.contextType;typeof i=="object"&&i!==null?r.context=yr(i):(i=Is(e)?Hl:ns.current,r.context=Gu(n,i)),r.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(rw(n,e,i,t),r.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&sy.enqueueReplaceState(r,r.state,null),Bg(n,t,r,s),r.state=n.memoizedState),typeof r.componentDidMount=="function"&&(n.flags|=4194308)}function zu(n,e){try{var t="",s=e;do t+=s9(s),s=s.return;while(s);var r=t}catch(i){r=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:r,digest:null}}function ex(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function ow(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var P7=typeof WeakMap=="function"?WeakMap:Map;function v2(n,e,t){t=Zi(-1,t),t.tag=3,t.payload={element:null};var s=e.value;return t.callback=function(){zg||(zg=!0,gw=s),ow(n,e)},t}function x2(n,e,t){t=Zi(-1,t),t.tag=3;var s=n.type.getDerivedStateFromError;if(typeof s=="function"){var r=e.value;t.payload=function(){return s(r)},t.callback=function(){ow(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){ow(n,e),typeof s!="function"&&(Sa===null?Sa=new Set([this]):Sa.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function MI(n,e,t){var s=n.pingCache;if(s===null){s=n.pingCache=new P7;var r=new Set;s.set(e,r)}else r=s.get(e),r===void 0&&(r=new Set,s.set(e,r));r.has(t)||(r.add(t),n=K7.bind(null,n,e,t),e.then(n,n))}function OI(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function jI(n,e,t,s,r){return n.mode&1?(n.flags|=65536,n.lanes=r,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Zi(-1,1),e.tag=2,ba(t,e,1))),t.lanes|=1),n)}var k7=To.ReactCurrentOwner,Ss=!1;function as(n,e,t,s){e.child=n===null?qD(e,null,t,s):Hu(e,n.child,t,s)}function FI(n,e,t,s,r){t=t.render;var i=e.ref;return mu(e,r),s=$b(n,e,t,s,i,r),t=Bb(),n!==null&&!Ss?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,co(n,e,r)):(Nt&&t&&Cb(e),e.flags|=1,as(n,e,s,r),e.child)}function UI(n,e,t,s,r){if(n===null){var i=t.type;return typeof i=="function"&&!Jb(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,E2(n,e,i,s,r)):(n=Zp(t.type,null,s,e,e.mode,r),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&r)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:df,t(o,s)&&n.ref===e.ref)return co(n,e,r)}return e.flags|=1,n=Aa(i,s),n.ref=e.ref,n.return=e,e.child=n}function E2(n,e,t,s,r){if(n!==null){var i=n.memoizedProps;if(df(i,s)&&n.ref===e.ref)if(Ss=!1,e.pendingProps=s=i,(n.lanes&r)!==0)n.flags&131072&&(Ss=!0);else return e.lanes=n.lanes,co(n,e,r)}return aw(n,e,t,s,r)}function w2(n,e,t){var s=e.pendingProps,r=s.children,i=n!==null?n.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},At(tu,Gs),Gs|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,At(tu,Gs),Gs|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=i!==null?i.baseLanes:t,At(tu,Gs),Gs|=s}else i!==null?(s=i.baseLanes|t,e.memoizedState=null):s=t,At(tu,Gs),Gs|=s;return as(n,e,r,t),e.child}function T2(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function aw(n,e,t,s,r){var i=Is(t)?Hl:ns.current;return i=Gu(e,i),mu(e,r),t=$b(n,e,t,s,i,r),s=Bb(),n!==null&&!Ss?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,co(n,e,r)):(Nt&&s&&Cb(e),e.flags|=1,as(n,e,t,r),e.child)}function VI(n,e,t,s,r){if(Is(t)){var i=!0;jg(e)}else i=!1;if(mu(e,r),e.stateNode===null)Qp(n,e),y2(e,t,s),iw(e,t,s,r),s=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=t.contextType;typeof c=="object"&&c!==null?c=yr(c):(c=Is(t)?Hl:ns.current,c=Gu(e,c));var d=t.getDerivedStateFromProps,h=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==s||l!==c)&&DI(e,o,s,c),Jo=!1;var f=e.memoizedState;o.state=f,Bg(e,s,o,r),l=e.memoizedState,a!==s||f!==l||As.current||Jo?(typeof d=="function"&&(rw(e,t,d,s),l=e.memoizedState),(a=Jo||LI(e,t,a,s,f,l,c))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=l),o.props=s,o.state=l,o.context=c,s=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{o=e.stateNode,QD(n,e),a=e.memoizedProps,c=e.type===e.elementType?a:kr(e.type,a),o.props=c,h=e.pendingProps,f=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=yr(l):(l=Is(t)?Hl:ns.current,l=Gu(e,l));var m=t.getDerivedStateFromProps;(d=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||f!==l)&&DI(e,o,s,l),Jo=!1,f=e.memoizedState,o.state=f,Bg(e,s,o,r);var p=e.memoizedState;a!==h||f!==p||As.current||Jo?(typeof m=="function"&&(rw(e,t,m,s),p=e.memoizedState),(c=Jo||LI(e,t,c,s,f,p,l)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(s,p,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(s,p,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=p),o.props=s,o.state=p,o.context=l,s=c):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),s=!1)}return lw(n,e,t,s,i,r)}function lw(n,e,t,s,r,i){T2(n,e);var o=(e.flags&128)!==0;if(!s&&!o)return r&&_I(e,t,!1),co(n,e,i);s=e.stateNode,k7.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,n!==null&&o?(e.child=Hu(e,n.child,null,i),e.child=Hu(e,null,a,i)):as(n,e,a,i),e.memoizedState=s.state,r&&_I(e,t,!0),e.child}function b2(n){var e=n.stateNode;e.pendingContext?SI(n,e.pendingContext,e.pendingContext!==e.context):e.context&&SI(n,e.context,!1),jb(n,e.containerInfo)}function $I(n,e,t,s,r){return Ku(),kb(r),e.flags|=256,as(n,e,t,s),e.child}var cw={dehydrated:null,treeContext:null,retryLane:0};function uw(n){return{baseLanes:n,cachePool:null,transitions:null}}function S2(n,e,t){var s=e.pendingProps,r=Ot.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(r&2)!==0),a?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(r|=1),At(Ot,r&1),n===null)return nw(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=s.children,n=s.fallback,i?(s=e.mode,i=e.child,o={mode:"hidden",children:o},!(s&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=oy(o,s,0,null),n=Ul(n,s,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=uw(t),e.memoizedState=cw,n):Hb(e,o));if(r=n.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return N7(n,e,o,s,a,r,t);if(i){i=s.fallback,o=e.mode,r=n.child,a=r.sibling;var l={mode:"hidden",children:s.children};return!(o&1)&&e.child!==r?(s=e.child,s.childLanes=0,s.pendingProps=l,e.deletions=null):(s=Aa(r,l),s.subtreeFlags=r.subtreeFlags&14680064),a!==null?i=Aa(a,i):(i=Ul(i,o,t,null),i.flags|=2),i.return=e,s.return=e,s.sibling=i,e.child=s,s=i,i=e.child,o=n.child.memoizedState,o=o===null?uw(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=n.childLanes&~t,e.memoizedState=cw,s}return i=n.child,n=i.sibling,s=Aa(i,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=t),s.return=e,s.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=s,e.memoizedState=null,s}function Hb(n,e){return e=oy({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function np(n,e,t,s){return s!==null&&kb(s),Hu(e,n.child,null,t),n=Hb(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function N7(n,e,t,s,r,i,o){if(t)return e.flags&256?(e.flags&=-257,s=ex(Error(se(422))),np(n,e,o,s)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=s.fallback,r=e.mode,s=oy({mode:"visible",children:s.children},r,0,null),i=Ul(i,r,o,null),i.flags|=2,s.return=e,i.return=e,s.sibling=i,e.child=s,e.mode&1&&Hu(e,n.child,null,o),e.child.memoizedState=uw(o),e.memoizedState=cw,i);if(!(e.mode&1))return np(n,e,o,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var a=s.dgst;return s=a,i=Error(se(419)),s=ex(i,s,void 0),np(n,e,o,s)}if(a=(o&n.childLanes)!==0,Ss||a){if(s=Rn,s!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|o)?0:r,r!==0&&r!==i.retryLane&&(i.retryLane=r,lo(n,r),Ur(s,n,r,-1))}return Xb(),s=ex(Error(se(421))),np(n,e,o,s)}return r.data==="$?"?(e.flags|=128,e.child=n.child,e=H7.bind(null,n),r._reactRetry=e,null):(n=i.treeContext,qs=Ta(r.nextSibling),Xs=e,Nt=!0,Or=null,n!==null&&(cr[ur++]=qi,cr[ur++]=Yi,cr[ur++]=Wl,qi=n.id,Yi=n.overflow,Wl=e),e=Hb(e,s.children),e.flags|=4096,e)}function BI(n,e,t){n.lanes|=e;var s=n.alternate;s!==null&&(s.lanes|=e),sw(n.return,e,t)}function tx(n,e,t,s,r){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:t,tailMode:r}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=s,i.tail=t,i.tailMode=r)}function _2(n,e,t){var s=e.pendingProps,r=s.revealOrder,i=s.tail;if(as(n,e,s.children,t),s=Ot.current,s&2)s=s&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&BI(n,t,e);else if(n.tag===19)BI(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}s&=1}if(At(Ot,s),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)n=t.alternate,n!==null&&Gg(n)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),tx(e,!1,r,t,i);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(n=r.alternate,n!==null&&Gg(n)===null){e.child=r;break}n=r.sibling,r.sibling=t,t=r,r=n}tx(e,!0,t,null,i);break;case"together":tx(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Qp(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function co(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),ql|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(se(153));if(e.child!==null){for(n=e.child,t=Aa(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Aa(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function L7(n,e,t){switch(e.tag){case 3:b2(e),Ku();break;case 5:XD(e);break;case 1:Is(e.type)&&jg(e);break;case 4:jb(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,r=e.memoizedProps.value;At(Vg,s._currentValue),s._currentValue=r;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(At(Ot,Ot.current&1),e.flags|=128,null):t&e.child.childLanes?S2(n,e,t):(At(Ot,Ot.current&1),n=co(n,e,t),n!==null?n.sibling:null);At(Ot,Ot.current&1);break;case 19:if(s=(t&e.childLanes)!==0,n.flags&128){if(s)return _2(n,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),At(Ot,Ot.current),s)break;return null;case 22:case 23:return e.lanes=0,w2(n,e,t)}return co(n,e,t)}var A2,dw,I2,R2;A2=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};dw=function(){};I2=function(n,e,t,s){var r=n.memoizedProps;if(r!==s){n=e.stateNode,_l(hi.current);var i=null;switch(t){case"input":r=LE(n,r),s=LE(n,s),i=[];break;case"select":r=$t({},r,{value:void 0}),s=$t({},s,{value:void 0}),i=[];break;case"textarea":r=OE(n,r),s=OE(n,s),i=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(n.onclick=Mg)}FE(t,s);var o;t=null;for(c in r)if(!s.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var a=r[c];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(sf.hasOwnProperty(c)?i||(i=[]):(i=i||[]).push(c,null));for(c in s){var l=s[c];if(a=r!=null?r[c]:void 0,s.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(i||(i=[]),i.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(sf.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Ct("scroll",n),i||a===l||(i=[])):(i=i||[]).push(c,l))}t&&(i=i||[]).push("style",t);var c=i;(e.updateQueue=c)&&(e.flags|=4)}};R2=function(n,e,t,s){t!==s&&(e.flags|=4)};function ch(n,e){if(!Nt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var s=null;t!==null;)t.alternate!==null&&(s=t),t=t.sibling;s===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:s.sibling=null}}function Wn(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,s=0;if(e)for(var r=n.child;r!==null;)t|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=n,r=r.sibling;else for(r=n.child;r!==null;)t|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=n,r=r.sibling;return n.subtreeFlags|=s,n.childLanes=t,e}function D7(n,e,t){var s=e.pendingProps;switch(Pb(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wn(e),null;case 1:return Is(e.type)&&Og(),Wn(e),null;case 3:return s=e.stateNode,Wu(),kt(As),kt(ns),Ub(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(n===null||n.child===null)&&(ep(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Or!==null&&(xw(Or),Or=null))),dw(n,e),Wn(e),null;case 5:Fb(e);var r=_l(gf.current);if(t=e.type,n!==null&&e.stateNode!=null)I2(n,e,t,s,r),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(se(166));return Wn(e),null}if(n=_l(hi.current),ep(e)){s=e.stateNode,t=e.type;var i=e.memoizedProps;switch(s[oi]=e,s[mf]=i,n=(e.mode&1)!==0,t){case"dialog":Ct("cancel",s),Ct("close",s);break;case"iframe":case"object":case"embed":Ct("load",s);break;case"video":case"audio":for(r=0;r<wh.length;r++)Ct(wh[r],s);break;case"source":Ct("error",s);break;case"img":case"image":case"link":Ct("error",s),Ct("load",s);break;case"details":Ct("toggle",s);break;case"input":XA(s,i),Ct("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!i.multiple},Ct("invalid",s);break;case"textarea":ZA(s,i),Ct("invalid",s)}FE(t,i),r=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?s.textContent!==a&&(i.suppressHydrationWarning!==!0&&Zm(s.textContent,a,n),r=["children",a]):typeof a=="number"&&s.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&Zm(s.textContent,a,n),r=["children",""+a]):sf.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Ct("scroll",s)}switch(t){case"input":Hm(s),JA(s,i,!0);break;case"textarea":Hm(s),eI(s);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(s.onclick=Mg)}s=r,e.updateQueue=s,s!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=nD(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof s.is=="string"?n=o.createElement(t,{is:s.is}):(n=o.createElement(t),t==="select"&&(o=n,s.multiple?o.multiple=!0:s.size&&(o.size=s.size))):n=o.createElementNS(n,t),n[oi]=e,n[mf]=s,A2(n,e,!1,!1),e.stateNode=n;e:{switch(o=UE(t,s),t){case"dialog":Ct("cancel",n),Ct("close",n),r=s;break;case"iframe":case"object":case"embed":Ct("load",n),r=s;break;case"video":case"audio":for(r=0;r<wh.length;r++)Ct(wh[r],n);r=s;break;case"source":Ct("error",n),r=s;break;case"img":case"image":case"link":Ct("error",n),Ct("load",n),r=s;break;case"details":Ct("toggle",n),r=s;break;case"input":XA(n,s),r=LE(n,s),Ct("invalid",n);break;case"option":r=s;break;case"select":n._wrapperState={wasMultiple:!!s.multiple},r=$t({},s,{value:void 0}),Ct("invalid",n);break;case"textarea":ZA(n,s),r=OE(n,s),Ct("invalid",n);break;default:r=s}FE(t,r),a=r;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?iD(n,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&sD(n,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&rf(n,l):typeof l=="number"&&rf(n,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(sf.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Ct("scroll",n):l!=null&&pb(n,i,l,o))}switch(t){case"input":Hm(n),JA(n,s,!1);break;case"textarea":Hm(n),eI(n);break;case"option":s.value!=null&&n.setAttribute("value",""+Ma(s.value));break;case"select":n.multiple=!!s.multiple,i=s.value,i!=null?uu(n,!!s.multiple,i,!1):s.defaultValue!=null&&uu(n,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(n.onclick=Mg)}switch(t){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Wn(e),null;case 6:if(n&&e.stateNode!=null)R2(n,e,n.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(se(166));if(t=_l(gf.current),_l(hi.current),ep(e)){if(s=e.stateNode,t=e.memoizedProps,s[oi]=e,(i=s.nodeValue!==t)&&(n=Xs,n!==null))switch(n.tag){case 3:Zm(s.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Zm(s.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else s=(t.nodeType===9?t:t.ownerDocument).createTextNode(s),s[oi]=e,e.stateNode=s}return Wn(e),null;case 13:if(kt(Ot),s=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Nt&&qs!==null&&e.mode&1&&!(e.flags&128))WD(),Ku(),e.flags|=98560,i=!1;else if(i=ep(e),s!==null&&s.dehydrated!==null){if(n===null){if(!i)throw Error(se(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(se(317));i[oi]=e}else Ku(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Wn(e),i=!1}else Or!==null&&(xw(Or),Or=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(s=s!==null,s!==(n!==null&&n.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(n===null||Ot.current&1?En===0&&(En=3):Xb())),e.updateQueue!==null&&(e.flags|=4),Wn(e),null);case 4:return Wu(),dw(n,e),n===null&&hf(e.stateNode.containerInfo),Wn(e),null;case 10:return Db(e.type._context),Wn(e),null;case 17:return Is(e.type)&&Og(),Wn(e),null;case 19:if(kt(Ot),i=e.memoizedState,i===null)return Wn(e),null;if(s=(e.flags&128)!==0,o=i.rendering,o===null)if(s)ch(i,!1);else{if(En!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=Gg(n),o!==null){for(e.flags|=128,ch(i,!1),s=o.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=t,t=e.child;t!==null;)i=t,n=s,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return At(Ot,Ot.current&1|2),e.child}n=n.sibling}i.tail!==null&&nn()>qu&&(e.flags|=128,s=!0,ch(i,!1),e.lanes=4194304)}else{if(!s)if(n=Gg(o),n!==null){if(e.flags|=128,s=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),ch(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Nt)return Wn(e),null}else 2*nn()-i.renderingStartTime>qu&&t!==1073741824&&(e.flags|=128,s=!0,ch(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=nn(),e.sibling=null,t=Ot.current,At(Ot,s?t&1|2:t&1),e):(Wn(e),null);case 22:case 23:return Qb(),s=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?Gs&1073741824&&(Wn(e),e.subtreeFlags&6&&(e.flags|=8192)):Wn(e),null;case 24:return null;case 25:return null}throw Error(se(156,e.tag))}function M7(n,e){switch(Pb(e),e.tag){case 1:return Is(e.type)&&Og(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Wu(),kt(As),kt(ns),Ub(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Fb(e),null;case 13:if(kt(Ot),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(se(340));Ku()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return kt(Ot),null;case 4:return Wu(),null;case 10:return Db(e.type._context),null;case 22:case 23:return Qb(),null;case 24:return null;default:return null}}var sp=!1,Xn=!1,O7=typeof WeakSet=="function"?WeakSet:Set,fe=null;function eu(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(s){Qt(n,e,s)}else t.current=null}function hw(n,e,t){try{t()}catch(s){Qt(n,e,s)}}var GI=!1;function j7(n,e){if(YE=Ng,n=LD(),Rb(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var s=t.getSelection&&t.getSelection();if(s&&s.rangeCount!==0){t=s.anchorNode;var r=s.anchorOffset,i=s.focusNode;s=s.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,c=0,d=0,h=n,f=null;t:for(;;){for(var m;h!==t||r!==0&&h.nodeType!==3||(a=o+r),h!==i||s!==0&&h.nodeType!==3||(l=o+s),h.nodeType===3&&(o+=h.nodeValue.length),(m=h.firstChild)!==null;)f=h,h=m;for(;;){if(h===n)break t;if(f===t&&++c===r&&(a=o),f===i&&++d===s&&(l=o),(m=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=m}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(QE={focusedElem:n,selectionRange:t},Ng=!1,fe=e;fe!==null;)if(e=fe,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,fe=n;else for(;fe!==null;){e=fe;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var y=p.memoizedProps,v=p.memoizedState,x=e.stateNode,E=x.getSnapshotBeforeUpdate(e.elementType===e.type?y:kr(e.type,y),v);x.__reactInternalSnapshotBeforeUpdate=E}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(se(163))}}catch(b){Qt(e,e.return,b)}if(n=e.sibling,n!==null){n.return=e.return,fe=n;break}fe=e.return}return p=GI,GI=!1,p}function Vh(n,e,t){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&n)===n){var i=r.destroy;r.destroy=void 0,i!==void 0&&hw(e,t,i)}r=r.next}while(r!==s)}}function ry(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var s=t.create;t.destroy=s()}t=t.next}while(t!==e)}}function fw(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function C2(n){var e=n.alternate;e!==null&&(n.alternate=null,C2(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[oi],delete e[mf],delete e[ZE],delete e[x7],delete e[E7])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function P2(n){return n.tag===5||n.tag===3||n.tag===4}function KI(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||P2(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function mw(n,e,t){var s=n.tag;if(s===5||s===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Mg));else if(s!==4&&(n=n.child,n!==null))for(mw(n,e,t),n=n.sibling;n!==null;)mw(n,e,t),n=n.sibling}function pw(n,e,t){var s=n.tag;if(s===5||s===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(s!==4&&(n=n.child,n!==null))for(pw(n,e,t),n=n.sibling;n!==null;)pw(n,e,t),n=n.sibling}var kn=null,Dr=!1;function Bo(n,e,t){for(t=t.child;t!==null;)k2(n,e,t),t=t.sibling}function k2(n,e,t){if(di&&typeof di.onCommitFiberUnmount=="function")try{di.onCommitFiberUnmount(Q0,t)}catch{}switch(t.tag){case 5:Xn||eu(t,e);case 6:var s=kn,r=Dr;kn=null,Bo(n,e,t),kn=s,Dr=r,kn!==null&&(Dr?(n=kn,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):kn.removeChild(t.stateNode));break;case 18:kn!==null&&(Dr?(n=kn,t=t.stateNode,n.nodeType===8?qv(n.parentNode,t):n.nodeType===1&&qv(n,t),cf(n)):qv(kn,t.stateNode));break;case 4:s=kn,r=Dr,kn=t.stateNode.containerInfo,Dr=!0,Bo(n,e,t),kn=s,Dr=r;break;case 0:case 11:case 14:case 15:if(!Xn&&(s=t.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var i=r,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&hw(t,e,o),r=r.next}while(r!==s)}Bo(n,e,t);break;case 1:if(!Xn&&(eu(t,e),s=t.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=t.memoizedProps,s.state=t.memoizedState,s.componentWillUnmount()}catch(a){Qt(t,e,a)}Bo(n,e,t);break;case 21:Bo(n,e,t);break;case 22:t.mode&1?(Xn=(s=Xn)||t.memoizedState!==null,Bo(n,e,t),Xn=s):Bo(n,e,t);break;default:Bo(n,e,t)}}function HI(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new O7),e.forEach(function(s){var r=W7.bind(null,n,s);t.has(s)||(t.add(s),s.then(r,r))})}}function Ar(n,e){var t=e.deletions;if(t!==null)for(var s=0;s<t.length;s++){var r=t[s];try{var i=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:kn=a.stateNode,Dr=!1;break e;case 3:kn=a.stateNode.containerInfo,Dr=!0;break e;case 4:kn=a.stateNode.containerInfo,Dr=!0;break e}a=a.return}if(kn===null)throw Error(se(160));k2(i,o,r),kn=null,Dr=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(c){Qt(r,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)N2(e,n),e=e.sibling}function N2(n,e){var t=n.alternate,s=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Ar(e,n),Yr(n),s&4){try{Vh(3,n,n.return),ry(3,n)}catch(y){Qt(n,n.return,y)}try{Vh(5,n,n.return)}catch(y){Qt(n,n.return,y)}}break;case 1:Ar(e,n),Yr(n),s&512&&t!==null&&eu(t,t.return);break;case 5:if(Ar(e,n),Yr(n),s&512&&t!==null&&eu(t,t.return),n.flags&32){var r=n.stateNode;try{rf(r,"")}catch(y){Qt(n,n.return,y)}}if(s&4&&(r=n.stateNode,r!=null)){var i=n.memoizedProps,o=t!==null?t.memoizedProps:i,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&eD(r,i),UE(a,o);var c=UE(a,i);for(o=0;o<l.length;o+=2){var d=l[o],h=l[o+1];d==="style"?iD(r,h):d==="dangerouslySetInnerHTML"?sD(r,h):d==="children"?rf(r,h):pb(r,d,h,c)}switch(a){case"input":DE(r,i);break;case"textarea":tD(r,i);break;case"select":var f=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!i.multiple;var m=i.value;m!=null?uu(r,!!i.multiple,m,!1):f!==!!i.multiple&&(i.defaultValue!=null?uu(r,!!i.multiple,i.defaultValue,!0):uu(r,!!i.multiple,i.multiple?[]:"",!1))}r[mf]=i}catch(y){Qt(n,n.return,y)}}break;case 6:if(Ar(e,n),Yr(n),s&4){if(n.stateNode===null)throw Error(se(162));r=n.stateNode,i=n.memoizedProps;try{r.nodeValue=i}catch(y){Qt(n,n.return,y)}}break;case 3:if(Ar(e,n),Yr(n),s&4&&t!==null&&t.memoizedState.isDehydrated)try{cf(e.containerInfo)}catch(y){Qt(n,n.return,y)}break;case 4:Ar(e,n),Yr(n);break;case 13:Ar(e,n),Yr(n),r=n.child,r.flags&8192&&(i=r.memoizedState!==null,r.stateNode.isHidden=i,!i||r.alternate!==null&&r.alternate.memoizedState!==null||(qb=nn())),s&4&&HI(n);break;case 22:if(d=t!==null&&t.memoizedState!==null,n.mode&1?(Xn=(c=Xn)||d,Ar(e,n),Xn=c):Ar(e,n),Yr(n),s&8192){if(c=n.memoizedState!==null,(n.stateNode.isHidden=c)&&!d&&n.mode&1)for(fe=n,d=n.child;d!==null;){for(h=fe=d;fe!==null;){switch(f=fe,m=f.child,f.tag){case 0:case 11:case 14:case 15:Vh(4,f,f.return);break;case 1:eu(f,f.return);var p=f.stateNode;if(typeof p.componentWillUnmount=="function"){s=f,t=f.return;try{e=s,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(y){Qt(s,t,y)}}break;case 5:eu(f,f.return);break;case 22:if(f.memoizedState!==null){zI(h);continue}}m!==null?(m.return=f,fe=m):zI(h)}d=d.sibling}e:for(d=null,h=n;;){if(h.tag===5){if(d===null){d=h;try{r=h.stateNode,c?(i=r.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=rD("display",o))}catch(y){Qt(n,n.return,y)}}}else if(h.tag===6){if(d===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(y){Qt(n,n.return,y)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===n)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===n)break e;for(;h.sibling===null;){if(h.return===null||h.return===n)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Ar(e,n),Yr(n),s&4&&HI(n);break;case 21:break;default:Ar(e,n),Yr(n)}}function Yr(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(P2(t)){var s=t;break e}t=t.return}throw Error(se(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(rf(r,""),s.flags&=-33);var i=KI(n);pw(n,i,r);break;case 3:case 4:var o=s.stateNode.containerInfo,a=KI(n);mw(n,a,o);break;default:throw Error(se(161))}}catch(l){Qt(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function F7(n,e,t){fe=n,L2(n)}function L2(n,e,t){for(var s=(n.mode&1)!==0;fe!==null;){var r=fe,i=r.child;if(r.tag===22&&s){var o=r.memoizedState!==null||sp;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||Xn;a=sp;var c=Xn;if(sp=o,(Xn=l)&&!c)for(fe=r;fe!==null;)o=fe,l=o.child,o.tag===22&&o.memoizedState!==null?qI(r):l!==null?(l.return=o,fe=l):qI(r);for(;i!==null;)fe=i,L2(i),i=i.sibling;fe=r,sp=a,Xn=c}WI(n)}else r.subtreeFlags&8772&&i!==null?(i.return=r,fe=i):WI(n)}}function WI(n){for(;fe!==null;){var e=fe;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Xn||ry(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!Xn)if(t===null)s.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:kr(e.type,t.memoizedProps);s.componentDidUpdate(r,t.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&PI(e,i,s);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}PI(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var d=c.memoizedState;if(d!==null){var h=d.dehydrated;h!==null&&cf(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(se(163))}Xn||e.flags&512&&fw(e)}catch(f){Qt(e,e.return,f)}}if(e===n){fe=null;break}if(t=e.sibling,t!==null){t.return=e.return,fe=t;break}fe=e.return}}function zI(n){for(;fe!==null;){var e=fe;if(e===n){fe=null;break}var t=e.sibling;if(t!==null){t.return=e.return,fe=t;break}fe=e.return}}function qI(n){for(;fe!==null;){var e=fe;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{ry(4,e)}catch(l){Qt(e,t,l)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var r=e.return;try{s.componentDidMount()}catch(l){Qt(e,r,l)}}var i=e.return;try{fw(e)}catch(l){Qt(e,i,l)}break;case 5:var o=e.return;try{fw(e)}catch(l){Qt(e,o,l)}}}catch(l){Qt(e,e.return,l)}if(e===n){fe=null;break}var a=e.sibling;if(a!==null){a.return=e.return,fe=a;break}fe=e.return}}var U7=Math.ceil,Wg=To.ReactCurrentDispatcher,Wb=To.ReactCurrentOwner,fr=To.ReactCurrentBatchConfig,lt=0,Rn=null,cn=null,Vn=0,Gs=0,tu=Ja(0),En=0,Ef=null,ql=0,iy=0,zb=0,$h=null,Ts=null,qb=0,qu=1/0,Gi=null,zg=!1,gw=null,Sa=null,rp=!1,ya=null,qg=0,Bh=0,yw=null,Xp=-1,Jp=0;function hs(){return lt&6?nn():Xp!==-1?Xp:Xp=nn()}function _a(n){return n.mode&1?lt&2&&Vn!==0?Vn&-Vn:T7.transition!==null?(Jp===0&&(Jp=yD()),Jp):(n=pt,n!==0||(n=window.event,n=n===void 0?16:SD(n.type)),n):1}function Ur(n,e,t,s){if(50<Bh)throw Bh=0,yw=null,Error(se(185));Jf(n,t,s),(!(lt&2)||n!==Rn)&&(n===Rn&&(!(lt&2)&&(iy|=t),En===4&&ia(n,Vn)),Rs(n,s),t===1&&lt===0&&!(e.mode&1)&&(qu=nn()+500,ty&&Za()))}function Rs(n,e){var t=n.callbackNode;T9(n,e);var s=kg(n,n===Rn?Vn:0);if(s===0)t!==null&&sI(t),n.callbackNode=null,n.callbackPriority=0;else if(e=s&-s,n.callbackPriority!==e){if(t!=null&&sI(t),e===1)n.tag===0?w7(YI.bind(null,n)):GD(YI.bind(null,n)),y7(function(){!(lt&6)&&Za()}),t=null;else{switch(vD(s)){case 1:t=Eb;break;case 4:t=pD;break;case 16:t=Pg;break;case 536870912:t=gD;break;default:t=Pg}t=$2(t,D2.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function D2(n,e){if(Xp=-1,Jp=0,lt&6)throw Error(se(327));var t=n.callbackNode;if(pu()&&n.callbackNode!==t)return null;var s=kg(n,n===Rn?Vn:0);if(s===0)return null;if(s&30||s&n.expiredLanes||e)e=Yg(n,s);else{e=s;var r=lt;lt|=2;var i=O2();(Rn!==n||Vn!==e)&&(Gi=null,qu=nn()+500,Fl(n,e));do try{B7();break}catch(a){M2(n,a)}while(!0);Lb(),Wg.current=i,lt=r,cn!==null?e=0:(Rn=null,Vn=0,e=En)}if(e!==0){if(e===2&&(r=KE(n),r!==0&&(s=r,e=vw(n,r))),e===1)throw t=Ef,Fl(n,0),ia(n,s),Rs(n,nn()),t;if(e===6)ia(n,s);else{if(r=n.current.alternate,!(s&30)&&!V7(r)&&(e=Yg(n,s),e===2&&(i=KE(n),i!==0&&(s=i,e=vw(n,i))),e===1))throw t=Ef,Fl(n,0),ia(n,s),Rs(n,nn()),t;switch(n.finishedWork=r,n.finishedLanes=s,e){case 0:case 1:throw Error(se(345));case 2:yl(n,Ts,Gi);break;case 3:if(ia(n,s),(s&130023424)===s&&(e=qb+500-nn(),10<e)){if(kg(n,0)!==0)break;if(r=n.suspendedLanes,(r&s)!==s){hs(),n.pingedLanes|=n.suspendedLanes&r;break}n.timeoutHandle=JE(yl.bind(null,n,Ts,Gi),e);break}yl(n,Ts,Gi);break;case 4:if(ia(n,s),(s&4194240)===s)break;for(e=n.eventTimes,r=-1;0<s;){var o=31-Fr(s);i=1<<o,o=e[o],o>r&&(r=o),s&=~i}if(s=r,s=nn()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*U7(s/1960))-s,10<s){n.timeoutHandle=JE(yl.bind(null,n,Ts,Gi),s);break}yl(n,Ts,Gi);break;case 5:yl(n,Ts,Gi);break;default:throw Error(se(329))}}}return Rs(n,nn()),n.callbackNode===t?D2.bind(null,n):null}function vw(n,e){var t=$h;return n.current.memoizedState.isDehydrated&&(Fl(n,e).flags|=256),n=Yg(n,e),n!==2&&(e=Ts,Ts=t,e!==null&&xw(e)),n}function xw(n){Ts===null?Ts=n:Ts.push.apply(Ts,n)}function V7(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var s=0;s<t.length;s++){var r=t[s],i=r.getSnapshot;r=r.value;try{if(!$r(i(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ia(n,e){for(e&=~zb,e&=~iy,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Fr(e),s=1<<t;n[t]=-1,e&=~s}}function YI(n){if(lt&6)throw Error(se(327));pu();var e=kg(n,0);if(!(e&1))return Rs(n,nn()),null;var t=Yg(n,e);if(n.tag!==0&&t===2){var s=KE(n);s!==0&&(e=s,t=vw(n,s))}if(t===1)throw t=Ef,Fl(n,0),ia(n,e),Rs(n,nn()),t;if(t===6)throw Error(se(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,yl(n,Ts,Gi),Rs(n,nn()),null}function Yb(n,e){var t=lt;lt|=1;try{return n(e)}finally{lt=t,lt===0&&(qu=nn()+500,ty&&Za())}}function Yl(n){ya!==null&&ya.tag===0&&!(lt&6)&&pu();var e=lt;lt|=1;var t=fr.transition,s=pt;try{if(fr.transition=null,pt=1,n)return n()}finally{pt=s,fr.transition=t,lt=e,!(lt&6)&&Za()}}function Qb(){Gs=tu.current,kt(tu)}function Fl(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,g7(t)),cn!==null)for(t=cn.return;t!==null;){var s=t;switch(Pb(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&Og();break;case 3:Wu(),kt(As),kt(ns),Ub();break;case 5:Fb(s);break;case 4:Wu();break;case 13:kt(Ot);break;case 19:kt(Ot);break;case 10:Db(s.type._context);break;case 22:case 23:Qb()}t=t.return}if(Rn=n,cn=n=Aa(n.current,null),Vn=Gs=e,En=0,Ef=null,zb=iy=ql=0,Ts=$h=null,Sl!==null){for(e=0;e<Sl.length;e++)if(t=Sl[e],s=t.interleaved,s!==null){t.interleaved=null;var r=s.next,i=t.pending;if(i!==null){var o=i.next;i.next=r,s.next=o}t.pending=s}Sl=null}return n}function M2(n,e){do{var t=cn;try{if(Lb(),qp.current=Hg,Kg){for(var s=Vt.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}Kg=!1}if(zl=0,In=vn=Vt=null,Uh=!1,yf=0,Wb.current=null,t===null||t.return===null){En=1,Ef=e,cn=null;break}e:{var i=n,o=t.return,a=t,l=e;if(e=Vn,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,d=a,h=d.tag;if(!(d.mode&1)&&(h===0||h===11||h===15)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var m=OI(o);if(m!==null){m.flags&=-257,jI(m,o,a,i,e),m.mode&1&&MI(i,c,e),e=m,l=c;var p=e.updateQueue;if(p===null){var y=new Set;y.add(l),e.updateQueue=y}else p.add(l);break e}else{if(!(e&1)){MI(i,c,e),Xb();break e}l=Error(se(426))}}else if(Nt&&a.mode&1){var v=OI(o);if(v!==null){!(v.flags&65536)&&(v.flags|=256),jI(v,o,a,i,e),kb(zu(l,a));break e}}i=l=zu(l,a),En!==4&&(En=2),$h===null?$h=[i]:$h.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var x=v2(i,l,e);CI(i,x);break e;case 1:a=l;var E=i.type,w=i.stateNode;if(!(i.flags&128)&&(typeof E.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Sa===null||!Sa.has(w)))){i.flags|=65536,e&=-e,i.lanes|=e;var b=x2(i,a,e);CI(i,b);break e}}i=i.return}while(i!==null)}F2(t)}catch(C){e=C,cn===t&&t!==null&&(cn=t=t.return);continue}break}while(!0)}function O2(){var n=Wg.current;return Wg.current=Hg,n===null?Hg:n}function Xb(){(En===0||En===3||En===2)&&(En=4),Rn===null||!(ql&268435455)&&!(iy&268435455)||ia(Rn,Vn)}function Yg(n,e){var t=lt;lt|=2;var s=O2();(Rn!==n||Vn!==e)&&(Gi=null,Fl(n,e));do try{$7();break}catch(r){M2(n,r)}while(!0);if(Lb(),lt=t,Wg.current=s,cn!==null)throw Error(se(261));return Rn=null,Vn=0,En}function $7(){for(;cn!==null;)j2(cn)}function B7(){for(;cn!==null&&!f9();)j2(cn)}function j2(n){var e=V2(n.alternate,n,Gs);n.memoizedProps=n.pendingProps,e===null?F2(n):cn=e,Wb.current=null}function F2(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=M7(t,e),t!==null){t.flags&=32767,cn=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{En=6,cn=null;return}}else if(t=D7(t,e,Gs),t!==null){cn=t;return}if(e=e.sibling,e!==null){cn=e;return}cn=e=n}while(e!==null);En===0&&(En=5)}function yl(n,e,t){var s=pt,r=fr.transition;try{fr.transition=null,pt=1,G7(n,e,t,s)}finally{fr.transition=r,pt=s}return null}function G7(n,e,t,s){do pu();while(ya!==null);if(lt&6)throw Error(se(327));t=n.finishedWork;var r=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(se(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(b9(n,i),n===Rn&&(cn=Rn=null,Vn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||rp||(rp=!0,$2(Pg,function(){return pu(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=fr.transition,fr.transition=null;var o=pt;pt=1;var a=lt;lt|=4,Wb.current=null,j7(n,t),N2(t,n),c7(QE),Ng=!!YE,QE=YE=null,n.current=t,F7(t),m9(),lt=a,pt=o,fr.transition=i}else n.current=t;if(rp&&(rp=!1,ya=n,qg=r),i=n.pendingLanes,i===0&&(Sa=null),y9(t.stateNode),Rs(n,nn()),e!==null)for(s=n.onRecoverableError,t=0;t<e.length;t++)r=e[t],s(r.value,{componentStack:r.stack,digest:r.digest});if(zg)throw zg=!1,n=gw,gw=null,n;return qg&1&&n.tag!==0&&pu(),i=n.pendingLanes,i&1?n===yw?Bh++:(Bh=0,yw=n):Bh=0,Za(),null}function pu(){if(ya!==null){var n=vD(qg),e=fr.transition,t=pt;try{if(fr.transition=null,pt=16>n?16:n,ya===null)var s=!1;else{if(n=ya,ya=null,qg=0,lt&6)throw Error(se(331));var r=lt;for(lt|=4,fe=n.current;fe!==null;){var i=fe,o=i.child;if(fe.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(fe=c;fe!==null;){var d=fe;switch(d.tag){case 0:case 11:case 15:Vh(8,d,i)}var h=d.child;if(h!==null)h.return=d,fe=h;else for(;fe!==null;){d=fe;var f=d.sibling,m=d.return;if(C2(d),d===c){fe=null;break}if(f!==null){f.return=m,fe=f;break}fe=m}}}var p=i.alternate;if(p!==null){var y=p.child;if(y!==null){p.child=null;do{var v=y.sibling;y.sibling=null,y=v}while(y!==null)}}fe=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,fe=o;else e:for(;fe!==null;){if(i=fe,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Vh(9,i,i.return)}var x=i.sibling;if(x!==null){x.return=i.return,fe=x;break e}fe=i.return}}var E=n.current;for(fe=E;fe!==null;){o=fe;var w=o.child;if(o.subtreeFlags&2064&&w!==null)w.return=o,fe=w;else e:for(o=E;fe!==null;){if(a=fe,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:ry(9,a)}}catch(C){Qt(a,a.return,C)}if(a===o){fe=null;break e}var b=a.sibling;if(b!==null){b.return=a.return,fe=b;break e}fe=a.return}}if(lt=r,Za(),di&&typeof di.onPostCommitFiberRoot=="function")try{di.onPostCommitFiberRoot(Q0,n)}catch{}s=!0}return s}finally{pt=t,fr.transition=e}}return!1}function QI(n,e,t){e=zu(t,e),e=v2(n,e,1),n=ba(n,e,1),e=hs(),n!==null&&(Jf(n,1,e),Rs(n,e))}function Qt(n,e,t){if(n.tag===3)QI(n,n,t);else for(;e!==null;){if(e.tag===3){QI(e,n,t);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Sa===null||!Sa.has(s))){n=zu(t,n),n=x2(e,n,1),e=ba(e,n,1),n=hs(),e!==null&&(Jf(e,1,n),Rs(e,n));break}}e=e.return}}function K7(n,e,t){var s=n.pingCache;s!==null&&s.delete(e),e=hs(),n.pingedLanes|=n.suspendedLanes&t,Rn===n&&(Vn&t)===t&&(En===4||En===3&&(Vn&130023424)===Vn&&500>nn()-qb?Fl(n,0):zb|=t),Rs(n,e)}function U2(n,e){e===0&&(n.mode&1?(e=qm,qm<<=1,!(qm&130023424)&&(qm=4194304)):e=1);var t=hs();n=lo(n,e),n!==null&&(Jf(n,e,t),Rs(n,t))}function H7(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),U2(n,t)}function W7(n,e){var t=0;switch(n.tag){case 13:var s=n.stateNode,r=n.memoizedState;r!==null&&(t=r.retryLane);break;case 19:s=n.stateNode;break;default:throw Error(se(314))}s!==null&&s.delete(e),U2(n,t)}var V2;V2=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||As.current)Ss=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Ss=!1,L7(n,e,t);Ss=!!(n.flags&131072)}else Ss=!1,Nt&&e.flags&1048576&&KD(e,Ug,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;Qp(n,e),n=e.pendingProps;var r=Gu(e,ns.current);mu(e,t),r=$b(null,e,s,n,r,t);var i=Bb();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Is(s)?(i=!0,jg(e)):i=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Ob(e),r.updater=sy,e.stateNode=r,r._reactInternals=e,iw(e,s,n,t),e=lw(null,e,s,!0,i,t)):(e.tag=0,Nt&&i&&Cb(e),as(null,e,r,t),e=e.child),e;case 16:s=e.elementType;e:{switch(Qp(n,e),n=e.pendingProps,r=s._init,s=r(s._payload),e.type=s,r=e.tag=q7(s),n=kr(s,n),r){case 0:e=aw(null,e,s,n,t);break e;case 1:e=VI(null,e,s,n,t);break e;case 11:e=FI(null,e,s,n,t);break e;case 14:e=UI(null,e,s,kr(s.type,n),t);break e}throw Error(se(306,s,""))}return e;case 0:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:kr(s,r),aw(n,e,s,r,t);case 1:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:kr(s,r),VI(n,e,s,r,t);case 3:e:{if(b2(e),n===null)throw Error(se(387));s=e.pendingProps,i=e.memoizedState,r=i.element,QD(n,e),Bg(e,s,null,t);var o=e.memoizedState;if(s=o.element,i.isDehydrated)if(i={element:s,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){r=zu(Error(se(423)),e),e=$I(n,e,s,t,r);break e}else if(s!==r){r=zu(Error(se(424)),e),e=$I(n,e,s,t,r);break e}else for(qs=Ta(e.stateNode.containerInfo.firstChild),Xs=e,Nt=!0,Or=null,t=qD(e,null,s,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Ku(),s===r){e=co(n,e,t);break e}as(n,e,s,t)}e=e.child}return e;case 5:return XD(e),n===null&&nw(e),s=e.type,r=e.pendingProps,i=n!==null?n.memoizedProps:null,o=r.children,XE(s,r)?o=null:i!==null&&XE(s,i)&&(e.flags|=32),T2(n,e),as(n,e,o,t),e.child;case 6:return n===null&&nw(e),null;case 13:return S2(n,e,t);case 4:return jb(e,e.stateNode.containerInfo),s=e.pendingProps,n===null?e.child=Hu(e,null,s,t):as(n,e,s,t),e.child;case 11:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:kr(s,r),FI(n,e,s,r,t);case 7:return as(n,e,e.pendingProps,t),e.child;case 8:return as(n,e,e.pendingProps.children,t),e.child;case 12:return as(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(s=e.type._context,r=e.pendingProps,i=e.memoizedProps,o=r.value,At(Vg,s._currentValue),s._currentValue=o,i!==null)if($r(i.value,o)){if(i.children===r.children&&!As.current){e=co(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===s){if(i.tag===1){l=Zi(-1,t&-t),l.tag=2;var c=i.updateQueue;if(c!==null){c=c.shared;var d=c.pending;d===null?l.next=l:(l.next=d.next,d.next=l),c.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),sw(i.return,t,e),a.lanes|=t;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(se(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),sw(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}as(n,e,r.children,t),e=e.child}return e;case 9:return r=e.type,s=e.pendingProps.children,mu(e,t),r=yr(r),s=s(r),e.flags|=1,as(n,e,s,t),e.child;case 14:return s=e.type,r=kr(s,e.pendingProps),r=kr(s.type,r),UI(n,e,s,r,t);case 15:return E2(n,e,e.type,e.pendingProps,t);case 17:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:kr(s,r),Qp(n,e),e.tag=1,Is(s)?(n=!0,jg(e)):n=!1,mu(e,t),y2(e,s,r),iw(e,s,r,t),lw(null,e,s,!0,n,t);case 19:return _2(n,e,t);case 22:return w2(n,e,t)}throw Error(se(156,e.tag))};function $2(n,e){return mD(n,e)}function z7(n,e,t,s){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function hr(n,e,t,s){return new z7(n,e,t,s)}function Jb(n){return n=n.prototype,!(!n||!n.isReactComponent)}function q7(n){if(typeof n=="function")return Jb(n)?1:0;if(n!=null){if(n=n.$$typeof,n===yb)return 11;if(n===vb)return 14}return 2}function Aa(n,e){var t=n.alternate;return t===null?(t=hr(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Zp(n,e,t,s,r,i){var o=2;if(s=n,typeof n=="function")Jb(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case Hc:return Ul(t.children,r,i,e);case gb:o=8,r|=8;break;case CE:return n=hr(12,t,e,r|2),n.elementType=CE,n.lanes=i,n;case PE:return n=hr(13,t,e,r),n.elementType=PE,n.lanes=i,n;case kE:return n=hr(19,t,e,r),n.elementType=kE,n.lanes=i,n;case XL:return oy(t,r,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case YL:o=10;break e;case QL:o=9;break e;case yb:o=11;break e;case vb:o=14;break e;case Xo:o=16,s=null;break e}throw Error(se(130,n==null?n:typeof n,""))}return e=hr(o,t,e,r),e.elementType=n,e.type=s,e.lanes=i,e}function Ul(n,e,t,s){return n=hr(7,n,s,e),n.lanes=t,n}function oy(n,e,t,s){return n=hr(22,n,s,e),n.elementType=XL,n.lanes=t,n.stateNode={isHidden:!1},n}function nx(n,e,t){return n=hr(6,n,null,e),n.lanes=t,n}function sx(n,e,t){return e=hr(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function Y7(n,e,t,s,r){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=jv(0),this.expirationTimes=jv(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=jv(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Zb(n,e,t,s,r,i,o,a,l){return n=new Y7(n,e,t,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=hr(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:s,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ob(i),n}function Q7(n,e,t){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Kc,key:s==null?null:""+s,children:n,containerInfo:e,implementation:t}}function B2(n){if(!n)return Oa;n=n._reactInternals;e:{if(ac(n)!==n||n.tag!==1)throw Error(se(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Is(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(se(171))}if(n.tag===1){var t=n.type;if(Is(t))return BD(n,t,e)}return e}function G2(n,e,t,s,r,i,o,a,l){return n=Zb(t,s,!0,n,r,i,o,a,l),n.context=B2(null),t=n.current,s=hs(),r=_a(t),i=Zi(s,r),i.callback=e??null,ba(t,i,r),n.current.lanes=r,Jf(n,r,s),Rs(n,s),n}function ay(n,e,t,s){var r=e.current,i=hs(),o=_a(r);return t=B2(t),e.context===null?e.context=t:e.pendingContext=t,e=Zi(i,o),e.payload={element:n},s=s===void 0?null:s,s!==null&&(e.callback=s),n=ba(r,e,o),n!==null&&(Ur(n,r,o,i),zp(n,r,o)),o}function Qg(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function XI(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function eS(n,e){XI(n,e),(n=n.alternate)&&XI(n,e)}function X7(){return null}var K2=typeof reportError=="function"?reportError:function(n){console.error(n)};function tS(n){this._internalRoot=n}ly.prototype.render=tS.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(se(409));ay(n,e,null,null)};ly.prototype.unmount=tS.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Yl(function(){ay(null,n,null,null)}),e[ao]=null}};function ly(n){this._internalRoot=n}ly.prototype.unstable_scheduleHydration=function(n){if(n){var e=wD();n={blockedOn:null,target:n,priority:e};for(var t=0;t<ra.length&&e!==0&&e<ra[t].priority;t++);ra.splice(t,0,n),t===0&&bD(n)}};function nS(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function cy(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function JI(){}function J7(n,e,t,s,r){if(r){if(typeof s=="function"){var i=s;s=function(){var c=Qg(o);i.call(c)}}var o=G2(e,s,n,0,null,!1,!1,"",JI);return n._reactRootContainer=o,n[ao]=o.current,hf(n.nodeType===8?n.parentNode:n),Yl(),o}for(;r=n.lastChild;)n.removeChild(r);if(typeof s=="function"){var a=s;s=function(){var c=Qg(l);a.call(c)}}var l=Zb(n,0,!1,null,null,!1,!1,"",JI);return n._reactRootContainer=l,n[ao]=l.current,hf(n.nodeType===8?n.parentNode:n),Yl(function(){ay(e,l,t,s)}),l}function uy(n,e,t,s,r){var i=t._reactRootContainer;if(i){var o=i;if(typeof r=="function"){var a=r;r=function(){var l=Qg(o);a.call(l)}}ay(e,o,n,r)}else o=J7(t,e,n,r,s);return Qg(o)}xD=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Eh(e.pendingLanes);t!==0&&(wb(e,t|1),Rs(e,nn()),!(lt&6)&&(qu=nn()+500,Za()))}break;case 13:Yl(function(){var s=lo(n,1);if(s!==null){var r=hs();Ur(s,n,1,r)}}),eS(n,1)}};Tb=function(n){if(n.tag===13){var e=lo(n,134217728);if(e!==null){var t=hs();Ur(e,n,134217728,t)}eS(n,134217728)}};ED=function(n){if(n.tag===13){var e=_a(n),t=lo(n,e);if(t!==null){var s=hs();Ur(t,n,e,s)}eS(n,e)}};wD=function(){return pt};TD=function(n,e){var t=pt;try{return pt=n,e()}finally{pt=t}};$E=function(n,e,t){switch(e){case"input":if(DE(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var s=t[e];if(s!==n&&s.form===n.form){var r=ey(s);if(!r)throw Error(se(90));ZL(s),DE(s,r)}}}break;case"textarea":tD(n,t);break;case"select":e=t.value,e!=null&&uu(n,!!t.multiple,e,!1)}};lD=Yb;cD=Yl;var Z7={usingClientEntryPoint:!1,Events:[em,Yc,ey,oD,aD,Yb]},uh={findFiberByHostInstance:bl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},eG={bundleType:uh.bundleType,version:uh.version,rendererPackageName:uh.rendererPackageName,rendererConfig:uh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:To.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=hD(n),n===null?null:n.stateNode},findFiberByHostInstance:uh.findFiberByHostInstance||X7,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ip=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ip.isDisabled&&ip.supportsFiber)try{Q0=ip.inject(eG),di=ip}catch{}}nr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Z7;nr.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nS(e))throw Error(se(200));return Q7(n,e,null,t)};nr.createRoot=function(n,e){if(!nS(n))throw Error(se(299));var t=!1,s="",r=K2;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Zb(n,1,!1,null,null,t,!1,s,r),n[ao]=e.current,hf(n.nodeType===8?n.parentNode:n),new tS(e)};nr.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(se(188)):(n=Object.keys(n).join(","),Error(se(268,n)));return n=hD(e),n=n===null?null:n.stateNode,n};nr.flushSync=function(n){return Yl(n)};nr.hydrate=function(n,e,t){if(!cy(e))throw Error(se(200));return uy(null,n,e,!0,t)};nr.hydrateRoot=function(n,e,t){if(!nS(n))throw Error(se(405));var s=t!=null&&t.hydratedSources||null,r=!1,i="",o=K2;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=G2(e,null,n,1,t??null,r,!1,i,o),n[ao]=e.current,hf(n),s)for(n=0;n<s.length;n++)t=s[n],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new ly(e)};nr.render=function(n,e,t){if(!cy(e))throw Error(se(200));return uy(null,n,e,!1,t)};nr.unmountComponentAtNode=function(n){if(!cy(n))throw Error(se(40));return n._reactRootContainer?(Yl(function(){uy(null,null,n,!1,function(){n._reactRootContainer=null,n[ao]=null})}),!0):!1};nr.unstable_batchedUpdates=Yb;nr.unstable_renderSubtreeIntoContainer=function(n,e,t,s){if(!cy(t))throw Error(se(200));if(n==null||n._reactInternals===void 0)throw Error(se(38));return uy(n,e,t,!1,s)};nr.version="18.3.1-next-f1338f8080-20240426";function H2(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(H2)}catch(n){console.error(n)}}H2(),HL.exports=nr;var lc=HL.exports;const tG=lL(lc);function ie(n,e,{checkForDefaultPrevented:t=!0}={}){return function(r){if(n==null||n(r),t===!1||!r.defaultPrevented)return e==null?void 0:e(r)}}function ZI(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function dy(...n){return e=>{let t=!1;const s=n.map(r=>{const i=ZI(r,e);return!t&&typeof i=="function"&&(t=!0),i});if(t)return()=>{for(let r=0;r<s.length;r++){const i=s[r];typeof i=="function"?i():ZI(n[r],null)}}}}function ze(...n){return T.useCallback(dy(...n),n)}function nG(n,e){const t=T.createContext(e),s=i=>{const{children:o,...a}=i,l=T.useMemo(()=>a,Object.values(a));return u.jsx(t.Provider,{value:l,children:o})};s.displayName=n+"Provider";function r(i){const o=T.useContext(t);if(o)return o;if(e!==void 0)return e;throw new Error(`\`${i}\` must be used within \`${n}\``)}return[s,r]}function Ds(n,e=[]){let t=[];function s(i,o){const a=T.createContext(o),l=t.length;t=[...t,o];const c=h=>{var x;const{scope:f,children:m,...p}=h,y=((x=f==null?void 0:f[n])==null?void 0:x[l])||a,v=T.useMemo(()=>p,Object.values(p));return u.jsx(y.Provider,{value:v,children:m})};c.displayName=i+"Provider";function d(h,f){var y;const m=((y=f==null?void 0:f[n])==null?void 0:y[l])||a,p=T.useContext(m);if(p)return p;if(o!==void 0)return o;throw new Error(`\`${h}\` must be used within \`${i}\``)}return[c,d]}const r=()=>{const i=t.map(o=>T.createContext(o));return function(a){const l=(a==null?void 0:a[n])||i;return T.useMemo(()=>({[`__scope${n}`]:{...a,[n]:l}}),[a,l])}};return r.scopeName=n,[s,sG(r,...e)]}function sG(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const s=n.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(i){const o=s.reduce((a,{useScope:l,scopeName:c})=>{const h=l(i)[`__scope${c}`];return{...a,...h}},{});return T.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}function Ql(n){const e=iG(n),t=T.forwardRef((s,r)=>{const{children:i,...o}=s,a=T.Children.toArray(i),l=a.find(aG);if(l){const c=l.props.children,d=a.map(h=>h===l?T.Children.count(c)>1?T.Children.only(null):T.isValidElement(c)?c.props.children:null:h);return u.jsx(e,{...o,ref:r,children:T.isValidElement(c)?T.cloneElement(c,void 0,d):null})}return u.jsx(e,{...o,ref:r,children:i})});return t.displayName=`${n}.Slot`,t}var rG=Ql("Slot");function iG(n){const e=T.forwardRef((t,s)=>{const{children:r,...i}=t;if(T.isValidElement(r)){const o=cG(r),a=lG(i,r.props);return r.type!==T.Fragment&&(a.ref=s?dy(s,o):o),T.cloneElement(r,a)}return T.Children.count(r)>1?T.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var W2=Symbol("radix.slottable");function oG(n){const e=({children:t})=>u.jsx(u.Fragment,{children:t});return e.displayName=`${n}.Slottable`,e.__radixId=W2,e}function aG(n){return T.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===W2}function lG(n,e){const t={...e};for(const s in e){const r=n[s],i=e[s];/^on[A-Z]/.test(s)?r&&i?t[s]=(...a)=>{i(...a),r(...a)}:r&&(t[s]=r):s==="style"?t[s]={...r,...i}:s==="className"&&(t[s]=[r,i].filter(Boolean).join(" "))}return{...n,...t}}function cG(n){var s,r;let e=(s=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(r=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}function vd(n){const e=n+"CollectionProvider",[t,s]=Ds(e),[r,i]=t(e,{collectionRef:{current:null},itemMap:new Map}),o=y=>{const{scope:v,children:x}=y,E=vt.useRef(null),w=vt.useRef(new Map).current;return u.jsx(r,{scope:v,itemMap:w,collectionRef:E,children:x})};o.displayName=e;const a=n+"CollectionSlot",l=Ql(a),c=vt.forwardRef((y,v)=>{const{scope:x,children:E}=y,w=i(a,x),b=ze(v,w.collectionRef);return u.jsx(l,{ref:b,children:E})});c.displayName=a;const d=n+"CollectionItemSlot",h="data-radix-collection-item",f=Ql(d),m=vt.forwardRef((y,v)=>{const{scope:x,children:E,...w}=y,b=vt.useRef(null),C=ze(v,b),D=i(d,x);return vt.useEffect(()=>(D.itemMap.set(b,{ref:b,...w}),()=>void D.itemMap.delete(b))),u.jsx(f,{[h]:"",ref:C,children:E})});m.displayName=d;function p(y){const v=i(n+"CollectionConsumer",y);return vt.useCallback(()=>{const E=v.collectionRef.current;if(!E)return[];const w=Array.from(E.querySelectorAll(`[${h}]`));return Array.from(v.itemMap.values()).sort((D,_)=>w.indexOf(D.ref.current)-w.indexOf(_.ref.current))},[v.collectionRef,v.itemMap])}return[{Provider:o,Slot:c,ItemSlot:m},p,s]}var uG=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Se=uG.reduce((n,e)=>{const t=Ql(`Primitive.${e}`),s=T.forwardRef((r,i)=>{const{asChild:o,...a}=r,l=o?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),u.jsx(l,{...a,ref:i})});return s.displayName=`Primitive.${e}`,{...n,[e]:s}},{});function sS(n,e){n&&lc.flushSync(()=>n.dispatchEvent(e))}function Bn(n){const e=T.useRef(n);return T.useEffect(()=>{e.current=n}),T.useMemo(()=>(...t)=>{var s;return(s=e.current)==null?void 0:s.call(e,...t)},[])}function dG(n,e=globalThis==null?void 0:globalThis.document){const t=Bn(n);T.useEffect(()=>{const s=r=>{r.key==="Escape"&&t(r)};return e.addEventListener("keydown",s,{capture:!0}),()=>e.removeEventListener("keydown",s,{capture:!0})},[t,e])}var hG="DismissableLayer",Ew="dismissableLayer.update",fG="dismissableLayer.pointerDownOutside",mG="dismissableLayer.focusOutside",eR,z2=T.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),xd=T.forwardRef((n,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:s,onPointerDownOutside:r,onFocusOutside:i,onInteractOutside:o,onDismiss:a,...l}=n,c=T.useContext(z2),[d,h]=T.useState(null),f=(d==null?void 0:d.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,m]=T.useState({}),p=ze(e,_=>h(_)),y=Array.from(c.layers),[v]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),x=y.indexOf(v),E=d?y.indexOf(d):-1,w=c.layersWithOutsidePointerEventsDisabled.size>0,b=E>=x,C=gG(_=>{const S=_.target,I=[...c.branches].some(R=>R.contains(S));!b||I||(r==null||r(_),o==null||o(_),_.defaultPrevented||a==null||a())},f),D=yG(_=>{const S=_.target;[...c.branches].some(R=>R.contains(S))||(i==null||i(_),o==null||o(_),_.defaultPrevented||a==null||a())},f);return dG(_=>{E===c.layers.size-1&&(s==null||s(_),!_.defaultPrevented&&a&&(_.preventDefault(),a()))},f),T.useEffect(()=>{if(d)return t&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(eR=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(d)),c.layers.add(d),tR(),()=>{t&&c.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=eR)}},[d,f,t,c]),T.useEffect(()=>()=>{d&&(c.layers.delete(d),c.layersWithOutsidePointerEventsDisabled.delete(d),tR())},[d,c]),T.useEffect(()=>{const _=()=>m({});return document.addEventListener(Ew,_),()=>document.removeEventListener(Ew,_)},[]),u.jsx(Se.div,{...l,ref:p,style:{pointerEvents:w?b?"auto":"none":void 0,...n.style},onFocusCapture:ie(n.onFocusCapture,D.onFocusCapture),onBlurCapture:ie(n.onBlurCapture,D.onBlurCapture),onPointerDownCapture:ie(n.onPointerDownCapture,C.onPointerDownCapture)})});xd.displayName=hG;var pG="DismissableLayerBranch",q2=T.forwardRef((n,e)=>{const t=T.useContext(z2),s=T.useRef(null),r=ze(e,s);return T.useEffect(()=>{const i=s.current;if(i)return t.branches.add(i),()=>{t.branches.delete(i)}},[t.branches]),u.jsx(Se.div,{...n,ref:r})});q2.displayName=pG;function gG(n,e=globalThis==null?void 0:globalThis.document){const t=Bn(n),s=T.useRef(!1),r=T.useRef(()=>{});return T.useEffect(()=>{const i=a=>{if(a.target&&!s.current){let l=function(){Y2(fG,t,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",r.current),r.current=l,e.addEventListener("click",r.current,{once:!0})):l()}else e.removeEventListener("click",r.current);s.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",i),e.removeEventListener("click",r.current)}},[e,t]),{onPointerDownCapture:()=>s.current=!0}}function yG(n,e=globalThis==null?void 0:globalThis.document){const t=Bn(n),s=T.useRef(!1);return T.useEffect(()=>{const r=i=>{i.target&&!s.current&&Y2(mG,t,{originalEvent:i},{discrete:!1})};return e.addEventListener("focusin",r),()=>e.removeEventListener("focusin",r)},[e,t]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}function tR(){const n=new CustomEvent(Ew);document.dispatchEvent(n)}function Y2(n,e,t,{discrete:s}){const r=t.originalEvent.target,i=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&r.addEventListener(n,e,{once:!0}),s?sS(r,i):r.dispatchEvent(i)}var vG=xd,xG=q2,hn=globalThis!=null&&globalThis.document?T.useLayoutEffect:()=>{},EG="Portal",nm=T.forwardRef((n,e)=>{var a;const{container:t,...s}=n,[r,i]=T.useState(!1);hn(()=>i(!0),[]);const o=t||r&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return o?tG.createPortal(u.jsx(Se.div,{...s,ref:e}),o):null});nm.displayName=EG;function wG(n,e){return T.useReducer((t,s)=>e[t][s]??t,n)}var wr=n=>{const{present:e,children:t}=n,s=TG(e),r=typeof t=="function"?t({present:s.isPresent}):T.Children.only(t),i=ze(s.ref,bG(r));return typeof t=="function"||s.isPresent?T.cloneElement(r,{ref:i}):null};wr.displayName="Presence";function TG(n){const[e,t]=T.useState(),s=T.useRef({}),r=T.useRef(n),i=T.useRef("none"),o=n?"mounted":"unmounted",[a,l]=wG(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return T.useEffect(()=>{const c=op(s.current);i.current=a==="mounted"?c:"none"},[a]),hn(()=>{const c=s.current,d=r.current;if(d!==n){const f=i.current,m=op(c);n?l("MOUNT"):m==="none"||(c==null?void 0:c.display)==="none"?l("UNMOUNT"):l(d&&f!==m?"ANIMATION_OUT":"UNMOUNT"),r.current=n}},[n,l]),hn(()=>{if(e){let c;const d=e.ownerDocument.defaultView??window,h=m=>{const y=op(s.current).includes(m.animationName);if(m.target===e&&y&&(l("ANIMATION_END"),!r.current)){const v=e.style.animationFillMode;e.style.animationFillMode="forwards",c=d.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=v)})}},f=m=>{m.target===e&&(i.current=op(s.current))};return e.addEventListener("animationstart",f),e.addEventListener("animationcancel",h),e.addEventListener("animationend",h),()=>{d.clearTimeout(c),e.removeEventListener("animationstart",f),e.removeEventListener("animationcancel",h),e.removeEventListener("animationend",h)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:T.useCallback(c=>{c&&(s.current=getComputedStyle(c)),t(c)},[])}}function op(n){return(n==null?void 0:n.animationName)||"none"}function bG(n){var s,r;let e=(s=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(r=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}function Br({prop:n,defaultProp:e,onChange:t=()=>{}}){const[s,r]=SG({defaultProp:e,onChange:t}),i=n!==void 0,o=i?n:s,a=Bn(t),l=T.useCallback(c=>{if(i){const h=typeof c=="function"?c(n):c;h!==n&&a(h)}else r(c)},[i,n,r,a]);return[o,l]}function SG({defaultProp:n,onChange:e}){const t=T.useState(n),[s]=t,r=T.useRef(s),i=Bn(e);return T.useEffect(()=>{r.current!==s&&(i(s),r.current=s)},[s,r,i]),t}var _G="VisuallyHidden",sm=T.forwardRef((n,e)=>u.jsx(Se.span,{...n,ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...n.style}}));sm.displayName=_G;var AG=sm,rS="ToastProvider",[iS,IG,RG]=vd("Toast"),[Q2,Ppe]=Ds("Toast",[RG]),[CG,hy]=Q2(rS),X2=n=>{const{__scopeToast:e,label:t="Notification",duration:s=5e3,swipeDirection:r="right",swipeThreshold:i=50,children:o}=n,[a,l]=T.useState(null),[c,d]=T.useState(0),h=T.useRef(!1),f=T.useRef(!1);return t.trim()||console.error(`Invalid prop \`label\` supplied to \`${rS}\`. Expected non-empty \`string\`.`),u.jsx(iS.Provider,{scope:e,children:u.jsx(CG,{scope:e,label:t,duration:s,swipeDirection:r,swipeThreshold:i,toastCount:c,viewport:a,onViewportChange:l,onToastAdd:T.useCallback(()=>d(m=>m+1),[]),onToastRemove:T.useCallback(()=>d(m=>m-1),[]),isFocusedToastEscapeKeyDownRef:h,isClosePausedRef:f,children:o})})};X2.displayName=rS;var J2="ToastViewport",PG=["F8"],ww="toast.viewportPause",Tw="toast.viewportResume",Z2=T.forwardRef((n,e)=>{const{__scopeToast:t,hotkey:s=PG,label:r="Notifications ({hotkey})",...i}=n,o=hy(J2,t),a=IG(t),l=T.useRef(null),c=T.useRef(null),d=T.useRef(null),h=T.useRef(null),f=ze(e,h,o.onViewportChange),m=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),p=o.toastCount>0;T.useEffect(()=>{const v=x=>{var w;s.length!==0&&s.every(b=>x[b]||x.code===b)&&((w=h.current)==null||w.focus())};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[s]),T.useEffect(()=>{const v=l.current,x=h.current;if(p&&v&&x){const E=()=>{if(!o.isClosePausedRef.current){const D=new CustomEvent(ww);x.dispatchEvent(D),o.isClosePausedRef.current=!0}},w=()=>{if(o.isClosePausedRef.current){const D=new CustomEvent(Tw);x.dispatchEvent(D),o.isClosePausedRef.current=!1}},b=D=>{!v.contains(D.relatedTarget)&&w()},C=()=>{v.contains(document.activeElement)||w()};return v.addEventListener("focusin",E),v.addEventListener("focusout",b),v.addEventListener("pointermove",E),v.addEventListener("pointerleave",C),window.addEventListener("blur",E),window.addEventListener("focus",w),()=>{v.removeEventListener("focusin",E),v.removeEventListener("focusout",b),v.removeEventListener("pointermove",E),v.removeEventListener("pointerleave",C),window.removeEventListener("blur",E),window.removeEventListener("focus",w)}}},[p,o.isClosePausedRef]);const y=T.useCallback(({tabbingDirection:v})=>{const E=a().map(w=>{const b=w.ref.current,C=[b,...GG(b)];return v==="forwards"?C:C.reverse()});return(v==="forwards"?E.reverse():E).flat()},[a]);return T.useEffect(()=>{const v=h.current;if(v){const x=E=>{var C,D,_;const w=E.altKey||E.ctrlKey||E.metaKey;if(E.key==="Tab"&&!w){const S=document.activeElement,I=E.shiftKey;if(E.target===v&&I){(C=c.current)==null||C.focus();return}const L=y({tabbingDirection:I?"backwards":"forwards"}),M=L.findIndex(G=>G===S);rx(L.slice(M+1))?E.preventDefault():I?(D=c.current)==null||D.focus():(_=d.current)==null||_.focus()}};return v.addEventListener("keydown",x),()=>v.removeEventListener("keydown",x)}},[a,y]),u.jsxs(xG,{ref:l,role:"region","aria-label":r.replace("{hotkey}",m),tabIndex:-1,style:{pointerEvents:p?void 0:"none"},children:[p&&u.jsx(bw,{ref:c,onFocusFromOutsideViewport:()=>{const v=y({tabbingDirection:"forwards"});rx(v)}}),u.jsx(iS.Slot,{scope:t,children:u.jsx(Se.ol,{tabIndex:-1,...i,ref:f})}),p&&u.jsx(bw,{ref:d,onFocusFromOutsideViewport:()=>{const v=y({tabbingDirection:"backwards"});rx(v)}})]})});Z2.displayName=J2;var eM="ToastFocusProxy",bw=T.forwardRef((n,e)=>{const{__scopeToast:t,onFocusFromOutsideViewport:s,...r}=n,i=hy(eM,t);return u.jsx(sm,{"aria-hidden":!0,tabIndex:0,...r,ref:e,style:{position:"fixed"},onFocus:o=>{var c;const a=o.relatedTarget;!((c=i.viewport)!=null&&c.contains(a))&&s()}})});bw.displayName=eM;var fy="Toast",kG="toast.swipeStart",NG="toast.swipeMove",LG="toast.swipeCancel",DG="toast.swipeEnd",tM=T.forwardRef((n,e)=>{const{forceMount:t,open:s,defaultOpen:r,onOpenChange:i,...o}=n,[a=!0,l]=Br({prop:s,defaultProp:r,onChange:i});return u.jsx(wr,{present:t||a,children:u.jsx(jG,{open:a,...o,ref:e,onClose:()=>l(!1),onPause:Bn(n.onPause),onResume:Bn(n.onResume),onSwipeStart:ie(n.onSwipeStart,c=>{c.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:ie(n.onSwipeMove,c=>{const{x:d,y:h}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","move"),c.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${d}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${h}px`)}),onSwipeCancel:ie(n.onSwipeCancel,c=>{c.currentTarget.setAttribute("data-swipe","cancel"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:ie(n.onSwipeEnd,c=>{const{x:d,y:h}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","end"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${d}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${h}px`),l(!1)})})})});tM.displayName=fy;var[MG,OG]=Q2(fy,{onClose(){}}),jG=T.forwardRef((n,e)=>{const{__scopeToast:t,type:s="foreground",duration:r,open:i,onClose:o,onEscapeKeyDown:a,onPause:l,onResume:c,onSwipeStart:d,onSwipeMove:h,onSwipeCancel:f,onSwipeEnd:m,...p}=n,y=hy(fy,t),[v,x]=T.useState(null),E=ze(e,G=>x(G)),w=T.useRef(null),b=T.useRef(null),C=r||y.duration,D=T.useRef(0),_=T.useRef(C),S=T.useRef(0),{onToastAdd:I,onToastRemove:R}=y,N=Bn(()=>{var V;(v==null?void 0:v.contains(document.activeElement))&&((V=y.viewport)==null||V.focus()),o()}),L=T.useCallback(G=>{!G||G===1/0||(window.clearTimeout(S.current),D.current=new Date().getTime(),S.current=window.setTimeout(N,G))},[N]);T.useEffect(()=>{const G=y.viewport;if(G){const V=()=>{L(_.current),c==null||c()},$=()=>{const F=new Date().getTime()-D.current;_.current=_.current-F,window.clearTimeout(S.current),l==null||l()};return G.addEventListener(ww,$),G.addEventListener(Tw,V),()=>{G.removeEventListener(ww,$),G.removeEventListener(Tw,V)}}},[y.viewport,C,l,c,L]),T.useEffect(()=>{i&&!y.isClosePausedRef.current&&L(C)},[i,C,y.isClosePausedRef,L]),T.useEffect(()=>(I(),()=>R()),[I,R]);const M=T.useMemo(()=>v?lM(v):null,[v]);return y.viewport?u.jsxs(u.Fragment,{children:[M&&u.jsx(FG,{__scopeToast:t,role:"status","aria-live":s==="foreground"?"assertive":"polite","aria-atomic":!0,children:M}),u.jsx(MG,{scope:t,onClose:N,children:lc.createPortal(u.jsx(iS.ItemSlot,{scope:t,children:u.jsx(vG,{asChild:!0,onEscapeKeyDown:ie(a,()=>{y.isFocusedToastEscapeKeyDownRef.current||N(),y.isFocusedToastEscapeKeyDownRef.current=!1}),children:u.jsx(Se.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":i?"open":"closed","data-swipe-direction":y.swipeDirection,...p,ref:E,style:{userSelect:"none",touchAction:"none",...n.style},onKeyDown:ie(n.onKeyDown,G=>{G.key==="Escape"&&(a==null||a(G.nativeEvent),G.nativeEvent.defaultPrevented||(y.isFocusedToastEscapeKeyDownRef.current=!0,N()))}),onPointerDown:ie(n.onPointerDown,G=>{G.button===0&&(w.current={x:G.clientX,y:G.clientY})}),onPointerMove:ie(n.onPointerMove,G=>{if(!w.current)return;const V=G.clientX-w.current.x,$=G.clientY-w.current.y,F=!!b.current,j=["left","right"].includes(y.swipeDirection),U=["left","up"].includes(y.swipeDirection)?Math.min:Math.max,X=j?U(0,V):0,Y=j?0:U(0,$),J=G.pointerType==="touch"?10:2,ae={x:X,y:Y},he={originalEvent:G,delta:ae};F?(b.current=ae,ap(NG,h,he,{discrete:!1})):nR(ae,y.swipeDirection,J)?(b.current=ae,ap(kG,d,he,{discrete:!1}),G.target.setPointerCapture(G.pointerId)):(Math.abs(V)>J||Math.abs($)>J)&&(w.current=null)}),onPointerUp:ie(n.onPointerUp,G=>{const V=b.current,$=G.target;if($.hasPointerCapture(G.pointerId)&&$.releasePointerCapture(G.pointerId),b.current=null,w.current=null,V){const F=G.currentTarget,j={originalEvent:G,delta:V};nR(V,y.swipeDirection,y.swipeThreshold)?ap(DG,m,j,{discrete:!0}):ap(LG,f,j,{discrete:!0}),F.addEventListener("click",U=>U.preventDefault(),{once:!0})}})})})}),y.viewport)})]}):null}),FG=n=>{const{__scopeToast:e,children:t,...s}=n,r=hy(fy,e),[i,o]=T.useState(!1),[a,l]=T.useState(!1);return $G(()=>o(!0)),T.useEffect(()=>{const c=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(c)},[]),a?null:u.jsx(nm,{asChild:!0,children:u.jsx(sm,{...s,children:i&&u.jsxs(u.Fragment,{children:[r.label," ",t]})})})},UG="ToastTitle",nM=T.forwardRef((n,e)=>{const{__scopeToast:t,...s}=n;return u.jsx(Se.div,{...s,ref:e})});nM.displayName=UG;var VG="ToastDescription",sM=T.forwardRef((n,e)=>{const{__scopeToast:t,...s}=n;return u.jsx(Se.div,{...s,ref:e})});sM.displayName=VG;var rM="ToastAction",iM=T.forwardRef((n,e)=>{const{altText:t,...s}=n;return t.trim()?u.jsx(aM,{altText:t,asChild:!0,children:u.jsx(oS,{...s,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${rM}\`. Expected non-empty \`string\`.`),null)});iM.displayName=rM;var oM="ToastClose",oS=T.forwardRef((n,e)=>{const{__scopeToast:t,...s}=n,r=OG(oM,t);return u.jsx(aM,{asChild:!0,children:u.jsx(Se.button,{type:"button",...s,ref:e,onClick:ie(n.onClick,r.onClose)})})});oS.displayName=oM;var aM=T.forwardRef((n,e)=>{const{__scopeToast:t,altText:s,...r}=n;return u.jsx(Se.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":s||void 0,...r,ref:e})});function lM(n){const e=[];return Array.from(n.childNodes).forEach(s=>{if(s.nodeType===s.TEXT_NODE&&s.textContent&&e.push(s.textContent),BG(s)){const r=s.ariaHidden||s.hidden||s.style.display==="none",i=s.dataset.radixToastAnnounceExclude==="";if(!r)if(i){const o=s.dataset.radixToastAnnounceAlt;o&&e.push(o)}else e.push(...lM(s))}}),e}function ap(n,e,t,{discrete:s}){const r=t.originalEvent.currentTarget,i=new CustomEvent(n,{bubbles:!0,cancelable:!0,detail:t});e&&r.addEventListener(n,e,{once:!0}),s?sS(r,i):r.dispatchEvent(i)}var nR=(n,e,t=0)=>{const s=Math.abs(n.x),r=Math.abs(n.y),i=s>r;return e==="left"||e==="right"?i&&s>t:!i&&r>t};function $G(n=()=>{}){const e=Bn(n);hn(()=>{let t=0,s=0;return t=window.requestAnimationFrame(()=>s=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(t),window.cancelAnimationFrame(s)}},[e])}function BG(n){return n.nodeType===n.ELEMENT_NODE}function GG(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const r=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||r?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function rx(n){const e=document.activeElement;return n.some(t=>t===e?!0:(t.focus(),document.activeElement!==e))}var KG=X2,cM=Z2,uM=tM,dM=nM,hM=sM,fM=iM,mM=oS;function pM(n){var e,t,s="";if(typeof n=="string"||typeof n=="number")s+=n;else if(typeof n=="object")if(Array.isArray(n)){var r=n.length;for(e=0;e<r;e++)n[e]&&(t=pM(n[e]))&&(s&&(s+=" "),s+=t)}else for(t in n)n[t]&&(s&&(s+=" "),s+=t);return s}function gM(){for(var n,e,t=0,s="",r=arguments.length;t<r;t++)(n=arguments[t])&&(e=pM(n))&&(s&&(s+=" "),s+=e);return s}const sR=n=>typeof n=="boolean"?`${n}`:n===0?"0":n,rR=gM,my=(n,e)=>t=>{var s;if((e==null?void 0:e.variants)==null)return rR(n,t==null?void 0:t.class,t==null?void 0:t.className);const{variants:r,defaultVariants:i}=e,o=Object.keys(r).map(c=>{const d=t==null?void 0:t[c],h=i==null?void 0:i[c];if(d===null)return null;const f=sR(d)||sR(h);return r[c][f]}),a=t&&Object.entries(t).reduce((c,d)=>{let[h,f]=d;return f===void 0||(c[h]=f),c},{}),l=e==null||(s=e.compoundVariants)===null||s===void 0?void 0:s.reduce((c,d)=>{let{class:h,className:f,...m}=d;return Object.entries(m).every(p=>{let[y,v]=p;return Array.isArray(v)?v.includes({...i,...a}[y]):{...i,...a}[y]===v})?[...c,h,f]:c},[]);return rR(n,o,l,t==null?void 0:t.class,t==null?void 0:t.className)};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HG=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),yM=(...n)=>n.filter((e,t,s)=>!!e&&s.indexOf(e)===t).join(" ");/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var WG={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zG=T.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:s,className:r="",children:i,iconNode:o,...a},l)=>T.createElement("svg",{ref:l,...WG,width:e,height:e,stroke:n,strokeWidth:s?Number(t)*24/Number(e):t,className:yM("lucide",r),...a},[...o.map(([c,d])=>T.createElement(c,d)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=(n,e)=>{const t=T.forwardRef(({className:s,...r},i)=>T.createElement(zG,{ref:i,iconNode:e,className:yM(`lucide-${HG(n)}`,s),...r}));return t.displayName=`${n}`,t};/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iR=me("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qG=me("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YG=me("BookmarkCheck",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z",key:"169p4p"}],["path",{d:"m9 10 2 2 4-4",key:"1gnqz4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QG=me("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XG=me("Bug",[["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1",key:"d7y7pr"}],["path",{d:"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6",key:"xs1cw7"}],["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M6.53 9C4.6 8.8 3 7.1 3 5",key:"32zzws"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"M3 21c0-2.1 1.7-3.9 3.8-4",key:"4p0ekp"}],["path",{d:"M20.97 5c0 2.1-1.6 3.8-3.5 4",key:"18gb23"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M17.2 17c2.1.1 3.8 1.9 3.8 4",key:"k3fwyw"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vM=me("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JG=me("Captions",[["rect",{width:"18",height:"14",x:"3",y:"5",rx:"2",ry:"2",key:"12ruh7"}],["path",{d:"M7 15h4M15 15h2M7 11h2M13 11h4",key:"1ueiar"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aS=me("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lS=me("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uo=me("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=me("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZG=me("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cS=me("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eK=me("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tK=me("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const py=me("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oR=me("Compass",[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nK=me("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uS=me("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sK=me("FileQuestion",[["path",{d:"M12 17h.01",key:"p32p05"}],["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z",key:"1mlx9k"}],["path",{d:"M9.1 9a3 3 0 0 1 5.82 1c0 2-3 3-3 3",key:"mhlwft"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nr=me("Film",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rK=me("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iK=me("Github",[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cc=me("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oK=me("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sw=me("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aK=me("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lK=me("Languages",[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aR=me("Library",[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ix=me("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cK=me("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uK=me("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dK=me("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hK=me("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lR=me("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const li=me("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fK=me("MessagesSquare",[["path",{d:"M14 9a2 2 0 0 1-2 2H6l-4 4V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2z",key:"p1xzt8"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1",key:"1cx29u"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mK=me("Minimize",[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pK=me("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gK=me("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fi=me("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xM=me("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yK=me("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vK=me("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xK=me("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gu=me("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cR=me("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EM=me("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EK=me("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wK=me("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _w=me("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TK=me("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wM=me("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bK=me("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SK=me("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _K=me("TvMinimalPlay",[["path",{d:"M10 7.75a.75.75 0 0 1 1.142-.638l3.664 2.249a.75.75 0 0 1 0 1.278l-3.664 2.25a.75.75 0 0 1-1.142-.64z",key:"1pctta"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xg=me("Tv",[["rect",{width:"20",height:"15",x:"2",y:"7",rx:"2",ry:"2",key:"10ag99"}],["polyline",{points:"17 2 12 7 7 2",key:"11pgbg"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uR=me("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AK=me("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IK=me("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dR=me("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aw=me("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TM=me("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bM=me("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lr=me("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RK=me("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),dS="-",CK=n=>{const e=kK(n),{conflictingClassGroups:t,conflictingClassGroupModifiers:s}=n;return{getClassGroupId:o=>{const a=o.split(dS);return a[0]===""&&a.length!==1&&a.shift(),SM(a,e)||PK(o)},getConflictingClassGroupIds:(o,a)=>{const l=t[o]||[];return a&&s[o]?[...l,...s[o]]:l}}},SM=(n,e)=>{var o;if(n.length===0)return e.classGroupId;const t=n[0],s=e.nextPart.get(t),r=s?SM(n.slice(1),s):void 0;if(r)return r;if(e.validators.length===0)return;const i=n.join(dS);return(o=e.validators.find(({validator:a})=>a(i)))==null?void 0:o.classGroupId},hR=/^\[(.+)\]$/,PK=n=>{if(hR.test(n)){const e=hR.exec(n)[1],t=e==null?void 0:e.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},kK=n=>{const{theme:e,prefix:t}=n,s={nextPart:new Map,validators:[]};return LK(Object.entries(n.classGroups),t).forEach(([i,o])=>{Iw(o,s,i,e)}),s},Iw=(n,e,t,s)=>{n.forEach(r=>{if(typeof r=="string"){const i=r===""?e:fR(e,r);i.classGroupId=t;return}if(typeof r=="function"){if(NK(r)){Iw(r(s),e,t,s);return}e.validators.push({validator:r,classGroupId:t});return}Object.entries(r).forEach(([i,o])=>{Iw(o,fR(e,i),t,s)})})},fR=(n,e)=>{let t=n;return e.split(dS).forEach(s=>{t.nextPart.has(s)||t.nextPart.set(s,{nextPart:new Map,validators:[]}),t=t.nextPart.get(s)}),t},NK=n=>n.isThemeGetter,LK=(n,e)=>e?n.map(([t,s])=>{const r=s.map(i=>typeof i=="string"?e+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(([o,a])=>[e+o,a])):i);return[t,r]}):n,DK=n=>{if(n<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,s=new Map;const r=(i,o)=>{t.set(i,o),e++,e>n&&(e=0,s=t,t=new Map)};return{get(i){let o=t.get(i);if(o!==void 0)return o;if((o=s.get(i))!==void 0)return r(i,o),o},set(i,o){t.has(i)?t.set(i,o):r(i,o)}}},_M="!",MK=n=>{const{separator:e,experimentalParseClassName:t}=n,s=e.length===1,r=e[0],i=e.length,o=a=>{const l=[];let c=0,d=0,h;for(let v=0;v<a.length;v++){let x=a[v];if(c===0){if(x===r&&(s||a.slice(v,v+i)===e)){l.push(a.slice(d,v)),d=v+i;continue}if(x==="/"){h=v;continue}}x==="["?c++:x==="]"&&c--}const f=l.length===0?a:a.substring(d),m=f.startsWith(_M),p=m?f.substring(1):f,y=h&&h>d?h-d:void 0;return{modifiers:l,hasImportantModifier:m,baseClassName:p,maybePostfixModifierPosition:y}};return t?a=>t({className:a,parseClassName:o}):o},OK=n=>{if(n.length<=1)return n;const e=[];let t=[];return n.forEach(s=>{s[0]==="["?(e.push(...t.sort(),s),t=[]):t.push(s)}),e.push(...t.sort()),e},jK=n=>({cache:DK(n.cacheSize),parseClassName:MK(n),...CK(n)}),FK=/\s+/,UK=(n,e)=>{const{parseClassName:t,getClassGroupId:s,getConflictingClassGroupIds:r}=e,i=[],o=n.trim().split(FK);let a="";for(let l=o.length-1;l>=0;l-=1){const c=o[l],{modifiers:d,hasImportantModifier:h,baseClassName:f,maybePostfixModifierPosition:m}=t(c);let p=!!m,y=s(p?f.substring(0,m):f);if(!y){if(!p){a=c+(a.length>0?" "+a:a);continue}if(y=s(f),!y){a=c+(a.length>0?" "+a:a);continue}p=!1}const v=OK(d).join(":"),x=h?v+_M:v,E=x+y;if(i.includes(E))continue;i.push(E);const w=r(y,p);for(let b=0;b<w.length;++b){const C=w[b];i.push(x+C)}a=c+(a.length>0?" "+a:a)}return a};function VK(){let n=0,e,t,s="";for(;n<arguments.length;)(e=arguments[n++])&&(t=AM(e))&&(s&&(s+=" "),s+=t);return s}const AM=n=>{if(typeof n=="string")return n;let e,t="";for(let s=0;s<n.length;s++)n[s]&&(e=AM(n[s]))&&(t&&(t+=" "),t+=e);return t};function $K(n,...e){let t,s,r,i=o;function o(l){const c=e.reduce((d,h)=>h(d),n());return t=jK(c),s=t.cache.get,r=t.cache.set,i=a,a(l)}function a(l){const c=s(l);if(c)return c;const d=UK(l,t);return r(l,d),d}return function(){return i(VK.apply(null,arguments))}}const Rt=n=>{const e=t=>t[n]||[];return e.isThemeGetter=!0,e},IM=/^\[(?:([a-z-]+):)?(.+)\]$/i,BK=/^\d+\/\d+$/,GK=new Set(["px","full","screen"]),KK=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,HK=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,WK=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,zK=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,qK=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Oi=n=>yu(n)||GK.has(n)||BK.test(n),Go=n=>Ed(n,"length",nH),yu=n=>!!n&&!Number.isNaN(Number(n)),ox=n=>Ed(n,"number",yu),dh=n=>!!n&&Number.isInteger(Number(n)),YK=n=>n.endsWith("%")&&yu(n.slice(0,-1)),Ge=n=>IM.test(n),Ko=n=>KK.test(n),QK=new Set(["length","size","percentage"]),XK=n=>Ed(n,QK,RM),JK=n=>Ed(n,"position",RM),ZK=new Set(["image","url"]),eH=n=>Ed(n,ZK,rH),tH=n=>Ed(n,"",sH),hh=()=>!0,Ed=(n,e,t)=>{const s=IM.exec(n);return s?s[1]?typeof e=="string"?s[1]===e:e.has(s[1]):t(s[2]):!1},nH=n=>HK.test(n)&&!WK.test(n),RM=()=>!1,sH=n=>zK.test(n),rH=n=>qK.test(n),iH=()=>{const n=Rt("colors"),e=Rt("spacing"),t=Rt("blur"),s=Rt("brightness"),r=Rt("borderColor"),i=Rt("borderRadius"),o=Rt("borderSpacing"),a=Rt("borderWidth"),l=Rt("contrast"),c=Rt("grayscale"),d=Rt("hueRotate"),h=Rt("invert"),f=Rt("gap"),m=Rt("gradientColorStops"),p=Rt("gradientColorStopPositions"),y=Rt("inset"),v=Rt("margin"),x=Rt("opacity"),E=Rt("padding"),w=Rt("saturate"),b=Rt("scale"),C=Rt("sepia"),D=Rt("skew"),_=Rt("space"),S=Rt("translate"),I=()=>["auto","contain","none"],R=()=>["auto","hidden","clip","visible","scroll"],N=()=>["auto",Ge,e],L=()=>[Ge,e],M=()=>["",Oi,Go],G=()=>["auto",yu,Ge],V=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],$=()=>["solid","dashed","dotted","double","none"],F=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],j=()=>["start","end","center","between","around","evenly","stretch"],U=()=>["","0",Ge],X=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Y=()=>[yu,Ge];return{cacheSize:500,separator:":",theme:{colors:[hh],spacing:[Oi,Go],blur:["none","",Ko,Ge],brightness:Y(),borderColor:[n],borderRadius:["none","","full",Ko,Ge],borderSpacing:L(),borderWidth:M(),contrast:Y(),grayscale:U(),hueRotate:Y(),invert:U(),gap:L(),gradientColorStops:[n],gradientColorStopPositions:[YK,Go],inset:N(),margin:N(),opacity:Y(),padding:L(),saturate:Y(),scale:Y(),sepia:U(),skew:Y(),space:L(),translate:L()},classGroups:{aspect:[{aspect:["auto","square","video",Ge]}],container:["container"],columns:[{columns:[Ko]}],"break-after":[{"break-after":X()}],"break-before":[{"break-before":X()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...V(),Ge]}],overflow:[{overflow:R()}],"overflow-x":[{"overflow-x":R()}],"overflow-y":[{"overflow-y":R()}],overscroll:[{overscroll:I()}],"overscroll-x":[{"overscroll-x":I()}],"overscroll-y":[{"overscroll-y":I()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[y]}],"inset-x":[{"inset-x":[y]}],"inset-y":[{"inset-y":[y]}],start:[{start:[y]}],end:[{end:[y]}],top:[{top:[y]}],right:[{right:[y]}],bottom:[{bottom:[y]}],left:[{left:[y]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",dh,Ge]}],basis:[{basis:N()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Ge]}],grow:[{grow:U()}],shrink:[{shrink:U()}],order:[{order:["first","last","none",dh,Ge]}],"grid-cols":[{"grid-cols":[hh]}],"col-start-end":[{col:["auto",{span:["full",dh,Ge]},Ge]}],"col-start":[{"col-start":G()}],"col-end":[{"col-end":G()}],"grid-rows":[{"grid-rows":[hh]}],"row-start-end":[{row:["auto",{span:[dh,Ge]},Ge]}],"row-start":[{"row-start":G()}],"row-end":[{"row-end":G()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Ge]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Ge]}],gap:[{gap:[f]}],"gap-x":[{"gap-x":[f]}],"gap-y":[{"gap-y":[f]}],"justify-content":[{justify:["normal",...j()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...j(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...j(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[E]}],px:[{px:[E]}],py:[{py:[E]}],ps:[{ps:[E]}],pe:[{pe:[E]}],pt:[{pt:[E]}],pr:[{pr:[E]}],pb:[{pb:[E]}],pl:[{pl:[E]}],m:[{m:[v]}],mx:[{mx:[v]}],my:[{my:[v]}],ms:[{ms:[v]}],me:[{me:[v]}],mt:[{mt:[v]}],mr:[{mr:[v]}],mb:[{mb:[v]}],ml:[{ml:[v]}],"space-x":[{"space-x":[_]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[_]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Ge,e]}],"min-w":[{"min-w":[Ge,e,"min","max","fit"]}],"max-w":[{"max-w":[Ge,e,"none","full","min","max","fit","prose",{screen:[Ko]},Ko]}],h:[{h:[Ge,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Ge,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Ge,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Ge,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Ko,Go]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",ox]}],"font-family":[{font:[hh]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Ge]}],"line-clamp":[{"line-clamp":["none",yu,ox]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Oi,Ge]}],"list-image":[{"list-image":["none",Ge]}],"list-style-type":[{list:["none","disc","decimal",Ge]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[n]}],"placeholder-opacity":[{"placeholder-opacity":[x]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[n]}],"text-opacity":[{"text-opacity":[x]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...$(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Oi,Go]}],"underline-offset":[{"underline-offset":["auto",Oi,Ge]}],"text-decoration-color":[{decoration:[n]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:L()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ge]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ge]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[x]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...V(),JK]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",XK]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},eH]}],"bg-color":[{bg:[n]}],"gradient-from-pos":[{from:[p]}],"gradient-via-pos":[{via:[p]}],"gradient-to-pos":[{to:[p]}],"gradient-from":[{from:[m]}],"gradient-via":[{via:[m]}],"gradient-to":[{to:[m]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[x]}],"border-style":[{border:[...$(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[x]}],"divide-style":[{divide:$()}],"border-color":[{border:[r]}],"border-color-x":[{"border-x":[r]}],"border-color-y":[{"border-y":[r]}],"border-color-s":[{"border-s":[r]}],"border-color-e":[{"border-e":[r]}],"border-color-t":[{"border-t":[r]}],"border-color-r":[{"border-r":[r]}],"border-color-b":[{"border-b":[r]}],"border-color-l":[{"border-l":[r]}],"divide-color":[{divide:[r]}],"outline-style":[{outline:["",...$()]}],"outline-offset":[{"outline-offset":[Oi,Ge]}],"outline-w":[{outline:[Oi,Go]}],"outline-color":[{outline:[n]}],"ring-w":[{ring:M()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[n]}],"ring-opacity":[{"ring-opacity":[x]}],"ring-offset-w":[{"ring-offset":[Oi,Go]}],"ring-offset-color":[{"ring-offset":[n]}],shadow:[{shadow:["","inner","none",Ko,tH]}],"shadow-color":[{shadow:[hh]}],opacity:[{opacity:[x]}],"mix-blend":[{"mix-blend":[...F(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":F()}],filter:[{filter:["","none"]}],blur:[{blur:[t]}],brightness:[{brightness:[s]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Ko,Ge]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[d]}],invert:[{invert:[h]}],saturate:[{saturate:[w]}],sepia:[{sepia:[C]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[t]}],"backdrop-brightness":[{"backdrop-brightness":[s]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[d]}],"backdrop-invert":[{"backdrop-invert":[h]}],"backdrop-opacity":[{"backdrop-opacity":[x]}],"backdrop-saturate":[{"backdrop-saturate":[w]}],"backdrop-sepia":[{"backdrop-sepia":[C]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Ge]}],duration:[{duration:Y()}],ease:[{ease:["linear","in","out","in-out",Ge]}],delay:[{delay:Y()}],animate:[{animate:["none","spin","ping","pulse","bounce",Ge]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[b]}],"scale-x":[{"scale-x":[b]}],"scale-y":[{"scale-y":[b]}],rotate:[{rotate:[dh,Ge]}],"translate-x":[{"translate-x":[S]}],"translate-y":[{"translate-y":[S]}],"skew-x":[{"skew-x":[D]}],"skew-y":[{"skew-y":[D]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Ge]}],accent:[{accent:["auto",n]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ge]}],"caret-color":[{caret:[n]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":L()}],"scroll-mx":[{"scroll-mx":L()}],"scroll-my":[{"scroll-my":L()}],"scroll-ms":[{"scroll-ms":L()}],"scroll-me":[{"scroll-me":L()}],"scroll-mt":[{"scroll-mt":L()}],"scroll-mr":[{"scroll-mr":L()}],"scroll-mb":[{"scroll-mb":L()}],"scroll-ml":[{"scroll-ml":L()}],"scroll-p":[{"scroll-p":L()}],"scroll-px":[{"scroll-px":L()}],"scroll-py":[{"scroll-py":L()}],"scroll-ps":[{"scroll-ps":L()}],"scroll-pe":[{"scroll-pe":L()}],"scroll-pt":[{"scroll-pt":L()}],"scroll-pr":[{"scroll-pr":L()}],"scroll-pb":[{"scroll-pb":L()}],"scroll-pl":[{"scroll-pl":L()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ge]}],fill:[{fill:[n,"none"]}],"stroke-w":[{stroke:[Oi,Go,ox]}],stroke:[{stroke:[n,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},oH=$K(iH);function Ae(...n){return oH(gM(n))}const aH=KG,CM=T.forwardRef(({className:n,...e},t)=>u.jsx(cM,{ref:t,className:Ae("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",n),...e}));CM.displayName=cM.displayName;const lH=my("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),PM=T.forwardRef(({className:n,variant:e,...t},s)=>u.jsx(uM,{ref:s,className:Ae(lH({variant:e}),n),...t}));PM.displayName=uM.displayName;const cH=T.forwardRef(({className:n,...e},t)=>u.jsx(fM,{ref:t,className:Ae("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",n),...e}));cH.displayName=fM.displayName;const kM=T.forwardRef(({className:n,...e},t)=>u.jsx(mM,{ref:t,className:Ae("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",n),"toast-close":"",...e,children:u.jsx(lr,{className:"h-4 w-4"})}));kM.displayName=mM.displayName;const NM=T.forwardRef(({className:n,...e},t)=>u.jsx(dM,{ref:t,className:Ae("text-sm font-semibold",n),...e}));NM.displayName=dM.displayName;const LM=T.forwardRef(({className:n,...e},t)=>u.jsx(hM,{ref:t,className:Ae("text-sm opacity-90",n),...e}));LM.displayName=hM.displayName;function DM(){const{toasts:n}=hb();return u.jsxs(aH,{children:[n.map(function({id:e,title:t,description:s,action:r,...i}){return u.jsxs(PM,{...i,children:[u.jsxs("div",{className:"grid gap-1",children:[t&&u.jsx(NM,{children:t}),s&&u.jsx(LM,{children:s})]}),r,u.jsx(kM,{})]},e)}),u.jsx(CM,{})]})}var uH=xL[" useId ".trim().toString()]||(()=>{}),dH=0;function mr(n){const[e,t]=T.useState(uH());return hn(()=>{n||t(s=>s??String(dH++))},[n]),n||(e?`radix-${e}`:"")}const hH=["top","right","bottom","left"],ja=Math.min,Ks=Math.max,Jg=Math.round,lp=Math.floor,mi=n=>({x:n,y:n}),fH={left:"right",right:"left",bottom:"top",top:"bottom"},mH={start:"end",end:"start"};function Rw(n,e,t){return Ks(n,ja(e,t))}function ho(n,e){return typeof n=="function"?n(e):n}function fo(n){return n.split("-")[0]}function wd(n){return n.split("-")[1]}function hS(n){return n==="x"?"y":"x"}function fS(n){return n==="y"?"height":"width"}function Fa(n){return["top","bottom"].includes(fo(n))?"y":"x"}function mS(n){return hS(Fa(n))}function pH(n,e,t){t===void 0&&(t=!1);const s=wd(n),r=mS(n),i=fS(r);let o=r==="x"?s===(t?"end":"start")?"right":"left":s==="start"?"bottom":"top";return e.reference[i]>e.floating[i]&&(o=Zg(o)),[o,Zg(o)]}function gH(n){const e=Zg(n);return[Cw(n),e,Cw(e)]}function Cw(n){return n.replace(/start|end/g,e=>mH[e])}function yH(n,e,t){const s=["left","right"],r=["right","left"],i=["top","bottom"],o=["bottom","top"];switch(n){case"top":case"bottom":return t?e?r:s:e?s:r;case"left":case"right":return e?i:o;default:return[]}}function vH(n,e,t,s){const r=wd(n);let i=yH(fo(n),t==="start",s);return r&&(i=i.map(o=>o+"-"+r),e&&(i=i.concat(i.map(Cw)))),i}function Zg(n){return n.replace(/left|right|bottom|top/g,e=>fH[e])}function xH(n){return{top:0,right:0,bottom:0,left:0,...n}}function MM(n){return typeof n!="number"?xH(n):{top:n,right:n,bottom:n,left:n}}function e0(n){const{x:e,y:t,width:s,height:r}=n;return{width:s,height:r,top:t,left:e,right:e+s,bottom:t+r,x:e,y:t}}function mR(n,e,t){let{reference:s,floating:r}=n;const i=Fa(e),o=mS(e),a=fS(o),l=fo(e),c=i==="y",d=s.x+s.width/2-r.width/2,h=s.y+s.height/2-r.height/2,f=s[a]/2-r[a]/2;let m;switch(l){case"top":m={x:d,y:s.y-r.height};break;case"bottom":m={x:d,y:s.y+s.height};break;case"right":m={x:s.x+s.width,y:h};break;case"left":m={x:s.x-r.width,y:h};break;default:m={x:s.x,y:s.y}}switch(wd(e)){case"start":m[o]-=f*(t&&c?-1:1);break;case"end":m[o]+=f*(t&&c?-1:1);break}return m}const EH=async(n,e,t)=>{const{placement:s="bottom",strategy:r="absolute",middleware:i=[],platform:o}=t,a=i.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:n,floating:e,strategy:r}),{x:d,y:h}=mR(c,s,l),f=s,m={},p=0;for(let y=0;y<a.length;y++){const{name:v,fn:x}=a[y],{x:E,y:w,data:b,reset:C}=await x({x:d,y:h,initialPlacement:s,placement:f,strategy:r,middlewareData:m,rects:c,platform:o,elements:{reference:n,floating:e}});d=E??d,h=w??h,m={...m,[v]:{...m[v],...b}},C&&p<=50&&(p++,typeof C=="object"&&(C.placement&&(f=C.placement),C.rects&&(c=C.rects===!0?await o.getElementRects({reference:n,floating:e,strategy:r}):C.rects),{x:d,y:h}=mR(c,f,l)),y=-1)}return{x:d,y:h,placement:f,strategy:r,middlewareData:m}};async function wf(n,e){var t;e===void 0&&(e={});const{x:s,y:r,platform:i,rects:o,elements:a,strategy:l}=n,{boundary:c="clippingAncestors",rootBoundary:d="viewport",elementContext:h="floating",altBoundary:f=!1,padding:m=0}=ho(e,n),p=MM(m),v=a[f?h==="floating"?"reference":"floating":h],x=e0(await i.getClippingRect({element:(t=await(i.isElement==null?void 0:i.isElement(v)))==null||t?v:v.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(a.floating)),boundary:c,rootBoundary:d,strategy:l})),E=h==="floating"?{x:s,y:r,width:o.floating.width,height:o.floating.height}:o.reference,w=await(i.getOffsetParent==null?void 0:i.getOffsetParent(a.floating)),b=await(i.isElement==null?void 0:i.isElement(w))?await(i.getScale==null?void 0:i.getScale(w))||{x:1,y:1}:{x:1,y:1},C=e0(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:E,offsetParent:w,strategy:l}):E);return{top:(x.top-C.top+p.top)/b.y,bottom:(C.bottom-x.bottom+p.bottom)/b.y,left:(x.left-C.left+p.left)/b.x,right:(C.right-x.right+p.right)/b.x}}const wH=n=>({name:"arrow",options:n,async fn(e){const{x:t,y:s,placement:r,rects:i,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:d=0}=ho(n,e)||{};if(c==null)return{};const h=MM(d),f={x:t,y:s},m=mS(r),p=fS(m),y=await o.getDimensions(c),v=m==="y",x=v?"top":"left",E=v?"bottom":"right",w=v?"clientHeight":"clientWidth",b=i.reference[p]+i.reference[m]-f[m]-i.floating[p],C=f[m]-i.reference[m],D=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let _=D?D[w]:0;(!_||!await(o.isElement==null?void 0:o.isElement(D)))&&(_=a.floating[w]||i.floating[p]);const S=b/2-C/2,I=_/2-y[p]/2-1,R=ja(h[x],I),N=ja(h[E],I),L=R,M=_-y[p]-N,G=_/2-y[p]/2+S,V=Rw(L,G,M),$=!l.arrow&&wd(r)!=null&&G!==V&&i.reference[p]/2-(G<L?R:N)-y[p]/2<0,F=$?G<L?G-L:G-M:0;return{[m]:f[m]+F,data:{[m]:V,centerOffset:G-V-F,...$&&{alignmentOffset:F}},reset:$}}}),TH=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t,s;const{placement:r,middlewareData:i,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:d=!0,crossAxis:h=!0,fallbackPlacements:f,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:y=!0,...v}=ho(n,e);if((t=i.arrow)!=null&&t.alignmentOffset)return{};const x=fo(r),E=Fa(a),w=fo(a)===a,b=await(l.isRTL==null?void 0:l.isRTL(c.floating)),C=f||(w||!y?[Zg(a)]:gH(a)),D=p!=="none";!f&&D&&C.push(...vH(a,y,p,b));const _=[a,...C],S=await wf(e,v),I=[];let R=((s=i.flip)==null?void 0:s.overflows)||[];if(d&&I.push(S[x]),h){const G=pH(r,o,b);I.push(S[G[0]],S[G[1]])}if(R=[...R,{placement:r,overflows:I}],!I.every(G=>G<=0)){var N,L;const G=(((N=i.flip)==null?void 0:N.index)||0)+1,V=_[G];if(V)return{data:{index:G,overflows:R},reset:{placement:V}};let $=(L=R.filter(F=>F.overflows[0]<=0).sort((F,j)=>F.overflows[1]-j.overflows[1])[0])==null?void 0:L.placement;if(!$)switch(m){case"bestFit":{var M;const F=(M=R.filter(j=>{if(D){const U=Fa(j.placement);return U===E||U==="y"}return!0}).map(j=>[j.placement,j.overflows.filter(U=>U>0).reduce((U,X)=>U+X,0)]).sort((j,U)=>j[1]-U[1])[0])==null?void 0:M[0];F&&($=F);break}case"initialPlacement":$=a;break}if(r!==$)return{reset:{placement:$}}}return{}}}};function pR(n,e){return{top:n.top-e.height,right:n.right-e.width,bottom:n.bottom-e.height,left:n.left-e.width}}function gR(n){return hH.some(e=>n[e]>=0)}const bH=function(n){return n===void 0&&(n={}),{name:"hide",options:n,async fn(e){const{rects:t}=e,{strategy:s="referenceHidden",...r}=ho(n,e);switch(s){case"referenceHidden":{const i=await wf(e,{...r,elementContext:"reference"}),o=pR(i,t.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:gR(o)}}}case"escaped":{const i=await wf(e,{...r,altBoundary:!0}),o=pR(i,t.floating);return{data:{escapedOffsets:o,escaped:gR(o)}}}default:return{}}}}};async function SH(n,e){const{placement:t,platform:s,elements:r}=n,i=await(s.isRTL==null?void 0:s.isRTL(r.floating)),o=fo(t),a=wd(t),l=Fa(t)==="y",c=["left","top"].includes(o)?-1:1,d=i&&l?-1:1,h=ho(e,n);let{mainAxis:f,crossAxis:m,alignmentAxis:p}=typeof h=="number"?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:h.mainAxis||0,crossAxis:h.crossAxis||0,alignmentAxis:h.alignmentAxis};return a&&typeof p=="number"&&(m=a==="end"?p*-1:p),l?{x:m*d,y:f*c}:{x:f*c,y:m*d}}const _H=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){var t,s;const{x:r,y:i,placement:o,middlewareData:a}=e,l=await SH(e,n);return o===((t=a.offset)==null?void 0:t.placement)&&(s=a.arrow)!=null&&s.alignmentOffset?{}:{x:r+l.x,y:i+l.y,data:{...l,placement:o}}}}},AH=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:s,placement:r}=e,{mainAxis:i=!0,crossAxis:o=!1,limiter:a={fn:v=>{let{x,y:E}=v;return{x,y:E}}},...l}=ho(n,e),c={x:t,y:s},d=await wf(e,l),h=Fa(fo(r)),f=hS(h);let m=c[f],p=c[h];if(i){const v=f==="y"?"top":"left",x=f==="y"?"bottom":"right",E=m+d[v],w=m-d[x];m=Rw(E,m,w)}if(o){const v=h==="y"?"top":"left",x=h==="y"?"bottom":"right",E=p+d[v],w=p-d[x];p=Rw(E,p,w)}const y=a.fn({...e,[f]:m,[h]:p});return{...y,data:{x:y.x-t,y:y.y-s,enabled:{[f]:i,[h]:o}}}}}},IH=function(n){return n===void 0&&(n={}),{options:n,fn(e){const{x:t,y:s,placement:r,rects:i,middlewareData:o}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=ho(n,e),d={x:t,y:s},h=Fa(r),f=hS(h);let m=d[f],p=d[h];const y=ho(a,e),v=typeof y=="number"?{mainAxis:y,crossAxis:0}:{mainAxis:0,crossAxis:0,...y};if(l){const w=f==="y"?"height":"width",b=i.reference[f]-i.floating[w]+v.mainAxis,C=i.reference[f]+i.reference[w]-v.mainAxis;m<b?m=b:m>C&&(m=C)}if(c){var x,E;const w=f==="y"?"width":"height",b=["top","left"].includes(fo(r)),C=i.reference[h]-i.floating[w]+(b&&((x=o.offset)==null?void 0:x[h])||0)+(b?0:v.crossAxis),D=i.reference[h]+i.reference[w]+(b?0:((E=o.offset)==null?void 0:E[h])||0)-(b?v.crossAxis:0);p<C?p=C:p>D&&(p=D)}return{[f]:m,[h]:p}}}},RH=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(e){var t,s;const{placement:r,rects:i,platform:o,elements:a}=e,{apply:l=()=>{},...c}=ho(n,e),d=await wf(e,c),h=fo(r),f=wd(r),m=Fa(r)==="y",{width:p,height:y}=i.floating;let v,x;h==="top"||h==="bottom"?(v=h,x=f===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(x=h,v=f==="end"?"top":"bottom");const E=y-d.top-d.bottom,w=p-d.left-d.right,b=ja(y-d[v],E),C=ja(p-d[x],w),D=!e.middlewareData.shift;let _=b,S=C;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(S=w),(s=e.middlewareData.shift)!=null&&s.enabled.y&&(_=E),D&&!f){const R=Ks(d.left,0),N=Ks(d.right,0),L=Ks(d.top,0),M=Ks(d.bottom,0);m?S=p-2*(R!==0||N!==0?R+N:Ks(d.left,d.right)):_=y-2*(L!==0||M!==0?L+M:Ks(d.top,d.bottom))}await l({...e,availableWidth:S,availableHeight:_});const I=await o.getDimensions(a.floating);return p!==I.width||y!==I.height?{reset:{rects:!0}}:{}}}};function gy(){return typeof window<"u"}function Td(n){return OM(n)?(n.nodeName||"").toLowerCase():"#document"}function Js(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function Pi(n){var e;return(e=(OM(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function OM(n){return gy()?n instanceof Node||n instanceof Js(n).Node:!1}function Gr(n){return gy()?n instanceof Element||n instanceof Js(n).Element:!1}function Si(n){return gy()?n instanceof HTMLElement||n instanceof Js(n).HTMLElement:!1}function yR(n){return!gy()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof Js(n).ShadowRoot}function rm(n){const{overflow:e,overflowX:t,overflowY:s,display:r}=Kr(n);return/auto|scroll|overlay|hidden|clip/.test(e+s+t)&&!["inline","contents"].includes(r)}function CH(n){return["table","td","th"].includes(Td(n))}function yy(n){return[":popover-open",":modal"].some(e=>{try{return n.matches(e)}catch{return!1}})}function pS(n){const e=gS(),t=Gr(n)?Kr(n):n;return["transform","translate","scale","rotate","perspective"].some(s=>t[s]?t[s]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(s=>(t.willChange||"").includes(s))||["paint","layout","strict","content"].some(s=>(t.contain||"").includes(s))}function PH(n){let e=Ua(n);for(;Si(e)&&!Yu(e);){if(pS(e))return e;if(yy(e))return null;e=Ua(e)}return null}function gS(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Yu(n){return["html","body","#document"].includes(Td(n))}function Kr(n){return Js(n).getComputedStyle(n)}function vy(n){return Gr(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function Ua(n){if(Td(n)==="html")return n;const e=n.assignedSlot||n.parentNode||yR(n)&&n.host||Pi(n);return yR(e)?e.host:e}function jM(n){const e=Ua(n);return Yu(e)?n.ownerDocument?n.ownerDocument.body:n.body:Si(e)&&rm(e)?e:jM(e)}function Tf(n,e,t){var s;e===void 0&&(e=[]),t===void 0&&(t=!0);const r=jM(n),i=r===((s=n.ownerDocument)==null?void 0:s.body),o=Js(r);if(i){const a=Pw(o);return e.concat(o,o.visualViewport||[],rm(r)?r:[],a&&t?Tf(a):[])}return e.concat(r,Tf(r,[],t))}function Pw(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function FM(n){const e=Kr(n);let t=parseFloat(e.width)||0,s=parseFloat(e.height)||0;const r=Si(n),i=r?n.offsetWidth:t,o=r?n.offsetHeight:s,a=Jg(t)!==i||Jg(s)!==o;return a&&(t=i,s=o),{width:t,height:s,$:a}}function yS(n){return Gr(n)?n:n.contextElement}function vu(n){const e=yS(n);if(!Si(e))return mi(1);const t=e.getBoundingClientRect(),{width:s,height:r,$:i}=FM(e);let o=(i?Jg(t.width):t.width)/s,a=(i?Jg(t.height):t.height)/r;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const kH=mi(0);function UM(n){const e=Js(n);return!gS()||!e.visualViewport?kH:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function NH(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==Js(n)?!1:e}function Xl(n,e,t,s){e===void 0&&(e=!1),t===void 0&&(t=!1);const r=n.getBoundingClientRect(),i=yS(n);let o=mi(1);e&&(s?Gr(s)&&(o=vu(s)):o=vu(n));const a=NH(i,t,s)?UM(i):mi(0);let l=(r.left+a.x)/o.x,c=(r.top+a.y)/o.y,d=r.width/o.x,h=r.height/o.y;if(i){const f=Js(i),m=s&&Gr(s)?Js(s):s;let p=f,y=Pw(p);for(;y&&s&&m!==p;){const v=vu(y),x=y.getBoundingClientRect(),E=Kr(y),w=x.left+(y.clientLeft+parseFloat(E.paddingLeft))*v.x,b=x.top+(y.clientTop+parseFloat(E.paddingTop))*v.y;l*=v.x,c*=v.y,d*=v.x,h*=v.y,l+=w,c+=b,p=Js(y),y=Pw(p)}}return e0({width:d,height:h,x:l,y:c})}function vS(n,e){const t=vy(n).scrollLeft;return e?e.left+t:Xl(Pi(n)).left+t}function VM(n,e,t){t===void 0&&(t=!1);const s=n.getBoundingClientRect(),r=s.left+e.scrollLeft-(t?0:vS(n,s)),i=s.top+e.scrollTop;return{x:r,y:i}}function LH(n){let{elements:e,rect:t,offsetParent:s,strategy:r}=n;const i=r==="fixed",o=Pi(s),a=e?yy(e.floating):!1;if(s===o||a&&i)return t;let l={scrollLeft:0,scrollTop:0},c=mi(1);const d=mi(0),h=Si(s);if((h||!h&&!i)&&((Td(s)!=="body"||rm(o))&&(l=vy(s)),Si(s))){const m=Xl(s);c=vu(s),d.x=m.x+s.clientLeft,d.y=m.y+s.clientTop}const f=o&&!h&&!i?VM(o,l,!0):mi(0);return{width:t.width*c.x,height:t.height*c.y,x:t.x*c.x-l.scrollLeft*c.x+d.x+f.x,y:t.y*c.y-l.scrollTop*c.y+d.y+f.y}}function DH(n){return Array.from(n.getClientRects())}function MH(n){const e=Pi(n),t=vy(n),s=n.ownerDocument.body,r=Ks(e.scrollWidth,e.clientWidth,s.scrollWidth,s.clientWidth),i=Ks(e.scrollHeight,e.clientHeight,s.scrollHeight,s.clientHeight);let o=-t.scrollLeft+vS(n);const a=-t.scrollTop;return Kr(s).direction==="rtl"&&(o+=Ks(e.clientWidth,s.clientWidth)-r),{width:r,height:i,x:o,y:a}}function OH(n,e){const t=Js(n),s=Pi(n),r=t.visualViewport;let i=s.clientWidth,o=s.clientHeight,a=0,l=0;if(r){i=r.width,o=r.height;const c=gS();(!c||c&&e==="fixed")&&(a=r.offsetLeft,l=r.offsetTop)}return{width:i,height:o,x:a,y:l}}function jH(n,e){const t=Xl(n,!0,e==="fixed"),s=t.top+n.clientTop,r=t.left+n.clientLeft,i=Si(n)?vu(n):mi(1),o=n.clientWidth*i.x,a=n.clientHeight*i.y,l=r*i.x,c=s*i.y;return{width:o,height:a,x:l,y:c}}function vR(n,e,t){let s;if(e==="viewport")s=OH(n,t);else if(e==="document")s=MH(Pi(n));else if(Gr(e))s=jH(e,t);else{const r=UM(n);s={x:e.x-r.x,y:e.y-r.y,width:e.width,height:e.height}}return e0(s)}function $M(n,e){const t=Ua(n);return t===e||!Gr(t)||Yu(t)?!1:Kr(t).position==="fixed"||$M(t,e)}function FH(n,e){const t=e.get(n);if(t)return t;let s=Tf(n,[],!1).filter(a=>Gr(a)&&Td(a)!=="body"),r=null;const i=Kr(n).position==="fixed";let o=i?Ua(n):n;for(;Gr(o)&&!Yu(o);){const a=Kr(o),l=pS(o);!l&&a.position==="fixed"&&(r=null),(i?!l&&!r:!l&&a.position==="static"&&!!r&&["absolute","fixed"].includes(r.position)||rm(o)&&!l&&$M(n,o))?s=s.filter(d=>d!==o):r=a,o=Ua(o)}return e.set(n,s),s}function UH(n){let{element:e,boundary:t,rootBoundary:s,strategy:r}=n;const o=[...t==="clippingAncestors"?yy(e)?[]:FH(e,this._c):[].concat(t),s],a=o[0],l=o.reduce((c,d)=>{const h=vR(e,d,r);return c.top=Ks(h.top,c.top),c.right=ja(h.right,c.right),c.bottom=ja(h.bottom,c.bottom),c.left=Ks(h.left,c.left),c},vR(e,a,r));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function VH(n){const{width:e,height:t}=FM(n);return{width:e,height:t}}function $H(n,e,t){const s=Si(e),r=Pi(e),i=t==="fixed",o=Xl(n,!0,i,e);let a={scrollLeft:0,scrollTop:0};const l=mi(0);if(s||!s&&!i)if((Td(e)!=="body"||rm(r))&&(a=vy(e)),s){const f=Xl(e,!0,i,e);l.x=f.x+e.clientLeft,l.y=f.y+e.clientTop}else r&&(l.x=vS(r));const c=r&&!s&&!i?VM(r,a):mi(0),d=o.left+a.scrollLeft-l.x-c.x,h=o.top+a.scrollTop-l.y-c.y;return{x:d,y:h,width:o.width,height:o.height}}function ax(n){return Kr(n).position==="static"}function xR(n,e){if(!Si(n)||Kr(n).position==="fixed")return null;if(e)return e(n);let t=n.offsetParent;return Pi(n)===t&&(t=t.ownerDocument.body),t}function BM(n,e){const t=Js(n);if(yy(n))return t;if(!Si(n)){let r=Ua(n);for(;r&&!Yu(r);){if(Gr(r)&&!ax(r))return r;r=Ua(r)}return t}let s=xR(n,e);for(;s&&CH(s)&&ax(s);)s=xR(s,e);return s&&Yu(s)&&ax(s)&&!pS(s)?t:s||PH(n)||t}const BH=async function(n){const e=this.getOffsetParent||BM,t=this.getDimensions,s=await t(n.floating);return{reference:$H(n.reference,await e(n.floating),n.strategy),floating:{x:0,y:0,width:s.width,height:s.height}}};function GH(n){return Kr(n).direction==="rtl"}const KH={convertOffsetParentRelativeRectToViewportRelativeRect:LH,getDocumentElement:Pi,getClippingRect:UH,getOffsetParent:BM,getElementRects:BH,getClientRects:DH,getDimensions:VH,getScale:vu,isElement:Gr,isRTL:GH};function GM(n,e){return n.x===e.x&&n.y===e.y&&n.width===e.width&&n.height===e.height}function HH(n,e){let t=null,s;const r=Pi(n);function i(){var a;clearTimeout(s),(a=t)==null||a.disconnect(),t=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),i();const c=n.getBoundingClientRect(),{left:d,top:h,width:f,height:m}=c;if(a||e(),!f||!m)return;const p=lp(h),y=lp(r.clientWidth-(d+f)),v=lp(r.clientHeight-(h+m)),x=lp(d),w={rootMargin:-p+"px "+-y+"px "+-v+"px "+-x+"px",threshold:Ks(0,ja(1,l))||1};let b=!0;function C(D){const _=D[0].intersectionRatio;if(_!==l){if(!b)return o();_?o(!1,_):s=setTimeout(()=>{o(!1,1e-7)},1e3)}_===1&&!GM(c,n.getBoundingClientRect())&&o(),b=!1}try{t=new IntersectionObserver(C,{...w,root:r.ownerDocument})}catch{t=new IntersectionObserver(C,w)}t.observe(n)}return o(!0),i}function WH(n,e,t,s){s===void 0&&(s={});const{ancestorScroll:r=!0,ancestorResize:i=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=s,c=yS(n),d=r||i?[...c?Tf(c):[],...Tf(e)]:[];d.forEach(x=>{r&&x.addEventListener("scroll",t,{passive:!0}),i&&x.addEventListener("resize",t)});const h=c&&a?HH(c,t):null;let f=-1,m=null;o&&(m=new ResizeObserver(x=>{let[E]=x;E&&E.target===c&&m&&(m.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var w;(w=m)==null||w.observe(e)})),t()}),c&&!l&&m.observe(c),m.observe(e));let p,y=l?Xl(n):null;l&&v();function v(){const x=Xl(n);y&&!GM(y,x)&&t(),y=x,p=requestAnimationFrame(v)}return t(),()=>{var x;d.forEach(E=>{r&&E.removeEventListener("scroll",t),i&&E.removeEventListener("resize",t)}),h==null||h(),(x=m)==null||x.disconnect(),m=null,l&&cancelAnimationFrame(p)}}const zH=_H,qH=AH,YH=TH,QH=RH,XH=bH,ER=wH,JH=IH,ZH=(n,e,t)=>{const s=new Map,r={platform:KH,...t},i={...r.platform,_c:s};return EH(n,e,{...r,platform:i})};var eg=typeof document<"u"?T.useLayoutEffect:T.useEffect;function t0(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="function"&&n.toString()===e.toString())return!0;let t,s,r;if(n&&e&&typeof n=="object"){if(Array.isArray(n)){if(t=n.length,t!==e.length)return!1;for(s=t;s--!==0;)if(!t0(n[s],e[s]))return!1;return!0}if(r=Object.keys(n),t=r.length,t!==Object.keys(e).length)return!1;for(s=t;s--!==0;)if(!{}.hasOwnProperty.call(e,r[s]))return!1;for(s=t;s--!==0;){const i=r[s];if(!(i==="_owner"&&n.$$typeof)&&!t0(n[i],e[i]))return!1}return!0}return n!==n&&e!==e}function KM(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function wR(n,e){const t=KM(n);return Math.round(e*t)/t}function lx(n){const e=T.useRef(n);return eg(()=>{e.current=n}),e}function eW(n){n===void 0&&(n={});const{placement:e="bottom",strategy:t="absolute",middleware:s=[],platform:r,elements:{reference:i,floating:o}={},transform:a=!0,whileElementsMounted:l,open:c}=n,[d,h]=T.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[f,m]=T.useState(s);t0(f,s)||m(s);const[p,y]=T.useState(null),[v,x]=T.useState(null),E=T.useCallback(j=>{j!==D.current&&(D.current=j,y(j))},[]),w=T.useCallback(j=>{j!==_.current&&(_.current=j,x(j))},[]),b=i||p,C=o||v,D=T.useRef(null),_=T.useRef(null),S=T.useRef(d),I=l!=null,R=lx(l),N=lx(r),L=lx(c),M=T.useCallback(()=>{if(!D.current||!_.current)return;const j={placement:e,strategy:t,middleware:f};N.current&&(j.platform=N.current),ZH(D.current,_.current,j).then(U=>{const X={...U,isPositioned:L.current!==!1};G.current&&!t0(S.current,X)&&(S.current=X,lc.flushSync(()=>{h(X)}))})},[f,e,t,N,L]);eg(()=>{c===!1&&S.current.isPositioned&&(S.current.isPositioned=!1,h(j=>({...j,isPositioned:!1})))},[c]);const G=T.useRef(!1);eg(()=>(G.current=!0,()=>{G.current=!1}),[]),eg(()=>{if(b&&(D.current=b),C&&(_.current=C),b&&C){if(R.current)return R.current(b,C,M);M()}},[b,C,M,R,I]);const V=T.useMemo(()=>({reference:D,floating:_,setReference:E,setFloating:w}),[E,w]),$=T.useMemo(()=>({reference:b,floating:C}),[b,C]),F=T.useMemo(()=>{const j={position:t,left:0,top:0};if(!$.floating)return j;const U=wR($.floating,d.x),X=wR($.floating,d.y);return a?{...j,transform:"translate("+U+"px, "+X+"px)",...KM($.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:U,top:X}},[t,a,$.floating,d.x,d.y]);return T.useMemo(()=>({...d,update:M,refs:V,elements:$,floatingStyles:F}),[d,M,V,$,F])}const tW=n=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:n,fn(t){const{element:s,padding:r}=typeof n=="function"?n(t):n;return s&&e(s)?s.current!=null?ER({element:s.current,padding:r}).fn(t):{}:s?ER({element:s,padding:r}).fn(t):{}}}},nW=(n,e)=>({...zH(n),options:[n,e]}),sW=(n,e)=>({...qH(n),options:[n,e]}),rW=(n,e)=>({...JH(n),options:[n,e]}),iW=(n,e)=>({...YH(n),options:[n,e]}),oW=(n,e)=>({...QH(n),options:[n,e]}),aW=(n,e)=>({...XH(n),options:[n,e]}),lW=(n,e)=>({...tW(n),options:[n,e]});var cW="Arrow",HM=T.forwardRef((n,e)=>{const{children:t,width:s=10,height:r=5,...i}=n;return u.jsx(Se.svg,{...i,ref:e,width:s,height:r,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:n.asChild?t:u.jsx("polygon",{points:"0,0 30,0 15,10"})})});HM.displayName=cW;var uW=HM;function WM(n){const[e,t]=T.useState(void 0);return hn(()=>{if(n){t({width:n.offsetWidth,height:n.offsetHeight});const s=new ResizeObserver(r=>{if(!Array.isArray(r)||!r.length)return;const i=r[0];let o,a;if("borderBoxSize"in i){const l=i.borderBoxSize,c=Array.isArray(l)?l[0]:l;o=c.inlineSize,a=c.blockSize}else o=n.offsetWidth,a=n.offsetHeight;t({width:o,height:a})});return s.observe(n,{box:"border-box"}),()=>s.unobserve(n)}else t(void 0)},[n]),e}var xS="Popper",[zM,bd]=Ds(xS),[dW,qM]=zM(xS),YM=n=>{const{__scopePopper:e,children:t}=n,[s,r]=T.useState(null);return u.jsx(dW,{scope:e,anchor:s,onAnchorChange:r,children:t})};YM.displayName=xS;var QM="PopperAnchor",XM=T.forwardRef((n,e)=>{const{__scopePopper:t,virtualRef:s,...r}=n,i=qM(QM,t),o=T.useRef(null),a=ze(e,o);return T.useEffect(()=>{i.onAnchorChange((s==null?void 0:s.current)||o.current)}),s?null:u.jsx(Se.div,{...r,ref:a})});XM.displayName=QM;var ES="PopperContent",[hW,fW]=zM(ES),JM=T.forwardRef((n,e)=>{var re,Ee,xe,Ne,Le,qe;const{__scopePopper:t,side:s="bottom",sideOffset:r=0,align:i="center",alignOffset:o=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:d=0,sticky:h="partial",hideWhenDetached:f=!1,updatePositionStrategy:m="optimized",onPlaced:p,...y}=n,v=qM(ES,t),[x,E]=T.useState(null),w=ze(e,gt=>E(gt)),[b,C]=T.useState(null),D=WM(b),_=(D==null?void 0:D.width)??0,S=(D==null?void 0:D.height)??0,I=s+(i!=="center"?"-"+i:""),R=typeof d=="number"?d:{top:0,right:0,bottom:0,left:0,...d},N=Array.isArray(c)?c:[c],L=N.length>0,M={padding:R,boundary:N.filter(pW),altBoundary:L},{refs:G,floatingStyles:V,placement:$,isPositioned:F,middlewareData:j}=eW({strategy:"fixed",placement:I,whileElementsMounted:(...gt)=>WH(...gt,{animationFrame:m==="always"}),elements:{reference:v.anchor},middleware:[nW({mainAxis:r+S,alignmentAxis:o}),l&&sW({mainAxis:!0,crossAxis:!1,limiter:h==="partial"?rW():void 0,...M}),l&&iW({...M}),oW({...M,apply:({elements:gt,rects:Jt,availableWidth:ys,availableHeight:De})=>{const{width:ct,height:Gt}=Jt.reference,rt=gt.floating.style;rt.setProperty("--radix-popper-available-width",`${ys}px`),rt.setProperty("--radix-popper-available-height",`${De}px`),rt.setProperty("--radix-popper-anchor-width",`${ct}px`),rt.setProperty("--radix-popper-anchor-height",`${Gt}px`)}}),b&&lW({element:b,padding:a}),gW({arrowWidth:_,arrowHeight:S}),f&&aW({strategy:"referenceHidden",...M})]}),[U,X]=tO($),Y=Bn(p);hn(()=>{F&&(Y==null||Y())},[F,Y]);const J=(re=j.arrow)==null?void 0:re.x,ae=(Ee=j.arrow)==null?void 0:Ee.y,he=((xe=j.arrow)==null?void 0:xe.centerOffset)!==0,[ve,ge]=T.useState();return hn(()=>{x&&ge(window.getComputedStyle(x).zIndex)},[x]),u.jsx("div",{ref:G.setFloating,"data-radix-popper-content-wrapper":"",style:{...V,transform:F?V.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ve,"--radix-popper-transform-origin":[(Ne=j.transformOrigin)==null?void 0:Ne.x,(Le=j.transformOrigin)==null?void 0:Le.y].join(" "),...((qe=j.hide)==null?void 0:qe.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:n.dir,children:u.jsx(hW,{scope:t,placedSide:U,onArrowChange:C,arrowX:J,arrowY:ae,shouldHideArrow:he,children:u.jsx(Se.div,{"data-side":U,"data-align":X,...y,ref:w,style:{...y.style,animation:F?void 0:"none"}})})})});JM.displayName=ES;var ZM="PopperArrow",mW={top:"bottom",right:"left",bottom:"top",left:"right"},eO=T.forwardRef(function(e,t){const{__scopePopper:s,...r}=e,i=fW(ZM,s),o=mW[i.placedSide];return u.jsx("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:u.jsx(uW,{...r,ref:t,style:{...r.style,display:"block"}})})});eO.displayName=ZM;function pW(n){return n!==null}var gW=n=>({name:"transformOrigin",options:n,fn(e){var v,x,E;const{placement:t,rects:s,middlewareData:r}=e,o=((v=r.arrow)==null?void 0:v.centerOffset)!==0,a=o?0:n.arrowWidth,l=o?0:n.arrowHeight,[c,d]=tO(t),h={start:"0%",center:"50%",end:"100%"}[d],f=(((x=r.arrow)==null?void 0:x.x)??0)+a/2,m=(((E=r.arrow)==null?void 0:E.y)??0)+l/2;let p="",y="";return c==="bottom"?(p=o?h:`${f}px`,y=`${-l}px`):c==="top"?(p=o?h:`${f}px`,y=`${s.floating.height+l}px`):c==="right"?(p=`${-l}px`,y=o?h:`${m}px`):c==="left"&&(p=`${s.floating.width+l}px`,y=o?h:`${m}px`),{data:{x:p,y}}}});function tO(n){const[e,t="center"]=n.split("-");return[e,t]}var nO=YM,wS=XM,TS=JM,bS=eO,[xy,kpe]=Ds("Tooltip",[bd]),SS=bd(),sO="TooltipProvider",yW=700,TR="tooltip.open",[vW,rO]=xy(sO),iO=n=>{const{__scopeTooltip:e,delayDuration:t=yW,skipDelayDuration:s=300,disableHoverableContent:r=!1,children:i}=n,o=T.useRef(!0),a=T.useRef(!1),l=T.useRef(0);return T.useEffect(()=>{const c=l.current;return()=>window.clearTimeout(c)},[]),u.jsx(vW,{scope:e,isOpenDelayedRef:o,delayDuration:t,onOpen:T.useCallback(()=>{window.clearTimeout(l.current),o.current=!1},[]),onClose:T.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>o.current=!0,s)},[s]),isPointerInTransitRef:a,onPointerInTransitChange:T.useCallback(c=>{a.current=c},[]),disableHoverableContent:r,children:i})};iO.displayName=sO;var oO="Tooltip",[Npe,Ey]=xy(oO),kw="TooltipTrigger",xW=T.forwardRef((n,e)=>{const{__scopeTooltip:t,...s}=n,r=Ey(kw,t),i=rO(kw,t),o=SS(t),a=T.useRef(null),l=ze(e,a,r.onTriggerChange),c=T.useRef(!1),d=T.useRef(!1),h=T.useCallback(()=>c.current=!1,[]);return T.useEffect(()=>()=>document.removeEventListener("pointerup",h),[h]),u.jsx(wS,{asChild:!0,...o,children:u.jsx(Se.button,{"aria-describedby":r.open?r.contentId:void 0,"data-state":r.stateAttribute,...s,ref:l,onPointerMove:ie(n.onPointerMove,f=>{f.pointerType!=="touch"&&!d.current&&!i.isPointerInTransitRef.current&&(r.onTriggerEnter(),d.current=!0)}),onPointerLeave:ie(n.onPointerLeave,()=>{r.onTriggerLeave(),d.current=!1}),onPointerDown:ie(n.onPointerDown,()=>{r.open&&r.onClose(),c.current=!0,document.addEventListener("pointerup",h,{once:!0})}),onFocus:ie(n.onFocus,()=>{c.current||r.onOpen()}),onBlur:ie(n.onBlur,r.onClose),onClick:ie(n.onClick,r.onClose)})})});xW.displayName=kw;var EW="TooltipPortal",[Lpe,wW]=xy(EW,{forceMount:void 0}),Qu="TooltipContent",aO=T.forwardRef((n,e)=>{const t=wW(Qu,n.__scopeTooltip),{forceMount:s=t.forceMount,side:r="top",...i}=n,o=Ey(Qu,n.__scopeTooltip);return u.jsx(wr,{present:s||o.open,children:o.disableHoverableContent?u.jsx(lO,{side:r,...i,ref:e}):u.jsx(TW,{side:r,...i,ref:e})})}),TW=T.forwardRef((n,e)=>{const t=Ey(Qu,n.__scopeTooltip),s=rO(Qu,n.__scopeTooltip),r=T.useRef(null),i=ze(e,r),[o,a]=T.useState(null),{trigger:l,onClose:c}=t,d=r.current,{onPointerInTransitChange:h}=s,f=T.useCallback(()=>{a(null),h(!1)},[h]),m=T.useCallback((p,y)=>{const v=p.currentTarget,x={x:p.clientX,y:p.clientY},E=IW(x,v.getBoundingClientRect()),w=RW(x,E),b=CW(y.getBoundingClientRect()),C=kW([...w,...b]);a(C),h(!0)},[h]);return T.useEffect(()=>()=>f(),[f]),T.useEffect(()=>{if(l&&d){const p=v=>m(v,d),y=v=>m(v,l);return l.addEventListener("pointerleave",p),d.addEventListener("pointerleave",y),()=>{l.removeEventListener("pointerleave",p),d.removeEventListener("pointerleave",y)}}},[l,d,m,f]),T.useEffect(()=>{if(o){const p=y=>{const v=y.target,x={x:y.clientX,y:y.clientY},E=(l==null?void 0:l.contains(v))||(d==null?void 0:d.contains(v)),w=!PW(x,o);E?f():w&&(f(),c())};return document.addEventListener("pointermove",p),()=>document.removeEventListener("pointermove",p)}},[l,d,o,c,f]),u.jsx(lO,{...n,ref:i})}),[bW,SW]=xy(oO,{isInside:!1}),_W=oG("TooltipContent"),lO=T.forwardRef((n,e)=>{const{__scopeTooltip:t,children:s,"aria-label":r,onEscapeKeyDown:i,onPointerDownOutside:o,...a}=n,l=Ey(Qu,t),c=SS(t),{onClose:d}=l;return T.useEffect(()=>(document.addEventListener(TR,d),()=>document.removeEventListener(TR,d)),[d]),T.useEffect(()=>{if(l.trigger){const h=f=>{const m=f.target;m!=null&&m.contains(l.trigger)&&d()};return window.addEventListener("scroll",h,{capture:!0}),()=>window.removeEventListener("scroll",h,{capture:!0})}},[l.trigger,d]),u.jsx(xd,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:h=>h.preventDefault(),onDismiss:d,children:u.jsxs(TS,{"data-state":l.stateAttribute,...c,...a,ref:e,style:{...a.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[u.jsx(_W,{children:s}),u.jsx(bW,{scope:t,isInside:!0,children:u.jsx(AG,{id:l.contentId,role:"tooltip",children:r||s})})]})})});aO.displayName=Qu;var cO="TooltipArrow",AW=T.forwardRef((n,e)=>{const{__scopeTooltip:t,...s}=n,r=SS(t);return SW(cO,t).isInside?null:u.jsx(bS,{...r,...s,ref:e})});AW.displayName=cO;function IW(n,e){const t=Math.abs(e.top-n.y),s=Math.abs(e.bottom-n.y),r=Math.abs(e.right-n.x),i=Math.abs(e.left-n.x);switch(Math.min(t,s,r,i)){case i:return"left";case r:return"right";case t:return"top";case s:return"bottom";default:throw new Error("unreachable")}}function RW(n,e,t=5){const s=[];switch(e){case"top":s.push({x:n.x-t,y:n.y+t},{x:n.x+t,y:n.y+t});break;case"bottom":s.push({x:n.x-t,y:n.y-t},{x:n.x+t,y:n.y-t});break;case"left":s.push({x:n.x+t,y:n.y-t},{x:n.x+t,y:n.y+t});break;case"right":s.push({x:n.x-t,y:n.y-t},{x:n.x-t,y:n.y+t});break}return s}function CW(n){const{top:e,right:t,bottom:s,left:r}=n;return[{x:r,y:e},{x:t,y:e},{x:t,y:s},{x:r,y:s}]}function PW(n,e){const{x:t,y:s}=n;let r=!1;for(let i=0,o=e.length-1;i<e.length;o=i++){const a=e[i].x,l=e[i].y,c=e[o].x,d=e[o].y;l>s!=d>s&&t<(c-a)*(s-l)/(d-l)+a&&(r=!r)}return r}function kW(n){const e=n.slice();return e.sort((t,s)=>t.x<s.x?-1:t.x>s.x?1:t.y<s.y?-1:t.y>s.y?1:0),NW(e)}function NW(n){if(n.length<=1)return n.slice();const e=[];for(let s=0;s<n.length;s++){const r=n[s];for(;e.length>=2;){const i=e[e.length-1],o=e[e.length-2];if((i.x-o.x)*(r.y-o.y)>=(i.y-o.y)*(r.x-o.x))e.pop();else break}e.push(r)}e.pop();const t=[];for(let s=n.length-1;s>=0;s--){const r=n[s];for(;t.length>=2;){const i=t[t.length-1],o=t[t.length-2];if((i.x-o.x)*(r.y-o.y)>=(i.y-o.y)*(r.x-o.x))t.pop();else break}t.push(r)}return t.pop(),e.length===1&&t.length===1&&e[0].x===t[0].x&&e[0].y===t[0].y?e:e.concat(t)}var LW=iO,uO=aO;const DW=LW,MW=T.forwardRef(({className:n,sideOffset:e=4,...t},s)=>u.jsx(uO,{ref:s,sideOffset:e,className:Ae("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",n),...t}));MW.displayName=uO.displayName;const OW="modulepreload",jW=function(n){return"/"+n},bR={},pi=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));r=Promise.allSettled(t.map(l=>{if(l=jW(l),l in bR)return;bR[l]=!0;const c=l.endsWith(".css"),d=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const h=document.createElement("link");if(h.rel=c?"stylesheet":OW,c||(h.as="script"),h.crossOrigin="",h.href=l,a&&h.setAttribute("nonce",a),document.head.appendChild(h),c)return new Promise((f,m)=>{h.addEventListener("load",f),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return r.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})},FW=()=>{};var SR={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dO=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},UW=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const r=n[t++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=n[t++];e[s++]=String.fromCharCode((r&31)<<6|i&63)}else if(r>239&&r<365){const i=n[t++],o=n[t++],a=n[t++],l=((r&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[s++]=String.fromCharCode((r&15)<<12|(i&63)<<6|o&63)}}return e.join("")},hO={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<n.length;r+=3){const i=n[r],o=r+1<n.length,a=o?n[r+1]:0,l=r+2<n.length,c=l?n[r+2]:0,d=i>>2,h=(i&3)<<4|a>>4;let f=(a&15)<<2|c>>6,m=c&63;l||(m=64,o||(f=64)),s.push(t[d],t[h],t[f],t[m])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(dO(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):UW(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<n.length;){const i=t[n.charAt(r++)],a=r<n.length?t[n.charAt(r)]:0;++r;const c=r<n.length?t[n.charAt(r)]:64;++r;const h=r<n.length?t[n.charAt(r)]:64;if(++r,i==null||a==null||c==null||h==null)throw new VW;const f=i<<2|a>>4;if(s.push(f),c!==64){const m=a<<4&240|c>>2;if(s.push(m),h!==64){const p=c<<6&192|h;s.push(p)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class VW extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const $W=function(n){const e=dO(n);return hO.encodeByteArray(e,!0)},n0=function(n){return $W(n).replace(/\./g,"")},fO=function(n){try{return hO.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BW(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GW=()=>BW().__FIREBASE_DEFAULTS__,KW=()=>{if(typeof process>"u"||typeof SR>"u")return;const n=SR.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},HW=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&fO(n[1]);return e&&JSON.parse(e)},wy=()=>{try{return FW()||GW()||KW()||HW()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},mO=n=>{var e,t;return(t=(e=wy())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},WW=n=>{const e=mO(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},pO=()=>{var n;return(n=wy())==null?void 0:n.config},gO=n=>{var e;return(e=wy())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zW{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sd(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function yO(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qW(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",r=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[n0(JSON.stringify(t)),n0(JSON.stringify(o)),""].join(".")}const Gh={};function YW(){const n={prod:[],emulator:[]};for(const e of Object.keys(Gh))Gh[e]?n.emulator.push(e):n.prod.push(e);return n}function QW(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let _R=!1;function vO(n,e){if(typeof window>"u"||typeof document>"u"||!Sd(window.location.host)||Gh[n]===e||Gh[n]||_R)return;Gh[n]=e;function t(f){return`__firebase__banner__${f}`}const s="__firebase__banner",i=YW().prod.length>0;function o(){const f=document.getElementById(s);f&&f.remove()}function a(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function l(f,m){f.setAttribute("width","24"),f.setAttribute("id",m),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function c(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{_R=!0,o()},f}function d(f,m){f.setAttribute("id",m),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function h(){const f=QW(s),m=t("text"),p=document.getElementById(m)||document.createElement("span"),y=t("learnmore"),v=document.getElementById(y)||document.createElement("a"),x=t("preprendIcon"),E=document.getElementById(x)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const w=f.element;a(w),d(v,y);const b=c();l(E,x),w.append(E,p,v,b),document.body.appendChild(w)}i?(p.innerText="Preview backend disconnected.",E.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(E.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,p.innerText="Preview backend running in this workspace."),p.setAttribute("id",m)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ss(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function XW(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ss())}function JW(){var e;const n=(e=wy())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function ZW(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function ez(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function tz(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function nz(){const n=ss();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function sz(){return!JW()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function rz(){try{return typeof indexedDB=="object"}catch{return!1}}function iz(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var i;e(((i=r.error)==null?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oz="FirebaseError";class bo extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=oz,Object.setPrototypeOf(this,bo.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,im.prototype.create)}}class im{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],o=i?az(i,s):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new bo(r,a,s)}}function az(n,e){return n.replace(lz,(t,s)=>{const r=e[s];return r!=null?String(r):`<${s}?>`})}const lz=/\{\$([^}]+)}/g;function cz(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function mo(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const r of t){if(!s.includes(r))return!1;const i=n[r],o=e[r];if(AR(i)&&AR(o)){if(!mo(i,o))return!1}else if(i!==o)return!1}for(const r of s)if(!t.includes(r))return!1;return!0}function AR(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function om(n){const e=[];for(const[t,s]of Object.entries(n))Array.isArray(s)?s.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function Th(n){const e={};return n.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[r,i]=s.split("=");e[decodeURIComponent(r)]=decodeURIComponent(i)}}),e}function bh(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function uz(n,e){const t=new dz(n,e);return t.subscribe.bind(t)}class dz{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let r;if(e===void 0&&t===void 0&&s===void 0)throw new Error("Missing Observer.");hz(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:s},r.next===void 0&&(r.next=cx),r.error===void 0&&(r.error=cx),r.complete===void 0&&(r.complete=cx);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function hz(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function cx(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fn(n){return n&&n._delegate?n._delegate:n}class Jl{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vl="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fz{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new zW;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&s.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(pz(e))try{this.getOrInitializeService({instanceIdentifier:vl})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:r});s.resolve(i)}catch{}}}}clearInstance(e=vl){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=vl){return this.instances.has(e)}getOptions(e=vl){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);s===a&&o.resolve(r)}return r}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(s)??new Set;r.add(e),this.onInitCallbacks.set(s,r);const i=this.instances.get(s);return i&&e(i,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const r of s)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:mz(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=vl){return this.component?this.component.multipleInstances?e:vl:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function mz(n){return n===vl?void 0:n}function pz(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gz{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new fz(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Je;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Je||(Je={}));const yz={debug:Je.DEBUG,verbose:Je.VERBOSE,info:Je.INFO,warn:Je.WARN,error:Je.ERROR,silent:Je.SILENT},vz=Je.INFO,xz={[Je.DEBUG]:"log",[Je.VERBOSE]:"log",[Je.INFO]:"info",[Je.WARN]:"warn",[Je.ERROR]:"error"},Ez=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),r=xz[e];if(r)console[r](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let _S=class{constructor(e){this.name=e,this._logLevel=vz,this._logHandler=Ez,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Je))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?yz[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Je.DEBUG,...e),this._logHandler(this,Je.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Je.VERBOSE,...e),this._logHandler(this,Je.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Je.INFO,...e),this._logHandler(this,Je.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Je.WARN,...e),this._logHandler(this,Je.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Je.ERROR,...e),this._logHandler(this,Je.ERROR,...e)}};const wz=(n,e)=>e.some(t=>n instanceof t);let IR,RR;function Tz(){return IR||(IR=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function bz(){return RR||(RR=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const xO=new WeakMap,Nw=new WeakMap,EO=new WeakMap,ux=new WeakMap,AS=new WeakMap;function Sz(n){const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Ia(n.result)),r()},o=()=>{s(n.error),r()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&xO.set(t,n)}).catch(()=>{}),AS.set(e,n),e}function _z(n){if(Nw.has(n))return;const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});Nw.set(n,e)}let Lw={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Nw.get(n);if(e==="objectStoreNames")return n.objectStoreNames||EO.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ia(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Az(n){Lw=n(Lw)}function Iz(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(dx(this),e,...t);return EO.set(s,e.sort?e.sort():[e]),Ia(s)}:bz().includes(n)?function(...e){return n.apply(dx(this),e),Ia(xO.get(this))}:function(...e){return Ia(n.apply(dx(this),e))}}function Rz(n){return typeof n=="function"?Iz(n):(n instanceof IDBTransaction&&_z(n),wz(n,Tz())?new Proxy(n,Lw):n)}function Ia(n){if(n instanceof IDBRequest)return Sz(n);if(ux.has(n))return ux.get(n);const e=Rz(n);return e!==n&&(ux.set(n,e),AS.set(e,n)),e}const dx=n=>AS.get(n);function Cz(n,e,{blocked:t,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(n,e),a=Ia(o);return s&&o.addEventListener("upgradeneeded",l=>{s(Ia(o.result),l.oldVersion,l.newVersion,Ia(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),r&&l.addEventListener("versionchange",c=>r(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const Pz=["get","getKey","getAll","getAllKeys","count"],kz=["put","add","delete","clear"],hx=new Map;function CR(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(hx.get(e))return hx.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,r=kz.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(r||Pz.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,r?"readwrite":"readonly");let c=l.store;return s&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),r&&l.done]))[0]};return hx.set(e,i),i}Az(n=>({...n,get:(e,t,s)=>CR(e,t)||n.get(e,t,s),has:(e,t)=>!!CR(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nz{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Lz(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function Lz(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Dw="@firebase/app",PR="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const po=new _S("@firebase/app"),Dz="@firebase/app-compat",Mz="@firebase/analytics-compat",Oz="@firebase/analytics",jz="@firebase/app-check-compat",Fz="@firebase/app-check",Uz="@firebase/auth",Vz="@firebase/auth-compat",$z="@firebase/database",Bz="@firebase/data-connect",Gz="@firebase/database-compat",Kz="@firebase/functions",Hz="@firebase/functions-compat",Wz="@firebase/installations",zz="@firebase/installations-compat",qz="@firebase/messaging",Yz="@firebase/messaging-compat",Qz="@firebase/performance",Xz="@firebase/performance-compat",Jz="@firebase/remote-config",Zz="@firebase/remote-config-compat",eq="@firebase/storage",tq="@firebase/storage-compat",nq="@firebase/firestore",sq="@firebase/ai",rq="@firebase/firestore-compat",iq="firebase",oq="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mw="[DEFAULT]",aq={[Dw]:"fire-core",[Dz]:"fire-core-compat",[Oz]:"fire-analytics",[Mz]:"fire-analytics-compat",[Fz]:"fire-app-check",[jz]:"fire-app-check-compat",[Uz]:"fire-auth",[Vz]:"fire-auth-compat",[$z]:"fire-rtdb",[Bz]:"fire-data-connect",[Gz]:"fire-rtdb-compat",[Kz]:"fire-fn",[Hz]:"fire-fn-compat",[Wz]:"fire-iid",[zz]:"fire-iid-compat",[qz]:"fire-fcm",[Yz]:"fire-fcm-compat",[Qz]:"fire-perf",[Xz]:"fire-perf-compat",[Jz]:"fire-rc",[Zz]:"fire-rc-compat",[eq]:"fire-gcs",[tq]:"fire-gcs-compat",[nq]:"fire-fst",[rq]:"fire-fst-compat",[sq]:"fire-vertex","fire-js":"fire-js",[iq]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s0=new Map,lq=new Map,Ow=new Map;function kR(n,e){try{n.container.addComponent(e)}catch(t){po.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Xu(n){const e=n.name;if(Ow.has(e))return po.debug(`There were multiple attempts to register component ${e}.`),!1;Ow.set(e,n);for(const t of s0.values())kR(t,n);for(const t of lq.values())kR(t,n);return!0}function IS(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function zs(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cq={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ra=new im("app","Firebase",cq);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uq{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Jl("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ra.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _d=oq;function wO(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s={name:Mw,automaticDataCollectionEnabled:!0,...e},r=s.name;if(typeof r!="string"||!r)throw Ra.create("bad-app-name",{appName:String(r)});if(t||(t=pO()),!t)throw Ra.create("no-options");const i=s0.get(r);if(i){if(mo(t,i.options)&&mo(s,i.config))return i;throw Ra.create("duplicate-app",{appName:r})}const o=new gz(r);for(const l of Ow.values())o.addComponent(l);const a=new uq(t,s,o);return s0.set(r,a),a}function TO(n=Mw){const e=s0.get(n);if(!e&&n===Mw&&pO())return wO();if(!e)throw Ra.create("no-app",{appName:n});return e}function Ca(n,e,t){let s=aq[n]??n;t&&(s+=`-${t}`);const r=s.match(/\s|\//),i=e.match(/\s|\//);if(r||i){const o=[`Unable to register library "${s}" with version "${e}":`];r&&o.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),po.warn(o.join(" "));return}Xu(new Jl(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dq="firebase-heartbeat-database",hq=1,bf="firebase-heartbeat-store";let fx=null;function bO(){return fx||(fx=Cz(dq,hq,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(bf)}catch(t){console.warn(t)}}}}).catch(n=>{throw Ra.create("idb-open",{originalErrorMessage:n.message})})),fx}async function fq(n){try{const t=(await bO()).transaction(bf),s=await t.objectStore(bf).get(SO(n));return await t.done,s}catch(e){if(e instanceof bo)po.warn(e.message);else{const t=Ra.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});po.warn(t.message)}}}async function NR(n,e){try{const s=(await bO()).transaction(bf,"readwrite");await s.objectStore(bf).put(e,SO(n)),await s.done}catch(t){if(t instanceof bo)po.warn(t.message);else{const s=Ra.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});po.warn(s.message)}}}function SO(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mq=1024,pq=30;class gq{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new vq(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,t;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=LR();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:r}),this._heartbeatsCache.heartbeats.length>pq){const o=xq(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(s){po.warn(s)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=LR(),{heartbeatsToSend:s,unsentEntries:r}=yq(this._heartbeatsCache.heartbeats),i=n0(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return po.warn(t),""}}}function LR(){return new Date().toISOString().substring(0,10)}function yq(n,e=mq){const t=[];let s=n.slice();for(const r of n){const i=t.find(o=>o.agent===r.agent);if(i){if(i.dates.push(r.date),DR(t)>e){i.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),DR(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class vq{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return rz()?iz().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await fq(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return NR(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return NR(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function DR(n){return n0(JSON.stringify({version:2,heartbeats:n})).length}function xq(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let s=1;s<n.length;s++)n[s].date<t&&(t=n[s].date,e=s);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eq(n){Xu(new Jl("platform-logger",e=>new Nz(e),"PRIVATE")),Xu(new Jl("heartbeat",e=>new gq(e),"PRIVATE")),Ca(Dw,PR,n),Ca(Dw,PR,"esm2020"),Ca("fire-js","")}Eq("");function _O(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const wq=_O,AO=new im("auth","Firebase",_O());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r0=new _S("@firebase/auth");function Tq(n,...e){r0.logLevel<=Je.WARN&&r0.warn(`Auth (${_d}): ${n}`,...e)}function tg(n,...e){r0.logLevel<=Je.ERROR&&r0.error(`Auth (${_d}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xr(n,...e){throw CS(n,...e)}function Vr(n,...e){return CS(n,...e)}function RS(n,e,t){const s={...wq(),[e]:t};return new im("auth","Firebase",s).create(e,{appName:n.name})}function eo(n){return RS(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function bq(n,e,t){const s=t;if(!(e instanceof s))throw s.name!==e.constructor.name&&xr(n,"argument-error"),RS(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function CS(n,...e){if(typeof n!="string"){const t=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=n.name),n._errorFactory.create(t,...s)}return AO.create(n,...e)}function Re(n,e,...t){if(!n)throw CS(e,...t)}function Qi(n){const e="INTERNAL ASSERTION FAILED: "+n;throw tg(e),new Error(e)}function go(n,e){n||Qi(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jw(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function Sq(){return MR()==="http:"||MR()==="https:"}function MR(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _q(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Sq()||ez()||"connection"in navigator)?navigator.onLine:!0}function Aq(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class am{constructor(e,t){this.shortDelay=e,this.longDelay=t,go(t>e,"Short delay should be less than long delay!"),this.isMobile=XW()||tz()}get(){return _q()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PS(n,e){go(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IO{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Qi("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Qi("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Qi("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iq={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rq=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Cq=new am(3e4,6e4);function So(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function ki(n,e,t,s,r={}){return RO(n,r,async()=>{let i={},o={};s&&(e==="GET"?o=s:i={body:JSON.stringify(s)});const a=om({key:n.config.apiKey,...o}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c={method:e,headers:l,...i};return ZW()||(c.referrerPolicy="no-referrer"),n.emulatorConfig&&Sd(n.emulatorConfig.host)&&(c.credentials="include"),IO.fetch()(await CO(n,n.config.apiHost,t,a),c)})}async function RO(n,e,t){n._canInitEmulator=!1;const s={...Iq,...e};try{const r=new kq(n),i=await Promise.race([t(),r.promise]);r.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw cp(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw cp(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw cp(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw cp(n,"user-disabled",o);const d=s[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw RS(n,d,c);xr(n,d)}}catch(r){if(r instanceof bo)throw r;xr(n,"network-request-failed",{message:String(r)})}}async function lm(n,e,t,s,r={}){const i=await ki(n,e,t,s,r);return"mfaPendingCredential"in i&&xr(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function CO(n,e,t,s){const r=`${e}${t}?${s}`,i=n,o=i.config.emulator?PS(n.config,r):`${n.config.apiScheme}://${r}`;return Rq.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function Pq(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class kq{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,s)=>{this.timer=setTimeout(()=>s(Vr(this.auth,"network-request-failed")),Cq.get())})}}function cp(n,e,t){const s={appName:n.name};t.email&&(s.email=t.email),t.phoneNumber&&(s.phoneNumber=t.phoneNumber);const r=Vr(n,e,s);return r.customData._tokenResponse=t,r}function OR(n){return n!==void 0&&n.enterprise!==void 0}class Nq{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Pq(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Lq(n,e){return ki(n,"GET","/v2/recaptchaConfig",So(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dq(n,e){return ki(n,"POST","/v1/accounts:delete",e)}async function i0(n,e){return ki(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kh(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Mq(n,e=!1){const t=fn(n),s=await t.getIdToken(e),r=kS(s);Re(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");const i=typeof r.firebase=="object"?r.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:r,token:s,authTime:Kh(mx(r.auth_time)),issuedAtTime:Kh(mx(r.iat)),expirationTime:Kh(mx(r.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function mx(n){return Number(n)*1e3}function kS(n){const[e,t,s]=n.split(".");if(e===void 0||t===void 0||s===void 0)return tg("JWT malformed, contained fewer than 3 sections"),null;try{const r=fO(t);return r?JSON.parse(r):(tg("Failed to decode base64 JWT payload"),null)}catch(r){return tg("Caught error parsing JWT payload as JSON",r==null?void 0:r.toString()),null}}function jR(n){const e=kS(n);return Re(e,"internal-error"),Re(typeof e.exp<"u","internal-error"),Re(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ju(n,e,t=!1){if(t)return e;try{return await e}catch(s){throw s instanceof bo&&Oq(s)&&n.auth.currentUser===n&&await n.auth.signOut(),s}}function Oq({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jq{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const s=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fw{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Kh(this.lastLoginAt),this.creationTime=Kh(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function o0(n){var h;const e=n.auth,t=await n.getIdToken(),s=await Ju(n,i0(e,{idToken:t}));Re(s==null?void 0:s.users.length,e,"internal-error");const r=s.users[0];n._notifyReloadListener(r);const i=(h=r.providerUserInfo)!=null&&h.length?PO(r.providerUserInfo):[],o=Uq(n.providerData,i),a=n.isAnonymous,l=!(n.email&&r.passwordHash)&&!(o!=null&&o.length),c=a?l:!1,d={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new Fw(r.createdAt,r.lastLoginAt),isAnonymous:c};Object.assign(n,d)}async function Fq(n){const e=fn(n);await o0(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Uq(n,e){return[...n.filter(s=>!e.some(r=>r.providerId===s.providerId)),...e]}function PO(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vq(n,e){const t=await RO(n,{},async()=>{const s=om({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:i}=n.config,o=await CO(n,r,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:s};return n.emulatorConfig&&Sd(n.emulatorConfig.host)&&(l.credentials="include"),IO.fetch()(o,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function $q(n,e){return ki(n,"POST","/v2/accounts:revokeToken",So(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xu{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Re(e.idToken,"internal-error"),Re(typeof e.idToken<"u","internal-error"),Re(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):jR(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Re(e.length!==0,"internal-error");const t=jR(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Re(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:s,refreshToken:r,expiresIn:i}=await Vq(e,t);this.updateTokensAndExpiration(s,r,Number(i))}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,t){const{refreshToken:s,accessToken:r,expirationTime:i}=t,o=new xu;return s&&(Re(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),r&&(Re(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),i&&(Re(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new xu,this.toJSON())}_performRefresh(){return Qi("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ho(n,e){Re(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class jr{constructor({uid:e,auth:t,stsTokenManager:s,...r}){this.providerId="firebase",this.proactiveRefresh=new jq(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new Fw(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await Ju(this,this.stsTokenManager.getToken(this.auth,e));return Re(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Mq(this,e)}reload(){return Fq(this)}_assign(e){this!==e&&(Re(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new jr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){Re(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&await o0(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(zs(this.auth.app))return Promise.reject(eo(this.auth));const e=await this.getIdToken();return await Ju(this,Dq(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const s=t.displayName??void 0,r=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,l=t._redirectEventId??void 0,c=t.createdAt??void 0,d=t.lastLoginAt??void 0,{uid:h,emailVerified:f,isAnonymous:m,providerData:p,stsTokenManager:y}=t;Re(h&&y,e,"internal-error");const v=xu.fromJSON(this.name,y);Re(typeof h=="string",e,"internal-error"),Ho(s,e.name),Ho(r,e.name),Re(typeof f=="boolean",e,"internal-error"),Re(typeof m=="boolean",e,"internal-error"),Ho(i,e.name),Ho(o,e.name),Ho(a,e.name),Ho(l,e.name),Ho(c,e.name),Ho(d,e.name);const x=new jr({uid:h,auth:e,email:r,emailVerified:f,displayName:s,isAnonymous:m,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:v,createdAt:c,lastLoginAt:d});return p&&Array.isArray(p)&&(x.providerData=p.map(E=>({...E}))),l&&(x._redirectEventId=l),x}static async _fromIdTokenResponse(e,t,s=!1){const r=new xu;r.updateFromServerResponse(t);const i=new jr({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:s});return await o0(i),i}static async _fromGetAccountInfoResponse(e,t,s){const r=t.users[0];Re(r.localId!==void 0,"internal-error");const i=r.providerUserInfo!==void 0?PO(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!(i!=null&&i.length),a=new xu;a.updateFromIdToken(s);const l=new jr({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new Fw(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FR=new Map;function Xi(n){go(n instanceof Function,"Expected a class definition");let e=FR.get(n);return e?(go(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,FR.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kO{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}kO.type="NONE";const UR=kO;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ng(n,e,t){return`firebase:${n}:${e}:${t}`}class Eu{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:r,name:i}=this.auth;this.fullUserKey=ng(this.userKey,r.apiKey,i),this.fullPersistenceKey=ng("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await i0(this.auth,{idToken:e}).catch(()=>{});return t?jr._fromGetAccountInfoResponse(this.auth,t,e):null}return jr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,s="authUser"){if(!t.length)return new Eu(Xi(UR),e,s);const r=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=r[0]||Xi(UR);const o=ng(s,e.config.apiKey,e.name);let a=null;for(const c of t)try{const d=await c._get(o);if(d){let h;if(typeof d=="string"){const f=await i0(e,{idToken:d}).catch(()=>{});if(!f)break;h=await jr._fromGetAccountInfoResponse(e,f,d)}else h=jr._fromJSON(e,d);c!==i&&(a=h),i=c;break}}catch{}const l=r.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Eu(i,e,s):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new Eu(i,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VR(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(MO(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(NO(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(jO(e))return"Blackberry";if(FO(e))return"Webos";if(LO(e))return"Safari";if((e.includes("chrome/")||DO(e))&&!e.includes("edge/"))return"Chrome";if(OO(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=n.match(t);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function NO(n=ss()){return/firefox\//i.test(n)}function LO(n=ss()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function DO(n=ss()){return/crios\//i.test(n)}function MO(n=ss()){return/iemobile/i.test(n)}function OO(n=ss()){return/android/i.test(n)}function jO(n=ss()){return/blackberry/i.test(n)}function FO(n=ss()){return/webos/i.test(n)}function NS(n=ss()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Bq(n=ss()){var e;return NS(n)&&!!((e=window.navigator)!=null&&e.standalone)}function Gq(){return nz()&&document.documentMode===10}function UO(n=ss()){return NS(n)||OO(n)||FO(n)||jO(n)||/windows phone/i.test(n)||MO(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VO(n,e=[]){let t;switch(n){case"Browser":t=VR(ss());break;case"Worker":t=`${VR(ss())}-${n}`;break;default:t=n}const s=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${_d}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kq{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});s.onAbort=t,this.queue.push(s);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)await s(e),s.onAbort&&t.push(s.onAbort)}catch(s){t.reverse();for(const r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hq(n,e={}){return ki(n,"GET","/v2/passwordPolicy",So(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wq=6;class zq{constructor(e){var s;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??Wq,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((s=e.allowedNonAlphanumericCharacters)==null?void 0:s.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let s;for(let r=0;r<e.length;r++)s=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qq{constructor(e,t,s,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new $R(this),this.idTokenSubscription=new $R(this),this.beforeStateQueue=new Kq(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=AO,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Xi(t)),this._initializationPromise=this.queue(async()=>{var s,r,i;if(!this._deleted&&(this.persistenceManager=await Eu.create(this,e),(s=this._resolvePersistenceManagerAvailable)==null||s.call(this),!this._deleted)){if((r=this._popupRedirectResolver)!=null&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await i0(this,{idToken:e}),s=await jr._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(zs(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let s=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,r=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return Re(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await o0(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Aq()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(zs(this.app))return Promise.reject(eo(this));const t=e?fn(e):null;return t&&Re(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Re(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return zs(this.app)?Promise.reject(eo(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return zs(this.app)?Promise.reject(eo(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Xi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Hq(this),t=new zq(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new im("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(s.tenantId=this.tenantId),await $q(this,s)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const s=await this.getOrInitRedirectPersistenceManager(t);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Xi(e)||this._popupRedirectResolver;Re(t,this,"argument-error"),this.redirectPersistenceManager=await Eu.create(this,[Xi(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,s;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((s=this.redirectUser)==null?void 0:s._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,r){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Re(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,s,r);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Re(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=VO(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var r;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((r=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:r.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const s=await this._getAppCheckToken();return s&&(e["X-Firebase-AppCheck"]=s),e}async _getAppCheckToken(){var t;if(zs(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&Tq(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function _o(n){return fn(n)}class $R{constructor(e){this.auth=e,this.observer=null,this.addObserver=uz(t=>this.observer=t)}get next(){return Re(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ty={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Yq(n){Ty=n}function $O(n){return Ty.loadJS(n)}function Qq(){return Ty.recaptchaEnterpriseScript}function Xq(){return Ty.gapiScript}function Jq(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class Zq{constructor(){this.enterprise=new eY}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class eY{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const tY="recaptcha-enterprise",BO="NO_RECAPTCHA";class nY{constructor(e){this.type=tY,this.auth=_o(e)}async verify(e="verify",t=!1){async function s(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{Lq(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new Nq(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function r(i,o,a){const l=window.grecaptcha;OR(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(BO)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Zq().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{s(this.auth).then(a=>{if(!t&&OR(window.grecaptcha))r(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=Qq();l.length!==0&&(l+=a),$O(l).then(()=>{r(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function BR(n,e,t,s=!1,r=!1){const i=new nY(n);let o;if(r)o=BO;else try{o=await i.verify(t)}catch{o=await i.verify(t,!0)}const a={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,c=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return s?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function a0(n,e,t,s,r){var i;if((i=n._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await BR(n,e,t,t==="getOobCode");return s(n,o)}else return s(n,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await BR(n,e,t,t==="getOobCode");return s(n,a)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sY(n,e){const t=IS(n,"auth");if(t.isInitialized()){const r=t.getImmediate(),i=t.getOptions();if(mo(i,e??{}))return r;xr(r,"already-initialized")}return t.initialize({options:e})}function rY(n,e){const t=(e==null?void 0:e.persistence)||[],s=(Array.isArray(t)?t:[t]).map(Xi);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(s,e==null?void 0:e.popupRedirectResolver)}function iY(n,e,t){const s=_o(n);Re(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const r=!!(t!=null&&t.disableWarnings),i=GO(e),{host:o,port:a}=oY(e),l=a===null?"":`:${a}`,c={url:`${i}//${o}${l}/`},d=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!s._canInitEmulator){Re(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),Re(mo(c,s.config.emulator)&&mo(d,s.emulatorConfig),s,"emulator-config-failed");return}s.config.emulator=c,s.emulatorConfig=d,s.settings.appVerificationDisabledForTesting=!0,Sd(o)?(yO(`${i}//${o}${l}`),vO("Auth",!0)):aY()}function GO(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function oY(n){const e=GO(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const s=t[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(s);if(r){const i=r[1];return{host:i,port:GR(s.substr(i.length+1))}}else{const[i,o]=s.split(":");return{host:i,port:GR(o)}}}function GR(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function aY(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LS{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Qi("not implemented")}_getIdTokenResponse(e){return Qi("not implemented")}_linkToIdToken(e,t){return Qi("not implemented")}_getReauthenticationResolver(e){return Qi("not implemented")}}async function lY(n,e){return ki(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cY(n,e){return lm(n,"POST","/v1/accounts:signInWithPassword",So(n,e))}async function uY(n,e){return ki(n,"POST","/v1/accounts:sendOobCode",So(n,e))}async function dY(n,e){return uY(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hY(n,e){return lm(n,"POST","/v1/accounts:signInWithEmailLink",So(n,e))}async function fY(n,e){return lm(n,"POST","/v1/accounts:signInWithEmailLink",So(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sf extends LS{constructor(e,t,s,r=null){super("password",s),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Sf(e,t,"password")}static _fromEmailAndCode(e,t,s=null){return new Sf(e,t,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return a0(e,t,"signInWithPassword",cY);case"emailLink":return hY(e,{email:this._email,oobCode:this._password});default:xr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const s={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return a0(e,s,"signUpPassword",lY);case"emailLink":return fY(e,{idToken:t,email:this._email,oobCode:this._password});default:xr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wu(n,e){return lm(n,"POST","/v1/accounts:signInWithIdp",So(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mY="http://localhost";class Zl extends LS{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Zl(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):xr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:r,...i}=t;if(!s||!r)return null;const o=new Zl(s,r);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return wu(e,t)}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,wu(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,wu(e,t)}buildRequest(){const e={requestUri:mY,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=om(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pY(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function gY(n){const e=Th(bh(n)).link,t=e?Th(bh(e)).deep_link_id:null,s=Th(bh(n)).deep_link_id;return(s?Th(bh(s)).link:null)||s||t||e||n}class DS{constructor(e){const t=Th(bh(e)),s=t.apiKey??null,r=t.oobCode??null,i=pY(t.mode??null);Re(s&&r&&i,"argument-error"),this.apiKey=s,this.operation=i,this.code=r,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=gY(e);try{return new DS(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ad{constructor(){this.providerId=Ad.PROVIDER_ID}static credential(e,t){return Sf._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const s=DS.parseLink(t);return Re(s,"argument-error"),Sf._fromEmailAndCode(e,s.code,s.tenantId)}}Ad.PROVIDER_ID="password";Ad.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Ad.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MS{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cm extends MS{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oa extends cm{constructor(){super("facebook.com")}static credential(e){return Zl._fromParams({providerId:oa.PROVIDER_ID,signInMethod:oa.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return oa.credentialFromTaggedObject(e)}static credentialFromError(e){return oa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return oa.credential(e.oauthAccessToken)}catch{return null}}}oa.FACEBOOK_SIGN_IN_METHOD="facebook.com";oa.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi extends cm{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Zl._fromParams({providerId:zi.PROVIDER_ID,signInMethod:zi.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return zi.credentialFromTaggedObject(e)}static credentialFromError(e){return zi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:s}=e;if(!t&&!s)return null;try{return zi.credential(t,s)}catch{return null}}}zi.GOOGLE_SIGN_IN_METHOD="google.com";zi.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa extends cm{constructor(){super("github.com")}static credential(e){return Zl._fromParams({providerId:aa.PROVIDER_ID,signInMethod:aa.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return aa.credentialFromTaggedObject(e)}static credentialFromError(e){return aa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return aa.credential(e.oauthAccessToken)}catch{return null}}}aa.GITHUB_SIGN_IN_METHOD="github.com";aa.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la extends cm{constructor(){super("twitter.com")}static credential(e,t){return Zl._fromParams({providerId:la.PROVIDER_ID,signInMethod:la.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return la.credentialFromTaggedObject(e)}static credentialFromError(e){return la.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:s}=e;if(!t||!s)return null;try{return la.credential(t,s)}catch{return null}}}la.TWITTER_SIGN_IN_METHOD="twitter.com";la.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yY(n,e){return lm(n,"POST","/v1/accounts:signUp",So(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ec{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,s,r=!1){const i=await jr._fromIdTokenResponse(e,s,r),o=KR(s);return new ec({user:i,providerId:o,_tokenResponse:s,operationType:t})}static async _forOperation(e,t,s){await e._updateTokensIfNecessary(s,!0);const r=KR(s);return new ec({user:e,providerId:r,_tokenResponse:s,operationType:t})}}function KR(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l0 extends bo{constructor(e,t,s,r){super(t.code,t.message),this.operationType=s,this.user=r,Object.setPrototypeOf(this,l0.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,r){return new l0(e,t,s,r)}}function KO(n,e,t,s){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?l0._fromErrorAndOperation(n,i,e,s):i})}async function vY(n,e,t=!1){const s=await Ju(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return ec._forOperation(n,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xY(n,e,t=!1){const{auth:s}=n;if(zs(s.app))return Promise.reject(eo(s));const r="reauthenticate";try{const i=await Ju(n,KO(s,r,e,n),t);Re(i.idToken,s,"internal-error");const o=kS(i.idToken);Re(o,s,"internal-error");const{sub:a}=o;return Re(n.uid===a,s,"user-mismatch"),ec._forOperation(n,r,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&xr(s,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HO(n,e,t=!1){if(zs(n.app))return Promise.reject(eo(n));const s="signIn",r=await KO(n,s,e),i=await ec._fromIdTokenResponse(n,s,r);return t||await n._updateCurrentUser(i.user),i}async function EY(n,e){return HO(_o(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WO(n){const e=_o(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function wY(n,e,t){const s=_o(n);await a0(s,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",dY)}async function TY(n,e,t){if(zs(n.app))return Promise.reject(eo(n));const s=_o(n),o=await a0(s,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",yY).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&WO(n),l}),a=await ec._fromIdTokenResponse(s,"signIn",o);return await s._updateCurrentUser(a.user),a}function bY(n,e,t){return zs(n.app)?Promise.reject(eo(n)):EY(fn(n),Ad.credential(e,t)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&WO(n),s})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SY(n,e){return ki(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _Y(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const s=fn(n),i={idToken:await s.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Ju(s,SY(s.auth,i));s.displayName=o.displayName||null,s.photoURL=o.photoUrl||null;const a=s.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=s.displayName,a.photoURL=s.photoURL),await s._updateTokensIfNecessary(o)}function AY(n,e,t,s){return fn(n).onIdTokenChanged(e,t,s)}function IY(n,e,t){return fn(n).beforeAuthStateChanged(e,t)}function RY(n,e,t,s){return fn(n).onAuthStateChanged(e,t,s)}function CY(n){return fn(n).signOut()}const c0="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zO{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(c0,"1"),this.storage.removeItem(c0),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PY=1e3,kY=10;class qO extends zO{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=UO(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),r=this.localCache[t];s!==r&&e(t,r,s)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const s=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const o=this.storage.getItem(s);!t&&this.localCache[s]===o||this.notifyListeners(s,o)},i=this.storage.getItem(s);Gq()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,kY):r()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},PY)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}qO.type="LOCAL";const NY=qO;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YO extends zO{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}YO.type="SESSION";const QO=YO;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LY(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class by{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(r=>r.isListeningto(e));if(t)return t;const s=new by(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:s,eventType:r,data:i}=t.data,o=this.handlersMap[r];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:r});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await LY(a);t.ports[0].postMessage({status:"done",eventId:s,eventType:r,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}by.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OS(n="",e=10){let t="";for(let s=0;s<e;s++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DY{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,s=50){const r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=OS("",20);r.port1.start();const d=setTimeout(()=>{l(new Error("unsupported_event"))},s);o={messageChannel:r,onMessage(h){const f=h;if(f.data.eventId===c)switch(f.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(f.data.response);break;default:clearTimeout(d),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gi(){return window}function MY(n){gi().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XO(){return typeof gi().WorkerGlobalScope<"u"&&typeof gi().importScripts=="function"}async function OY(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function jY(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function FY(){return XO()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JO="firebaseLocalStorageDb",UY=1,u0="firebaseLocalStorage",ZO="fbase_key";class um{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Sy(n,e){return n.transaction([u0],e?"readwrite":"readonly").objectStore(u0)}function VY(){const n=indexedDB.deleteDatabase(JO);return new um(n).toPromise()}function Uw(){const n=indexedDB.open(JO,UY);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const s=n.result;try{s.createObjectStore(u0,{keyPath:ZO})}catch(r){t(r)}}),n.addEventListener("success",async()=>{const s=n.result;s.objectStoreNames.contains(u0)?e(s):(s.close(),await VY(),e(await Uw()))})})}async function HR(n,e,t){const s=Sy(n,!0).put({[ZO]:e,value:t});return new um(s).toPromise()}async function $Y(n,e){const t=Sy(n,!1).get(e),s=await new um(t).toPromise();return s===void 0?null:s.value}function WR(n,e){const t=Sy(n,!0).delete(e);return new um(t).toPromise()}const BY=800,GY=3;class ej{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Uw(),this.db)}async _withRetries(e){let t=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(t++>GY)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return XO()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=by._getInstance(FY()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,s;if(this.activeServiceWorker=await OY(),!this.activeServiceWorker)return;this.sender=new DY(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(s=e[0])!=null&&s.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||jY()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Uw();return await HR(e,c0,"1"),await WR(e,c0),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(s=>HR(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(s=>$Y(s,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>WR(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(r=>{const i=Sy(r,!1).getAll();return new um(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],s=new Set;if(e.length!==0)for(const{fbase_key:r,value:i}of e)s.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!s.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),BY)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}ej.type="LOCAL";const KY=ej;new am(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tj(n,e){return e?Xi(e):(Re(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jS extends LS{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return wu(e,this._buildIdpRequest())}_linkToIdToken(e,t){return wu(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return wu(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function HY(n){return HO(n.auth,new jS(n),n.bypassAuthState)}function WY(n){const{auth:e,user:t}=n;return Re(t,e,"internal-error"),xY(t,new jS(n),n.bypassAuthState)}async function zY(n){const{auth:e,user:t}=n;return Re(t,e,"internal-error"),vY(t,new jS(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nj{constructor(e,t,s,r,i=!1){this.auth=e,this.resolver=s,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:s,postBody:r,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:s,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return HY;case"linkViaPopup":case"linkViaRedirect":return zY;case"reauthViaPopup":case"reauthViaRedirect":return WY;default:xr(this.auth,"internal-error")}}resolve(e){go(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){go(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qY=new am(2e3,1e4);async function YY(n,e,t){if(zs(n.app))return Promise.reject(Vr(n,"operation-not-supported-in-this-environment"));const s=_o(n);bq(n,e,MS);const r=tj(s,t);return new Al(s,"signInViaPopup",e,r).executeNotNull()}class Al extends nj{constructor(e,t,s,r,i){super(e,t,r,i),this.provider=s,this.authWindow=null,this.pollId=null,Al.currentPopupAction&&Al.currentPopupAction.cancel(),Al.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Re(e,this.auth,"internal-error"),e}async onExecution(){go(this.filter.length===1,"Popup operations only handle one event");const e=OS();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Vr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Vr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Al.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,s;if((s=(t=this.authWindow)==null?void 0:t.window)!=null&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Vr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,qY.get())};e()}}Al.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QY="pendingRedirect",sg=new Map;class XY extends nj{constructor(e,t,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,s),this.eventId=null}async execute(){let e=sg.get(this.auth._key());if(!e){try{const s=await JY(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(t){e=()=>Promise.reject(t)}sg.set(this.auth._key(),e)}return this.bypassAuthState||sg.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function JY(n,e){const t=tQ(e),s=eQ(n);if(!await s._isAvailable())return!1;const r=await s._get(t)==="true";return await s._remove(t),r}function ZY(n,e){sg.set(n._key(),e)}function eQ(n){return Xi(n._redirectPersistence)}function tQ(n){return ng(QY,n.config.apiKey,n.name)}async function nQ(n,e,t=!1){if(zs(n.app))return Promise.reject(eo(n));const s=_o(n),r=tj(s,e),o=await new XY(s,r,t).execute();return o&&!t&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sQ=10*60*1e3;class rQ{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!iQ(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var s;if(e.error&&!sj(e)){const r=((s=e.error.code)==null?void 0:s.split("auth/")[1])||"internal-error";t.onError(Vr(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=sQ&&this.cachedEventUids.clear(),this.cachedEventUids.has(zR(e))}saveEventToCache(e){this.cachedEventUids.add(zR(e)),this.lastProcessedEventTime=Date.now()}}function zR(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function sj({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function iQ(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return sj(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oQ(n,e={}){return ki(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aQ=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,lQ=/^https?/;async function cQ(n){if(n.config.emulator)return;const{authorizedDomains:e}=await oQ(n);for(const t of e)try{if(uQ(t))return}catch{}xr(n,"unauthorized-domain")}function uQ(n){const e=jw(),{protocol:t,hostname:s}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&s===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===s}if(!lQ.test(t))return!1;if(aQ.test(n))return s===n;const r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dQ=new am(3e4,6e4);function qR(){const n=gi().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function hQ(n){return new Promise((e,t)=>{var r,i,o;function s(){qR(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{qR(),t(Vr(n,"network-request-failed"))},timeout:dQ.get()})}if((i=(r=gi().gapi)==null?void 0:r.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=gi().gapi)!=null&&o.load)s();else{const a=Jq("iframefcb");return gi()[a]=()=>{gapi.load?s():t(Vr(n,"network-request-failed"))},$O(`${Xq()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw rg=null,e})}let rg=null;function fQ(n){return rg=rg||hQ(n),rg}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mQ=new am(5e3,15e3),pQ="__/auth/iframe",gQ="emulator/auth/iframe",yQ={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},vQ=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function xQ(n){const e=n.config;Re(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?PS(e,gQ):`https://${n.config.authDomain}/${pQ}`,s={apiKey:e.apiKey,appName:n.name,v:_d},r=vQ.get(n.config.apiHost);r&&(s.eid=r);const i=n._getFrameworks();return i.length&&(s.fw=i.join(",")),`${t}?${om(s).slice(1)}`}async function EQ(n){const e=await fQ(n),t=gi().gapi;return Re(t,n,"internal-error"),e.open({where:document.body,url:xQ(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:yQ,dontclear:!0},s=>new Promise(async(r,i)=>{await s.restyle({setHideOnLeave:!1});const o=Vr(n,"network-request-failed"),a=gi().setTimeout(()=>{i(o)},mQ.get());function l(){gi().clearTimeout(a),r(s)}s.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wQ={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},TQ=500,bQ=600,SQ="_blank",_Q="http://localhost";class YR{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function AQ(n,e,t,s=TQ,r=bQ){const i=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const l={...wQ,width:s.toString(),height:r.toString(),top:i,left:o},c=ss().toLowerCase();t&&(a=DO(c)?SQ:t),NO(c)&&(e=e||_Q,l.scrollbars="yes");const d=Object.entries(l).reduce((f,[m,p])=>`${f}${m}=${p},`,"");if(Bq(c)&&a!=="_self")return IQ(e||"",a),new YR(null);const h=window.open(e||"",a,d);Re(h,n,"popup-blocked");try{h.focus()}catch{}return new YR(h)}function IQ(n,e){const t=document.createElement("a");t.href=n,t.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RQ="__/auth/handler",CQ="emulator/auth/handler",PQ=encodeURIComponent("fac");async function QR(n,e,t,s,r,i){Re(n.config.authDomain,n,"auth-domain-config-required"),Re(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:s,v:_d,eventId:r};if(e instanceof MS){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",cz(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,h]of Object.entries({}))o[d]=h}if(e instanceof cm){const d=e.getScopes().filter(h=>h!=="");d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const l=await n._getAppCheckToken(),c=l?`#${PQ}=${encodeURIComponent(l)}`:"";return`${kQ(n)}?${om(a).slice(1)}${c}`}function kQ({config:n}){return n.emulator?PS(n,CQ):`https://${n.authDomain}/${RQ}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const px="webStorageSupport";class NQ{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=QO,this._completeRedirectFn=nQ,this._overrideRedirectResult=ZY}async _openPopup(e,t,s,r){var o;go((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await QR(e,t,s,jw(),r);return AQ(e,i,OS())}async _openRedirect(e,t,s,r){await this._originValidation(e);const i=await QR(e,t,s,jw(),r);return MY(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:i}=this.eventManagers[t];return r?Promise.resolve(r):(go(i,"If manager is not set, promise should be"),i)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}async initAndGetManager(e){const t=await EQ(e),s=new rQ(e);return t.register("authEvent",r=>(Re(r==null?void 0:r.authEvent,e,"invalid-auth-event"),{status:s.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(px,{type:px},r=>{var o;const i=(o=r==null?void 0:r[0])==null?void 0:o[px];i!==void 0&&t(!!i),xr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=cQ(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return UO()||LO()||NS()}}const LQ=NQ;var XR="@firebase/auth",JR="1.11.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DQ{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(s=>{e((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Re(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MQ(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function OQ(n){Xu(new Jl("auth",(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=s.options;Re(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:VO(n)},c=new qq(s,r,i,l);return rY(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),Xu(new Jl("auth-internal",e=>{const t=_o(e.getProvider("auth").getImmediate());return(s=>new DQ(s))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ca(XR,JR,MQ(n)),Ca(XR,JR,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jQ=5*60,FQ=gO("authIdTokenMaxAge")||jQ;let ZR=null;const UQ=n=>async e=>{const t=e&&await e.getIdTokenResult(),s=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(s&&s>FQ)return;const r=t==null?void 0:t.token;ZR!==r&&(ZR=r,await fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function VQ(n=TO()){const e=IS(n,"auth");if(e.isInitialized())return e.getImmediate();const t=sY(n,{popupRedirectResolver:LQ,persistence:[KY,NY,QO]}),s=gO("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(s,location.origin);if(location.origin===i.origin){const o=UQ(i.toString());IY(t,o,()=>o(t.currentUser)),AY(t,a=>o(a))}}const r=mO("auth");return r&&iY(t,`http://${r}`),t}function $Q(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}Yq({loadJS(n){return new Promise((e,t)=>{const s=document.createElement("script");s.setAttribute("src",n),s.onload=e,s.onerror=r=>{const i=Vr("internal-error");i.customData=r,t(i)},s.type="text/javascript",s.charset="UTF-8",$Q().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});OQ("Browser");var eC=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Pa,rj;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(_,S){function I(){}I.prototype=S.prototype,_.F=S.prototype,_.prototype=new I,_.prototype.constructor=_,_.D=function(R,N,L){for(var M=Array(arguments.length-2),G=2;G<arguments.length;G++)M[G-2]=arguments[G];return S.prototype[N].apply(R,M)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(s,t),s.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(_,S,I){I||(I=0);const R=Array(16);if(typeof S=="string")for(var N=0;N<16;++N)R[N]=S.charCodeAt(I++)|S.charCodeAt(I++)<<8|S.charCodeAt(I++)<<16|S.charCodeAt(I++)<<24;else for(N=0;N<16;++N)R[N]=S[I++]|S[I++]<<8|S[I++]<<16|S[I++]<<24;S=_.g[0],I=_.g[1],N=_.g[2];let L=_.g[3],M;M=S+(L^I&(N^L))+R[0]+3614090360&4294967295,S=I+(M<<7&4294967295|M>>>25),M=L+(N^S&(I^N))+R[1]+3905402710&4294967295,L=S+(M<<12&4294967295|M>>>20),M=N+(I^L&(S^I))+R[2]+606105819&4294967295,N=L+(M<<17&4294967295|M>>>15),M=I+(S^N&(L^S))+R[3]+3250441966&4294967295,I=N+(M<<22&4294967295|M>>>10),M=S+(L^I&(N^L))+R[4]+4118548399&4294967295,S=I+(M<<7&4294967295|M>>>25),M=L+(N^S&(I^N))+R[5]+1200080426&4294967295,L=S+(M<<12&4294967295|M>>>20),M=N+(I^L&(S^I))+R[6]+2821735955&4294967295,N=L+(M<<17&4294967295|M>>>15),M=I+(S^N&(L^S))+R[7]+4249261313&4294967295,I=N+(M<<22&4294967295|M>>>10),M=S+(L^I&(N^L))+R[8]+1770035416&4294967295,S=I+(M<<7&4294967295|M>>>25),M=L+(N^S&(I^N))+R[9]+2336552879&4294967295,L=S+(M<<12&4294967295|M>>>20),M=N+(I^L&(S^I))+R[10]+4294925233&4294967295,N=L+(M<<17&4294967295|M>>>15),M=I+(S^N&(L^S))+R[11]+2304563134&4294967295,I=N+(M<<22&4294967295|M>>>10),M=S+(L^I&(N^L))+R[12]+1804603682&4294967295,S=I+(M<<7&4294967295|M>>>25),M=L+(N^S&(I^N))+R[13]+4254626195&4294967295,L=S+(M<<12&4294967295|M>>>20),M=N+(I^L&(S^I))+R[14]+2792965006&4294967295,N=L+(M<<17&4294967295|M>>>15),M=I+(S^N&(L^S))+R[15]+1236535329&4294967295,I=N+(M<<22&4294967295|M>>>10),M=S+(N^L&(I^N))+R[1]+4129170786&4294967295,S=I+(M<<5&4294967295|M>>>27),M=L+(I^N&(S^I))+R[6]+3225465664&4294967295,L=S+(M<<9&4294967295|M>>>23),M=N+(S^I&(L^S))+R[11]+643717713&4294967295,N=L+(M<<14&4294967295|M>>>18),M=I+(L^S&(N^L))+R[0]+3921069994&4294967295,I=N+(M<<20&4294967295|M>>>12),M=S+(N^L&(I^N))+R[5]+3593408605&4294967295,S=I+(M<<5&4294967295|M>>>27),M=L+(I^N&(S^I))+R[10]+38016083&4294967295,L=S+(M<<9&4294967295|M>>>23),M=N+(S^I&(L^S))+R[15]+3634488961&4294967295,N=L+(M<<14&4294967295|M>>>18),M=I+(L^S&(N^L))+R[4]+3889429448&4294967295,I=N+(M<<20&4294967295|M>>>12),M=S+(N^L&(I^N))+R[9]+568446438&4294967295,S=I+(M<<5&4294967295|M>>>27),M=L+(I^N&(S^I))+R[14]+3275163606&4294967295,L=S+(M<<9&4294967295|M>>>23),M=N+(S^I&(L^S))+R[3]+4107603335&4294967295,N=L+(M<<14&4294967295|M>>>18),M=I+(L^S&(N^L))+R[8]+1163531501&4294967295,I=N+(M<<20&4294967295|M>>>12),M=S+(N^L&(I^N))+R[13]+2850285829&4294967295,S=I+(M<<5&4294967295|M>>>27),M=L+(I^N&(S^I))+R[2]+4243563512&4294967295,L=S+(M<<9&4294967295|M>>>23),M=N+(S^I&(L^S))+R[7]+1735328473&4294967295,N=L+(M<<14&4294967295|M>>>18),M=I+(L^S&(N^L))+R[12]+2368359562&4294967295,I=N+(M<<20&4294967295|M>>>12),M=S+(I^N^L)+R[5]+4294588738&4294967295,S=I+(M<<4&4294967295|M>>>28),M=L+(S^I^N)+R[8]+2272392833&4294967295,L=S+(M<<11&4294967295|M>>>21),M=N+(L^S^I)+R[11]+1839030562&4294967295,N=L+(M<<16&4294967295|M>>>16),M=I+(N^L^S)+R[14]+4259657740&4294967295,I=N+(M<<23&4294967295|M>>>9),M=S+(I^N^L)+R[1]+2763975236&4294967295,S=I+(M<<4&4294967295|M>>>28),M=L+(S^I^N)+R[4]+1272893353&4294967295,L=S+(M<<11&4294967295|M>>>21),M=N+(L^S^I)+R[7]+4139469664&4294967295,N=L+(M<<16&4294967295|M>>>16),M=I+(N^L^S)+R[10]+3200236656&4294967295,I=N+(M<<23&4294967295|M>>>9),M=S+(I^N^L)+R[13]+681279174&4294967295,S=I+(M<<4&4294967295|M>>>28),M=L+(S^I^N)+R[0]+3936430074&4294967295,L=S+(M<<11&4294967295|M>>>21),M=N+(L^S^I)+R[3]+3572445317&4294967295,N=L+(M<<16&4294967295|M>>>16),M=I+(N^L^S)+R[6]+76029189&4294967295,I=N+(M<<23&4294967295|M>>>9),M=S+(I^N^L)+R[9]+3654602809&4294967295,S=I+(M<<4&4294967295|M>>>28),M=L+(S^I^N)+R[12]+3873151461&4294967295,L=S+(M<<11&4294967295|M>>>21),M=N+(L^S^I)+R[15]+530742520&4294967295,N=L+(M<<16&4294967295|M>>>16),M=I+(N^L^S)+R[2]+3299628645&4294967295,I=N+(M<<23&4294967295|M>>>9),M=S+(N^(I|~L))+R[0]+4096336452&4294967295,S=I+(M<<6&4294967295|M>>>26),M=L+(I^(S|~N))+R[7]+1126891415&4294967295,L=S+(M<<10&4294967295|M>>>22),M=N+(S^(L|~I))+R[14]+2878612391&4294967295,N=L+(M<<15&4294967295|M>>>17),M=I+(L^(N|~S))+R[5]+4237533241&4294967295,I=N+(M<<21&4294967295|M>>>11),M=S+(N^(I|~L))+R[12]+1700485571&4294967295,S=I+(M<<6&4294967295|M>>>26),M=L+(I^(S|~N))+R[3]+2399980690&4294967295,L=S+(M<<10&4294967295|M>>>22),M=N+(S^(L|~I))+R[10]+4293915773&4294967295,N=L+(M<<15&4294967295|M>>>17),M=I+(L^(N|~S))+R[1]+2240044497&4294967295,I=N+(M<<21&4294967295|M>>>11),M=S+(N^(I|~L))+R[8]+1873313359&4294967295,S=I+(M<<6&4294967295|M>>>26),M=L+(I^(S|~N))+R[15]+4264355552&4294967295,L=S+(M<<10&4294967295|M>>>22),M=N+(S^(L|~I))+R[6]+2734768916&4294967295,N=L+(M<<15&4294967295|M>>>17),M=I+(L^(N|~S))+R[13]+1309151649&4294967295,I=N+(M<<21&4294967295|M>>>11),M=S+(N^(I|~L))+R[4]+4149444226&4294967295,S=I+(M<<6&4294967295|M>>>26),M=L+(I^(S|~N))+R[11]+3174756917&4294967295,L=S+(M<<10&4294967295|M>>>22),M=N+(S^(L|~I))+R[2]+718787259&4294967295,N=L+(M<<15&4294967295|M>>>17),M=I+(L^(N|~S))+R[9]+3951481745&4294967295,_.g[0]=_.g[0]+S&4294967295,_.g[1]=_.g[1]+(N+(M<<21&4294967295|M>>>11))&4294967295,_.g[2]=_.g[2]+N&4294967295,_.g[3]=_.g[3]+L&4294967295}s.prototype.v=function(_,S){S===void 0&&(S=_.length);const I=S-this.blockSize,R=this.C;let N=this.h,L=0;for(;L<S;){if(N==0)for(;L<=I;)r(this,_,L),L+=this.blockSize;if(typeof _=="string"){for(;L<S;)if(R[N++]=_.charCodeAt(L++),N==this.blockSize){r(this,R),N=0;break}}else for(;L<S;)if(R[N++]=_[L++],N==this.blockSize){r(this,R),N=0;break}}this.h=N,this.o+=S},s.prototype.A=function(){var _=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);_[0]=128;for(var S=1;S<_.length-8;++S)_[S]=0;S=this.o*8;for(var I=_.length-8;I<_.length;++I)_[I]=S&255,S/=256;for(this.v(_),_=Array(16),S=0,I=0;I<4;++I)for(let R=0;R<32;R+=8)_[S++]=this.g[I]>>>R&255;return _};function i(_,S){var I=a;return Object.prototype.hasOwnProperty.call(I,_)?I[_]:I[_]=S(_)}function o(_,S){this.h=S;const I=[];let R=!0;for(let N=_.length-1;N>=0;N--){const L=_[N]|0;R&&L==S||(I[N]=L,R=!1)}this.g=I}var a={};function l(_){return-128<=_&&_<128?i(_,function(S){return new o([S|0],S<0?-1:0)}):new o([_|0],_<0?-1:0)}function c(_){if(isNaN(_)||!isFinite(_))return h;if(_<0)return v(c(-_));const S=[];let I=1;for(let R=0;_>=I;R++)S[R]=_/I|0,I*=4294967296;return new o(S,0)}function d(_,S){if(_.length==0)throw Error("number format error: empty string");if(S=S||10,S<2||36<S)throw Error("radix out of range: "+S);if(_.charAt(0)=="-")return v(d(_.substring(1),S));if(_.indexOf("-")>=0)throw Error('number format error: interior "-" character');const I=c(Math.pow(S,8));let R=h;for(let L=0;L<_.length;L+=8){var N=Math.min(8,_.length-L);const M=parseInt(_.substring(L,L+N),S);N<8?(N=c(Math.pow(S,N)),R=R.j(N).add(c(M))):(R=R.j(I),R=R.add(c(M)))}return R}var h=l(0),f=l(1),m=l(16777216);n=o.prototype,n.m=function(){if(y(this))return-v(this).m();let _=0,S=1;for(let I=0;I<this.g.length;I++){const R=this.i(I);_+=(R>=0?R:4294967296+R)*S,S*=4294967296}return _},n.toString=function(_){if(_=_||10,_<2||36<_)throw Error("radix out of range: "+_);if(p(this))return"0";if(y(this))return"-"+v(this).toString(_);const S=c(Math.pow(_,6));var I=this;let R="";for(;;){const N=b(I,S).g;I=x(I,N.j(S));let L=((I.g.length>0?I.g[0]:I.h)>>>0).toString(_);if(I=N,p(I))return L+R;for(;L.length<6;)L="0"+L;R=L+R}},n.i=function(_){return _<0?0:_<this.g.length?this.g[_]:this.h};function p(_){if(_.h!=0)return!1;for(let S=0;S<_.g.length;S++)if(_.g[S]!=0)return!1;return!0}function y(_){return _.h==-1}n.l=function(_){return _=x(this,_),y(_)?-1:p(_)?0:1};function v(_){const S=_.g.length,I=[];for(let R=0;R<S;R++)I[R]=~_.g[R];return new o(I,~_.h).add(f)}n.abs=function(){return y(this)?v(this):this},n.add=function(_){const S=Math.max(this.g.length,_.g.length),I=[];let R=0;for(let N=0;N<=S;N++){let L=R+(this.i(N)&65535)+(_.i(N)&65535),M=(L>>>16)+(this.i(N)>>>16)+(_.i(N)>>>16);R=M>>>16,L&=65535,M&=65535,I[N]=M<<16|L}return new o(I,I[I.length-1]&-2147483648?-1:0)};function x(_,S){return _.add(v(S))}n.j=function(_){if(p(this)||p(_))return h;if(y(this))return y(_)?v(this).j(v(_)):v(v(this).j(_));if(y(_))return v(this.j(v(_)));if(this.l(m)<0&&_.l(m)<0)return c(this.m()*_.m());const S=this.g.length+_.g.length,I=[];for(var R=0;R<2*S;R++)I[R]=0;for(R=0;R<this.g.length;R++)for(let N=0;N<_.g.length;N++){const L=this.i(R)>>>16,M=this.i(R)&65535,G=_.i(N)>>>16,V=_.i(N)&65535;I[2*R+2*N]+=M*V,E(I,2*R+2*N),I[2*R+2*N+1]+=L*V,E(I,2*R+2*N+1),I[2*R+2*N+1]+=M*G,E(I,2*R+2*N+1),I[2*R+2*N+2]+=L*G,E(I,2*R+2*N+2)}for(_=0;_<S;_++)I[_]=I[2*_+1]<<16|I[2*_];for(_=S;_<2*S;_++)I[_]=0;return new o(I,0)};function E(_,S){for(;(_[S]&65535)!=_[S];)_[S+1]+=_[S]>>>16,_[S]&=65535,S++}function w(_,S){this.g=_,this.h=S}function b(_,S){if(p(S))throw Error("division by zero");if(p(_))return new w(h,h);if(y(_))return S=b(v(_),S),new w(v(S.g),v(S.h));if(y(S))return S=b(_,v(S)),new w(v(S.g),S.h);if(_.g.length>30){if(y(_)||y(S))throw Error("slowDivide_ only works with positive integers.");for(var I=f,R=S;R.l(_)<=0;)I=C(I),R=C(R);var N=D(I,1),L=D(R,1);for(R=D(R,2),I=D(I,2);!p(R);){var M=L.add(R);M.l(_)<=0&&(N=N.add(I),L=M),R=D(R,1),I=D(I,1)}return S=x(_,N.j(S)),new w(N,S)}for(N=h;_.l(S)>=0;){for(I=Math.max(1,Math.floor(_.m()/S.m())),R=Math.ceil(Math.log(I)/Math.LN2),R=R<=48?1:Math.pow(2,R-48),L=c(I),M=L.j(S);y(M)||M.l(_)>0;)I-=R,L=c(I),M=L.j(S);p(L)&&(L=f),N=N.add(L),_=x(_,M)}return new w(N,_)}n.B=function(_){return b(this,_).h},n.and=function(_){const S=Math.max(this.g.length,_.g.length),I=[];for(let R=0;R<S;R++)I[R]=this.i(R)&_.i(R);return new o(I,this.h&_.h)},n.or=function(_){const S=Math.max(this.g.length,_.g.length),I=[];for(let R=0;R<S;R++)I[R]=this.i(R)|_.i(R);return new o(I,this.h|_.h)},n.xor=function(_){const S=Math.max(this.g.length,_.g.length),I=[];for(let R=0;R<S;R++)I[R]=this.i(R)^_.i(R);return new o(I,this.h^_.h)};function C(_){const S=_.g.length+1,I=[];for(let R=0;R<S;R++)I[R]=_.i(R)<<1|_.i(R-1)>>>31;return new o(I,_.h)}function D(_,S){const I=S>>5;S%=32;const R=_.g.length-I,N=[];for(let L=0;L<R;L++)N[L]=S>0?_.i(L+I)>>>S|_.i(L+I+1)<<32-S:_.i(L+I);return new o(N,_.h)}s.prototype.digest=s.prototype.A,s.prototype.reset=s.prototype.u,s.prototype.update=s.prototype.v,rj=s,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=d,Pa=o}).apply(typeof eC<"u"?eC:typeof self<"u"?self:typeof window<"u"?window:{});var up=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ij,Sh,oj,ig,Vw,aj,lj,cj;(function(){var n,e=Object.defineProperty;function t(g){g=[typeof globalThis=="object"&&globalThis,g,typeof window=="object"&&window,typeof self=="object"&&self,typeof up=="object"&&up];for(var A=0;A<g.length;++A){var k=g[A];if(k&&k.Math==Math)return k}throw Error("Cannot find global object")}var s=t(this);function r(g,A){if(A)e:{var k=s;g=g.split(".");for(var O=0;O<g.length-1;O++){var z=g[O];if(!(z in k))break e;k=k[z]}g=g[g.length-1],O=k[g],A=A(O),A!=O&&A!=null&&e(k,g,{configurable:!0,writable:!0,value:A})}}r("Symbol.dispose",function(g){return g||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(g){return g||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(g){return g||function(A){var k=[],O;for(O in A)Object.prototype.hasOwnProperty.call(A,O)&&k.push([O,A[O]]);return k}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var i=i||{},o=this||self;function a(g){var A=typeof g;return A=="object"&&g!=null||A=="function"}function l(g,A,k){return g.call.apply(g.bind,arguments)}function c(g,A,k){return c=l,c.apply(null,arguments)}function d(g,A){var k=Array.prototype.slice.call(arguments,1);return function(){var O=k.slice();return O.push.apply(O,arguments),g.apply(this,O)}}function h(g,A){function k(){}k.prototype=A.prototype,g.Z=A.prototype,g.prototype=new k,g.prototype.constructor=g,g.Ob=function(O,z,Q){for(var oe=Array(arguments.length-2),Ke=2;Ke<arguments.length;Ke++)oe[Ke-2]=arguments[Ke];return A.prototype[z].apply(O,oe)}}var f=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?g=>g&&AsyncContext.Snapshot.wrap(g):g=>g;function m(g){const A=g.length;if(A>0){const k=Array(A);for(let O=0;O<A;O++)k[O]=g[O];return k}return[]}function p(g,A){for(let O=1;O<arguments.length;O++){const z=arguments[O];var k=typeof z;if(k=k!="object"?k:z?Array.isArray(z)?"array":k:"null",k=="array"||k=="object"&&typeof z.length=="number"){k=g.length||0;const Q=z.length||0;g.length=k+Q;for(let oe=0;oe<Q;oe++)g[k+oe]=z[oe]}else g.push(z)}}class y{constructor(A,k){this.i=A,this.j=k,this.h=0,this.g=null}get(){let A;return this.h>0?(this.h--,A=this.g,this.g=A.next,A.next=null):A=this.i(),A}}function v(g){o.setTimeout(()=>{throw g},0)}function x(){var g=_;let A=null;return g.g&&(A=g.g,g.g=g.g.next,g.g||(g.h=null),A.next=null),A}class E{constructor(){this.h=this.g=null}add(A,k){const O=w.get();O.set(A,k),this.h?this.h.next=O:this.g=O,this.h=O}}var w=new y(()=>new b,g=>g.reset());class b{constructor(){this.next=this.g=this.h=null}set(A,k){this.h=A,this.g=k,this.next=null}reset(){this.next=this.g=this.h=null}}let C,D=!1,_=new E,S=()=>{const g=Promise.resolve(void 0);C=()=>{g.then(I)}};function I(){for(var g;g=x();){try{g.h.call(g.g)}catch(k){v(k)}var A=w;A.j(g),A.h<100&&(A.h++,g.next=A.g,A.g=g)}D=!1}function R(){this.u=this.u,this.C=this.C}R.prototype.u=!1,R.prototype.dispose=function(){this.u||(this.u=!0,this.N())},R.prototype[Symbol.dispose]=function(){this.dispose()},R.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function N(g,A){this.type=g,this.g=this.target=A,this.defaultPrevented=!1}N.prototype.h=function(){this.defaultPrevented=!0};var L=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var g=!1,A=Object.defineProperty({},"passive",{get:function(){g=!0}});try{const k=()=>{};o.addEventListener("test",k,A),o.removeEventListener("test",k,A)}catch{}return g}();function M(g){return/^[\s\xa0]*$/.test(g)}function G(g,A){N.call(this,g?g.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,g&&this.init(g,A)}h(G,N),G.prototype.init=function(g,A){const k=this.type=g.type,O=g.changedTouches&&g.changedTouches.length?g.changedTouches[0]:null;this.target=g.target||g.srcElement,this.g=A,A=g.relatedTarget,A||(k=="mouseover"?A=g.fromElement:k=="mouseout"&&(A=g.toElement)),this.relatedTarget=A,O?(this.clientX=O.clientX!==void 0?O.clientX:O.pageX,this.clientY=O.clientY!==void 0?O.clientY:O.pageY,this.screenX=O.screenX||0,this.screenY=O.screenY||0):(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0),this.button=g.button,this.key=g.key||"",this.ctrlKey=g.ctrlKey,this.altKey=g.altKey,this.shiftKey=g.shiftKey,this.metaKey=g.metaKey,this.pointerId=g.pointerId||0,this.pointerType=g.pointerType,this.state=g.state,this.i=g,g.defaultPrevented&&G.Z.h.call(this)},G.prototype.h=function(){G.Z.h.call(this);const g=this.i;g.preventDefault?g.preventDefault():g.returnValue=!1};var V="closure_listenable_"+(Math.random()*1e6|0),$=0;function F(g,A,k,O,z){this.listener=g,this.proxy=null,this.src=A,this.type=k,this.capture=!!O,this.ha=z,this.key=++$,this.da=this.fa=!1}function j(g){g.da=!0,g.listener=null,g.proxy=null,g.src=null,g.ha=null}function U(g,A,k){for(const O in g)A.call(k,g[O],O,g)}function X(g,A){for(const k in g)A.call(void 0,g[k],k,g)}function Y(g){const A={};for(const k in g)A[k]=g[k];return A}const J="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ae(g,A){let k,O;for(let z=1;z<arguments.length;z++){O=arguments[z];for(k in O)g[k]=O[k];for(let Q=0;Q<J.length;Q++)k=J[Q],Object.prototype.hasOwnProperty.call(O,k)&&(g[k]=O[k])}}function he(g){this.src=g,this.g={},this.h=0}he.prototype.add=function(g,A,k,O,z){const Q=g.toString();g=this.g[Q],g||(g=this.g[Q]=[],this.h++);const oe=ge(g,A,O,z);return oe>-1?(A=g[oe],k||(A.fa=!1)):(A=new F(A,this.src,Q,!!O,z),A.fa=k,g.push(A)),A};function ve(g,A){const k=A.type;if(k in g.g){var O=g.g[k],z=Array.prototype.indexOf.call(O,A,void 0),Q;(Q=z>=0)&&Array.prototype.splice.call(O,z,1),Q&&(j(A),g.g[k].length==0&&(delete g.g[k],g.h--))}}function ge(g,A,k,O){for(let z=0;z<g.length;++z){const Q=g[z];if(!Q.da&&Q.listener==A&&Q.capture==!!k&&Q.ha==O)return z}return-1}var re="closure_lm_"+(Math.random()*1e6|0),Ee={};function xe(g,A,k,O,z){if(Array.isArray(A)){for(let Q=0;Q<A.length;Q++)xe(g,A[Q],k,O,z);return null}return k=Gt(k),g&&g[V]?g.J(A,k,a(O)?!!O.capture:!!O,z):Ne(g,A,k,!1,O,z)}function Ne(g,A,k,O,z,Q){if(!A)throw Error("Invalid event type");const oe=a(z)?!!z.capture:!!z;let Ke=De(g);if(Ke||(g[re]=Ke=new he(g)),k=Ke.add(A,k,O,oe,Q),k.proxy)return k;if(O=Le(),k.proxy=O,O.src=g,O.listener=k,g.addEventListener)L||(z=oe),z===void 0&&(z=!1),g.addEventListener(A.toString(),O,z);else if(g.attachEvent)g.attachEvent(Jt(A.toString()),O);else if(g.addListener&&g.removeListener)g.addListener(O);else throw Error("addEventListener and attachEvent are unavailable.");return k}function Le(){function g(k){return A.call(g.src,g.listener,k)}const A=ys;return g}function qe(g,A,k,O,z){if(Array.isArray(A))for(var Q=0;Q<A.length;Q++)qe(g,A[Q],k,O,z);else O=a(O)?!!O.capture:!!O,k=Gt(k),g&&g[V]?(g=g.i,Q=String(A).toString(),Q in g.g&&(A=g.g[Q],k=ge(A,k,O,z),k>-1&&(j(A[k]),Array.prototype.splice.call(A,k,1),A.length==0&&(delete g.g[Q],g.h--)))):g&&(g=De(g))&&(A=g.g[A.toString()],g=-1,A&&(g=ge(A,k,O,z)),(k=g>-1?A[g]:null)&&gt(k))}function gt(g){if(typeof g!="number"&&g&&!g.da){var A=g.src;if(A&&A[V])ve(A.i,g);else{var k=g.type,O=g.proxy;A.removeEventListener?A.removeEventListener(k,O,g.capture):A.detachEvent?A.detachEvent(Jt(k),O):A.addListener&&A.removeListener&&A.removeListener(O),(k=De(A))?(ve(k,g),k.h==0&&(k.src=null,A[re]=null)):j(g)}}}function Jt(g){return g in Ee?Ee[g]:Ee[g]="on"+g}function ys(g,A){if(g.da)g=!0;else{A=new G(A,this);const k=g.listener,O=g.ha||g.src;g.fa&&gt(g),g=k.call(O,A)}return g}function De(g){return g=g[re],g instanceof he?g:null}var ct="__closure_events_fn_"+(Math.random()*1e9>>>0);function Gt(g){return typeof g=="function"?g:(g[ct]||(g[ct]=function(A){return g.handleEvent(A)}),g[ct])}function rt(){R.call(this),this.i=new he(this),this.M=this,this.G=null}h(rt,R),rt.prototype[V]=!0,rt.prototype.removeEventListener=function(g,A,k,O){qe(this,g,A,k,O)};function at(g,A){var k,O=g.G;if(O)for(k=[];O;O=O.G)k.push(O);if(g=g.M,O=A.type||A,typeof A=="string")A=new N(A,g);else if(A instanceof N)A.target=A.target||g;else{var z=A;A=new N(O,g),ae(A,z)}z=!0;let Q,oe;if(k)for(oe=k.length-1;oe>=0;oe--)Q=A.g=k[oe],z=Kn(Q,O,!0,A)&&z;if(Q=A.g=g,z=Kn(Q,O,!0,A)&&z,z=Kn(Q,O,!1,A)&&z,k)for(oe=0;oe<k.length;oe++)Q=A.g=k[oe],z=Kn(Q,O,!1,A)&&z}rt.prototype.N=function(){if(rt.Z.N.call(this),this.i){var g=this.i;for(const A in g.g){const k=g.g[A];for(let O=0;O<k.length;O++)j(k[O]);delete g.g[A],g.h--}}this.G=null},rt.prototype.J=function(g,A,k,O){return this.i.add(String(g),A,!1,k,O)},rt.prototype.K=function(g,A,k,O){return this.i.add(String(g),A,!0,k,O)};function Kn(g,A,k,O){if(A=g.i.g[String(A)],!A)return!0;A=A.concat();let z=!0;for(let Q=0;Q<A.length;++Q){const oe=A[Q];if(oe&&!oe.da&&oe.capture==k){const Ke=oe.listener,gn=oe.ha||oe.src;oe.fa&&ve(g.i,oe),z=Ke.call(gn,O)!==!1&&z}}return z&&!O.defaultPrevented}function vs(g,A){if(typeof g!="function")if(g&&typeof g.handleEvent=="function")g=c(g.handleEvent,g);else throw Error("Invalid listener argument");return Number(A)>2147483647?-1:o.setTimeout(g,A||0)}function br(g){g.g=vs(()=>{g.g=null,g.i&&(g.i=!1,br(g))},g.l);const A=g.h;g.h=null,g.m.apply(null,A)}class on extends R{constructor(A,k){super(),this.m=A,this.l=k,this.h=null,this.i=!1,this.g=null}j(A){this.h=arguments,this.g?this.i=!0:br(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function an(g){R.call(this),this.h=g,this.g={}}h(an,R);var q=[];function Pe(g){U(g.g,function(A,k){this.g.hasOwnProperty(k)&&gt(A)},g),g.g={}}an.prototype.N=function(){an.Z.N.call(this),Pe(this)},an.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Xe=o.JSON.stringify,$e=o.JSON.parse,Os=class{stringify(g){return o.JSON.stringify(g,void 0)}parse(g){return o.JSON.parse(g,void 0)}};function rs(){}function Co(){}var pn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Ni(){N.call(this,"d")}h(Ni,N);function Od(){N.call(this,"c")}h(Od,N);var Li={},Sm=null;function Po(){return Sm=Sm||new rt}Li.Ia="serverreachability";function _m(g){N.call(this,Li.Ia,g)}h(_m,N);function il(g){const A=Po();at(A,new _m(A))}Li.STAT_EVENT="statevent";function jd(g,A){N.call(this,Li.STAT_EVENT,g),this.stat=A}h(jd,N);function Cn(g){const A=Po();at(A,new jd(A,g))}Li.Ja="timingevent";function Am(g,A){N.call(this,Li.Ja,g),this.size=A}h(Am,N);function ol(g,A){if(typeof g!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){g()},A)}function al(){this.g=!0}al.prototype.ua=function(){this.g=!1};function Fd(g,A,k,O,z,Q){g.info(function(){if(g.g)if(Q){var oe="",Ke=Q.split("&");for(let Tt=0;Tt<Ke.length;Tt++){var gn=Ke[Tt].split("=");if(gn.length>1){const Sn=gn[0];gn=gn[1];const qr=Sn.split("_");oe=qr.length>=2&&qr[1]=="type"?oe+(Sn+"="+gn+"&"):oe+(Sn+"=redacted&")}}}else oe=null;else oe=Q;return"XMLHTTP REQ ("+O+") [attempt "+z+"]: "+A+`
`+k+`
`+oe})}function Ev(g,A,k,O,z,Q,oe){g.info(function(){return"XMLHTTP RESP ("+O+") [ attempt "+z+"]: "+A+`
`+k+`
`+Q+" "+oe})}function ko(g,A,k,O){g.info(function(){return"XMLHTTP TEXT ("+A+"): "+Rm(g,k)+(O?" "+O:"")})}function Im(g,A){g.info(function(){return"TIMEOUT: "+A})}al.prototype.info=function(){};function Rm(g,A){if(!g.g)return A;if(!A)return null;try{const Q=JSON.parse(A);if(Q){for(g=0;g<Q.length;g++)if(Array.isArray(Q[g])){var k=Q[g];if(!(k.length<2)){var O=k[1];if(Array.isArray(O)&&!(O.length<1)){var z=O[0];if(z!="noop"&&z!="stop"&&z!="close")for(let oe=1;oe<O.length;oe++)O[oe]=""}}}}return Xe(Q)}catch{return A}}var ll={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ud={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Vd;function Ec(){}h(Ec,rs),Ec.prototype.g=function(){return new XMLHttpRequest},Vd=new Ec;function No(g){return encodeURIComponent(String(g))}function Cm(g){var A=1;g=g.split(":");const k=[];for(;A>0&&g.length;)k.push(g.shift()),A--;return g.length&&k.push(g.join(":")),k}function Sr(g,A,k,O){this.j=g,this.i=A,this.l=k,this.S=O||1,this.V=new an(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new $d}function $d(){this.i=null,this.g="",this.h=!1}var Bd={},wc={};function Tc(g,A,k){g.M=1,g.A=K(js(A)),g.u=k,g.R=!0,Gd(g,null)}function Gd(g,A){g.F=Date.now(),cl(g),g.B=js(g.A);var k=g.B,O=g.S;Array.isArray(O)||(O=[String(O)]),Di(k.i,"t",O),g.C=0,k=g.j.L,g.h=new $d,g.g=_A(g.j,k?A:null,!g.u),g.P>0&&(g.O=new on(c(g.Y,g,g.g),g.P)),A=g.V,k=g.g,O=g.ba;var z="readystatechange";Array.isArray(z)||(z&&(q[0]=z.toString()),z=q);for(let Q=0;Q<z.length;Q++){const oe=xe(k,z[Q],O||A.handleEvent,!1,A.h||A);if(!oe)break;A.g[oe.key]=oe}A=g.J?Y(g.J):{},g.u?(g.v||(g.v="POST"),A["Content-Type"]="application/x-www-form-urlencoded",g.g.ea(g.B,g.v,g.u,A)):(g.v="GET",g.g.ea(g.B,g.v,null,A)),il(),Fd(g.i,g.v,g.B,g.l,g.S,g.u)}Sr.prototype.ba=function(g){g=g.target;const A=this.O;A&&Uo(g)==3?A.j():this.Y(g)},Sr.prototype.Y=function(g){try{if(g==this.g)e:{const Ke=Uo(this.g),gn=this.g.ya(),Tt=this.g.ca();if(!(Ke<3)&&(Ke!=3||this.g&&(this.h.h||this.g.la()||mA(this.g)))){this.K||Ke!=4||gn==7||(gn==8||Tt<=0?il(3):il(2)),bc(this);var A=this.g.ca();this.X=A;var k=Pm(this);if(this.o=A==200,Ev(this.i,this.v,this.B,this.l,this.S,Ke,A),this.o){if(this.U&&!this.L){t:{if(this.g){var O,z=this.g;if((O=z.g?z.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!M(O)){var Q=O;break t}}Q=null}if(g=Q)ko(this.i,this.l,g,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Sc(this,g);else{this.o=!1,this.m=3,Cn(12),zr(this),Lo(this);break e}}if(this.R){g=!0;let Sn;for(;!this.K&&this.C<k.length;)if(Sn=km(this,k),Sn==wc){Ke==4&&(this.m=4,Cn(14),g=!1),ko(this.i,this.l,null,"[Incomplete Response]");break}else if(Sn==Bd){this.m=4,Cn(15),ko(this.i,this.l,k,"[Invalid Chunk]"),g=!1;break}else ko(this.i,this.l,Sn,null),Sc(this,Sn);if(Kd(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ke!=4||k.length!=0||this.h.h||(this.m=1,Cn(16),g=!1),this.o=this.o&&g,!g)ko(this.i,this.l,k,"[Invalid Chunked Response]"),zr(this),Lo(this);else if(k.length>0&&!this.W){this.W=!0;var oe=this.j;oe.g==this&&oe.aa&&!oe.P&&(oe.j.info("Great, no buffering proxy detected. Bytes received: "+k.length),_v(oe),oe.P=!0,Cn(11))}}else ko(this.i,this.l,k,null),Sc(this,k);Ke==4&&zr(this),this.o&&!this.K&&(Ke==4?wA(this.j,this):(this.o=!1,cl(this)))}else u6(this.g),A==400&&k.indexOf("Unknown SID")>0?(this.m=3,Cn(12)):(this.m=0,Cn(13)),zr(this),Lo(this)}}}catch{}finally{}};function Pm(g){if(!Kd(g))return g.g.la();const A=mA(g.g);if(A==="")return"";let k="";const O=A.length,z=Uo(g.g)==4;if(!g.h.i){if(typeof TextDecoder>"u")return zr(g),Lo(g),"";g.h.i=new o.TextDecoder}for(let Q=0;Q<O;Q++)g.h.h=!0,k+=g.h.i.decode(A[Q],{stream:!(z&&Q==O-1)});return A.length=0,g.h.g+=k,g.C=0,g.h.g}function Kd(g){return g.g?g.v=="GET"&&g.M!=2&&g.j.Aa:!1}function km(g,A){var k=g.C,O=A.indexOf(`
`,k);return O==-1?wc:(k=Number(A.substring(k,O)),isNaN(k)?Bd:(O+=1,O+k>A.length?wc:(A=A.slice(O,O+k),g.C=O+k,A)))}Sr.prototype.cancel=function(){this.K=!0,zr(this)};function cl(g){g.T=Date.now()+g.H,Hd(g,g.H)}function Hd(g,A){if(g.D!=null)throw Error("WatchDog timer not null");g.D=ol(c(g.aa,g),A)}function bc(g){g.D&&(o.clearTimeout(g.D),g.D=null)}Sr.prototype.aa=function(){this.D=null;const g=Date.now();g-this.T>=0?(Im(this.i,this.B),this.M!=2&&(il(),Cn(17)),zr(this),this.m=2,Lo(this)):Hd(this,this.T-g)};function Lo(g){g.j.I==0||g.K||wA(g.j,g)}function zr(g){bc(g);var A=g.O;A&&typeof A.dispose=="function"&&A.dispose(),g.O=null,Pe(g.V),g.g&&(A=g.g,g.g=null,A.abort(),A.dispose())}function Sc(g,A){try{var k=g.j;if(k.I!=0&&(k.g==g||_c(k.h,g))){if(!g.L&&_c(k.h,g)&&k.I==3){try{var O=k.Ba.g.parse(A)}catch{O=null}if(Array.isArray(O)&&O.length==3){var z=O;if(z[0]==0){e:if(!k.v){if(k.g)if(k.g.F+3e3<g.F)Fm(k),Om(k);else break e;Sv(k),Cn(18)}}else k.xa=z[1],0<k.xa-k.K&&z[2]<37500&&k.F&&k.A==0&&!k.C&&(k.C=ol(c(k.Va,k),6e3));qd(k.h)<=1&&k.ta&&(k.ta=void 0)}else dl(k,11)}else if((g.L||k.g==g)&&Fm(k),!M(A))for(z=k.Ba.g.parse(A),A=0;A<z.length;A++){let Tt=z[A];const Sn=Tt[0];if(!(Sn<=k.K))if(k.K=Sn,Tt=Tt[1],k.I==2)if(Tt[0]=="c"){k.M=Tt[1],k.ba=Tt[2];const qr=Tt[3];qr!=null&&(k.ka=qr,k.j.info("VER="+k.ka));const hl=Tt[4];hl!=null&&(k.za=hl,k.j.info("SVER="+k.za));const Vo=Tt[5];Vo!=null&&typeof Vo=="number"&&Vo>0&&(O=1.5*Vo,k.O=O,k.j.info("backChannelRequestTimeoutMs_="+O)),O=k;const $o=g.g;if($o){const Vm=$o.g?$o.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Vm){var Q=O.h;Q.g||Vm.indexOf("spdy")==-1&&Vm.indexOf("quic")==-1&&Vm.indexOf("h2")==-1||(Q.j=Q.l,Q.g=new Set,Q.h&&(Ac(Q,Q.h),Q.h=null))}if(O.G){const Av=$o.g?$o.g.getResponseHeader("X-HTTP-Session-Id"):null;Av&&(O.wa=Av,yt(O.J,O.G,Av))}}k.I=3,k.l&&k.l.ra(),k.aa&&(k.T=Date.now()-g.F,k.j.info("Handshake RTT: "+k.T+"ms")),O=k;var oe=g;if(O.na=SA(O,O.L?O.ba:null,O.W),oe.L){Yd(O.h,oe);var Ke=oe,gn=O.O;gn&&(Ke.H=gn),Ke.D&&(bc(Ke),cl(Ke)),O.g=oe}else xA(O);k.i.length>0&&jm(k)}else Tt[0]!="stop"&&Tt[0]!="close"||dl(k,7);else k.I==3&&(Tt[0]=="stop"||Tt[0]=="close"?Tt[0]=="stop"?dl(k,7):bv(k):Tt[0]!="noop"&&k.l&&k.l.qa(Tt),k.A=0)}}il(4)}catch{}}var Nm=class{constructor(g,A){this.g=g,this.map=A}};function Wd(g){this.l=g||10,o.PerformanceNavigationTiming?(g=o.performance.getEntriesByType("navigation"),g=g.length>0&&(g[0].nextHopProtocol=="hq"||g[0].nextHopProtocol=="h2")):g=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=g?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function zd(g){return g.h?!0:g.g?g.g.size>=g.j:!1}function qd(g){return g.h?1:g.g?g.g.size:0}function _c(g,A){return g.h?g.h==A:g.g?g.g.has(A):!1}function Ac(g,A){g.g?g.g.add(A):g.h=A}function Yd(g,A){g.h&&g.h==A?g.h=null:g.g&&g.g.has(A)&&g.g.delete(A)}Wd.prototype.cancel=function(){if(this.i=Qd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const g of this.g.values())g.cancel();this.g.clear()}};function Qd(g){if(g.h!=null)return g.i.concat(g.h.G);if(g.g!=null&&g.g.size!==0){let A=g.i;for(const k of g.g.values())A=A.concat(k.G);return A}return m(g.i)}var Xd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Lm(g,A){if(g){g=g.split("&");for(let k=0;k<g.length;k++){const O=g[k].indexOf("=");let z,Q=null;O>=0?(z=g[k].substring(0,O),Q=g[k].substring(O+1)):z=g[k],A(z,Q?decodeURIComponent(Q.replace(/\+/g," ")):"")}}}function _r(g){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let A;g instanceof _r?(this.l=g.l,Do(this,g.j),this.o=g.o,this.g=g.g,Mo(this,g.u),this.h=g.h,Ic(this,Jd(g.i)),this.m=g.m):g&&(A=String(g).match(Xd))?(this.l=!1,Do(this,A[1]||"",!0),this.o=we(A[2]||""),this.g=we(A[3]||"",!0),Mo(this,A[4]),this.h=we(A[5]||"",!0),Ic(this,A[6]||"",!0),this.m=we(A[7]||"")):(this.l=!1,this.i=new Dt(null,this.l))}_r.prototype.toString=function(){const g=[];var A=this.j;A&&g.push(je(A,wt,!0),":");var k=this.g;return(k||A=="file")&&(g.push("//"),(A=this.o)&&g.push(je(A,wt,!0),"@"),g.push(No(k).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),k=this.u,k!=null&&g.push(":",String(k))),(k=this.h)&&(this.g&&k.charAt(0)!="/"&&g.push("/"),g.push(je(k,k.charAt(0)=="/"?Be:Pn,!0))),(k=this.i.toString())&&g.push("?",k),(k=this.m)&&g.push("#",je(k,Zt)),g.join("")},_r.prototype.resolve=function(g){const A=js(this);let k=!!g.j;k?Do(A,g.j):k=!!g.o,k?A.o=g.o:k=!!g.g,k?A.g=g.g:k=g.u!=null;var O=g.h;if(k)Mo(A,g.u);else if(k=!!g.h){if(O.charAt(0)!="/")if(this.g&&!this.h)O="/"+O;else{var z=A.h.lastIndexOf("/");z!=-1&&(O=A.h.slice(0,z+1)+O)}if(z=O,z==".."||z==".")O="";else if(z.indexOf("./")!=-1||z.indexOf("/.")!=-1){O=z.lastIndexOf("/",0)==0,z=z.split("/");const Q=[];for(let oe=0;oe<z.length;){const Ke=z[oe++];Ke=="."?O&&oe==z.length&&Q.push(""):Ke==".."?((Q.length>1||Q.length==1&&Q[0]!="")&&Q.pop(),O&&oe==z.length&&Q.push("")):(Q.push(Ke),O=!0)}O=Q.join("/")}else O=z}return k?A.h=O:k=g.i.toString()!=="",k?Ic(A,Jd(g.i)):k=!!g.m,k&&(A.m=g.m),A};function js(g){return new _r(g)}function Do(g,A,k){g.j=k?we(A,!0):A,g.j&&(g.j=g.j.replace(/:$/,""))}function Mo(g,A){if(A){if(A=Number(A),isNaN(A)||A<0)throw Error("Bad port number "+A);g.u=A}else g.u=null}function Ic(g,A,k){A instanceof Dt?(g.i=A,r6(g.i,g.l)):(k||(A=je(A,tt)),g.i=new Dt(A,g.l))}function yt(g,A,k){g.i.set(A,k)}function K(g){return yt(g,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),g}function we(g,A){return g?A?decodeURI(g.replace(/%25/g,"%2525")):decodeURIComponent(g):""}function je(g,A,k){return typeof g=="string"?(g=encodeURI(g).replace(A,Ye),k&&(g=g.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g):null}function Ye(g){return g=g.charCodeAt(0),"%"+(g>>4&15).toString(16)+(g&15).toString(16)}var wt=/[#\/\?@]/g,Pn=/[#\?:]/g,Be=/[#\?]/g,tt=/[#\?@]/g,Zt=/#/g;function Dt(g,A){this.h=this.g=null,this.i=g||null,this.j=!!A}function Kt(g){g.g||(g.g=new Map,g.h=0,g.i&&Lm(g.i,function(A,k){g.add(decodeURIComponent(A.replace(/\+/g," ")),k)}))}n=Dt.prototype,n.add=function(g,A){Kt(this),this.i=null,g=Mi(this,g);let k=this.g.get(g);return k||this.g.set(g,k=[]),k.push(A),this.h+=1,this};function ul(g,A){Kt(g),A=Mi(g,A),g.g.has(A)&&(g.i=null,g.h-=g.g.get(A).length,g.g.delete(A))}function Oo(g,A){return Kt(g),A=Mi(g,A),g.g.has(A)}n.forEach=function(g,A){Kt(this),this.g.forEach(function(k,O){k.forEach(function(z){g.call(A,z,O,this)},this)},this)};function jo(g,A){Kt(g);let k=[];if(typeof A=="string")Oo(g,A)&&(k=k.concat(g.g.get(Mi(g,A))));else for(g=Array.from(g.g.values()),A=0;A<g.length;A++)k=k.concat(g[A]);return k}n.set=function(g,A){return Kt(this),this.i=null,g=Mi(this,g),Oo(this,g)&&(this.h-=this.g.get(g).length),this.g.set(g,[A]),this.h+=1,this},n.get=function(g,A){return g?(g=jo(this,g),g.length>0?String(g[0]):A):A};function Di(g,A,k){ul(g,A),k.length>0&&(g.i=null,g.g.set(Mi(g,A),m(k)),g.h+=k.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const g=[],A=Array.from(this.g.keys());for(let O=0;O<A.length;O++){var k=A[O];const z=No(k);k=jo(this,k);for(let Q=0;Q<k.length;Q++){let oe=z;k[Q]!==""&&(oe+="="+No(k[Q])),g.push(oe)}}return this.i=g.join("&")};function Jd(g){const A=new Dt;return A.i=g.i,g.g&&(A.g=new Map(g.g),A.h=g.h),A}function Mi(g,A){return A=String(A),g.j&&(A=A.toLowerCase()),A}function r6(g,A){A&&!g.j&&(Kt(g),g.i=null,g.g.forEach(function(k,O){const z=O.toLowerCase();O!=z&&(ul(this,O),Di(this,z,k))},g)),g.j=A}function i6(g,A){const k=new al;if(o.Image){const O=new Image;O.onload=d(Fo,k,"TestLoadImage: loaded",!0,A,O),O.onerror=d(Fo,k,"TestLoadImage: error",!1,A,O),O.onabort=d(Fo,k,"TestLoadImage: abort",!1,A,O),O.ontimeout=d(Fo,k,"TestLoadImage: timeout",!1,A,O),o.setTimeout(function(){O.ontimeout&&O.ontimeout()},1e4),O.src=g}else A(!1)}function o6(g,A){const k=new al,O=new AbortController,z=setTimeout(()=>{O.abort(),Fo(k,"TestPingServer: timeout",!1,A)},1e4);fetch(g,{signal:O.signal}).then(Q=>{clearTimeout(z),Q.ok?Fo(k,"TestPingServer: ok",!0,A):Fo(k,"TestPingServer: server error",!1,A)}).catch(()=>{clearTimeout(z),Fo(k,"TestPingServer: error",!1,A)})}function Fo(g,A,k,O,z){try{z&&(z.onload=null,z.onerror=null,z.onabort=null,z.ontimeout=null),O(k)}catch{}}function a6(){this.g=new Os}function wv(g){this.i=g.Sb||null,this.h=g.ab||!1}h(wv,rs),wv.prototype.g=function(){return new Dm(this.i,this.h)};function Dm(g,A){rt.call(this),this.H=g,this.o=A,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}h(Dm,rt),n=Dm.prototype,n.open=function(g,A){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=g,this.D=A,this.readyState=1,eh(this)},n.send=function(g){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const A={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};g&&(A.body=g),(this.H||o).fetch(new Request(this.D,A)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Zd(this)),this.readyState=0},n.Pa=function(g){if(this.g&&(this.l=g,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=g.headers,this.readyState=2,eh(this)),this.g&&(this.readyState=3,eh(this),this.g)))if(this.responseType==="arraybuffer")g.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in g){if(this.j=g.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;cA(this)}else g.text().then(this.Oa.bind(this),this.ga.bind(this))};function cA(g){g.j.read().then(g.Ma.bind(g)).catch(g.ga.bind(g))}n.Ma=function(g){if(this.g){if(this.o&&g.value)this.response.push(g.value);else if(!this.o){var A=g.value?g.value:new Uint8Array(0);(A=this.B.decode(A,{stream:!g.done}))&&(this.response=this.responseText+=A)}g.done?Zd(this):eh(this),this.readyState==3&&cA(this)}},n.Oa=function(g){this.g&&(this.response=this.responseText=g,Zd(this))},n.Na=function(g){this.g&&(this.response=g,Zd(this))},n.ga=function(){this.g&&Zd(this)};function Zd(g){g.readyState=4,g.l=null,g.j=null,g.B=null,eh(g)}n.setRequestHeader=function(g,A){this.A.append(g,A)},n.getResponseHeader=function(g){return this.h&&this.h.get(g.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const g=[],A=this.h.entries();for(var k=A.next();!k.done;)k=k.value,g.push(k[0]+": "+k[1]),k=A.next();return g.join(`\r
`)};function eh(g){g.onreadystatechange&&g.onreadystatechange.call(g)}Object.defineProperty(Dm.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(g){this.m=g?"include":"same-origin"}});function uA(g){let A="";return U(g,function(k,O){A+=O,A+=":",A+=k,A+=`\r
`}),A}function Tv(g,A,k){e:{for(O in k){var O=!1;break e}O=!0}O||(k=uA(k),typeof g=="string"?k!=null&&No(k):yt(g,A,k))}function Ht(g){rt.call(this),this.headers=new Map,this.L=g||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}h(Ht,rt);var l6=/^https?$/i,c6=["POST","PUT"];n=Ht.prototype,n.Fa=function(g){this.H=g},n.ea=function(g,A,k,O){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+g);A=A?A.toUpperCase():"GET",this.D=g,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Vd.g(),this.g.onreadystatechange=f(c(this.Ca,this));try{this.B=!0,this.g.open(A,String(g),!0),this.B=!1}catch(Q){dA(this,Q);return}if(g=k||"",k=new Map(this.headers),O)if(Object.getPrototypeOf(O)===Object.prototype)for(var z in O)k.set(z,O[z]);else if(typeof O.keys=="function"&&typeof O.get=="function")for(const Q of O.keys())k.set(Q,O.get(Q));else throw Error("Unknown input type for opt_headers: "+String(O));O=Array.from(k.keys()).find(Q=>Q.toLowerCase()=="content-type"),z=o.FormData&&g instanceof o.FormData,!(Array.prototype.indexOf.call(c6,A,void 0)>=0)||O||z||k.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Q,oe]of k)this.g.setRequestHeader(Q,oe);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(g),this.v=!1}catch(Q){dA(this,Q)}};function dA(g,A){g.h=!1,g.g&&(g.j=!0,g.g.abort(),g.j=!1),g.l=A,g.o=5,hA(g),Mm(g)}function hA(g){g.A||(g.A=!0,at(g,"complete"),at(g,"error"))}n.abort=function(g){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=g||7,at(this,"complete"),at(this,"abort"),Mm(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Mm(this,!0)),Ht.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?fA(this):this.Xa())},n.Xa=function(){fA(this)};function fA(g){if(g.h&&typeof i<"u"){if(g.v&&Uo(g)==4)setTimeout(g.Ca.bind(g),0);else if(at(g,"readystatechange"),Uo(g)==4){g.h=!1;try{const Q=g.ca();e:switch(Q){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var A=!0;break e;default:A=!1}var k;if(!(k=A)){var O;if(O=Q===0){let oe=String(g.D).match(Xd)[1]||null;!oe&&o.self&&o.self.location&&(oe=o.self.location.protocol.slice(0,-1)),O=!l6.test(oe?oe.toLowerCase():"")}k=O}if(k)at(g,"complete"),at(g,"success");else{g.o=6;try{var z=Uo(g)>2?g.g.statusText:""}catch{z=""}g.l=z+" ["+g.ca()+"]",hA(g)}}finally{Mm(g)}}}}function Mm(g,A){if(g.g){g.m&&(clearTimeout(g.m),g.m=null);const k=g.g;g.g=null,A||at(g,"ready");try{k.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Uo(g){return g.g?g.g.readyState:0}n.ca=function(){try{return Uo(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(g){if(this.g){var A=this.g.responseText;return g&&A.indexOf(g)==0&&(A=A.substring(g.length)),$e(A)}};function mA(g){try{if(!g.g)return null;if("response"in g.g)return g.g.response;switch(g.F){case"":case"text":return g.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in g.g)return g.g.mozResponseArrayBuffer}return null}catch{return null}}function u6(g){const A={};g=(g.g&&Uo(g)>=2&&g.g.getAllResponseHeaders()||"").split(`\r
`);for(let O=0;O<g.length;O++){if(M(g[O]))continue;var k=Cm(g[O]);const z=k[0];if(k=k[1],typeof k!="string")continue;k=k.trim();const Q=A[z]||[];A[z]=Q,Q.push(k)}X(A,function(O){return O.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function th(g,A,k){return k&&k.internalChannelParams&&k.internalChannelParams[g]||A}function pA(g){this.za=0,this.i=[],this.j=new al,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=th("failFast",!1,g),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=th("baseRetryDelayMs",5e3,g),this.Za=th("retryDelaySeedMs",1e4,g),this.Ta=th("forwardChannelMaxRetries",2,g),this.va=th("forwardChannelRequestTimeoutMs",2e4,g),this.ma=g&&g.xmlHttpFactory||void 0,this.Ua=g&&g.Rb||void 0,this.Aa=g&&g.useFetchStreams||!1,this.O=void 0,this.L=g&&g.supportsCrossDomainXhr||!1,this.M="",this.h=new Wd(g&&g.concurrentRequestLimit),this.Ba=new a6,this.S=g&&g.fastHandshake||!1,this.R=g&&g.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=g&&g.Pb||!1,g&&g.ua&&this.j.ua(),g&&g.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&g&&g.detectBufferingProxy||!1,this.ia=void 0,g&&g.longPollingTimeout&&g.longPollingTimeout>0&&(this.ia=g.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=pA.prototype,n.ka=8,n.I=1,n.connect=function(g,A,k,O){Cn(0),this.W=g,this.H=A||{},k&&O!==void 0&&(this.H.OSID=k,this.H.OAID=O),this.F=this.X,this.J=SA(this,null,this.W),jm(this)};function bv(g){if(gA(g),g.I==3){var A=g.V++,k=js(g.J);if(yt(k,"SID",g.M),yt(k,"RID",A),yt(k,"TYPE","terminate"),nh(g,k),A=new Sr(g,g.j,A),A.M=2,A.A=K(js(k)),k=!1,o.navigator&&o.navigator.sendBeacon)try{k=o.navigator.sendBeacon(A.A.toString(),"")}catch{}!k&&o.Image&&(new Image().src=A.A,k=!0),k||(A.g=_A(A.j,null),A.g.ea(A.A)),A.F=Date.now(),cl(A)}bA(g)}function Om(g){g.g&&(_v(g),g.g.cancel(),g.g=null)}function gA(g){Om(g),g.v&&(o.clearTimeout(g.v),g.v=null),Fm(g),g.h.cancel(),g.m&&(typeof g.m=="number"&&o.clearTimeout(g.m),g.m=null)}function jm(g){if(!zd(g.h)&&!g.m){g.m=!0;var A=g.Ea;C||S(),D||(C(),D=!0),_.add(A,g),g.D=0}}function d6(g,A){return qd(g.h)>=g.h.j-(g.m?1:0)?!1:g.m?(g.i=A.G.concat(g.i),!0):g.I==1||g.I==2||g.D>=(g.Sa?0:g.Ta)?!1:(g.m=ol(c(g.Ea,g,A),TA(g,g.D)),g.D++,!0)}n.Ea=function(g){if(this.m)if(this.m=null,this.I==1){if(!g){this.V=Math.floor(Math.random()*1e5),g=this.V++;const z=new Sr(this,this.j,g);let Q=this.o;if(this.U&&(Q?(Q=Y(Q),ae(Q,this.U)):Q=this.U),this.u!==null||this.R||(z.J=Q,Q=null),this.S)e:{for(var A=0,k=0;k<this.i.length;k++){t:{var O=this.i[k];if("__data__"in O.map&&(O=O.map.__data__,typeof O=="string")){O=O.length;break t}O=void 0}if(O===void 0)break;if(A+=O,A>4096){A=k;break e}if(A===4096||k===this.i.length-1){A=k+1;break e}}A=1e3}else A=1e3;A=vA(this,z,A),k=js(this.J),yt(k,"RID",g),yt(k,"CVER",22),this.G&&yt(k,"X-HTTP-Session-Id",this.G),nh(this,k),Q&&(this.R?A="headers="+No(uA(Q))+"&"+A:this.u&&Tv(k,this.u,Q)),Ac(this.h,z),this.Ra&&yt(k,"TYPE","init"),this.S?(yt(k,"$req",A),yt(k,"SID","null"),z.U=!0,Tc(z,k,null)):Tc(z,k,A),this.I=2}}else this.I==3&&(g?yA(this,g):this.i.length==0||zd(this.h)||yA(this))};function yA(g,A){var k;A?k=A.l:k=g.V++;const O=js(g.J);yt(O,"SID",g.M),yt(O,"RID",k),yt(O,"AID",g.K),nh(g,O),g.u&&g.o&&Tv(O,g.u,g.o),k=new Sr(g,g.j,k,g.D+1),g.u===null&&(k.J=g.o),A&&(g.i=A.G.concat(g.i)),A=vA(g,k,1e3),k.H=Math.round(g.va*.5)+Math.round(g.va*.5*Math.random()),Ac(g.h,k),Tc(k,O,A)}function nh(g,A){g.H&&U(g.H,function(k,O){yt(A,O,k)}),g.l&&U({},function(k,O){yt(A,O,k)})}function vA(g,A,k){k=Math.min(g.i.length,k);const O=g.l?c(g.l.Ka,g.l,g):null;e:{var z=g.i;let Ke=-1;for(;;){const gn=["count="+k];Ke==-1?k>0?(Ke=z[0].g,gn.push("ofs="+Ke)):Ke=0:gn.push("ofs="+Ke);let Tt=!0;for(let Sn=0;Sn<k;Sn++){var Q=z[Sn].g;const qr=z[Sn].map;if(Q-=Ke,Q<0)Ke=Math.max(0,z[Sn].g-100),Tt=!1;else try{Q="req"+Q+"_"||"";try{var oe=qr instanceof Map?qr:Object.entries(qr);for(const[hl,Vo]of oe){let $o=Vo;a(Vo)&&($o=Xe(Vo)),gn.push(Q+hl+"="+encodeURIComponent($o))}}catch(hl){throw gn.push(Q+"type="+encodeURIComponent("_badmap")),hl}}catch{O&&O(qr)}}if(Tt){oe=gn.join("&");break e}}oe=void 0}return g=g.i.splice(0,k),A.G=g,oe}function xA(g){if(!g.g&&!g.v){g.Y=1;var A=g.Da;C||S(),D||(C(),D=!0),_.add(A,g),g.A=0}}function Sv(g){return g.g||g.v||g.A>=3?!1:(g.Y++,g.v=ol(c(g.Da,g),TA(g,g.A)),g.A++,!0)}n.Da=function(){if(this.v=null,EA(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var g=4*this.T;this.j.info("BP detection timer enabled: "+g),this.B=ol(c(this.Wa,this),g)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Cn(10),Om(this),EA(this))};function _v(g){g.B!=null&&(o.clearTimeout(g.B),g.B=null)}function EA(g){g.g=new Sr(g,g.j,"rpc",g.Y),g.u===null&&(g.g.J=g.o),g.g.P=0;var A=js(g.na);yt(A,"RID","rpc"),yt(A,"SID",g.M),yt(A,"AID",g.K),yt(A,"CI",g.F?"0":"1"),!g.F&&g.ia&&yt(A,"TO",g.ia),yt(A,"TYPE","xmlhttp"),nh(g,A),g.u&&g.o&&Tv(A,g.u,g.o),g.O&&(g.g.H=g.O);var k=g.g;g=g.ba,k.M=1,k.A=K(js(A)),k.u=null,k.R=!0,Gd(k,g)}n.Va=function(){this.C!=null&&(this.C=null,Om(this),Sv(this),Cn(19))};function Fm(g){g.C!=null&&(o.clearTimeout(g.C),g.C=null)}function wA(g,A){var k=null;if(g.g==A){Fm(g),_v(g),g.g=null;var O=2}else if(_c(g.h,A))k=A.G,Yd(g.h,A),O=1;else return;if(g.I!=0){if(A.o)if(O==1){k=A.u?A.u.length:0,A=Date.now()-A.F;var z=g.D;O=Po(),at(O,new Am(O,k)),jm(g)}else xA(g);else if(z=A.m,z==3||z==0&&A.X>0||!(O==1&&d6(g,A)||O==2&&Sv(g)))switch(k&&k.length>0&&(A=g.h,A.i=A.i.concat(k)),z){case 1:dl(g,5);break;case 4:dl(g,10);break;case 3:dl(g,6);break;default:dl(g,2)}}}function TA(g,A){let k=g.Qa+Math.floor(Math.random()*g.Za);return g.isActive()||(k*=2),k*A}function dl(g,A){if(g.j.info("Error code "+A),A==2){var k=c(g.bb,g),O=g.Ua;const z=!O;O=new _r(O||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||Do(O,"https"),K(O),z?i6(O.toString(),k):o6(O.toString(),k)}else Cn(2);g.I=0,g.l&&g.l.pa(A),bA(g),gA(g)}n.bb=function(g){g?(this.j.info("Successfully pinged google.com"),Cn(2)):(this.j.info("Failed to ping google.com"),Cn(1))};function bA(g){if(g.I=0,g.ja=[],g.l){const A=Qd(g.h);(A.length!=0||g.i.length!=0)&&(p(g.ja,A),p(g.ja,g.i),g.h.i.length=0,m(g.i),g.i.length=0),g.l.oa()}}function SA(g,A,k){var O=k instanceof _r?js(k):new _r(k);if(O.g!="")A&&(O.g=A+"."+O.g),Mo(O,O.u);else{var z=o.location;O=z.protocol,A=A?A+"."+z.hostname:z.hostname,z=+z.port;const Q=new _r(null);O&&Do(Q,O),A&&(Q.g=A),z&&Mo(Q,z),k&&(Q.h=k),O=Q}return k=g.G,A=g.wa,k&&A&&yt(O,k,A),yt(O,"VER",g.ka),nh(g,O),O}function _A(g,A,k){if(A&&!g.L)throw Error("Can't create secondary domain capable XhrIo object.");return A=g.Aa&&!g.ma?new Ht(new wv({ab:k})):new Ht(g.ma),A.Fa(g.L),A}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function AA(){}n=AA.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Um(){}Um.prototype.g=function(g,A){return new Fs(g,A)};function Fs(g,A){rt.call(this),this.g=new pA(A),this.l=g,this.h=A&&A.messageUrlParams||null,g=A&&A.messageHeaders||null,A&&A.clientProtocolHeaderRequired&&(g?g["X-Client-Protocol"]="webchannel":g={"X-Client-Protocol":"webchannel"}),this.g.o=g,g=A&&A.initMessageHeaders||null,A&&A.messageContentType&&(g?g["X-WebChannel-Content-Type"]=A.messageContentType:g={"X-WebChannel-Content-Type":A.messageContentType}),A&&A.sa&&(g?g["X-WebChannel-Client-Profile"]=A.sa:g={"X-WebChannel-Client-Profile":A.sa}),this.g.U=g,(g=A&&A.Qb)&&!M(g)&&(this.g.u=g),this.A=A&&A.supportsCrossDomainXhr||!1,this.v=A&&A.sendRawJson||!1,(A=A&&A.httpSessionIdParam)&&!M(A)&&(this.g.G=A,g=this.h,g!==null&&A in g&&(g=this.h,A in g&&delete g[A])),this.j=new Rc(this)}h(Fs,rt),Fs.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Fs.prototype.close=function(){bv(this.g)},Fs.prototype.o=function(g){var A=this.g;if(typeof g=="string"){var k={};k.__data__=g,g=k}else this.v&&(k={},k.__data__=Xe(g),g=k);A.i.push(new Nm(A.Ya++,g)),A.I==3&&jm(A)},Fs.prototype.N=function(){this.g.l=null,delete this.j,bv(this.g),delete this.g,Fs.Z.N.call(this)};function IA(g){Ni.call(this),g.__headers__&&(this.headers=g.__headers__,this.statusCode=g.__status__,delete g.__headers__,delete g.__status__);var A=g.__sm__;if(A){e:{for(const k in A){g=k;break e}g=void 0}(this.i=g)&&(g=this.i,A=A!==null&&g in A?A[g]:void 0),this.data=A}else this.data=g}h(IA,Ni);function RA(){Od.call(this),this.status=1}h(RA,Od);function Rc(g){this.g=g}h(Rc,AA),Rc.prototype.ra=function(){at(this.g,"a")},Rc.prototype.qa=function(g){at(this.g,new IA(g))},Rc.prototype.pa=function(g){at(this.g,new RA)},Rc.prototype.oa=function(){at(this.g,"b")},Um.prototype.createWebChannel=Um.prototype.g,Fs.prototype.send=Fs.prototype.o,Fs.prototype.open=Fs.prototype.m,Fs.prototype.close=Fs.prototype.close,cj=function(){return new Um},lj=function(){return Po()},aj=Li,Vw={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ll.NO_ERROR=0,ll.TIMEOUT=8,ll.HTTP_ERROR=6,ig=ll,Ud.COMPLETE="complete",oj=Ud,Co.EventType=pn,pn.OPEN="a",pn.CLOSE="b",pn.ERROR="c",pn.MESSAGE="d",rt.prototype.listen=rt.prototype.J,Sh=Co,Ht.prototype.listenOnce=Ht.prototype.K,Ht.prototype.getLastError=Ht.prototype.Ha,Ht.prototype.getLastErrorCode=Ht.prototype.ya,Ht.prototype.getStatus=Ht.prototype.ca,Ht.prototype.getResponseJson=Ht.prototype.La,Ht.prototype.getResponseText=Ht.prototype.la,Ht.prototype.send=Ht.prototype.ea,Ht.prototype.setWithCredentials=Ht.prototype.Fa,ij=Ht}).apply(typeof up<"u"?up:typeof self<"u"?self:typeof window<"u"?window:{});const tC="@firebase/firestore",nC="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Qn.UNAUTHENTICATED=new Qn(null),Qn.GOOGLE_CREDENTIALS=new Qn("google-credentials-uid"),Qn.FIRST_PARTY=new Qn("first-party-uid"),Qn.MOCK_USER=new Qn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Id="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tc=new _S("@firebase/firestore");function Uc(){return tc.logLevel}function ue(n,...e){if(tc.logLevel<=Je.DEBUG){const t=e.map(FS);tc.debug(`Firestore (${Id}): ${n}`,...t)}}function yo(n,...e){if(tc.logLevel<=Je.ERROR){const t=e.map(FS);tc.error(`Firestore (${Id}): ${n}`,...t)}}function Zu(n,...e){if(tc.logLevel<=Je.WARN){const t=e.map(FS);tc.warn(`Firestore (${Id}): ${n}`,...t)}}function FS(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ce(n,e,t){let s="Unexpected state";typeof e=="string"?s=e:t=e,uj(n,s,t)}function uj(n,e,t){let s=`FIRESTORE (${Id}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{s+=" CONTEXT: "+JSON.stringify(t)}catch{s+=" CONTEXT: "+t}throw yo(s),new Error(s)}function ht(n,e,t,s){let r="Unexpected state";typeof t=="string"?r=t:s=t,n||uj(e,r,s)}function Ve(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ee={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ce extends bo{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class to{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dj{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class BQ{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Qn.UNAUTHENTICATED))}shutdown(){}}class GQ{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class KQ{constructor(e){this.t=e,this.currentUser=Qn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ht(this.o===void 0,42304);let s=this.i;const r=l=>this.i!==s?(s=this.i,t(l)):Promise.resolve();let i=new to;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new to,e.enqueueRetryable(()=>r(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await r(this.currentUser)})},a=l=>{ue("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(ue("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new to)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(s=>this.i!==e?(ue("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(ht(typeof s.accessToken=="string",31837,{l:s}),new dj(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ht(e===null||typeof e=="string",2055,{h:e}),new Qn(e)}}class HQ{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=Qn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class WQ{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new HQ(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Qn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class sC{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class zQ{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,zs(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ht(this.o===void 0,3512);const s=i=>{i.error!=null&&ue("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,ue("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>s(i))};const r=i=>{ue("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>r(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?r(i):ue("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new sC(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ht(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new sC(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qQ(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class US{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const r=qQ(40);for(let i=0;i<r.length;++i)s.length<20&&r[i]<t&&(s+=e.charAt(r[i]%62))}return s}}function Ze(n,e){return n<e?-1:n>e?1:0}function $w(n,e){const t=Math.min(n.length,e.length);for(let s=0;s<t;s++){const r=n.charAt(s),i=e.charAt(s);if(r!==i)return gx(r)===gx(i)?Ze(r,i):gx(r)?1:-1}return Ze(n.length,e.length)}const YQ=55296,QQ=57343;function gx(n){const e=n.charCodeAt(0);return e>=YQ&&e<=QQ}function ed(n,e,t){return n.length===e.length&&n.every((s,r)=>t(s,e[r]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rC="__name__";class ei{constructor(e,t,s){t===void 0?t=0:t>e.length&&Ce(637,{offset:t,range:e.length}),s===void 0?s=e.length-t:s>e.length-t&&Ce(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return ei.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ei?e.forEach(s=>{t.push(s)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const i=ei.compareSegments(e.get(r),t.get(r));if(i!==0)return i}return Ze(e.length,t.length)}static compareSegments(e,t){const s=ei.isNumericId(e),r=ei.isNumericId(t);return s&&!r?-1:!s&&r?1:s&&r?ei.extractNumericId(e).compare(ei.extractNumericId(t)):$w(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Pa.fromString(e.substring(4,e.length-2))}}class _t extends ei{construct(e,t,s){return new _t(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new ce(ee.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter(r=>r.length>0))}return new _t(t)}static emptyPath(){return new _t([])}}const XQ=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Fn extends ei{construct(e,t,s){return new Fn(e,t,s)}static isValidIdentifier(e){return XQ.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Fn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===rC}static keyField(){return new Fn([rC])}static fromServerFormat(e){const t=[];let s="",r=0;const i=()=>{if(s.length===0)throw new ce(ee.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let o=!1;for(;r<e.length;){const a=e[r];if(a==="\\"){if(r+1===e.length)throw new ce(ee.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[r+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new ce(ee.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=l,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(s+=a,r++):(i(),r++)}if(i(),o)throw new ce(ee.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Fn(t)}static emptyPath(){return new Fn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _e{constructor(e){this.path=e}static fromPath(e){return new _e(_t.fromString(e))}static fromName(e){return new _e(_t.fromString(e).popFirst(5))}static empty(){return new _e(_t.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&_t.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return _t.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new _e(new _t(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hj(n,e,t){if(!t)throw new ce(ee.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function JQ(n,e,t,s){if(e===!0&&s===!0)throw new ce(ee.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function iC(n){if(!_e.isDocumentKey(n))throw new ce(ee.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function oC(n){if(_e.isDocumentKey(n))throw new ce(ee.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function fj(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function _y(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(s){return s.constructor?s.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Ce(12329,{type:typeof n})}function Cs(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new ce(ee.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=_y(n);throw new ce(ee.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function ZQ(n,e){if(e<=0)throw new ce(ee.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dn(n,e){const t={typeString:n};return e&&(t.value=e),t}function dm(n,e){if(!fj(n))throw new ce(ee.INVALID_ARGUMENT,"JSON must be an object");let t;for(const s in e)if(e[s]){const r=e[s].typeString,i="value"in e[s]?{value:e[s].value}:void 0;if(!(s in n)){t=`JSON missing required field: '${s}'`;break}const o=n[s];if(r&&typeof o!==r){t=`JSON field '${s}' must be a ${r}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${s}' field to equal '${i.value}'`;break}}if(t)throw new ce(ee.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aC=-62135596800,lC=1e6;class Pt{static now(){return Pt.fromMillis(Date.now())}static fromDate(e){return Pt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*lC);return new Pt(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new ce(ee.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new ce(ee.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<aC)throw new ce(ee.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ce(ee.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/lC}_compareTo(e){return this.seconds===e.seconds?Ze(this.nanoseconds,e.nanoseconds):Ze(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Pt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(dm(e,Pt._jsonSchema))return new Pt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-aC;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Pt._jsonSchemaVersion="firestore/timestamp/1.0",Pt._jsonSchema={type:dn("string",Pt._jsonSchemaVersion),seconds:dn("number"),nanoseconds:dn("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fe{static fromTimestamp(e){return new Fe(e)}static min(){return new Fe(new Pt(0,0))}static max(){return new Fe(new Pt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _f=-1;function eX(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,r=Fe.fromTimestamp(s===1e9?new Pt(t+1,0):new Pt(t,s));return new Va(r,_e.empty(),e)}function tX(n){return new Va(n.readTime,n.key,_f)}class Va{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new Va(Fe.min(),_e.empty(),_f)}static max(){return new Va(Fe.max(),_e.empty(),_f)}}function nX(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=_e.comparator(n.documentKey,e.documentKey),t!==0?t:Ze(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sX="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class rX{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rd(n){if(n.code!==ee.FAILED_PRECONDITION||n.message!==sX)throw n;ue("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class te{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ce(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new te((s,r)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(s,r)},this.catchCallback=i=>{this.wrapFailure(t,i).next(s,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof te?t:te.resolve(t)}catch(t){return te.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):te.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):te.reject(t)}static resolve(e){return new te((t,s)=>{t(e)})}static reject(e){return new te((t,s)=>{s(e)})}static waitFor(e){return new te((t,s)=>{let r=0,i=0,o=!1;e.forEach(a=>{++r,a.next(()=>{++i,o&&i===r&&t()},l=>s(l))}),o=!0,i===r&&t()})}static or(e){let t=te.resolve(!1);for(const s of e)t=t.next(r=>r?te.resolve(r):s());return t}static forEach(e,t){const s=[];return e.forEach((r,i)=>{s.push(t.call(this,r,i))}),this.waitFor(s)}static mapArray(e,t){return new te((s,r)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(d=>{o[c]=d,++a,a===i&&s(o)},d=>r(d))}})}static doWhile(e,t){return new te((s,r)=>{const i=()=>{e()===!0?t().next(()=>{i()},r):s()};i()})}}function iX(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Cd(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ay{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>t.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Ay.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VS=-1;function Iy(n){return n==null}function d0(n){return n===0&&1/n==-1/0}function oX(n){return typeof n=="number"&&Number.isInteger(n)&&!d0(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mj="";function aX(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=cC(e)),e=lX(n.get(t),e);return cC(e)}function lX(n,e){let t=e;const s=n.length;for(let r=0;r<s;r++){const i=n.charAt(r);switch(i){case"\0":t+="";break;case mj:t+="";break;default:t+=i}}return t}function cC(n){return n+mj+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uC(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function el(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function pj(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bt{constructor(e,t){this.comparator=e,this.root=t||Dn.EMPTY}insert(e,t){return new Bt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Dn.BLACK,null,null))}remove(e){return new Bt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Dn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(r===0)return t+s.left.size;r<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,s)=>(e(t,s),!1))}toString(){const e=[];return this.inorderTraversal((t,s)=>(e.push(`${t}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new dp(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new dp(this.root,e,this.comparator,!1)}getReverseIterator(){return new dp(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new dp(this.root,e,this.comparator,!0)}}class dp{constructor(e,t,s,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?s(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Dn{constructor(e,t,s,r,i){this.key=e,this.value=t,this.color=s??Dn.RED,this.left=r??Dn.EMPTY,this.right=i??Dn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,r,i){return new Dn(e??this.key,t??this.value,s??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const i=s(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,s),null):i===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Dn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return Dn.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Dn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Dn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ce(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ce(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ce(27949);return e+(this.isRed()?0:1)}}Dn.EMPTY=null,Dn.RED=!0,Dn.BLACK=!1;Dn.EMPTY=new class{constructor(){this.size=0}get key(){throw Ce(57766)}get value(){throw Ce(16141)}get color(){throw Ce(16727)}get left(){throw Ce(29726)}get right(){throw Ce(36894)}copy(e,t,s,r,i){return this}insert(e,t,s){return new Dn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tn{constructor(e){this.comparator=e,this.data=new Bt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,s)=>(e(t),!1))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new dC(this.data.getIterator())}getIteratorFrom(e){return new dC(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(s=>{t=t.add(s)}),t}isEqual(e){if(!(e instanceof Tn)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(this.comparator(r,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Tn(this.comparator);return t.data=e,t}}class dC{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys{constructor(e){this.fields=e,e.sort(Fn.comparator)}static empty(){return new Ys([])}unionWith(e){let t=new Tn(Fn.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new Ys(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ed(this.fields,e.fields,(t,s)=>t.isEqual(s))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gj extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(r){try{return atob(r)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new gj("Invalid base64 string: "+i):i}}(e);return new Gn(t)}static fromUint8Array(e){const t=function(r){let i="";for(let o=0;o<r.length;++o)i+=String.fromCharCode(r[o]);return i}(e);return new Gn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ze(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Gn.EMPTY_BYTE_STRING=new Gn("");const cX=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function $a(n){if(ht(!!n,39018),typeof n=="string"){let e=0;const t=cX.exec(n);if(ht(!!t,46558,{timestamp:n}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:tn(n.seconds),nanos:tn(n.nanos)}}function tn(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ba(n){return typeof n=="string"?Gn.fromBase64String(n):Gn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yj="server_timestamp",vj="__type__",xj="__previous_value__",Ej="__local_write_time__";function $S(n){var t,s;return((s=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[vj])==null?void 0:s.stringValue)===yj}function Ry(n){const e=n.mapValue.fields[xj];return $S(e)?Ry(e):e}function Af(n){const e=$a(n.mapValue.fields[Ej].timestampValue);return new Pt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uX{constructor(e,t,s,r,i,o,a,l,c,d){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c,this.isUsingEmulator=d}}const h0="(default)";class If{constructor(e,t){this.projectId=e,this.database=t||h0}static empty(){return new If("","")}get isDefaultDatabase(){return this.database===h0}isEqual(e){return e instanceof If&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wj="__type__",Tj="__max__",hp={mapValue:{fields:{__type__:{stringValue:Tj}}}},bj="__vector__",f0="value";function Ga(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?$S(n)?4:hX(n)?9007199254740991:dX(n)?10:11:Ce(28295,{value:n})}function _i(n,e){if(n===e)return!0;const t=Ga(n);if(t!==Ga(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Af(n).isEqual(Af(e));case 3:return function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const o=$a(r.timestampValue),a=$a(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(r,i){return Ba(r.bytesValue).isEqual(Ba(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,i){return tn(r.geoPointValue.latitude)===tn(i.geoPointValue.latitude)&&tn(r.geoPointValue.longitude)===tn(i.geoPointValue.longitude)}(n,e);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return tn(r.integerValue)===tn(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const o=tn(r.doubleValue),a=tn(i.doubleValue);return o===a?d0(o)===d0(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return ed(n.arrayValue.values||[],e.arrayValue.values||[],_i);case 10:case 11:return function(r,i){const o=r.mapValue.fields||{},a=i.mapValue.fields||{};if(uC(o)!==uC(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!_i(o[l],a[l])))return!1;return!0}(n,e);default:return Ce(52216,{left:n})}}function Rf(n,e){return(n.values||[]).find(t=>_i(t,e))!==void 0}function td(n,e){if(n===e)return 0;const t=Ga(n),s=Ga(e);if(t!==s)return Ze(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ze(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=tn(i.integerValue||i.doubleValue),l=tn(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return hC(n.timestampValue,e.timestampValue);case 4:return hC(Af(n),Af(e));case 5:return $w(n.stringValue,e.stringValue);case 6:return function(i,o){const a=Ba(i),l=Ba(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const d=Ze(a[c],l[c]);if(d!==0)return d}return Ze(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Ze(tn(i.latitude),tn(o.latitude));return a!==0?a:Ze(tn(i.longitude),tn(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return fC(n.arrayValue,e.arrayValue);case 10:return function(i,o){var f,m,p,y;const a=i.fields||{},l=o.fields||{},c=(f=a[f0])==null?void 0:f.arrayValue,d=(m=l[f0])==null?void 0:m.arrayValue,h=Ze(((p=c==null?void 0:c.values)==null?void 0:p.length)||0,((y=d==null?void 0:d.values)==null?void 0:y.length)||0);return h!==0?h:fC(c,d)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===hp.mapValue&&o===hp.mapValue)return 0;if(i===hp.mapValue)return 1;if(o===hp.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},d=Object.keys(c);l.sort(),d.sort();for(let h=0;h<l.length&&h<d.length;++h){const f=$w(l[h],d[h]);if(f!==0)return f;const m=td(a[l[h]],c[d[h]]);if(m!==0)return m}return Ze(l.length,d.length)}(n.mapValue,e.mapValue);default:throw Ce(23264,{he:t})}}function hC(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ze(n,e);const t=$a(n),s=$a(e),r=Ze(t.seconds,s.seconds);return r!==0?r:Ze(t.nanos,s.nanos)}function fC(n,e){const t=n.values||[],s=e.values||[];for(let r=0;r<t.length&&r<s.length;++r){const i=td(t[r],s[r]);if(i)return i}return Ze(t.length,s.length)}function nd(n){return Bw(n)}function Bw(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const s=$a(t);return`time(${s.seconds},${s.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Ba(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return _e.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let s="[",r=!0;for(const i of t.values||[])r?r=!1:s+=",",s+=Bw(i);return s+"]"}(n.arrayValue):"mapValue"in n?function(t){const s=Object.keys(t.fields||{}).sort();let r="{",i=!0;for(const o of s)i?i=!1:r+=",",r+=`${o}:${Bw(t.fields[o])}`;return r+"}"}(n.mapValue):Ce(61005,{value:n})}function og(n){switch(Ga(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ry(n);return e?16+og(e):16;case 5:return 2*n.stringValue.length;case 6:return Ba(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(s){return(s.values||[]).reduce((r,i)=>r+og(i),0)}(n.arrayValue);case 10:case 11:return function(s){let r=0;return el(s.fields,(i,o)=>{r+=i.length+og(o)}),r}(n.mapValue);default:throw Ce(13486,{value:n})}}function mC(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Gw(n){return!!n&&"integerValue"in n}function BS(n){return!!n&&"arrayValue"in n}function pC(n){return!!n&&"nullValue"in n}function gC(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ag(n){return!!n&&"mapValue"in n}function dX(n){var t,s;return((s=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[wj])==null?void 0:s.stringValue)===bj}function Hh(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return el(n.mapValue.fields,(t,s)=>e.mapValue.fields[t]=Hh(s)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Hh(n.arrayValue.values[t]);return e}return{...n}}function hX(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Tj}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bs{constructor(e){this.value=e}static empty(){return new bs({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!ag(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Hh(t)}setAll(e){let t=Fn.emptyPath(),s={},r=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,s,r),s={},r=[],t=a.popLast()}o?s[a.lastSegment()]=Hh(o):r.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,s,r)}delete(e){const t=this.field(e.popLast());ag(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return _i(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=t.mapValue.fields[e.get(s)];ag(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,s){el(t,(r,i)=>e[r]=i);for(const r of s)delete e[r]}clone(){return new bs(Hh(this.value))}}function Sj(n){const e=[];return el(n.fields,(t,s)=>{const r=new Fn([t]);if(ag(s)){const i=Sj(s.mapValue).fields;if(i.length===0)e.push(r);else for(const o of i)e.push(r.child(o))}else e.push(r)}),new Ys(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jn{constructor(e,t,s,r,i,o,a){this.key=e,this.documentType=t,this.version=s,this.readTime=r,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Jn(e,0,Fe.min(),Fe.min(),Fe.min(),bs.empty(),0)}static newFoundDocument(e,t,s,r){return new Jn(e,1,t,Fe.min(),s,r,0)}static newNoDocument(e,t){return new Jn(e,2,t,Fe.min(),Fe.min(),bs.empty(),0)}static newUnknownDocument(e,t){return new Jn(e,3,t,Fe.min(),Fe.min(),bs.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Fe.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=bs.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=bs.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Fe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Jn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Jn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m0{constructor(e,t){this.position=e,this.inclusive=t}}function yC(n,e,t){let s=0;for(let r=0;r<n.position.length;r++){const i=e[r],o=n.position[r];if(i.field.isKeyField()?s=_e.comparator(_e.fromName(o.referenceValue),t.key):s=td(o,t.data.field(i.field)),i.dir==="desc"&&(s*=-1),s!==0)break}return s}function vC(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!_i(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cf{constructor(e,t="asc"){this.field=e,this.dir=t}}function fX(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _j{}class un extends _j{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new pX(e,t,s):t==="array-contains"?new vX(e,s):t==="in"?new xX(e,s):t==="not-in"?new EX(e,s):t==="array-contains-any"?new wX(e,s):new un(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new gX(e,s):new yX(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(td(t,this.value)):t!==null&&Ga(this.value)===Ga(t)&&this.matchesComparison(td(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ce(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Hr extends _j{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Hr(e,t)}matches(e){return Aj(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Aj(n){return n.op==="and"}function Ij(n){return mX(n)&&Aj(n)}function mX(n){for(const e of n.filters)if(e instanceof Hr)return!1;return!0}function Kw(n){if(n instanceof un)return n.field.canonicalString()+n.op.toString()+nd(n.value);if(Ij(n))return n.filters.map(e=>Kw(e)).join(",");{const e=n.filters.map(t=>Kw(t)).join(",");return`${n.op}(${e})`}}function Rj(n,e){return n instanceof un?function(s,r){return r instanceof un&&s.op===r.op&&s.field.isEqual(r.field)&&_i(s.value,r.value)}(n,e):n instanceof Hr?function(s,r){return r instanceof Hr&&s.op===r.op&&s.filters.length===r.filters.length?s.filters.reduce((i,o,a)=>i&&Rj(o,r.filters[a]),!0):!1}(n,e):void Ce(19439)}function Cj(n){return n instanceof un?function(t){return`${t.field.canonicalString()} ${t.op} ${nd(t.value)}`}(n):n instanceof Hr?function(t){return t.op.toString()+" {"+t.getFilters().map(Cj).join(" ,")+"}"}(n):"Filter"}class pX extends un{constructor(e,t,s){super(e,t,s),this.key=_e.fromName(s.referenceValue)}matches(e){const t=_e.comparator(e.key,this.key);return this.matchesComparison(t)}}class gX extends un{constructor(e,t){super(e,"in",t),this.keys=Pj("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class yX extends un{constructor(e,t){super(e,"not-in",t),this.keys=Pj("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Pj(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(s=>_e.fromName(s.referenceValue))}class vX extends un{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return BS(t)&&Rf(t.arrayValue,this.value)}}class xX extends un{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Rf(this.value.arrayValue,t)}}class EX extends un{constructor(e,t){super(e,"not-in",t)}matches(e){if(Rf(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Rf(this.value.arrayValue,t)}}class wX extends un{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!BS(t)||!t.arrayValue.values)&&t.arrayValue.values.some(s=>Rf(this.value.arrayValue,s))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TX{constructor(e,t=null,s=[],r=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function xC(n,e=null,t=[],s=[],r=null,i=null,o=null){return new TX(n,e,t,s,r,i,o)}function GS(n){const e=Ve(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(s=>Kw(s)).join(","),t+="|ob:",t+=e.orderBy.map(s=>function(i){return i.field.canonicalString()+i.dir}(s)).join(","),Iy(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(s=>nd(s)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(s=>nd(s)).join(",")),e.Te=t}return e.Te}function KS(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!fX(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Rj(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!vC(n.startAt,e.startAt)&&vC(n.endAt,e.endAt)}function Hw(n){return _e.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pd{constructor(e,t=null,s=[],r=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function bX(n,e,t,s,r,i,o,a){return new Pd(n,e,t,s,r,i,o,a)}function Cy(n){return new Pd(n)}function EC(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function kj(n){return n.collectionGroup!==null}function Wh(n){const e=Ve(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Tn(Fn.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Cf(i,s))}),t.has(Fn.keyField().canonicalString())||e.Ie.push(new Cf(Fn.keyField(),s))}return e.Ie}function yi(n){const e=Ve(n);return e.Ee||(e.Ee=SX(e,Wh(n))),e.Ee}function SX(n,e){if(n.limitType==="F")return xC(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(r=>{const i=r.dir==="desc"?"asc":"desc";return new Cf(r.field,i)});const t=n.endAt?new m0(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new m0(n.startAt.position,n.startAt.inclusive):null;return xC(n.path,n.collectionGroup,e,n.filters,n.limit,t,s)}}function Ww(n,e){const t=n.filters.concat([e]);return new Pd(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function p0(n,e,t){return new Pd(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Py(n,e){return KS(yi(n),yi(e))&&n.limitType===e.limitType}function Nj(n){return`${GS(yi(n))}|lt:${n.limitType}`}function Vc(n){return`Query(target=${function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map(r=>Cj(r)).join(", ")}]`),Iy(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map(r=>nd(r)).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map(r=>nd(r)).join(",")),`Target(${s})`}(yi(n))}; limitType=${n.limitType})`}function ky(n,e){return e.isFoundDocument()&&function(s,r){const i=r.key.path;return s.collectionGroup!==null?r.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(i):_e.isDocumentKey(s.path)?s.path.isEqual(i):s.path.isImmediateParentOf(i)}(n,e)&&function(s,r){for(const i of Wh(s))if(!i.field.isKeyField()&&r.data.field(i.field)===null)return!1;return!0}(n,e)&&function(s,r){for(const i of s.filters)if(!i.matches(r))return!1;return!0}(n,e)&&function(s,r){return!(s.startAt&&!function(o,a,l){const c=yC(o,a,l);return o.inclusive?c<=0:c<0}(s.startAt,Wh(s),r)||s.endAt&&!function(o,a,l){const c=yC(o,a,l);return o.inclusive?c>=0:c>0}(s.endAt,Wh(s),r))}(n,e)}function _X(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Lj(n){return(e,t)=>{let s=!1;for(const r of Wh(n)){const i=AX(r,e,t);if(i!==0)return i;s=s||r.field.isKeyField()}return 0}}function AX(n,e,t){const s=n.field.isKeyField()?_e.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?td(l,c):Ce(42886)}(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return Ce(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uc{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[r,i]of s)if(this.equalsFn(r,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),r=this.inner[s];if(r===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return s.length===1?delete this.inner[t]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){el(this.inner,(t,s)=>{for(const[r,i]of s)e(r,i)})}isEmpty(){return pj(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IX=new Bt(_e.comparator);function vo(){return IX}const Dj=new Bt(_e.comparator);function _h(...n){let e=Dj;for(const t of n)e=e.insert(t.key,t);return e}function Mj(n){let e=Dj;return n.forEach((t,s)=>e=e.insert(t,s.overlayedDocument)),e}function Il(){return zh()}function Oj(){return zh()}function zh(){return new uc(n=>n.toString(),(n,e)=>n.isEqual(e))}const RX=new Bt(_e.comparator),CX=new Tn(_e.comparator);function et(...n){let e=CX;for(const t of n)e=e.add(t);return e}const PX=new Tn(Ze);function kX(){return PX}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HS(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:d0(e)?"-0":e}}function jj(n){return{integerValue:""+n}}function Fj(n,e){return oX(e)?jj(e):HS(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ny{constructor(){this._=void 0}}function NX(n,e,t){return n instanceof Pf?function(r,i){const o={fields:{[vj]:{stringValue:yj},[Ej]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&$S(i)&&(i=Ry(i)),i&&(o.fields[xj]=i),{mapValue:o}}(t,e):n instanceof sd?Vj(n,e):n instanceof rd?$j(n,e):function(r,i){const o=Uj(r,i),a=wC(o)+wC(r.Ae);return Gw(o)&&Gw(r.Ae)?jj(a):HS(r.serializer,a)}(n,e)}function LX(n,e,t){return n instanceof sd?Vj(n,e):n instanceof rd?$j(n,e):t}function Uj(n,e){return n instanceof kf?function(s){return Gw(s)||function(i){return!!i&&"doubleValue"in i}(s)}(e)?e:{integerValue:0}:null}class Pf extends Ny{}class sd extends Ny{constructor(e){super(),this.elements=e}}function Vj(n,e){const t=Bj(e);for(const s of n.elements)t.some(r=>_i(r,s))||t.push(s);return{arrayValue:{values:t}}}class rd extends Ny{constructor(e){super(),this.elements=e}}function $j(n,e){let t=Bj(e);for(const s of n.elements)t=t.filter(r=>!_i(r,s));return{arrayValue:{values:t}}}class kf extends Ny{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function wC(n){return tn(n.integerValue||n.doubleValue)}function Bj(n){return BS(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ly{constructor(e,t){this.field=e,this.transform=t}}function DX(n,e){return n.field.isEqual(e.field)&&function(s,r){return s instanceof sd&&r instanceof sd||s instanceof rd&&r instanceof rd?ed(s.elements,r.elements,_i):s instanceof kf&&r instanceof kf?_i(s.Ae,r.Ae):s instanceof Pf&&r instanceof Pf}(n.transform,e.transform)}class MX{constructor(e,t){this.version=e,this.transformResults=t}}class pr{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new pr}static exists(e){return new pr(void 0,e)}static updateTime(e){return new pr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function lg(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Dy{}function Gj(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new WS(n.key,pr.none()):new hm(n.key,n.data,pr.none());{const t=n.data,s=bs.empty();let r=new Tn(Fn.comparator);for(let i of e.fields)if(!r.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?s.delete(i):s.set(i,o),r=r.add(i)}return new tl(n.key,s,new Ys(r.toArray()),pr.none())}}function OX(n,e,t){n instanceof hm?function(r,i,o){const a=r.value.clone(),l=bC(r.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof tl?function(r,i,o){if(!lg(r.precondition,i))return void i.convertToUnknownDocument(o.version);const a=bC(r.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(Kj(r)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(r,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function qh(n,e,t,s){return n instanceof hm?function(i,o,a,l){if(!lg(i.precondition,o))return a;const c=i.value.clone(),d=SC(i.fieldTransforms,l,o);return c.setAll(d),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,s):n instanceof tl?function(i,o,a,l){if(!lg(i.precondition,o))return a;const c=SC(i.fieldTransforms,l,o),d=o.data;return d.setAll(Kj(i)),d.setAll(c),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(h=>h.field))}(n,e,t,s):function(i,o,a){return lg(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function jX(n,e){let t=null;for(const s of n.fieldTransforms){const r=e.data.field(s.field),i=Uj(s.transform,r||null);i!=null&&(t===null&&(t=bs.empty()),t.set(s.field,i))}return t||null}function TC(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(s,r){return s===void 0&&r===void 0||!(!s||!r)&&ed(s,r,(i,o)=>DX(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class hm extends Dy{constructor(e,t,s,r=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class tl extends Dy{constructor(e,t,s,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Kj(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}}),e}function bC(n,e,t){const s=new Map;ht(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let r=0;r<t.length;r++){const i=n[r],o=i.transform,a=e.data.field(i.field);s.set(i.field,LX(o,a,t[r]))}return s}function SC(n,e,t){const s=new Map;for(const r of n){const i=r.transform,o=t.data.field(r.field);s.set(r.field,NX(i,o,e))}return s}class WS extends Dy{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class FX extends Dy{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UX{constructor(e,t,s,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&OX(i,e,s[r])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=qh(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=qh(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=Oj();return this.mutations.forEach(r=>{const i=e.get(r.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(r.key)?null:a;const l=Gj(o,a);l!==null&&s.set(r.key,l),o.isValidDocument()||o.convertToNoDocument(Fe.min())}),s}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),et())}isEqual(e){return this.batchId===e.batchId&&ed(this.mutations,e.mutations,(t,s)=>TC(t,s))&&ed(this.baseMutations,e.baseMutations,(t,s)=>TC(t,s))}}class zS{constructor(e,t,s,r){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=r}static from(e,t,s){ht(e.mutations.length===s.length,58842,{me:e.mutations.length,fe:s.length});let r=function(){return RX}();const i=e.mutations;for(let o=0;o<i.length;o++)r=r.insert(i[o].key,s[o].version);return new zS(e,t,s,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let VX=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $X{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ln,it;function BX(n){switch(n){case ee.OK:return Ce(64938);case ee.CANCELLED:case ee.UNKNOWN:case ee.DEADLINE_EXCEEDED:case ee.RESOURCE_EXHAUSTED:case ee.INTERNAL:case ee.UNAVAILABLE:case ee.UNAUTHENTICATED:return!1;case ee.INVALID_ARGUMENT:case ee.NOT_FOUND:case ee.ALREADY_EXISTS:case ee.PERMISSION_DENIED:case ee.FAILED_PRECONDITION:case ee.ABORTED:case ee.OUT_OF_RANGE:case ee.UNIMPLEMENTED:case ee.DATA_LOSS:return!0;default:return Ce(15467,{code:n})}}function Hj(n){if(n===void 0)return yo("GRPC error has no .code"),ee.UNKNOWN;switch(n){case ln.OK:return ee.OK;case ln.CANCELLED:return ee.CANCELLED;case ln.UNKNOWN:return ee.UNKNOWN;case ln.DEADLINE_EXCEEDED:return ee.DEADLINE_EXCEEDED;case ln.RESOURCE_EXHAUSTED:return ee.RESOURCE_EXHAUSTED;case ln.INTERNAL:return ee.INTERNAL;case ln.UNAVAILABLE:return ee.UNAVAILABLE;case ln.UNAUTHENTICATED:return ee.UNAUTHENTICATED;case ln.INVALID_ARGUMENT:return ee.INVALID_ARGUMENT;case ln.NOT_FOUND:return ee.NOT_FOUND;case ln.ALREADY_EXISTS:return ee.ALREADY_EXISTS;case ln.PERMISSION_DENIED:return ee.PERMISSION_DENIED;case ln.FAILED_PRECONDITION:return ee.FAILED_PRECONDITION;case ln.ABORTED:return ee.ABORTED;case ln.OUT_OF_RANGE:return ee.OUT_OF_RANGE;case ln.UNIMPLEMENTED:return ee.UNIMPLEMENTED;case ln.DATA_LOSS:return ee.DATA_LOSS;default:return Ce(39323,{code:n})}}(it=ln||(ln={}))[it.OK=0]="OK",it[it.CANCELLED=1]="CANCELLED",it[it.UNKNOWN=2]="UNKNOWN",it[it.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",it[it.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",it[it.NOT_FOUND=5]="NOT_FOUND",it[it.ALREADY_EXISTS=6]="ALREADY_EXISTS",it[it.PERMISSION_DENIED=7]="PERMISSION_DENIED",it[it.UNAUTHENTICATED=16]="UNAUTHENTICATED",it[it.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",it[it.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",it[it.ABORTED=10]="ABORTED",it[it.OUT_OF_RANGE=11]="OUT_OF_RANGE",it[it.UNIMPLEMENTED=12]="UNIMPLEMENTED",it[it.INTERNAL=13]="INTERNAL",it[it.UNAVAILABLE=14]="UNAVAILABLE",it[it.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GX(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KX=new Pa([4294967295,4294967295],0);function _C(n){const e=GX().encode(n),t=new rj;return t.update(e),new Uint8Array(t.digest())}function AC(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),r=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Pa([t,s],0),new Pa([r,i],0)]}class qS{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new Ah(`Invalid padding: ${t}`);if(s<0)throw new Ah(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new Ah(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new Ah(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Pa.fromNumber(this.ge)}ye(e,t,s){let r=e.add(t.multiply(Pa.fromNumber(s)));return r.compare(KX)===1&&(r=new Pa([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=_C(e),[s,r]=AC(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(s,r,i);if(!this.we(o))return!1}return!0}static create(e,t,s){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new qS(i,r,t);return s.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;const t=_C(e),[s,r]=AC(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(s,r,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class Ah extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class My{constructor(e,t,s,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const r=new Map;return r.set(e,fm.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new My(Fe.min(),r,new Bt(Ze),vo(),et())}}class fm{constructor(e,t,s,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new fm(s,t,et(),et(),et())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cg{constructor(e,t,s,r){this.be=e,this.removedTargetIds=t,this.key=s,this.De=r}}class Wj{constructor(e,t){this.targetId=e,this.Ce=t}}class zj{constructor(e,t,s=Gn.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=r}}class IC{constructor(){this.ve=0,this.Fe=RC(),this.Me=Gn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=et(),t=et(),s=et();return this.Fe.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:s=s.add(r);break;default:Ce(38017,{changeType:i})}}),new fm(this.Me,this.xe,e,t,s)}qe(){this.Oe=!1,this.Fe=RC()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,ht(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class HX{constructor(e){this.Ge=e,this.ze=new Map,this.je=vo(),this.Je=fp(),this.He=fp(),this.Ye=new Bt(Ze)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.Ke(),s.Ne||s.qe(),s.Le(e.resumeToken);break;case 2:s.Ke(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.We(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:Ce(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((s,r)=>{this.rt(r)&&t(r)})}st(e){const t=e.targetId,s=e.Ce.count,r=this.ot(t);if(r){const i=r.target;if(Hw(i))if(s===0){const o=new _e(i.path);this.et(t,o,Jn.newNoDocument(o,Fe.min()))}else ht(s===1,20013,{expectedCount:s});else{const o=this._t(t);if(o!==s){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,c)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:r=0},hashCount:i=0}=t;let o,a;try{o=Ba(s).toUint8Array()}catch(l){if(l instanceof gj)return Zu("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new qS(o,r,i)}catch(l){return Zu(l instanceof Ah?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let r=0;return s.forEach(i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),r++)}),r}Tt(e){const t=new Map;this.ze.forEach((i,o)=>{const a=this.ot(o);if(a){if(i.current&&Hw(a.target)){const l=new _e(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,Jn.newNoDocument(l,e))}i.Be&&(t.set(o,i.ke()),i.qe())}});let s=et();this.He.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.ot(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(s=s.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const r=new My(e,t,this.Ye,this.je,s);return this.je=vo(),this.Je=fp(),this.He=fp(),this.Ye=new Bt(Ze),r}Xe(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,s),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new IC,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Tn(Ze),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Tn(Ze),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||ue("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new IC),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function fp(){return new Bt(_e.comparator)}function RC(){return new Bt(_e.comparator)}const WX={asc:"ASCENDING",desc:"DESCENDING"},zX={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},qX={and:"AND",or:"OR"};class YX{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function zw(n,e){return n.useProto3Json||Iy(e)?e:{value:e}}function g0(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function qj(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function QX(n,e){return g0(n,e.toTimestamp())}function vi(n){return ht(!!n,49232),Fe.fromTimestamp(function(t){const s=$a(t);return new Pt(s.seconds,s.nanos)}(n))}function YS(n,e){return qw(n,e).canonicalString()}function qw(n,e){const t=function(r){return new _t(["projects",r.projectId,"databases",r.database])}(n).child("documents");return e===void 0?t:t.child(e)}function Yj(n){const e=_t.fromString(n);return ht(eF(e),10190,{key:e.toString()}),e}function Yw(n,e){return YS(n.databaseId,e.path)}function yx(n,e){const t=Yj(e);if(t.get(1)!==n.databaseId.projectId)throw new ce(ee.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new ce(ee.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new _e(Xj(t))}function Qj(n,e){return YS(n.databaseId,e)}function XX(n){const e=Yj(n);return e.length===4?_t.emptyPath():Xj(e)}function Qw(n){return new _t(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Xj(n){return ht(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function CC(n,e,t){return{name:Yw(n,e),fields:t.value.mapValue.fields}}function JX(n,e){let t;if("targetChange"in e){e.targetChange;const s=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:Ce(39313,{state:c})}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],i=function(c,d){return c.useProto3Json?(ht(d===void 0||typeof d=="string",58123),Gn.fromBase64String(d||"")):(ht(d===void 0||d instanceof Buffer||d instanceof Uint8Array,16193),Gn.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const d=c.code===void 0?ee.UNKNOWN:Hj(c.code);return new ce(d,c.message||"")}(o);t=new zj(s,r,i,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=yx(n,s.document.name),i=vi(s.document.updateTime),o=s.document.createTime?vi(s.document.createTime):Fe.min(),a=new bs({mapValue:{fields:s.document.fields}}),l=Jn.newFoundDocument(r,i,o,a),c=s.targetIds||[],d=s.removedTargetIds||[];t=new cg(c,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=yx(n,s.document),i=s.readTime?vi(s.readTime):Fe.min(),o=Jn.newNoDocument(r,i),a=s.removedTargetIds||[];t=new cg([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=yx(n,s.document),i=s.removedTargetIds||[];t=new cg([],i,r,null)}else{if(!("filter"in e))return Ce(11601,{Rt:e});{e.filter;const s=e.filter;s.targetId;const{count:r=0,unchangedNames:i}=s,o=new $X(r,i),a=s.targetId;t=new Wj(a,o)}}return t}function ZX(n,e){let t;if(e instanceof hm)t={update:CC(n,e.key,e.value)};else if(e instanceof WS)t={delete:Yw(n,e.key)};else if(e instanceof tl)t={update:CC(n,e.key,e.data),updateMask:lJ(e.fieldMask)};else{if(!(e instanceof FX))return Ce(16599,{Vt:e.type});t={verify:Yw(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(s=>function(i,o){const a=o.transform;if(a instanceof Pf)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof sd)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof rd)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof kf)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw Ce(20930,{transform:o.transform})}(0,s))),e.precondition.isNone||(t.currentDocument=function(r,i){return i.updateTime!==void 0?{updateTime:QX(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Ce(27497)}(n,e.precondition)),t}function eJ(n,e){return n&&n.length>0?(ht(e!==void 0,14353),n.map(t=>function(r,i){let o=r.updateTime?vi(r.updateTime):vi(i);return o.isEqual(Fe.min())&&(o=vi(i)),new MX(o,r.transformResults||[])}(t,e))):[]}function tJ(n,e){return{documents:[Qj(n,e.path)]}}function nJ(n,e){const t={structuredQuery:{}},s=e.path;let r;e.collectionGroup!==null?(r=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=Qj(n,r);const i=function(c){if(c.length!==0)return Zj(Hr.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(d=>function(f){return{field:$c(f.field),direction:iJ(f.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=zw(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{ft:t,parent:r}}function sJ(n){let e=XX(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let r=null;if(s>0){ht(s===1,65062);const d=t.from[0];d.allDescendants?r=d.collectionId:e=e.child(d.collectionId)}let i=[];t.where&&(i=function(h){const f=Jj(h);return f instanceof Hr&&Ij(f)?f.getFilters():[f]}(t.where));let o=[];t.orderBy&&(o=function(h){return h.map(f=>function(p){return new Cf(Bc(p.field),function(v){switch(v){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(p.direction))}(f))}(t.orderBy));let a=null;t.limit&&(a=function(h){let f;return f=typeof h=="object"?h.value:h,Iy(f)?null:f}(t.limit));let l=null;t.startAt&&(l=function(h){const f=!!h.before,m=h.values||[];return new m0(m,f)}(t.startAt));let c=null;return t.endAt&&(c=function(h){const f=!h.before,m=h.values||[];return new m0(m,f)}(t.endAt)),bX(e,r,o,i,a,"F",l,c)}function rJ(n,e){const t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ce(28987,{purpose:r})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Jj(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=Bc(t.unaryFilter.field);return un.create(s,"==",{doubleValue:NaN});case"IS_NULL":const r=Bc(t.unaryFilter.field);return un.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Bc(t.unaryFilter.field);return un.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Bc(t.unaryFilter.field);return un.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ce(61313);default:return Ce(60726)}}(n):n.fieldFilter!==void 0?function(t){return un.create(Bc(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ce(58110);default:return Ce(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Hr.create(t.compositeFilter.filters.map(s=>Jj(s)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return Ce(1026)}}(t.compositeFilter.op))}(n):Ce(30097,{filter:n})}function iJ(n){return WX[n]}function oJ(n){return zX[n]}function aJ(n){return qX[n]}function $c(n){return{fieldPath:n.canonicalString()}}function Bc(n){return Fn.fromServerFormat(n.fieldPath)}function Zj(n){return n instanceof un?function(t){if(t.op==="=="){if(gC(t.value))return{unaryFilter:{field:$c(t.field),op:"IS_NAN"}};if(pC(t.value))return{unaryFilter:{field:$c(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(gC(t.value))return{unaryFilter:{field:$c(t.field),op:"IS_NOT_NAN"}};if(pC(t.value))return{unaryFilter:{field:$c(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:$c(t.field),op:oJ(t.op),value:t.value}}}(n):n instanceof Hr?function(t){const s=t.getFilters().map(r=>Zj(r));return s.length===1?s[0]:{compositeFilter:{op:aJ(t.op),filters:s}}}(n):Ce(54877,{filter:n})}function lJ(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function eF(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{constructor(e,t,s,r,i=Fe.min(),o=Fe.min(),a=Gn.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new va(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new va(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new va(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new va(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cJ{constructor(e){this.yt=e}}function uJ(n){const e=sJ({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?p0(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dJ{constructor(){this.Cn=new hJ}addToCollectionParentIndex(e,t){return this.Cn.add(t),te.resolve()}getCollectionParents(e,t){return te.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return te.resolve()}deleteFieldIndex(e,t){return te.resolve()}deleteAllFieldIndexes(e){return te.resolve()}createTargetIndexes(e,t){return te.resolve()}getDocumentsMatchingTarget(e,t){return te.resolve(null)}getIndexType(e,t){return te.resolve(0)}getFieldIndexes(e,t){return te.resolve([])}getNextCollectionGroupToUpdate(e){return te.resolve(null)}getMinOffset(e,t){return te.resolve(Va.min())}getMinOffsetFromCollectionGroup(e,t){return te.resolve(Va.min())}updateCollectionGroup(e,t,s){return te.resolve()}updateIndexEntries(e,t){return te.resolve()}}class hJ{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t]||new Tn(_t.comparator),i=!r.has(s);return this.index[t]=r.add(s),i}has(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t];return r&&r.has(s)}getEntries(e){return(this.index[e]||new Tn(_t.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PC={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},tF=41943040;class ws{static withCacheSize(e){return new ws(e,ws.DEFAULT_COLLECTION_PERCENTILE,ws.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ws.DEFAULT_COLLECTION_PERCENTILE=10,ws.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ws.DEFAULT=new ws(tF,ws.DEFAULT_COLLECTION_PERCENTILE,ws.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ws.DISABLED=new ws(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class id{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new id(0)}static cr(){return new id(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kC="LruGarbageCollector",fJ=1048576;function NC([n,e],[t,s]){const r=Ze(n,t);return r===0?Ze(e,s):r}class mJ{constructor(e){this.Ir=e,this.buffer=new Tn(NC),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();NC(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class pJ{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){ue(kC,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Cd(t)?ue(kC,"Ignoring IndexedDB error during garbage collection: ",t):await Rd(t)}await this.Vr(3e5)})}}class gJ{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(s=>Math.floor(t/100*s))}nthSequenceNumber(e,t){if(t===0)return te.resolve(Ay.ce);const s=new mJ(t);return this.mr.forEachTarget(e,r=>s.Ar(r.sequenceNumber)).next(()=>this.mr.pr(e,r=>s.Ar(r))).next(()=>s.maxValue)}removeTargets(e,t,s){return this.mr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(ue("LruGarbageCollector","Garbage collection skipped; disabled"),te.resolve(PC)):this.getCacheSize(e).next(s=>s<this.params.cacheSizeCollectionThreshold?(ue("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),PC):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let s,r,i,o,a,l,c;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(ue("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),r=this.params.maximumSequenceNumbersToCollect):r=h,o=Date.now(),this.nthSequenceNumber(e,r))).next(h=>(s=h,a=Date.now(),this.removeTargets(e,s,t))).next(h=>(i=h,l=Date.now(),this.removeOrphanedDocuments(e,s))).next(h=>(c=Date.now(),Uc()<=Je.DEBUG&&ue("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${r} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${h} documents in `+(c-l)+`ms
Total Duration: ${c-d}ms`),te.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:h})))}}function yJ(n,e){return new gJ(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vJ{constructor(){this.changes=new uc(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Jn.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?te.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xJ{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EJ{constructor(e,t,s,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(s=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(s!==null&&qh(s.mutation,r,Ys.empty(),Pt.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(s=>this.getLocalViewOfDocuments(e,s,et()).next(()=>s))}getLocalViewOfDocuments(e,t,s=et()){const r=Il();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,s).next(i=>{let o=_h();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const s=Il();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,et()))}populateOverlays(e,t,s){const r=[];return s.forEach(i=>{t.has(i)||r.push(i)}),this.documentOverlayCache.getOverlays(e,r).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,s,r){let i=vo();const o=zh(),a=function(){return zh()}();return t.forEach((l,c)=>{const d=s.get(c.key);r.has(c.key)&&(d===void 0||d.mutation instanceof tl)?i=i.insert(c.key,c):d!==void 0?(o.set(c.key,d.mutation.getFieldMask()),qh(d.mutation,c,d.mutation.getFieldMask(),Pt.now())):o.set(c.key,Ys.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,d)=>o.set(c,d)),t.forEach((c,d)=>a.set(c,new xJ(d,o.get(c)??null))),a))}recalculateAndSaveOverlays(e,t){const s=zh();let r=new Bt((o,a)=>o-a),i=et();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let d=s.get(l)||Ys.empty();d=a.applyToLocalView(c,d),s.set(l,d);const h=(r.get(a.batchId)||et()).add(l);r=r.insert(a.batchId,h)})}).next(()=>{const o=[],a=r.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,d=l.value,h=Oj();d.forEach(f=>{if(!i.has(f)){const m=Gj(t.get(f),s.get(f));m!==null&&h.set(f,m),i=i.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return te.waitFor(o)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(s=>this.recalculateAndSaveOverlays(e,s))}getDocumentsMatchingQuery(e,t,s,r){return function(o){return _e.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):kj(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,r):this.getDocumentsMatchingCollectionQuery(e,t,s,r)}getNextDocuments(e,t,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,r).next(i=>{const o=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,r-i.size):te.resolve(Il());let a=_f,l=i;return o.next(c=>te.forEach(c,(d,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),i.get(d)?te.resolve():this.remoteDocumentCache.getEntry(e,d).next(f=>{l=l.insert(d,f)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,et())).next(d=>({batchId:a,changes:Mj(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new _e(t)).next(s=>{let r=_h();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,s,r){const i=t.collectionGroup;let o=_h();return this.indexManager.getCollectionParents(e,i).next(a=>te.forEach(a,l=>{const c=function(h,f){return new Pd(f,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,s,r).next(d=>{d.forEach((h,f)=>{o=o.insert(h,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,s,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,i,r))).next(o=>{i.forEach((l,c)=>{const d=c.getKey();o.get(d)===null&&(o=o.insert(d,Jn.newInvalidDocument(d)))});let a=_h();return o.forEach((l,c)=>{const d=i.get(l);d!==void 0&&qh(d.mutation,c,Ys.empty(),Pt.now()),ky(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wJ{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return te.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(r){return{id:r.id,version:r.version,createTime:vi(r.createTime)}}(t)),te.resolve()}getNamedQuery(e,t){return te.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(r){return{name:r.name,query:uJ(r.bundledQuery),readTime:vi(r.readTime)}}(t)),te.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TJ{constructor(){this.overlays=new Bt(_e.comparator),this.qr=new Map}getOverlay(e,t){return te.resolve(this.overlays.get(t))}getOverlays(e,t){const s=Il();return te.forEach(t,r=>this.getOverlay(e,r).next(i=>{i!==null&&s.set(r,i)})).next(()=>s)}saveOverlays(e,t,s){return s.forEach((r,i)=>{this.St(e,t,i)}),te.resolve()}removeOverlaysForBatchId(e,t,s){const r=this.qr.get(s);return r!==void 0&&(r.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(s)),te.resolve()}getOverlaysForCollection(e,t,s){const r=Il(),i=t.length+1,o=new _e(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>s&&r.set(l.getKey(),l)}return te.resolve(r)}getOverlaysForCollectionGroup(e,t,s,r){let i=new Bt((c,d)=>c-d);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>s){let d=i.get(c.largestBatchId);d===null&&(d=Il(),i=i.insert(c.largestBatchId,d)),d.set(c.getKey(),c)}}const a=Il(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,d)=>a.set(c,d)),!(a.size()>=r)););return te.resolve(a)}St(e,t,s){const r=this.overlays.get(s.key);if(r!==null){const o=this.qr.get(r.largestBatchId).delete(s.key);this.qr.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(s.key,new VX(t,s));let i=this.qr.get(t);i===void 0&&(i=et(),this.qr.set(t,i)),this.qr.set(t,i.add(s.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bJ{constructor(){this.sessionToken=Gn.EMPTY_BYTE_STRING}getSessionToken(e){return te.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,te.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QS{constructor(){this.Qr=new Tn(An.$r),this.Ur=new Tn(An.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const s=new An(e,t);this.Qr=this.Qr.add(s),this.Ur=this.Ur.add(s)}Wr(e,t){e.forEach(s=>this.addReference(s,t))}removeReference(e,t){this.Gr(new An(e,t))}zr(e,t){e.forEach(s=>this.removeReference(s,t))}jr(e){const t=new _e(new _t([])),s=new An(t,e),r=new An(t,e+1),i=[];return this.Ur.forEachInRange([s,r],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new _e(new _t([])),s=new An(t,e),r=new An(t,e+1);let i=et();return this.Ur.forEachInRange([s,r],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new An(e,0),s=this.Qr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class An{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return _e.comparator(e.key,t.key)||Ze(e.Yr,t.Yr)}static Kr(e,t){return Ze(e.Yr,t.Yr)||_e.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SJ{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Tn(An.$r)}checkEmpty(e){return te.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,r){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new UX(i,t,s,r);this.mutationQueue.push(o);for(const a of r)this.Zr=this.Zr.add(new An(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return te.resolve(o)}lookupMutationBatch(e,t){return te.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=this.ei(s),i=r<0?0:r;return te.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return te.resolve(this.mutationQueue.length===0?VS:this.tr-1)}getAllMutationBatches(e){return te.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new An(t,0),r=new An(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([s,r],o=>{const a=this.Xr(o.Yr);i.push(a)}),te.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new Tn(Ze);return t.forEach(r=>{const i=new An(r,0),o=new An(r,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],a=>{s=s.add(a.Yr)})}),te.resolve(this.ti(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1;let i=s;_e.isDocumentKey(i)||(i=i.child(""));const o=new An(new _e(i),0);let a=new Tn(Ze);return this.Zr.forEachWhile(l=>{const c=l.key.path;return!!s.isPrefixOf(c)&&(c.length===r&&(a=a.add(l.Yr)),!0)},o),te.resolve(this.ti(a))}ti(e){const t=[];return e.forEach(s=>{const r=this.Xr(s);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){ht(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Zr;return te.forEach(t.mutations,r=>{const i=new An(r.key,t.batchId);return s=s.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Zr=s})}ir(e){}containsKey(e,t){const s=new An(t,0),r=this.Zr.firstAfterOrEqual(s);return te.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,te.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _J{constructor(e){this.ri=e,this.docs=function(){return new Bt(_e.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,r=this.docs.get(s),i=r?r.size:0,o=this.ri(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return te.resolve(s?s.document.mutableCopy():Jn.newInvalidDocument(t))}getEntries(e,t){let s=vo();return t.forEach(r=>{const i=this.docs.get(r);s=s.insert(r,i?i.document.mutableCopy():Jn.newInvalidDocument(r))}),te.resolve(s)}getDocumentsMatchingQuery(e,t,s,r){let i=vo();const o=t.path,a=new _e(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:d}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||nX(tX(d),s)<=0||(r.has(d.key)||ky(t,d))&&(i=i.insert(d.key,d.mutableCopy()))}return te.resolve(i)}getAllFromCollectionGroup(e,t,s,r){Ce(9500)}ii(e,t){return te.forEach(this.docs,s=>t(s))}newChangeBuffer(e){return new AJ(this)}getSize(e){return te.resolve(this.size)}}class AJ extends vJ{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((s,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(s)}),te.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IJ{constructor(e){this.persistence=e,this.si=new uc(t=>GS(t),KS),this.lastRemoteSnapshotVersion=Fe.min(),this.highestTargetId=0,this.oi=0,this._i=new QS,this.targetCount=0,this.ai=id.ur()}forEachTarget(e,t){return this.si.forEach((s,r)=>t(r)),te.resolve()}getLastRemoteSnapshotVersion(e){return te.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return te.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),te.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.oi&&(this.oi=t),te.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new id(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,te.resolve()}updateTargetData(e,t){return this.Pr(t),te.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,te.resolve()}removeTargets(e,t,s){let r=0;const i=[];return this.si.forEach((o,a)=>{a.sequenceNumber<=t&&s.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),te.waitFor(i).next(()=>r)}getTargetCount(e){return te.resolve(this.targetCount)}getTargetData(e,t){const s=this.si.get(t)||null;return te.resolve(s)}addMatchingKeys(e,t,s){return this._i.Wr(t,s),te.resolve()}removeMatchingKeys(e,t,s){this._i.zr(t,s);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(o=>{i.push(r.markPotentiallyOrphaned(e,o))}),te.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),te.resolve()}getMatchingKeysForTargetId(e,t){const s=this._i.Hr(t);return te.resolve(s)}containsKey(e,t){return te.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nF{constructor(e,t){this.ui={},this.overlays={},this.ci=new Ay(0),this.li=!1,this.li=!0,this.hi=new bJ,this.referenceDelegate=e(this),this.Pi=new IJ(this),this.indexManager=new dJ,this.remoteDocumentCache=function(r){return new _J(r)}(s=>this.referenceDelegate.Ti(s)),this.serializer=new cJ(t),this.Ii=new wJ(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new TJ,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.ui[e.toKey()];return s||(s=new SJ(t,this.referenceDelegate),this.ui[e.toKey()]=s),s}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,s){ue("MemoryPersistence","Starting transaction:",e);const r=new RJ(this.ci.next());return this.referenceDelegate.Ei(),s(r).next(i=>this.referenceDelegate.di(r).next(()=>i)).toPromise().then(i=>(r.raiseOnCommittedEvent(),i))}Ai(e,t){return te.or(Object.values(this.ui).map(s=>()=>s.containsKey(e,t)))}}class RJ extends rX{constructor(e){super(),this.currentSequenceNumber=e}}class XS{constructor(e){this.persistence=e,this.Ri=new QS,this.Vi=null}static mi(e){return new XS(e)}get fi(){if(this.Vi)return this.Vi;throw Ce(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.fi.delete(s.toString()),te.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.fi.add(s.toString()),te.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),te.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(r=>this.fi.add(r.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(i=>this.fi.add(i.toString()))}).next(()=>s.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return te.forEach(this.fi,s=>{const r=_e.fromPath(s);return this.gi(e,r).next(i=>{i||t.removeEntry(r,Fe.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(s=>{s?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return te.or([()=>te.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class y0{constructor(e,t){this.persistence=e,this.pi=new uc(s=>aX(s.path),(s,r)=>s.isEqual(r)),this.garbageCollector=yJ(this,t)}static mi(e,t){return new y0(e,t)}Ei(){}di(e){return te.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(s=>t.next(r=>s+r))}wr(e){let t=0;return this.pr(e,s=>{t++}).next(()=>t)}pr(e,t){return te.forEach(this.pi,(s,r)=>this.br(e,s,r).next(i=>i?te.resolve():t(r)))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,o=>this.br(e,o,t).next(a=>{a||(s++,i.removeEntry(o,Fe.min()))})).next(()=>i.apply(e)).next(()=>s)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),te.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),te.resolve()}removeReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),te.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),te.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=og(e.data.value)),t}br(e,t,s){return te.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.pi.get(t);return te.resolve(r!==void 0&&r>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JS{constructor(e,t,s,r){this.targetId=e,this.fromCache=t,this.Es=s,this.ds=r}static As(e,t){let s=et(),r=et();for(const i of t.docChanges)switch(i.type){case 0:s=s.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new JS(e,t.fromCache,s,r)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CJ{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PJ{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return sz()?8:iX(ss())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,r){const i={result:null};return this.ys(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,t,r,s).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new CJ;return this.Ss(e,t,o).next(a=>{if(i.result=a,this.Vs)return this.bs(e,t,o,a.size)})}).next(()=>i.result)}bs(e,t,s,r){return s.documentReadCount<this.fs?(Uc()<=Je.DEBUG&&ue("QueryEngine","SDK will not create cache indexes for query:",Vc(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),te.resolve()):(Uc()<=Je.DEBUG&&ue("QueryEngine","Query:",Vc(t),"scans",s.documentReadCount,"local documents and returns",r,"documents as results."),s.documentReadCount>this.gs*r?(Uc()<=Je.DEBUG&&ue("QueryEngine","The SDK decides to create cache indexes for query:",Vc(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,yi(t))):te.resolve())}ys(e,t){if(EC(t))return te.resolve(null);let s=yi(t);return this.indexManager.getIndexType(e,s).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=p0(t,null,"F"),s=yi(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next(i=>{const o=et(...i);return this.ps.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,s).next(l=>{const c=this.Ds(t,a);return this.Cs(t,c,o,l.readTime)?this.ys(e,p0(t,null,"F")):this.vs(e,c,t,l)}))})))}ws(e,t,s,r){return EC(t)||r.isEqual(Fe.min())?te.resolve(null):this.ps.getDocuments(e,s).next(i=>{const o=this.Ds(t,i);return this.Cs(t,o,s,r)?te.resolve(null):(Uc()<=Je.DEBUG&&ue("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Vc(t)),this.vs(e,o,t,eX(r,_f)).next(a=>a))})}Ds(e,t){let s=new Tn(Lj(e));return t.forEach((r,i)=>{ky(e,i)&&(s=s.add(i))}),s}Cs(e,t,s,r){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,s){return Uc()<=Je.DEBUG&&ue("QueryEngine","Using full collection scan to execute query:",Vc(t)),this.ps.getDocumentsMatchingQuery(e,t,Va.min(),s)}vs(e,t,s,r){return this.ps.getDocumentsMatchingQuery(e,s,r).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZS="LocalStore",kJ=3e8;class NJ{constructor(e,t,s,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new Bt(Ze),this.xs=new uc(i=>GS(i),KS),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(s)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new EJ(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function LJ(n,e,t,s){return new NJ(n,e,t,s)}async function sF(n,e){const t=Ve(n);return await t.persistence.runTransaction("Handle user change","readonly",s=>{let r;return t.mutationQueue.getAllMutationBatches(s).next(i=>(r=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(s))).next(i=>{const o=[],a=[];let l=et();for(const c of r){o.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}for(const c of i){a.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(s,l).next(c=>({Ls:c,removedBatchIds:o,addedBatchIds:a}))})})}function DJ(n,e){const t=Ve(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const r=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return function(a,l,c,d){const h=c.batch,f=h.keys();let m=te.resolve();return f.forEach(p=>{m=m.next(()=>d.getEntry(l,p)).next(y=>{const v=c.docVersions.get(p);ht(v!==null,48541),y.version.compareTo(v)<0&&(h.applyToRemoteDocument(y,c),y.isValidDocument()&&(y.setReadTime(c.commitVersion),d.addEntry(y)))})}),m.next(()=>a.mutationQueue.removeMutationBatch(l,h))}(t,s,e,i).next(()=>i.apply(s)).next(()=>t.mutationQueue.performConsistencyCheck(s)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(s,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(a){let l=et();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(s,r))})}function rF(n){const e=Ve(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function MJ(n,e){const t=Ve(n),s=e.snapshotVersion;let r=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});r=t.Ms;const a=[];e.targetChanges.forEach((d,h)=>{const f=r.get(h);if(!f)return;a.push(t.Pi.removeMatchingKeys(i,d.removedDocuments,h).next(()=>t.Pi.addMatchingKeys(i,d.addedDocuments,h)));let m=f.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(h)!==null?m=m.withResumeToken(Gn.EMPTY_BYTE_STRING,Fe.min()).withLastLimboFreeSnapshotVersion(Fe.min()):d.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(d.resumeToken,s)),r=r.insert(h,m),function(y,v,x){return y.resumeToken.approximateByteSize()===0||v.snapshotVersion.toMicroseconds()-y.snapshotVersion.toMicroseconds()>=kJ?!0:x.addedDocuments.size+x.modifiedDocuments.size+x.removedDocuments.size>0}(f,m,d)&&a.push(t.Pi.updateTargetData(i,m))});let l=vo(),c=et();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,d))}),a.push(OJ(i,o,e.documentUpdates).next(d=>{l=d.ks,c=d.qs})),!s.isEqual(Fe.min())){const d=t.Pi.getLastRemoteSnapshotVersion(i).next(h=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,s));a.push(d)}return te.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.Ms=r,i))}function OJ(n,e,t){let s=et(),r=et();return t.forEach(i=>s=s.add(i)),e.getEntries(n,s).next(i=>{let o=vo();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(r=r.add(a)),l.isNoDocument()&&l.version.isEqual(Fe.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):ue(ZS,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{ks:o,qs:r}})}function jJ(n,e){const t=Ve(n);return t.persistence.runTransaction("Get next mutation batch","readonly",s=>(e===void 0&&(e=VS),t.mutationQueue.getNextMutationBatchAfterBatchId(s,e)))}function FJ(n,e){const t=Ve(n);return t.persistence.runTransaction("Allocate target","readwrite",s=>{let r;return t.Pi.getTargetData(s,e).next(i=>i?(r=i,te.resolve(r)):t.Pi.allocateTargetId(s).next(o=>(r=new va(e,o,"TargetPurposeListen",s.currentSequenceNumber),t.Pi.addTargetData(s,r).next(()=>r))))}).then(s=>{const r=t.Ms.get(s.targetId);return(r===null||s.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(s.targetId,s),t.xs.set(e,s.targetId)),s})}async function Xw(n,e,t){const s=Ve(n),r=s.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",i,o=>s.persistence.referenceDelegate.removeTarget(o,r))}catch(o){if(!Cd(o))throw o;ue(ZS,`Failed to update sequence numbers for target ${e}: ${o}`)}s.Ms=s.Ms.remove(e),s.xs.delete(r.target)}function LC(n,e,t){const s=Ve(n);let r=Fe.min(),i=et();return s.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,d){const h=Ve(l),f=h.xs.get(d);return f!==void 0?te.resolve(h.Ms.get(f)):h.Pi.getTargetData(c,d)}(s,o,yi(e)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,s.Pi.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>s.Fs.getDocumentsMatchingQuery(o,e,t?r:Fe.min(),t?i:et())).next(a=>(UJ(s,_X(e),a),{documents:a,Qs:i})))}function UJ(n,e,t){let s=n.Os.get(e)||Fe.min();t.forEach((r,i)=>{i.readTime.compareTo(s)>0&&(s=i.readTime)}),n.Os.set(e,s)}class DC{constructor(){this.activeTargetIds=kX()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class VJ{constructor(){this.Mo=new DC,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,s){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new DC,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $J{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MC="ConnectivityMonitor";class OC{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){ue(MC,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){ue(MC,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mp=null;function Jw(){return mp===null?mp=function(){return 268435456+Math.round(2147483648*Math.random())}():mp++,"0x"+mp.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vx="RestConnection",BJ={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class GJ{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${s}/databases/${r}`,this.Wo=this.databaseId.database===h0?`project_id=${s}`:`project_id=${s}&database_id=${r}`}Go(e,t,s,r,i){const o=Jw(),a=this.zo(e,t.toUriEncodedString());ue(vx,`Sending RPC '${e}' ${o}:`,a,s);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,r,i);const{host:c}=new URL(a),d=Sd(c);return this.Jo(e,a,l,s,d).then(h=>(ue(vx,`Received RPC '${e}' ${o}: `,h),h),h=>{throw Zu(vx,`RPC '${e}' ${o} failed with error: `,h,"url: ",a,"request:",s),h})}Ho(e,t,s,r,i,o){return this.Go(e,t,s,r,i)}jo(e,t,s){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Id}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((r,i)=>e[i]=r),s&&s.headers.forEach((r,i)=>e[i]=r)}zo(e,t){const s=BJ[e];return`${this.Uo}/v1/${t}:${s}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KJ{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zn="WebChannelConnection";class HJ extends GJ{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,s,r,i){const o=Jw();return new Promise((a,l)=>{const c=new ij;c.setWithCredentials(!0),c.listenOnce(oj.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case ig.NO_ERROR:const h=c.getResponseJson();ue(zn,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(h)),a(h);break;case ig.TIMEOUT:ue(zn,`RPC '${e}' ${o} timed out`),l(new ce(ee.DEADLINE_EXCEEDED,"Request time out"));break;case ig.HTTP_ERROR:const f=c.getStatus();if(ue(zn,`RPC '${e}' ${o} failed with status:`,f,"response text:",c.getResponseText()),f>0){let m=c.getResponseJson();Array.isArray(m)&&(m=m[0]);const p=m==null?void 0:m.error;if(p&&p.status&&p.message){const y=function(x){const E=x.toLowerCase().replace(/_/g,"-");return Object.values(ee).indexOf(E)>=0?E:ee.UNKNOWN}(p.status);l(new ce(y,p.message))}else l(new ce(ee.UNKNOWN,"Server responded with status "+c.getStatus()))}else l(new ce(ee.UNAVAILABLE,"Connection failed."));break;default:Ce(9055,{l_:e,streamId:o,h_:c.getLastErrorCode(),P_:c.getLastError()})}}finally{ue(zn,`RPC '${e}' ${o} completed.`)}});const d=JSON.stringify(r);ue(zn,`RPC '${e}' ${o} sending request:`,r),c.send(t,"POST",d,s,15)})}T_(e,t,s){const r=Jw(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=cj(),a=lj(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,s),l.encodeInitMessageHeaders=!0;const d=i.join("");ue(zn,`Creating RPC '${e}' stream ${r}: ${d}`,l);const h=o.createWebChannel(d,l);this.I_(h);let f=!1,m=!1;const p=new KJ({Yo:v=>{m?ue(zn,`Not sending because RPC '${e}' stream ${r} is closed:`,v):(f||(ue(zn,`Opening RPC '${e}' stream ${r} transport.`),h.open(),f=!0),ue(zn,`RPC '${e}' stream ${r} sending:`,v),h.send(v))},Zo:()=>h.close()}),y=(v,x,E)=>{v.listen(x,w=>{try{E(w)}catch(b){setTimeout(()=>{throw b},0)}})};return y(h,Sh.EventType.OPEN,()=>{m||(ue(zn,`RPC '${e}' stream ${r} transport opened.`),p.o_())}),y(h,Sh.EventType.CLOSE,()=>{m||(m=!0,ue(zn,`RPC '${e}' stream ${r} transport closed`),p.a_(),this.E_(h))}),y(h,Sh.EventType.ERROR,v=>{m||(m=!0,Zu(zn,`RPC '${e}' stream ${r} transport errored. Name:`,v.name,"Message:",v.message),p.a_(new ce(ee.UNAVAILABLE,"The operation could not be completed")))}),y(h,Sh.EventType.MESSAGE,v=>{var x;if(!m){const E=v.data[0];ht(!!E,16349);const w=E,b=(w==null?void 0:w.error)||((x=w[0])==null?void 0:x.error);if(b){ue(zn,`RPC '${e}' stream ${r} received error:`,b);const C=b.status;let D=function(I){const R=ln[I];if(R!==void 0)return Hj(R)}(C),_=b.message;D===void 0&&(D=ee.INTERNAL,_="Unknown error status: "+C+" with message "+b.message),m=!0,p.a_(new ce(D,_)),h.close()}else ue(zn,`RPC '${e}' stream ${r} received:`,E),p.u_(E)}}),y(a,aj.STAT_EVENT,v=>{v.stat===Vw.PROXY?ue(zn,`RPC '${e}' stream ${r} detected buffering proxy`):v.stat===Vw.NOPROXY&&ue(zn,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{p.__()},0),p}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function xx(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oy(n){return new YX(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iF{constructor(e,t,s=1e3,r=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=s,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),s=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-s);r>0&&ue("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jC="PersistentStream";class oF{constructor(e,t,s,r,i,o,a,l){this.Mi=e,this.S_=s,this.b_=r,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new iF(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===ee.RESOURCE_EXHAUSTED?(yo(t.toString()),yo("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===ee.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,r])=>{this.D_===t&&this.G_(s,r)},s=>{e(()=>{const r=new ce(ee.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(r)})})}G_(e,t){const s=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{s(()=>this.listener.Xo())}),this.stream.t_(()=>{s(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(r=>{s(()=>this.z_(r))}),this.stream.onMessage(r=>{s(()=>++this.F_==1?this.J_(r):this.onNext(r))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return ue(jC,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(ue(jC,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class WJ extends oF{constructor(e,t,s,r,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,r,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=JX(this.serializer,e),s=function(i){if(!("targetChange"in i))return Fe.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Fe.min():o.readTime?vi(o.readTime):Fe.min()}(e);return this.listener.H_(t,s)}Y_(e){const t={};t.database=Qw(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=Hw(l)?{documents:tJ(i,l)}:{query:nJ(i,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=qj(i,o.resumeToken);const c=zw(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(Fe.min())>0){a.readTime=g0(i,o.snapshotVersion.toTimestamp());const c=zw(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const s=rJ(this.serializer,e);s&&(t.labels=s),this.q_(t)}Z_(e){const t={};t.database=Qw(this.serializer),t.removeTarget=e,this.q_(t)}}class zJ extends oF{constructor(e,t,s,r,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,r,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return ht(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ht(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ht(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=eJ(e.writeResults,e.commitTime),s=vi(e.commitTime);return this.listener.na(s,t)}ra(){const e={};e.database=Qw(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(s=>ZX(this.serializer,s))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qJ{}class YJ extends qJ{constructor(e,t,s,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new ce(ee.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,qw(t,s),r,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===ee.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new ce(ee.UNKNOWN,i.toString())})}Ho(e,t,s,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Ho(e,qw(t,s),r,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===ee.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new ce(ee.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class QJ{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(yo(t),this.aa=!1):ue("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nc="RemoteStore";class XJ{constructor(e,t,s,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(o=>{s.enqueueAndForget(async()=>{dc(this)&&(ue(nc,"Restarting streams for network reachability change."),await async function(l){const c=Ve(l);c.Ea.add(4),await mm(c),c.Ra.set("Unknown"),c.Ea.delete(4),await jy(c)}(this))})}),this.Ra=new QJ(s,r)}}async function jy(n){if(dc(n))for(const e of n.da)await e(!0)}async function mm(n){for(const e of n.da)await e(!1)}function aF(n,e){const t=Ve(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),s1(t)?n1(t):kd(t).O_()&&t1(t,e))}function e1(n,e){const t=Ve(n),s=kd(t);t.Ia.delete(e),s.O_()&&lF(t,e),t.Ia.size===0&&(s.O_()?s.L_():dc(t)&&t.Ra.set("Unknown"))}function t1(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Fe.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}kd(n).Y_(e)}function lF(n,e){n.Va.Ue(e),kd(n).Z_(e)}function n1(n){n.Va=new HX({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),kd(n).start(),n.Ra.ua()}function s1(n){return dc(n)&&!kd(n).x_()&&n.Ia.size>0}function dc(n){return Ve(n).Ea.size===0}function cF(n){n.Va=void 0}async function JJ(n){n.Ra.set("Online")}async function ZJ(n){n.Ia.forEach((e,t)=>{t1(n,e)})}async function eZ(n,e){cF(n),s1(n)?(n.Ra.ha(e),n1(n)):n.Ra.set("Unknown")}async function tZ(n,e,t){if(n.Ra.set("Online"),e instanceof zj&&e.state===2&&e.cause)try{await async function(r,i){const o=i.cause;for(const a of i.targetIds)r.Ia.has(a)&&(await r.remoteSyncer.rejectListen(a,o),r.Ia.delete(a),r.Va.removeTarget(a))}(n,e)}catch(s){ue(nc,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await v0(n,s)}else if(e instanceof cg?n.Va.Ze(e):e instanceof Wj?n.Va.st(e):n.Va.tt(e),!t.isEqual(Fe.min()))try{const s=await rF(n.localStore);t.compareTo(s)>=0&&await function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const d=i.Ia.get(c);d&&i.Ia.set(c,d.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const d=i.Ia.get(l);if(!d)return;i.Ia.set(l,d.withResumeToken(Gn.EMPTY_BYTE_STRING,d.snapshotVersion)),lF(i,l);const h=new va(d.target,l,c,d.sequenceNumber);t1(i,h)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(s){ue(nc,"Failed to raise snapshot:",s),await v0(n,s)}}async function v0(n,e,t){if(!Cd(e))throw e;n.Ea.add(1),await mm(n),n.Ra.set("Offline"),t||(t=()=>rF(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{ue(nc,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await jy(n)})}function uF(n,e){return e().catch(t=>v0(n,t,e))}async function Fy(n){const e=Ve(n),t=Ka(e);let s=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:VS;for(;nZ(e);)try{const r=await jJ(e.localStore,s);if(r===null){e.Ta.length===0&&t.L_();break}s=r.batchId,sZ(e,r)}catch(r){await v0(e,r)}dF(e)&&hF(e)}function nZ(n){return dc(n)&&n.Ta.length<10}function sZ(n,e){n.Ta.push(e);const t=Ka(n);t.O_()&&t.X_&&t.ea(e.mutations)}function dF(n){return dc(n)&&!Ka(n).x_()&&n.Ta.length>0}function hF(n){Ka(n).start()}async function rZ(n){Ka(n).ra()}async function iZ(n){const e=Ka(n);for(const t of n.Ta)e.ea(t.mutations)}async function oZ(n,e,t){const s=n.Ta.shift(),r=zS.from(s,e,t);await uF(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),await Fy(n)}async function aZ(n,e){e&&Ka(n).X_&&await async function(s,r){if(function(o){return BX(o)&&o!==ee.ABORTED}(r.code)){const i=s.Ta.shift();Ka(s).B_(),await uF(s,()=>s.remoteSyncer.rejectFailedWrite(i.batchId,r)),await Fy(s)}}(n,e),dF(n)&&hF(n)}async function FC(n,e){const t=Ve(n);t.asyncQueue.verifyOperationInProgress(),ue(nc,"RemoteStore received new credentials");const s=dc(t);t.Ea.add(3),await mm(t),s&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await jy(t)}async function lZ(n,e){const t=Ve(n);e?(t.Ea.delete(2),await jy(t)):e||(t.Ea.add(2),await mm(t),t.Ra.set("Unknown"))}function kd(n){return n.ma||(n.ma=function(t,s,r){const i=Ve(t);return i.sa(),new WJ(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(n.datastore,n.asyncQueue,{Xo:JJ.bind(null,n),t_:ZJ.bind(null,n),r_:eZ.bind(null,n),H_:tZ.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),s1(n)?n1(n):n.Ra.set("Unknown")):(await n.ma.stop(),cF(n))})),n.ma}function Ka(n){return n.fa||(n.fa=function(t,s,r){const i=Ve(t);return i.sa(),new zJ(s,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:rZ.bind(null,n),r_:aZ.bind(null,n),ta:iZ.bind(null,n),na:oZ.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await Fy(n)):(await n.fa.stop(),n.Ta.length>0&&(ue(nc,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r1{constructor(e,t,s,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=r,this.removalCallback=i,this.deferred=new to,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,r,i){const o=Date.now()+s,a=new r1(e,t,o,r,i);return a.start(s),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ce(ee.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function i1(n,e){if(yo("AsyncQueue",`${e}: ${n}`),Cd(n))return new ce(ee.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tu{static emptySet(e){return new Tu(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||_e.comparator(t.key,s.key):(t,s)=>_e.comparator(t.key,s.key),this.keyedMap=_h(),this.sortedSet=new Bt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,s)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Tu)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=s.getNext().key;if(!r.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new Tu;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UC{constructor(){this.ga=new Bt(_e.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?e.type!==0&&s.type===3?this.ga=this.ga.insert(t,e):e.type===3&&s.type!==1?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.ga=this.ga.remove(t):e.type===1&&s.type===2?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Ce(63341,{Rt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,s)=>{e.push(s)}),e}}class od{constructor(e,t,s,r,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,s,r,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new od(e,t,Tu.emptySet(t),o,s,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Py(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==s[r].type||!t[r].doc.isEqual(s[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cZ{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class uZ{constructor(){this.queries=VC(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,s){const r=Ve(t),i=r.queries;r.queries=VC(),i.forEach((o,a)=>{for(const l of a.Sa)l.onError(s)})})(this,new ce(ee.ABORTED,"Firestore shutting down"))}}function VC(){return new uc(n=>Nj(n),Py)}async function o1(n,e){const t=Ve(n);let s=3;const r=e.query;let i=t.queries.get(r);i?!i.ba()&&e.Da()&&(s=2):(i=new cZ,s=e.Da()?0:1);try{switch(s){case 0:i.wa=await t.onListen(r,!0);break;case 1:i.wa=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(o){const a=i1(o,`Initialization of query '${Vc(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&l1(t)}async function a1(n,e){const t=Ve(n),s=e.query;let r=3;const i=t.queries.get(s);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?r=e.Da()?0:1:!i.ba()&&e.Da()&&(r=2))}switch(r){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function dZ(n,e){const t=Ve(n);let s=!1;for(const r of e){const i=r.query,o=t.queries.get(i);if(o){for(const a of o.Sa)a.Fa(r)&&(s=!0);o.wa=r}}s&&l1(t)}function hZ(n,e,t){const s=Ve(n),r=s.queries.get(e);if(r)for(const i of r.Sa)i.onError(t);s.queries.delete(e)}function l1(n){n.Ca.forEach(e=>{e.next()})}var Zw,$C;($C=Zw||(Zw={})).Ma="default",$C.Cache="cache";class c1{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const s=[];for(const r of e.docChanges)r.type!==3&&s.push(r);e=new od(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const s=t!=="Offline";return(!this.options.qa||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=od.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Zw.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fF{constructor(e){this.key=e}}class mF{constructor(e){this.key=e}}class fZ{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=et(),this.mutatedKeys=et(),this.eu=Lj(e),this.tu=new Tu(this.eu)}get nu(){return this.Ya}ru(e,t){const s=t?t.iu:new UC,r=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=r,a=!1;const l=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,c=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((d,h)=>{const f=r.get(d),m=ky(this.query,h)?h:null,p=!!f&&this.mutatedKeys.has(f.key),y=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations);let v=!1;f&&m?f.data.isEqual(m.data)?p!==y&&(s.track({type:3,doc:m}),v=!0):this.su(f,m)||(s.track({type:2,doc:m}),v=!0,(l&&this.eu(m,l)>0||c&&this.eu(m,c)<0)&&(a=!0)):!f&&m?(s.track({type:0,doc:m}),v=!0):f&&!m&&(s.track({type:1,doc:f}),v=!0,(l||c)&&(a=!0)),v&&(m?(o=o.add(m),i=y?i.add(d):i.delete(d)):(o=o.delete(d),i=i.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),i=i.delete(d.key),s.track({type:1,doc:d})}return{tu:o,iu:s,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,r){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((d,h)=>function(m,p){const y=v=>{switch(v){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ce(20277,{Rt:v})}};return y(m)-y(p)}(d.type,h.type)||this.eu(d.doc,h.doc)),this.ou(s),r=r??!1;const a=t&&!r?this._u():[],l=this.Xa.size===0&&this.current&&!r?1:0,c=l!==this.Za;return this.Za=l,o.length!==0||c?{snapshot:new od(this.query,e.tu,i,o,e.mutatedKeys,l===0,c,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new UC,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=et(),this.tu.forEach(s=>{this.uu(s.key)&&(this.Xa=this.Xa.add(s.key))});const t=[];return e.forEach(s=>{this.Xa.has(s)||t.push(new mF(s))}),this.Xa.forEach(s=>{e.has(s)||t.push(new fF(s))}),t}cu(e){this.Ya=e.Qs,this.Xa=et();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return od.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const u1="SyncEngine";class mZ{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class pZ{constructor(e){this.key=e,this.hu=!1}}class gZ{constructor(e,t,s,r,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new uc(a=>Nj(a),Py),this.Iu=new Map,this.Eu=new Set,this.du=new Bt(_e.comparator),this.Au=new Map,this.Ru=new QS,this.Vu={},this.mu=new Map,this.fu=id.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function yZ(n,e,t=!0){const s=EF(n);let r;const i=s.Tu.get(e);return i?(s.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.lu()):r=await pF(s,e,t,!0),r}async function vZ(n,e){const t=EF(n);await pF(t,e,!0,!1)}async function pF(n,e,t,s){const r=await FJ(n.localStore,yi(e)),i=r.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return s&&(a=await xZ(n,e,i,o==="current",r.resumeToken)),n.isPrimaryClient&&t&&aF(n.remoteStore,r),a}async function xZ(n,e,t,s,r){n.pu=(h,f,m)=>async function(y,v,x,E){let w=v.view.ru(x);w.Cs&&(w=await LC(y.localStore,v.query,!1).then(({documents:_})=>v.view.ru(_,w)));const b=E&&E.targetChanges.get(v.targetId),C=E&&E.targetMismatches.get(v.targetId)!=null,D=v.view.applyChanges(w,y.isPrimaryClient,b,C);return GC(y,v.targetId,D.au),D.snapshot}(n,h,f,m);const i=await LC(n.localStore,e,!0),o=new fZ(e,i.Qs),a=o.ru(i.documents),l=fm.createSynthesizedTargetChangeForCurrentChange(t,s&&n.onlineState!=="Offline",r),c=o.applyChanges(a,n.isPrimaryClient,l);GC(n,t,c.au);const d=new mZ(e,t,o);return n.Tu.set(e,d),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),c.snapshot}async function EZ(n,e,t){const s=Ve(n),r=s.Tu.get(e),i=s.Iu.get(r.targetId);if(i.length>1)return s.Iu.set(r.targetId,i.filter(o=>!Py(o,e))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||await Xw(s.localStore,r.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(r.targetId),t&&e1(s.remoteStore,r.targetId),eT(s,r.targetId)}).catch(Rd)):(eT(s,r.targetId),await Xw(s.localStore,r.targetId,!0))}async function wZ(n,e){const t=Ve(n),s=t.Tu.get(e),r=t.Iu.get(s.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),e1(t.remoteStore,s.targetId))}async function TZ(n,e,t){const s=CZ(n);try{const r=await function(o,a){const l=Ve(o),c=Pt.now(),d=a.reduce((m,p)=>m.add(p.key),et());let h,f;return l.persistence.runTransaction("Locally write mutations","readwrite",m=>{let p=vo(),y=et();return l.Ns.getEntries(m,d).next(v=>{p=v,p.forEach((x,E)=>{E.isValidDocument()||(y=y.add(x))})}).next(()=>l.localDocuments.getOverlayedDocuments(m,p)).next(v=>{h=v;const x=[];for(const E of a){const w=jX(E,h.get(E.key).overlayedDocument);w!=null&&x.push(new tl(E.key,w,Sj(w.value.mapValue),pr.exists(!0)))}return l.mutationQueue.addMutationBatch(m,c,x,a)}).next(v=>{f=v;const x=v.applyToLocalDocumentSet(h,y);return l.documentOverlayCache.saveOverlays(m,v.batchId,x)})}).then(()=>({batchId:f.batchId,changes:Mj(h)}))}(s.localStore,e);s.sharedClientState.addPendingMutation(r.batchId),function(o,a,l){let c=o.Vu[o.currentUser.toKey()];c||(c=new Bt(Ze)),c=c.insert(a,l),o.Vu[o.currentUser.toKey()]=c}(s,r.batchId,t),await pm(s,r.changes),await Fy(s.remoteStore)}catch(r){const i=i1(r,"Failed to persist write");t.reject(i)}}async function gF(n,e){const t=Ve(n);try{const s=await MJ(t.localStore,e);e.targetChanges.forEach((r,i)=>{const o=t.Au.get(i);o&&(ht(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?o.hu=!0:r.modifiedDocuments.size>0?ht(o.hu,14607):r.removedDocuments.size>0&&(ht(o.hu,42227),o.hu=!1))}),await pm(t,s,e)}catch(s){await Rd(s)}}function BC(n,e,t){const s=Ve(n);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const r=[];s.Tu.forEach((i,o)=>{const a=o.view.va(e);a.snapshot&&r.push(a.snapshot)}),function(o,a){const l=Ve(o);l.onlineState=a;let c=!1;l.queries.forEach((d,h)=>{for(const f of h.Sa)f.va(a)&&(c=!0)}),c&&l1(l)}(s.eventManager,e),r.length&&s.Pu.H_(r),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function bZ(n,e,t){const s=Ve(n);s.sharedClientState.updateQueryState(e,"rejected",t);const r=s.Au.get(e),i=r&&r.key;if(i){let o=new Bt(_e.comparator);o=o.insert(i,Jn.newNoDocument(i,Fe.min()));const a=et().add(i),l=new My(Fe.min(),new Map,new Bt(Ze),o,a);await gF(s,l),s.du=s.du.remove(i),s.Au.delete(e),d1(s)}else await Xw(s.localStore,e,!1).then(()=>eT(s,e,t)).catch(Rd)}async function SZ(n,e){const t=Ve(n),s=e.batch.batchId;try{const r=await DJ(t.localStore,e);vF(t,s,null),yF(t,s),t.sharedClientState.updateMutationState(s,"acknowledged"),await pm(t,r)}catch(r){await Rd(r)}}async function _Z(n,e,t){const s=Ve(n);try{const r=await function(o,a){const l=Ve(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let d;return l.mutationQueue.lookupMutationBatch(c,a).next(h=>(ht(h!==null,37113),d=h.keys(),l.mutationQueue.removeMutationBatch(c,h))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,d,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,d)).next(()=>l.localDocuments.getDocuments(c,d))})}(s.localStore,e);vF(s,e,t),yF(s,e),s.sharedClientState.updateMutationState(e,"rejected",t),await pm(s,r)}catch(r){await Rd(r)}}function yF(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function vF(n,e,t){const s=Ve(n);let r=s.Vu[s.currentUser.toKey()];if(r){const i=r.get(e);i&&(t?i.reject(t):i.resolve(),r=r.remove(e)),s.Vu[s.currentUser.toKey()]=r}}function eT(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Iu.get(e))n.Tu.delete(s),t&&n.Pu.yu(s,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(s=>{n.Ru.containsKey(s)||xF(n,s)})}function xF(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(e1(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),d1(n))}function GC(n,e,t){for(const s of t)s instanceof fF?(n.Ru.addReference(s.key,e),AZ(n,s)):s instanceof mF?(ue(u1,"Document no longer in limbo: "+s.key),n.Ru.removeReference(s.key,e),n.Ru.containsKey(s.key)||xF(n,s.key)):Ce(19791,{wu:s})}function AZ(n,e){const t=e.key,s=t.path.canonicalString();n.du.get(t)||n.Eu.has(s)||(ue(u1,"New document in limbo: "+t),n.Eu.add(s),d1(n))}function d1(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new _e(_t.fromString(e)),s=n.fu.next();n.Au.set(s,new pZ(t)),n.du=n.du.insert(t,s),aF(n.remoteStore,new va(yi(Cy(t.path)),s,"TargetPurposeLimboResolution",Ay.ce))}}async function pm(n,e,t){const s=Ve(n),r=[],i=[],o=[];s.Tu.isEmpty()||(s.Tu.forEach((a,l)=>{o.push(s.pu(l,e,t).then(c=>{var d;if((c||t)&&s.isPrimaryClient){const h=c?!c.fromCache:(d=t==null?void 0:t.targetChanges.get(l.targetId))==null?void 0:d.current;s.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(c){r.push(c);const h=JS.As(l.targetId,c);i.push(h)}}))}),await Promise.all(o),s.Pu.H_(r),await async function(l,c){const d=Ve(l);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>te.forEach(c,f=>te.forEach(f.Es,m=>d.persistence.referenceDelegate.addReference(h,f.targetId,m)).next(()=>te.forEach(f.ds,m=>d.persistence.referenceDelegate.removeReference(h,f.targetId,m)))))}catch(h){if(!Cd(h))throw h;ue(ZS,"Failed to update sequence numbers: "+h)}for(const h of c){const f=h.targetId;if(!h.fromCache){const m=d.Ms.get(f),p=m.snapshotVersion,y=m.withLastLimboFreeSnapshotVersion(p);d.Ms=d.Ms.insert(f,y)}}}(s.localStore,i))}async function IZ(n,e){const t=Ve(n);if(!t.currentUser.isEqual(e)){ue(u1,"User change. New user:",e.toKey());const s=await sF(t.localStore,e);t.currentUser=e,function(i,o){i.mu.forEach(a=>{a.forEach(l=>{l.reject(new ce(ee.CANCELLED,o))})}),i.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await pm(t,s.Ls)}}function RZ(n,e){const t=Ve(n),s=t.Au.get(e);if(s&&s.hu)return et().add(s.key);{let r=et();const i=t.Iu.get(e);if(!i)return r;for(const o of i){const a=t.Tu.get(o);r=r.unionWith(a.view.nu)}return r}}function EF(n){const e=Ve(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=gF.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=RZ.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=bZ.bind(null,e),e.Pu.H_=dZ.bind(null,e.eventManager),e.Pu.yu=hZ.bind(null,e.eventManager),e}function CZ(n){const e=Ve(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=SZ.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=_Z.bind(null,e),e}class x0{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Oy(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return LJ(this.persistence,new PJ,e.initialUser,this.serializer)}Cu(e){return new nF(XS.mi,this.serializer)}Du(e){return new VJ}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}x0.provider={build:()=>new x0};class PZ extends x0{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ht(this.persistence.referenceDelegate instanceof y0,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new pJ(s,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?ws.withCacheSize(this.cacheSizeBytes):ws.DEFAULT;return new nF(s=>y0.mi(s,t),this.serializer)}}class tT{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>BC(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=IZ.bind(null,this.syncEngine),await lZ(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new uZ}()}createDatastore(e){const t=Oy(e.databaseInfo.databaseId),s=function(i){return new HJ(i)}(e.databaseInfo);return function(i,o,a,l){return new YJ(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return function(s,r,i,o,a){return new XJ(s,r,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>BC(this.syncEngine,t,0),function(){return OC.v()?new OC:new $J}())}createSyncEngine(e,t){return function(r,i,o,a,l,c,d){const h=new gZ(r,i,o,a,l,c);return d&&(h.gu=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(r){const i=Ve(r);ue(nc,"RemoteStore shutting down."),i.Ea.add(5),await mm(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}tT.provider={build:()=>new tT};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h1{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):yo("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ha="FirestoreClient";class kZ{constructor(e,t,s,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=r,this.user=Qn.UNAUTHENTICATED,this.clientId=US.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(s,async o=>{ue(Ha,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(s,o=>(ue(Ha,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new to;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=i1(t,"Failed to shutdown persistence");e.reject(s)}}),e.promise}}async function Ex(n,e){n.asyncQueue.verifyOperationInProgress(),ue(Ha,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener(async r=>{s.isEqual(r)||(await sF(e.localStore,r),s=r)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function KC(n,e){n.asyncQueue.verifyOperationInProgress();const t=await NZ(n);ue(Ha,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(s=>FC(e.remoteStore,s)),n.setAppCheckTokenChangeListener((s,r)=>FC(e.remoteStore,r)),n._onlineComponents=e}async function NZ(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){ue(Ha,"Using user provided OfflineComponentProvider");try{await Ex(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(r){return r.name==="FirebaseError"?r.code===ee.FAILED_PRECONDITION||r.code===ee.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(t))throw t;Zu("Error using user provided cache. Falling back to memory cache: "+t),await Ex(n,new x0)}}else ue(Ha,"Using default OfflineComponentProvider"),await Ex(n,new PZ(void 0));return n._offlineComponents}async function wF(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(ue(Ha,"Using user provided OnlineComponentProvider"),await KC(n,n._uninitializedComponentsProvider._online)):(ue(Ha,"Using default OnlineComponentProvider"),await KC(n,new tT))),n._onlineComponents}function LZ(n){return wF(n).then(e=>e.syncEngine)}async function E0(n){const e=await wF(n),t=e.eventManager;return t.onListen=yZ.bind(null,e.syncEngine),t.onUnlisten=EZ.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=vZ.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=wZ.bind(null,e.syncEngine),t}function DZ(n,e,t={}){const s=new to;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new h1({next:f=>{d.Nu(),o.enqueueAndForget(()=>a1(i,h));const m=f.docs.has(a);!m&&f.fromCache?c.reject(new ce(ee.UNAVAILABLE,"Failed to get document because the client is offline.")):m&&f.fromCache&&l&&l.source==="server"?c.reject(new ce(ee.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(f)},error:f=>c.reject(f)}),h=new c1(Cy(a.path),d,{includeMetadataChanges:!0,qa:!0});return o1(i,h)}(await E0(n),n.asyncQueue,e,t,s)),s.promise}function MZ(n,e,t={}){const s=new to;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new h1({next:f=>{d.Nu(),o.enqueueAndForget(()=>a1(i,h)),f.fromCache&&l.source==="server"?c.reject(new ce(ee.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(f)},error:f=>c.reject(f)}),h=new c1(a,d,{includeMetadataChanges:!0,qa:!0});return o1(i,h)}(await E0(n),n.asyncQueue,e,t,s)),s.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TF(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HC=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bF="firestore.googleapis.com",WC=!0;class zC{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new ce(ee.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=bF,this.ssl=WC}else this.host=e.host,this.ssl=e.ssl??WC;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=tF;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<fJ)throw new ce(ee.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}JQ("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=TF(e.experimentalLongPollingOptions??{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new ce(ee.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new ce(ee.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new ce(ee.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(s,r){return s.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Uy{constructor(e,t,s,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new zC({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ce(ee.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ce(ee.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new zC(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new BQ;switch(s.type){case"firstParty":return new WQ(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new ce(ee.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const s=HC.get(t);s&&(ue("ComponentProvider","Removing Datastore"),HC.delete(t),s.terminate())}(this),Promise.resolve()}}function OZ(n,e,t,s={}){var c;n=Cs(n,Uy);const r=Sd(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;r&&(yO(`https://${a}`),vO("Firestore",!0)),i.host!==bF&&i.host!==a&&Zu("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:a,ssl:r,emulatorOptions:s};if(!mo(l,o)&&(n._setSettings(l),s.mockUserToken)){let d,h;if(typeof s.mockUserToken=="string")d=s.mockUserToken,h=Qn.MOCK_USER;else{d=qW(s.mockUserToken,(c=n._app)==null?void 0:c.options.projectId);const f=s.mockUserToken.sub||s.mockUserToken.user_id;if(!f)throw new ce(ee.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new Qn(f)}n._authCredentials=new GQ(new dj(d,h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ao{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new Ao(this.firestore,e,this._query)}}class Xt{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ka(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Xt(this.firestore,e,this._key)}toJSON(){return{type:Xt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(dm(t,Xt._jsonSchema))return new Xt(e,s||null,new _e(_t.fromString(t.referencePath)))}}Xt._jsonSchemaVersion="firestore/documentReference/1.0",Xt._jsonSchema={type:dn("string",Xt._jsonSchemaVersion),referencePath:dn("string")};class ka extends Ao{constructor(e,t,s){super(e,t,Cy(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Xt(this.firestore,null,new _e(e))}withConverter(e){return new ka(this.firestore,e,this._path)}}function ut(n,e,...t){if(n=fn(n),hj("collection","path",e),n instanceof Uy){const s=_t.fromString(e,...t);return oC(s),new ka(n,null,s)}{if(!(n instanceof Xt||n instanceof ka))throw new ce(ee.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(_t.fromString(e,...t));return oC(s),new ka(n.firestore,null,s)}}function ot(n,e,...t){if(n=fn(n),arguments.length===1&&(e=US.newId()),hj("doc","path",e),n instanceof Uy){const s=_t.fromString(e,...t);return iC(s),new Xt(n,null,new _e(s))}{if(!(n instanceof Xt||n instanceof ka))throw new ce(ee.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(_t.fromString(e,...t));return iC(s),new Xt(n.firestore,n instanceof ka?n.converter:null,new _e(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qC="AsyncQueue";class YC{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new iF(this,"async_queue_retry"),this._c=()=>{const s=xx();s&&ue(qC,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;const t=xx();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=xx();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new to;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Cd(e))throw e;ue(qC,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(s=>{throw this.nc=s,this.rc=!1,yo("INTERNAL UNHANDLED ERROR: ",QC(s)),s}).then(s=>(this.rc=!1,s))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=r1.createAndSchedule(this,e,t,s,i=>this.hc(i));return this.tc.push(r),r}uc(){this.nc&&Ce(47125,{Pc:QC(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,s)=>t.targetTimeMs-s.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function QC(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XC(n){return function(t,s){if(typeof t!="object"||t===null)return!1;const r=t;for(const i of s)if(i in r&&typeof r[i]=="function")return!0;return!1}(n,["next","error","complete"])}class xo extends Uy{constructor(e,t,s,r){super(e,t,s,r),this.type="firestore",this._queue=new YC,this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new YC(e),this._firestoreClient=void 0,await e}}}function jZ(n,e){const t=typeof n=="object"?n:TO(),s=typeof n=="string"?n:h0,r=IS(t,"firestore").getImmediate({identifier:s});if(!r._initialized){const i=WW("firestore");i&&OZ(r,...i)}return r}function Vy(n){if(n._terminated)throw new ce(ee.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||FZ(n),n._firestoreClient}function FZ(n){var s,r,i;const e=n._freezeSettings(),t=function(a,l,c,d){return new uX(a,l,c,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,TF(d.experimentalLongPollingOptions),d.useFetchStreams,d.isUsingEmulator)}(n._databaseId,((s=n._app)==null?void 0:s.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(r=e.localCache)!=null&&r._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new kZ(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new dr(Gn.fromBase64String(e))}catch(t){throw new ce(ee.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new dr(Gn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:dr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(dm(e,dr._jsonSchema))return dr.fromBase64String(e.bytes)}}dr._jsonSchemaVersion="firestore/bytes/1.0",dr._jsonSchema={type:dn("string",dr._jsonSchemaVersion),bytes:dn("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $y{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new ce(ee.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Fn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hc{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xi{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ce(ee.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ce(ee.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ze(this._lat,e._lat)||Ze(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:xi._jsonSchemaVersion}}static fromJSON(e){if(dm(e,xi._jsonSchema))return new xi(e.latitude,e.longitude)}}xi._jsonSchemaVersion="firestore/geoPoint/1.0",xi._jsonSchema={type:dn("string",xi._jsonSchemaVersion),latitude:dn("number"),longitude:dn("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ei{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(s,r){if(s.length!==r.length)return!1;for(let i=0;i<s.length;++i)if(s[i]!==r[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Ei._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(dm(e,Ei._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new Ei(e.vectorValues);throw new ce(ee.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ei._jsonSchemaVersion="firestore/vectorValue/1.0",Ei._jsonSchema={type:dn("string",Ei._jsonSchemaVersion),vectorValues:dn("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UZ=/^__.*__$/;class VZ{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return this.fieldMask!==null?new tl(e,this.data,this.fieldMask,t,this.fieldTransforms):new hm(e,this.data,t,this.fieldTransforms)}}class SF{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return new tl(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function _F(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ce(40011,{Ac:n})}}class By{constructor(e,t,s,r,i,o){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=r,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new By({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var r;const t=(r=this.path)==null?void 0:r.child(e),s=this.Vc({path:t,fc:!1});return s.gc(e),s}yc(e){var r;const t=(r=this.path)==null?void 0:r.child(e),s=this.Vc({path:t,fc:!1});return s.Rc(),s}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return w0(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(_F(this.Ac)&&UZ.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class $Z{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||Oy(e)}Cc(e,t,s,r=!1){return new By({Ac:e,methodName:t,Dc:s,path:Fn.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Gy(n){const e=n._freezeSettings(),t=Oy(n._databaseId);return new $Z(n._databaseId,!!e.ignoreUndefinedProperties,t)}function AF(n,e,t,s,r,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,r);y1("Data must be an object, but it was:",o,s);const a=RF(s,o);let l,c;if(i.merge)l=new Ys(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const d=[];for(const h of i.mergeFields){const f=nT(e,h,t);if(!o.contains(f))throw new ce(ee.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);PF(d,f)||d.push(f)}l=new Ys(d),c=o.fieldTransforms.filter(h=>l.covers(h.field))}else l=null,c=o.fieldTransforms;return new VZ(new bs(a),l,c)}class Ky extends hc{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ky}}function IF(n,e,t){return new By({Ac:3,Dc:e.settings.Dc,methodName:n._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class f1 extends hc{_toFieldTransform(e){return new Ly(e.path,new Pf)}isEqual(e){return e instanceof f1}}class m1 extends hc{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=IF(this,e,!0),s=this.vc.map(i=>fc(i,t)),r=new sd(s);return new Ly(e.path,r)}isEqual(e){return e instanceof m1&&mo(this.vc,e.vc)}}class p1 extends hc{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=IF(this,e,!0),s=this.vc.map(i=>fc(i,t)),r=new rd(s);return new Ly(e.path,r)}isEqual(e){return e instanceof p1&&mo(this.vc,e.vc)}}class g1 extends hc{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new kf(e.serializer,Fj(e.serializer,this.Fc));return new Ly(e.path,t)}isEqual(e){return e instanceof g1&&this.Fc===e.Fc}}function BZ(n,e,t,s){const r=n.Cc(1,e,t);y1("Data must be an object, but it was:",r,s);const i=[],o=bs.empty();el(s,(l,c)=>{const d=v1(e,l,t);c=fn(c);const h=r.yc(d);if(c instanceof Ky)i.push(d);else{const f=fc(c,h);f!=null&&(i.push(d),o.set(d,f))}});const a=new Ys(i);return new SF(o,a,r.fieldTransforms)}function GZ(n,e,t,s,r,i){const o=n.Cc(1,e,t),a=[nT(e,s,t)],l=[r];if(i.length%2!=0)throw new ce(ee.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<i.length;f+=2)a.push(nT(e,i[f])),l.push(i[f+1]);const c=[],d=bs.empty();for(let f=a.length-1;f>=0;--f)if(!PF(c,a[f])){const m=a[f];let p=l[f];p=fn(p);const y=o.yc(m);if(p instanceof Ky)c.push(m);else{const v=fc(p,y);v!=null&&(c.push(m),d.set(m,v))}}const h=new Ys(c);return new SF(d,h,o.fieldTransforms)}function KZ(n,e,t,s=!1){return fc(t,n.Cc(s?4:3,e))}function fc(n,e){if(CF(n=fn(n)))return y1("Unsupported field value:",e,n),RF(n,e);if(n instanceof hc)return function(s,r){if(!_F(r.Ac))throw r.Sc(`${s._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Sc(`${s._methodName}() is not currently supported inside arrays`);const i=s._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(s,r){const i=[];let o=0;for(const a of s){let l=fc(a,r.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(s,r){if((s=fn(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return Fj(r.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const i=Pt.fromDate(s);return{timestampValue:g0(r.serializer,i)}}if(s instanceof Pt){const i=new Pt(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:g0(r.serializer,i)}}if(s instanceof xi)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof dr)return{bytesValue:qj(r.serializer,s._byteString)};if(s instanceof Xt){const i=r.databaseId,o=s.firestore._databaseId;if(!o.isEqual(i))throw r.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:YS(s.firestore._databaseId||r.databaseId,s._key.path)}}if(s instanceof Ei)return function(o,a){return{mapValue:{fields:{[wj]:{stringValue:bj},[f0]:{arrayValue:{values:o.toArray().map(c=>{if(typeof c!="number")throw a.Sc("VectorValues must only contain numeric values.");return HS(a.serializer,c)})}}}}}}(s,r);throw r.Sc(`Unsupported field value: ${_y(s)}`)}(n,e)}function RF(n,e){const t={};return pj(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):el(n,(s,r)=>{const i=fc(r,e.mc(s));i!=null&&(t[s]=i)}),{mapValue:{fields:t}}}function CF(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Pt||n instanceof xi||n instanceof dr||n instanceof Xt||n instanceof hc||n instanceof Ei)}function y1(n,e,t){if(!CF(t)||!fj(t)){const s=_y(t);throw s==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+s)}}function nT(n,e,t){if((e=fn(e))instanceof $y)return e._internalPath;if(typeof e=="string")return v1(n,e);throw w0("Field path arguments must be of type string or ",n,!1,void 0,t)}const HZ=new RegExp("[~\\*/\\[\\]]");function v1(n,e,t){if(e.search(HZ)>=0)throw w0(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new $y(...e.split("."))._internalPath}catch{throw w0(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function w0(n,e,t,s,r){const i=s&&!s.isEmpty(),o=r!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${s}`),o&&(l+=` in document ${r}`),l+=")"),new ce(ee.INVALID_ARGUMENT,a+n+l)}function PF(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kF{constructor(e,t,s,r,i){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Xt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new WZ(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Hy("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class WZ extends kF{data(){return super.data()}}function Hy(n,e){return typeof e=="string"?v1(n,e):e instanceof $y?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NF(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new ce(ee.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class x1{}class E1 extends x1{}function us(n,e,...t){let s=[];e instanceof x1&&s.push(e),s=s.concat(t),function(i){const o=i.filter(l=>l instanceof w1).length,a=i.filter(l=>l instanceof Wy).length;if(o>1||o>0&&a>0)throw new ce(ee.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const r of s)n=r._apply(n);return n}class Wy extends E1{constructor(e,t,s){super(),this._field=e,this._op=t,this._value=s,this.type="where"}static _create(e,t,s){return new Wy(e,t,s)}_apply(e){const t=this._parse(e);return LF(e._query,t),new Ao(e.firestore,e.converter,Ww(e._query,t))}_parse(e){const t=Gy(e.firestore);return function(i,o,a,l,c,d,h){let f;if(c.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new ce(ee.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){ZC(h,d);const p=[];for(const y of h)p.push(JC(l,i,y));f={arrayValue:{values:p}}}else f=JC(l,i,h)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||ZC(h,d),f=KZ(a,o,h,d==="in"||d==="not-in");return un.create(c,d,f)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function nu(n,e,t){const s=e,r=Hy("where",n);return Wy._create(r,s,t)}class w1 extends x1{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new w1(e,t)}_parse(e){const t=this._queryConstraints.map(s=>s._parse(e)).filter(s=>s.getFilters().length>0);return t.length===1?t[0]:Hr.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(r,i){let o=r;const a=i.getFlattenedFilters();for(const l of a)LF(o,l),o=Ww(o,l)}(e._query,t),new Ao(e.firestore,e.converter,Ww(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class T1 extends E1{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new T1(e,t)}_apply(e){const t=function(r,i,o){if(r.startAt!==null)throw new ce(ee.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new ce(ee.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Cf(i,o)}(e._query,this._field,this._direction);return new Ao(e.firestore,e.converter,function(r,i){const o=r.explicitOrderBy.concat([i]);return new Pd(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}function Io(n,e="asc"){const t=e,s=Hy("orderBy",n);return T1._create(s,t)}class b1 extends E1{constructor(e,t,s){super(),this.type=e,this._limit=t,this._limitType=s}static _create(e,t,s){return new b1(e,t,s)}_apply(e){return new Ao(e.firestore,e.converter,p0(e._query,this._limit,this._limitType))}}function zy(n){return ZQ("limit",n),b1._create("limit",n,"F")}function JC(n,e,t){if(typeof(t=fn(t))=="string"){if(t==="")throw new ce(ee.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!kj(e)&&t.indexOf("/")!==-1)throw new ce(ee.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const s=e.path.child(_t.fromString(t));if(!_e.isDocumentKey(s))throw new ce(ee.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return mC(n,new _e(s))}if(t instanceof Xt)return mC(n,t._key);throw new ce(ee.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${_y(t)}.`)}function ZC(n,e){if(!Array.isArray(n)||n.length===0)throw new ce(ee.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function LF(n,e){const t=function(r,i){for(const o of r)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new ce(ee.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ce(ee.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class zZ{convertValue(e,t="none"){switch(Ga(e)){case 0:return null;case 1:return e.booleanValue;case 2:return tn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ba(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ce(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return el(e,(r,i)=>{s[r]=this.convertValue(i,t)}),s}convertVectorValue(e){var s,r,i;const t=(i=(r=(s=e.fields)==null?void 0:s[f0].arrayValue)==null?void 0:r.values)==null?void 0:i.map(o=>tn(o.doubleValue));return new Ei(t)}convertGeoPoint(e){return new xi(tn(e.latitude),tn(e.longitude))}convertArray(e,t){return(e.values||[]).map(s=>this.convertValue(s,t))}convertServerTimestamp(e,t){switch(t){case"previous":const s=Ry(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(Af(e));default:return null}}convertTimestamp(e){const t=$a(e);return new Pt(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=_t.fromString(e);ht(eF(s),9688,{name:e});const r=new If(s.get(1),s.get(3)),i=new _e(s.popFirst(5));return r.isEqual(t)||yo(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DF(n,e,t){let s;return s=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,s}class Ih{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Vl extends kF{constructor(e,t,s,r,i,o){super(e,t,s,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ug(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(Hy("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new ce(ee.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Vl._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Vl._jsonSchemaVersion="firestore/documentSnapshot/1.0",Vl._jsonSchema={type:dn("string",Vl._jsonSchemaVersion),bundleSource:dn("string","DocumentSnapshot"),bundleName:dn("string"),bundle:dn("string")};class ug extends Vl{data(e={}){return super.data(e)}}class $l{constructor(e,t,s,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Ih(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(s=>{e.call(t,new ug(this._firestore,this._userDataWriter,s.key,s,new Ih(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ce(ee.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(a=>{const l=new ug(r._firestore,r._userDataWriter,a.doc.key,a.doc,new Ih(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new ug(r._firestore,r._userDataWriter,a.doc.key,a.doc,new Ih(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);let c=-1,d=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:qZ(a.type),doc:l,oldIndex:c,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new ce(ee.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=$l._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=US.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],r=[];return this.docs.forEach(i=>{i._document!==null&&(t.push(i._document),s.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),r.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function qZ(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ce(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fs(n){n=Cs(n,Xt);const e=Cs(n.firestore,xo);return DZ(Vy(e),n._key).then(t=>MF(e,n,t))}$l._jsonSchemaVersion="firestore/querySnapshot/1.0",$l._jsonSchema={type:dn("string",$l._jsonSchemaVersion),bundleSource:dn("string","QuerySnapshot"),bundleName:dn("string"),bundle:dn("string")};class S1 extends zZ{constructor(e){super(),this.firestore=e}convertBytes(e){return new dr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Xt(this.firestore,null,t)}}function Lt(n){n=Cs(n,Ao);const e=Cs(n.firestore,xo),t=Vy(e),s=new S1(e);return NF(n._query),MZ(t,n._query).then(r=>new $l(e,s,n,r))}function Ai(n,e,t){n=Cs(n,Xt);const s=Cs(n.firestore,xo),r=DF(n.converter,e,t);return qy(s,[AF(Gy(s),"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,pr.none())])}function wn(n,e,t,...s){n=Cs(n,Xt);const r=Cs(n.firestore,xo),i=Gy(r);let o;return o=typeof(e=fn(e))=="string"||e instanceof $y?GZ(i,"updateDoc",n._key,e,t,s):BZ(i,"updateDoc",n._key,e),qy(r,[o.toMutation(n._key,pr.exists(!0))])}function Eo(n){return qy(Cs(n.firestore,xo),[new WS(n._key,pr.none())])}function mc(n,e){const t=Cs(n.firestore,xo),s=ot(n),r=DF(n.converter,e);return qy(t,[AF(Gy(n.firestore),"addDoc",s._key,r,n.converter!==null,{}).toMutation(s._key,pr.exists(!1))]).then(()=>s)}function YZ(n,...e){var l,c,d;n=fn(n);let t={includeMetadataChanges:!1,source:"default"},s=0;typeof e[s]!="object"||XC(e[s])||(t=e[s++]);const r={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(XC(e[s])){const h=e[s];e[s]=(l=h.next)==null?void 0:l.bind(h),e[s+1]=(c=h.error)==null?void 0:c.bind(h),e[s+2]=(d=h.complete)==null?void 0:d.bind(h)}let i,o,a;if(n instanceof Xt)o=Cs(n.firestore,xo),a=Cy(n._key.path),i={next:h=>{e[s]&&e[s](MF(o,n,h))},error:e[s+1],complete:e[s+2]};else{const h=Cs(n,Ao);o=Cs(h.firestore,xo),a=h._query;const f=new S1(o);i={next:m=>{e[s]&&e[s](new $l(o,f,h,m))},error:e[s+1],complete:e[s+2]},NF(n._query)}return function(f,m,p,y){const v=new h1(y),x=new c1(m,v,p);return f.asyncQueue.enqueueAndForget(async()=>o1(await E0(f),x)),()=>{v.Nu(),f.asyncQueue.enqueueAndForget(async()=>a1(await E0(f),x))}}(Vy(o),a,r,i)}function qy(n,e){return function(s,r){const i=new to;return s.asyncQueue.enqueueAndForget(async()=>TZ(await LZ(s),r,i)),i.promise}(Vy(n),e)}function MF(n,e,t){const s=t.docs.get(e._key),r=new S1(n);return new Vl(n,r,e._key,s,new Ih(t.hasPendingWrites,t.fromCache),e.converter)}function mn(){return new f1("serverTimestamp")}function OF(...n){return new m1("arrayUnion",n)}function jF(...n){return new p1("arrayRemove",n)}function Qs(n){return new g1("increment",n)}(function(e,t=!0){(function(r){Id=r})(_d),Xu(new Jl("firestore",(s,{instanceIdentifier:r,options:i})=>{const o=s.getProvider("app").getImmediate(),a=new xo(new KQ(s.getProvider("auth-internal")),new zQ(o,s.getProvider("app-check-internal")),function(c,d){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new ce(ee.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new If(c.options.projectId,d)}(o,r),o);return i={useFetchStreams:t,...i},a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Ca(tC,nC,e),Ca(tC,nC,"esm2020")})();var QZ="firebase",XZ="12.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ca(QZ,XZ,"app");const JZ={apiKey:"AIzaSyBXcxTjCdkl8C_Jy4RbglLg_vX-BX6qMRE",authDomain:"animebite-57d38.firebaseapp.com",projectId:"animebite-57d38",storageBucket:"animebite-57d38.firebasestorage.app",messagingSenderId:"634867345512",appId:"1:634867345512:web:7c2990a55037753bc5b3dd"},FF=wO(JZ),Pc=VQ(FF),pe=jZ(FF),UF=T.createContext(void 0);function Ms(){const n=T.useContext(UF);if(!n)throw new Error("useAuth must be used within AuthProvider");return n}function VF({children:n}){const[e,t]=T.useState(null),[s,r]=T.useState(null),[i,o]=T.useState(!0);async function a(v,x){var b;const E=ot(pe,"users",v.uid),w=await fs(E);if(!w.exists()){const C=x||v.displayName||((b=v.email)==null?void 0:b.split("@")[0])||"User",D={uid:v.uid,email:v.email||"",username:C,avatarUrl:v.photoURL||"/img1.jpg",bannerUrl:"https://images.unsplash.com/photo-1578632767115-351597cf2477?w=1200",bio:"",parentalPin:"",preferences:{genres:[]},totalWatchTime:0,isWatchlistPublic:!0,isContinueWatchingPublic:!0,createdAt:mn()};return await Ai(E,D),D}return w.data()}async function l(v){const x=ot(pe,"users",v.uid),E=await fs(x);if(E.exists())r(E.data());else{const w=await a(v);r(w)}}async function c(v,x,E){const{isUsernameAvailable:w}=await pi(async()=>{const{isUsernameAvailable:D}=await Promise.resolve().then(()=>wi);return{isUsernameAvailable:D}},void 0);if(!await w(E))throw new Error('Username is already taken or contains restricted words (e.g., "admin")');const C=await TY(Pc,v,x);await _Y(C.user,{displayName:E}),await a(C.user,E)}async function d(v,x){await bY(Pc,v,x)}async function h(){await CY(Pc),r(null)}async function f(){const v=new zi,x=await YY(Pc,v);await a(x.user)}async function m(v){await wY(Pc,v)}async function p(v){if(!e||!s)throw new Error("No user logged in");const x=ot(pe,"users",e.uid);if(v.username&&v.username!==s.username){const{isUsernameAvailable:E,updateUsernameInContent:w}=await pi(async()=>{const{isUsernameAvailable:C,updateUsernameInContent:D}=await Promise.resolve().then(()=>wi);return{isUsernameAvailable:C,updateUsernameInContent:D}},void 0);if(!await E(v.username,e.uid))throw new Error('Username is already taken or contains restricted words (e.g., "admin")');await w(e.uid,s.username,v.username,v.avatarUrl||s.avatarUrl)}await Ai(x,v,{merge:!0}),r({...s,...v})}T.useEffect(()=>RY(Pc,async x=>{t(x),x?await l(x):r(null),o(!1)}),[]);const y={currentUser:e,userProfile:s,loading:i,signup:c,login:d,logout:h,googleSignIn:f,resetPassword:m,updateUserProfile:p};return u.jsx(UF.Provider,{value:y,children:!i&&n})}const bn=T.forwardRef(({className:n,type:e,...t},s)=>u.jsx("input",{type:e,className:Ae("flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),ref:s,...t}));bn.displayName="Input";const ZZ=my("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 hover-elevate active-elevate-2",{variants:{variant:{default:"bg-primary text-primary-foreground border border-primary-border",destructive:"bg-destructive text-destructive-foreground border border-destructive-border",outline:" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none ",secondary:"border bg-secondary text-secondary-foreground border border-secondary-border ",ghost:"border border-transparent"},size:{default:"min-h-9 px-4 py-2",sm:"min-h-8 rounded-md px-3 text-xs",lg:"min-h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),ne=T.forwardRef(({className:n,variant:e,size:t,asChild:s=!1,...r},i)=>{const o=s?rG:"button";return u.jsx(o,{className:Ae(ZZ({variant:e,size:t,className:n})),ref:i,...r})});ne.displayName="Button";var _1="Avatar",[eee,jpe]=Ds(_1),[tee,$F]=eee(_1),BF=T.forwardRef((n,e)=>{const{__scopeAvatar:t,...s}=n,[r,i]=T.useState("idle");return u.jsx(tee,{scope:t,imageLoadingStatus:r,onImageLoadingStatusChange:i,children:u.jsx(Se.span,{...s,ref:e})})});BF.displayName=_1;var GF="AvatarImage",KF=T.forwardRef((n,e)=>{const{__scopeAvatar:t,src:s,onLoadingStatusChange:r=()=>{},...i}=n,o=$F(GF,t),a=nee(s,i),l=Bn(c=>{r(c),o.onImageLoadingStatusChange(c)});return hn(()=>{a!=="idle"&&l(a)},[a,l]),a==="loaded"?u.jsx(Se.img,{...i,ref:e,src:s}):null});KF.displayName=GF;var HF="AvatarFallback",WF=T.forwardRef((n,e)=>{const{__scopeAvatar:t,delayMs:s,...r}=n,i=$F(HF,t),[o,a]=T.useState(s===void 0);return T.useEffect(()=>{if(s!==void 0){const l=window.setTimeout(()=>a(!0),s);return()=>window.clearTimeout(l)}},[s]),o&&i.imageLoadingStatus!=="loaded"?u.jsx(Se.span,{...r,ref:e}):null});WF.displayName=HF;function eP(n,e){return n?e?(n.src!==e&&(n.src=e),n.complete&&n.naturalWidth>0?"loaded":"loading"):"error":"idle"}function nee(n,{referrerPolicy:e,crossOrigin:t}){const s=ree(),r=T.useRef(null),i=s?(r.current||(r.current=new window.Image),r.current):null,[o,a]=T.useState(()=>eP(i,n));return hn(()=>{a(eP(i,n))},[i,n]),hn(()=>{const l=h=>()=>{a(h)};if(!i)return;const c=l("loaded"),d=l("error");return i.addEventListener("load",c),i.addEventListener("error",d),e&&(i.referrerPolicy=e),typeof t=="string"&&(i.crossOrigin=t),()=>{i.removeEventListener("load",c),i.removeEventListener("error",d)}},[i,t,e]),o}function see(){return()=>{}}function ree(){return T.useSyncExternalStore(see,()=>!0,()=>!1)}var zF=BF,qF=KF,YF=WF;const Ps=T.forwardRef(({className:n,...e},t)=>u.jsx(zF,{ref:t,className:Ae(`
      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10
      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,n),...e}));Ps.displayName=zF.displayName;const ks=T.forwardRef(({className:n,...e},t)=>u.jsx(qF,{ref:t,className:Ae("aspect-square h-full w-full",n),...e}));ks.displayName=qF.displayName;const Ns=T.forwardRef(({className:n,...e},t)=>u.jsx(YF,{ref:t,className:Ae("flex h-full w-full items-center justify-center rounded-full bg-muted",n),...e}));Ns.displayName=YF.displayName;var iee=T.createContext(void 0);function Nd(n){const e=T.useContext(iee);return n||e||"ltr"}var wx=0;function A1(){T.useEffect(()=>{const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",n[0]??tP()),document.body.insertAdjacentElement("beforeend",n[1]??tP()),wx++,()=>{wx===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),wx--}},[])}function tP(){const n=document.createElement("span");return n.setAttribute("data-radix-focus-guard",""),n.tabIndex=0,n.style.outline="none",n.style.opacity="0",n.style.position="fixed",n.style.pointerEvents="none",n}var Tx="focusScope.autoFocusOnMount",bx="focusScope.autoFocusOnUnmount",nP={bubbles:!1,cancelable:!0},oee="FocusScope",Yy=T.forwardRef((n,e)=>{const{loop:t=!1,trapped:s=!1,onMountAutoFocus:r,onUnmountAutoFocus:i,...o}=n,[a,l]=T.useState(null),c=Bn(r),d=Bn(i),h=T.useRef(null),f=ze(e,y=>l(y)),m=T.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;T.useEffect(()=>{if(s){let y=function(w){if(m.paused||!a)return;const b=w.target;a.contains(b)?h.current=b:Yo(h.current,{select:!0})},v=function(w){if(m.paused||!a)return;const b=w.relatedTarget;b!==null&&(a.contains(b)||Yo(h.current,{select:!0}))},x=function(w){if(document.activeElement===document.body)for(const C of w)C.removedNodes.length>0&&Yo(a)};document.addEventListener("focusin",y),document.addEventListener("focusout",v);const E=new MutationObserver(x);return a&&E.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",y),document.removeEventListener("focusout",v),E.disconnect()}}},[s,a,m.paused]),T.useEffect(()=>{if(a){rP.add(m);const y=document.activeElement;if(!a.contains(y)){const x=new CustomEvent(Tx,nP);a.addEventListener(Tx,c),a.dispatchEvent(x),x.defaultPrevented||(aee(hee(QF(a)),{select:!0}),document.activeElement===y&&Yo(a))}return()=>{a.removeEventListener(Tx,c),setTimeout(()=>{const x=new CustomEvent(bx,nP);a.addEventListener(bx,d),a.dispatchEvent(x),x.defaultPrevented||Yo(y??document.body,{select:!0}),a.removeEventListener(bx,d),rP.remove(m)},0)}}},[a,c,d,m]);const p=T.useCallback(y=>{if(!t&&!s||m.paused)return;const v=y.key==="Tab"&&!y.altKey&&!y.ctrlKey&&!y.metaKey,x=document.activeElement;if(v&&x){const E=y.currentTarget,[w,b]=lee(E);w&&b?!y.shiftKey&&x===b?(y.preventDefault(),t&&Yo(w,{select:!0})):y.shiftKey&&x===w&&(y.preventDefault(),t&&Yo(b,{select:!0})):x===E&&y.preventDefault()}},[t,s,m.paused]);return u.jsx(Se.div,{tabIndex:-1,...o,ref:f,onKeyDown:p})});Yy.displayName=oee;function aee(n,{select:e=!1}={}){const t=document.activeElement;for(const s of n)if(Yo(s,{select:e}),document.activeElement!==t)return}function lee(n){const e=QF(n),t=sP(e,n),s=sP(e.reverse(),n);return[t,s]}function QF(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const r=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||r?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function sP(n,e){for(const t of n)if(!cee(t,{upTo:e}))return t}function cee(n,{upTo:e}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(e!==void 0&&n===e)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function uee(n){return n instanceof HTMLInputElement&&"select"in n}function Yo(n,{select:e=!1}={}){if(n&&n.focus){const t=document.activeElement;n.focus({preventScroll:!0}),n!==t&&uee(n)&&e&&n.select()}}var rP=dee();function dee(){let n=[];return{add(e){const t=n[0];e!==t&&(t==null||t.pause()),n=iP(n,e),n.unshift(e)},remove(e){var t;n=iP(n,e),(t=n[0])==null||t.resume()}}}function iP(n,e){const t=[...n],s=t.indexOf(e);return s!==-1&&t.splice(s,1),t}function hee(n){return n.filter(e=>e.tagName!=="A")}var Sx="rovingFocusGroup.onEntryFocus",fee={bubbles:!1,cancelable:!0},Qy="RovingFocusGroup",[sT,XF,mee]=vd(Qy),[pee,Xy]=Ds(Qy,[mee]),[gee,yee]=pee(Qy),JF=T.forwardRef((n,e)=>u.jsx(sT.Provider,{scope:n.__scopeRovingFocusGroup,children:u.jsx(sT.Slot,{scope:n.__scopeRovingFocusGroup,children:u.jsx(vee,{...n,ref:e})})}));JF.displayName=Qy;var vee=T.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,orientation:s,loop:r=!1,dir:i,currentTabStopId:o,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:c,preventScrollOnEntryFocus:d=!1,...h}=n,f=T.useRef(null),m=ze(e,f),p=Nd(i),[y=null,v]=Br({prop:o,defaultProp:a,onChange:l}),[x,E]=T.useState(!1),w=Bn(c),b=XF(t),C=T.useRef(!1),[D,_]=T.useState(0);return T.useEffect(()=>{const S=f.current;if(S)return S.addEventListener(Sx,w),()=>S.removeEventListener(Sx,w)},[w]),u.jsx(gee,{scope:t,orientation:s,dir:p,loop:r,currentTabStopId:y,onItemFocus:T.useCallback(S=>v(S),[v]),onItemShiftTab:T.useCallback(()=>E(!0),[]),onFocusableItemAdd:T.useCallback(()=>_(S=>S+1),[]),onFocusableItemRemove:T.useCallback(()=>_(S=>S-1),[]),children:u.jsx(Se.div,{tabIndex:x||D===0?-1:0,"data-orientation":s,...h,ref:m,style:{outline:"none",...n.style},onMouseDown:ie(n.onMouseDown,()=>{C.current=!0}),onFocus:ie(n.onFocus,S=>{const I=!C.current;if(S.target===S.currentTarget&&I&&!x){const R=new CustomEvent(Sx,fee);if(S.currentTarget.dispatchEvent(R),!R.defaultPrevented){const N=b().filter($=>$.focusable),L=N.find($=>$.active),M=N.find($=>$.id===y),V=[L,M,...N].filter(Boolean).map($=>$.ref.current);t4(V,d)}}C.current=!1}),onBlur:ie(n.onBlur,()=>E(!1))})})}),ZF="RovingFocusGroupItem",e4=T.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,focusable:s=!0,active:r=!1,tabStopId:i,...o}=n,a=mr(),l=i||a,c=yee(ZF,t),d=c.currentTabStopId===l,h=XF(t),{onFocusableItemAdd:f,onFocusableItemRemove:m}=c;return T.useEffect(()=>{if(s)return f(),()=>m()},[s,f,m]),u.jsx(sT.ItemSlot,{scope:t,id:l,focusable:s,active:r,children:u.jsx(Se.span,{tabIndex:d?0:-1,"data-orientation":c.orientation,...o,ref:e,onMouseDown:ie(n.onMouseDown,p=>{s?c.onItemFocus(l):p.preventDefault()}),onFocus:ie(n.onFocus,()=>c.onItemFocus(l)),onKeyDown:ie(n.onKeyDown,p=>{if(p.key==="Tab"&&p.shiftKey){c.onItemShiftTab();return}if(p.target!==p.currentTarget)return;const y=wee(p,c.orientation,c.dir);if(y!==void 0){if(p.metaKey||p.ctrlKey||p.altKey||p.shiftKey)return;p.preventDefault();let x=h().filter(E=>E.focusable).map(E=>E.ref.current);if(y==="last")x.reverse();else if(y==="prev"||y==="next"){y==="prev"&&x.reverse();const E=x.indexOf(p.currentTarget);x=c.loop?Tee(x,E+1):x.slice(E+1)}setTimeout(()=>t4(x))}})})})});e4.displayName=ZF;var xee={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Eee(n,e){return e!=="rtl"?n:n==="ArrowLeft"?"ArrowRight":n==="ArrowRight"?"ArrowLeft":n}function wee(n,e,t){const s=Eee(n.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(s))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(s)))return xee[s]}function t4(n,e=!1){const t=document.activeElement;for(const s of n)if(s===t||(s.focus({preventScroll:e}),document.activeElement!==t))return}function Tee(n,e){return n.map((t,s)=>n[(e+s)%n.length])}var n4=JF,s4=e4,bee=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},kc=new WeakMap,pp=new WeakMap,gp={},_x=0,r4=function(n){return n&&(n.host||r4(n.parentNode))},See=function(n,e){return e.map(function(t){if(n.contains(t))return t;var s=r4(t);return s&&n.contains(s)?s:(console.error("aria-hidden",t,"in not contained inside",n,". Doing nothing"),null)}).filter(function(t){return!!t})},_ee=function(n,e,t,s){var r=See(e,Array.isArray(n)?n:[n]);gp[t]||(gp[t]=new WeakMap);var i=gp[t],o=[],a=new Set,l=new Set(r),c=function(h){!h||a.has(h)||(a.add(h),c(h.parentNode))};r.forEach(c);var d=function(h){!h||l.has(h)||Array.prototype.forEach.call(h.children,function(f){if(a.has(f))d(f);else try{var m=f.getAttribute(s),p=m!==null&&m!=="false",y=(kc.get(f)||0)+1,v=(i.get(f)||0)+1;kc.set(f,y),i.set(f,v),o.push(f),y===1&&p&&pp.set(f,!0),v===1&&f.setAttribute(t,"true"),p||f.setAttribute(s,"true")}catch(x){console.error("aria-hidden: cannot operate on ",f,x)}})};return d(e),a.clear(),_x++,function(){o.forEach(function(h){var f=kc.get(h)-1,m=i.get(h)-1;kc.set(h,f),i.set(h,m),f||(pp.has(h)||h.removeAttribute(s),pp.delete(h)),m||h.removeAttribute(t)}),_x--,_x||(kc=new WeakMap,kc=new WeakMap,pp=new WeakMap,gp={})}},I1=function(n,e,t){t===void 0&&(t="data-aria-hidden");var s=Array.from(Array.isArray(n)?n:[n]),r=bee(n);return r?(s.push.apply(s,Array.from(r.querySelectorAll("[aria-live]"))),_ee(s,r,t,"aria-hidden")):function(){return null}},ai=function(){return ai=Object.assign||function(e){for(var t,s=1,r=arguments.length;s<r;s++){t=arguments[s];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},ai.apply(this,arguments)};function i4(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t}function Aee(n,e,t){if(t||arguments.length===2)for(var s=0,r=e.length,i;s<r;s++)(i||!(s in e))&&(i||(i=Array.prototype.slice.call(e,0,s)),i[s]=e[s]);return n.concat(i||Array.prototype.slice.call(e))}var dg="right-scroll-bar-position",hg="width-before-scroll-bar",Iee="with-scroll-bars-hidden",Ree="--removed-body-scroll-bar-size";function Ax(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function Cee(n,e){var t=T.useState(function(){return{value:n,callback:e,facade:{get current(){return t.value},set current(s){var r=t.value;r!==s&&(t.value=s,t.callback(s,r))}}}})[0];return t.callback=e,t.facade}var Pee=typeof window<"u"?T.useLayoutEffect:T.useEffect,oP=new WeakMap;function kee(n,e){var t=Cee(null,function(s){return n.forEach(function(r){return Ax(r,s)})});return Pee(function(){var s=oP.get(t);if(s){var r=new Set(s),i=new Set(n),o=t.current;r.forEach(function(a){i.has(a)||Ax(a,null)}),i.forEach(function(a){r.has(a)||Ax(a,o)})}oP.set(t,n)},[n]),t}function Nee(n){return n}function Lee(n,e){e===void 0&&(e=Nee);var t=[],s=!1,r={read:function(){if(s)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:n},useMedium:function(i){var o=e(i,s);return t.push(o),function(){t=t.filter(function(a){return a!==o})}},assignSyncMedium:function(i){for(s=!0;t.length;){var o=t;t=[],o.forEach(i)}t={push:function(a){return i(a)},filter:function(){return t}}},assignMedium:function(i){s=!0;var o=[];if(t.length){var a=t;t=[],a.forEach(i),o=t}var l=function(){var d=o;o=[],d.forEach(i)},c=function(){return Promise.resolve().then(l)};c(),t={push:function(d){o.push(d),c()},filter:function(d){return o=o.filter(d),t}}}};return r}function Dee(n){n===void 0&&(n={});var e=Lee(null);return e.options=ai({async:!0,ssr:!1},n),e}var o4=function(n){var e=n.sideCar,t=i4(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var s=e.read();if(!s)throw new Error("Sidecar medium not found");return T.createElement(s,ai({},t))};o4.isSideCarExport=!0;function Mee(n,e){return n.useMedium(e),o4}var a4=Dee(),Ix=function(){},Jy=T.forwardRef(function(n,e){var t=T.useRef(null),s=T.useState({onScrollCapture:Ix,onWheelCapture:Ix,onTouchMoveCapture:Ix}),r=s[0],i=s[1],o=n.forwardProps,a=n.children,l=n.className,c=n.removeScrollBar,d=n.enabled,h=n.shards,f=n.sideCar,m=n.noIsolation,p=n.inert,y=n.allowPinchZoom,v=n.as,x=v===void 0?"div":v,E=n.gapMode,w=i4(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),b=f,C=kee([t,e]),D=ai(ai({},w),r);return T.createElement(T.Fragment,null,d&&T.createElement(b,{sideCar:a4,removeScrollBar:c,shards:h,noIsolation:m,inert:p,setCallbacks:i,allowPinchZoom:!!y,lockRef:t,gapMode:E}),o?T.cloneElement(T.Children.only(a),ai(ai({},D),{ref:C})):T.createElement(x,ai({},D,{className:l,ref:C}),a))});Jy.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Jy.classNames={fullWidth:hg,zeroRight:dg};var Oee=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function jee(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=Oee();return e&&n.setAttribute("nonce",e),n}function Fee(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function Uee(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var Vee=function(){var n=0,e=null;return{add:function(t){n==0&&(e=jee())&&(Fee(e,t),Uee(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},$ee=function(){var n=Vee();return function(e,t){T.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&t])}},l4=function(){var n=$ee(),e=function(t){var s=t.styles,r=t.dynamic;return n(s,r),null};return e},Bee={left:0,top:0,right:0,gap:0},Rx=function(n){return parseInt(n||"",10)||0},Gee=function(n){var e=window.getComputedStyle(document.body),t=e[n==="padding"?"paddingLeft":"marginLeft"],s=e[n==="padding"?"paddingTop":"marginTop"],r=e[n==="padding"?"paddingRight":"marginRight"];return[Rx(t),Rx(s),Rx(r)]},Kee=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return Bee;var e=Gee(n),t=document.documentElement.clientWidth,s=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,s-t+e[2]-e[0])}},Hee=l4(),bu="data-scroll-locked",Wee=function(n,e,t,s){var r=n.left,i=n.top,o=n.right,a=n.gap;return t===void 0&&(t="margin"),`
  .`.concat(Iee,` {
   overflow: hidden `).concat(s,`;
   padding-right: `).concat(a,"px ").concat(s,`;
  }
  body[`).concat(bu,`] {
    overflow: hidden `).concat(s,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(s,";"),t==="margin"&&`
    padding-left: `.concat(r,`px;
    padding-top: `).concat(i,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(s,`;
    `),t==="padding"&&"padding-right: ".concat(a,"px ").concat(s,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(dg,` {
    right: `).concat(a,"px ").concat(s,`;
  }
  
  .`).concat(hg,` {
    margin-right: `).concat(a,"px ").concat(s,`;
  }
  
  .`).concat(dg," .").concat(dg,` {
    right: 0 `).concat(s,`;
  }
  
  .`).concat(hg," .").concat(hg,` {
    margin-right: 0 `).concat(s,`;
  }
  
  body[`).concat(bu,`] {
    `).concat(Ree,": ").concat(a,`px;
  }
`)},aP=function(){var n=parseInt(document.body.getAttribute(bu)||"0",10);return isFinite(n)?n:0},zee=function(){T.useEffect(function(){return document.body.setAttribute(bu,(aP()+1).toString()),function(){var n=aP()-1;n<=0?document.body.removeAttribute(bu):document.body.setAttribute(bu,n.toString())}},[])},qee=function(n){var e=n.noRelative,t=n.noImportant,s=n.gapMode,r=s===void 0?"margin":s;zee();var i=T.useMemo(function(){return Kee(r)},[r]);return T.createElement(Hee,{styles:Wee(i,!e,r,t?"":"!important")})},rT=!1;if(typeof window<"u")try{var yp=Object.defineProperty({},"passive",{get:function(){return rT=!0,!0}});window.addEventListener("test",yp,yp),window.removeEventListener("test",yp,yp)}catch{rT=!1}var Nc=rT?{passive:!1}:!1,Yee=function(n){return n.tagName==="TEXTAREA"},c4=function(n,e){if(!(n instanceof Element))return!1;var t=window.getComputedStyle(n);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!Yee(n)&&t[e]==="visible")},Qee=function(n){return c4(n,"overflowY")},Xee=function(n){return c4(n,"overflowX")},lP=function(n,e){var t=e.ownerDocument,s=e;do{typeof ShadowRoot<"u"&&s instanceof ShadowRoot&&(s=s.host);var r=u4(n,s);if(r){var i=d4(n,s),o=i[1],a=i[2];if(o>a)return!0}s=s.parentNode}while(s&&s!==t.body);return!1},Jee=function(n){var e=n.scrollTop,t=n.scrollHeight,s=n.clientHeight;return[e,t,s]},Zee=function(n){var e=n.scrollLeft,t=n.scrollWidth,s=n.clientWidth;return[e,t,s]},u4=function(n,e){return n==="v"?Qee(e):Xee(e)},d4=function(n,e){return n==="v"?Jee(e):Zee(e)},ete=function(n,e){return n==="h"&&e==="rtl"?-1:1},tte=function(n,e,t,s,r){var i=ete(n,window.getComputedStyle(e).direction),o=i*s,a=t.target,l=e.contains(a),c=!1,d=o>0,h=0,f=0;do{var m=d4(n,a),p=m[0],y=m[1],v=m[2],x=y-v-i*p;(p||x)&&u4(n,a)&&(h+=x,f+=p),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(d&&(Math.abs(h)<1||!r)||!d&&(Math.abs(f)<1||!r))&&(c=!0),c},vp=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},cP=function(n){return[n.deltaX,n.deltaY]},uP=function(n){return n&&"current"in n?n.current:n},nte=function(n,e){return n[0]===e[0]&&n[1]===e[1]},ste=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},rte=0,Lc=[];function ite(n){var e=T.useRef([]),t=T.useRef([0,0]),s=T.useRef(),r=T.useState(rte++)[0],i=T.useState(l4)[0],o=T.useRef(n);T.useEffect(function(){o.current=n},[n]),T.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(r));var y=Aee([n.lockRef.current],(n.shards||[]).map(uP),!0).filter(Boolean);return y.forEach(function(v){return v.classList.add("allow-interactivity-".concat(r))}),function(){document.body.classList.remove("block-interactivity-".concat(r)),y.forEach(function(v){return v.classList.remove("allow-interactivity-".concat(r))})}}},[n.inert,n.lockRef.current,n.shards]);var a=T.useCallback(function(y,v){if("touches"in y&&y.touches.length===2||y.type==="wheel"&&y.ctrlKey)return!o.current.allowPinchZoom;var x=vp(y),E=t.current,w="deltaX"in y?y.deltaX:E[0]-x[0],b="deltaY"in y?y.deltaY:E[1]-x[1],C,D=y.target,_=Math.abs(w)>Math.abs(b)?"h":"v";if("touches"in y&&_==="h"&&D.type==="range")return!1;var S=lP(_,D);if(!S)return!0;if(S?C=_:(C=_==="v"?"h":"v",S=lP(_,D)),!S)return!1;if(!s.current&&"changedTouches"in y&&(w||b)&&(s.current=C),!C)return!0;var I=s.current||C;return tte(I,v,y,I==="h"?w:b,!0)},[]),l=T.useCallback(function(y){var v=y;if(!(!Lc.length||Lc[Lc.length-1]!==i)){var x="deltaY"in v?cP(v):vp(v),E=e.current.filter(function(C){return C.name===v.type&&(C.target===v.target||v.target===C.shadowParent)&&nte(C.delta,x)})[0];if(E&&E.should){v.cancelable&&v.preventDefault();return}if(!E){var w=(o.current.shards||[]).map(uP).filter(Boolean).filter(function(C){return C.contains(v.target)}),b=w.length>0?a(v,w[0]):!o.current.noIsolation;b&&v.cancelable&&v.preventDefault()}}},[]),c=T.useCallback(function(y,v,x,E){var w={name:y,delta:v,target:x,should:E,shadowParent:ote(x)};e.current.push(w),setTimeout(function(){e.current=e.current.filter(function(b){return b!==w})},1)},[]),d=T.useCallback(function(y){t.current=vp(y),s.current=void 0},[]),h=T.useCallback(function(y){c(y.type,cP(y),y.target,a(y,n.lockRef.current))},[]),f=T.useCallback(function(y){c(y.type,vp(y),y.target,a(y,n.lockRef.current))},[]);T.useEffect(function(){return Lc.push(i),n.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:f}),document.addEventListener("wheel",l,Nc),document.addEventListener("touchmove",l,Nc),document.addEventListener("touchstart",d,Nc),function(){Lc=Lc.filter(function(y){return y!==i}),document.removeEventListener("wheel",l,Nc),document.removeEventListener("touchmove",l,Nc),document.removeEventListener("touchstart",d,Nc)}},[]);var m=n.removeScrollBar,p=n.inert;return T.createElement(T.Fragment,null,p?T.createElement(i,{styles:ste(r)}):null,m?T.createElement(qee,{gapMode:n.gapMode}):null)}function ote(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const ate=Mee(a4,ite);var Zy=T.forwardRef(function(n,e){return T.createElement(Jy,ai({},n,{ref:e,sideCar:ate}))});Zy.classNames=Jy.classNames;var iT=["Enter"," "],lte=["ArrowDown","PageUp","Home"],h4=["ArrowUp","PageDown","End"],cte=[...lte,...h4],ute={ltr:[...iT,"ArrowRight"],rtl:[...iT,"ArrowLeft"]},dte={ltr:["ArrowLeft"],rtl:["ArrowRight"]},gm="Menu",[Nf,hte,fte]=vd(gm),[pc,f4]=Ds(gm,[fte,bd,Xy]),ev=bd(),m4=Xy(),[mte,gc]=pc(gm),[pte,ym]=pc(gm),p4=n=>{const{__scopeMenu:e,open:t=!1,children:s,dir:r,onOpenChange:i,modal:o=!0}=n,a=ev(e),[l,c]=T.useState(null),d=T.useRef(!1),h=Bn(i),f=Nd(r);return T.useEffect(()=>{const m=()=>{d.current=!0,document.addEventListener("pointerdown",p,{capture:!0,once:!0}),document.addEventListener("pointermove",p,{capture:!0,once:!0})},p=()=>d.current=!1;return document.addEventListener("keydown",m,{capture:!0}),()=>{document.removeEventListener("keydown",m,{capture:!0}),document.removeEventListener("pointerdown",p,{capture:!0}),document.removeEventListener("pointermove",p,{capture:!0})}},[]),u.jsx(nO,{...a,children:u.jsx(mte,{scope:e,open:t,onOpenChange:h,content:l,onContentChange:c,children:u.jsx(pte,{scope:e,onClose:T.useCallback(()=>h(!1),[h]),isUsingKeyboardRef:d,dir:f,modal:o,children:s})})})};p4.displayName=gm;var gte="MenuAnchor",R1=T.forwardRef((n,e)=>{const{__scopeMenu:t,...s}=n,r=ev(t);return u.jsx(wS,{...r,...s,ref:e})});R1.displayName=gte;var C1="MenuPortal",[yte,g4]=pc(C1,{forceMount:void 0}),y4=n=>{const{__scopeMenu:e,forceMount:t,children:s,container:r}=n,i=gc(C1,e);return u.jsx(yte,{scope:e,forceMount:t,children:u.jsx(wr,{present:t||i.open,children:u.jsx(nm,{asChild:!0,container:r,children:s})})})};y4.displayName=C1;var gr="MenuContent",[vte,P1]=pc(gr),v4=T.forwardRef((n,e)=>{const t=g4(gr,n.__scopeMenu),{forceMount:s=t.forceMount,...r}=n,i=gc(gr,n.__scopeMenu),o=ym(gr,n.__scopeMenu);return u.jsx(Nf.Provider,{scope:n.__scopeMenu,children:u.jsx(wr,{present:s||i.open,children:u.jsx(Nf.Slot,{scope:n.__scopeMenu,children:o.modal?u.jsx(xte,{...r,ref:e}):u.jsx(Ete,{...r,ref:e})})})})}),xte=T.forwardRef((n,e)=>{const t=gc(gr,n.__scopeMenu),s=T.useRef(null),r=ze(e,s);return T.useEffect(()=>{const i=s.current;if(i)return I1(i)},[]),u.jsx(k1,{...n,ref:r,trapFocus:t.open,disableOutsidePointerEvents:t.open,disableOutsideScroll:!0,onFocusOutside:ie(n.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>t.onOpenChange(!1)})}),Ete=T.forwardRef((n,e)=>{const t=gc(gr,n.__scopeMenu);return u.jsx(k1,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>t.onOpenChange(!1)})}),wte=Ql("MenuContent.ScrollLock"),k1=T.forwardRef((n,e)=>{const{__scopeMenu:t,loop:s=!1,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,disableOutsidePointerEvents:a,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:f,onDismiss:m,disableOutsideScroll:p,...y}=n,v=gc(gr,t),x=ym(gr,t),E=ev(t),w=m4(t),b=hte(t),[C,D]=T.useState(null),_=T.useRef(null),S=ze(e,_,v.onContentChange),I=T.useRef(0),R=T.useRef(""),N=T.useRef(0),L=T.useRef(null),M=T.useRef("right"),G=T.useRef(0),V=p?Zy:T.Fragment,$=p?{as:wte,allowPinchZoom:!0}:void 0,F=U=>{var re,Ee;const X=R.current+U,Y=b().filter(xe=>!xe.disabled),J=document.activeElement,ae=(re=Y.find(xe=>xe.ref.current===J))==null?void 0:re.textValue,he=Y.map(xe=>xe.textValue),ve=Lte(he,X,ae),ge=(Ee=Y.find(xe=>xe.textValue===ve))==null?void 0:Ee.ref.current;(function xe(Ne){R.current=Ne,window.clearTimeout(I.current),Ne!==""&&(I.current=window.setTimeout(()=>xe(""),1e3))})(X),ge&&setTimeout(()=>ge.focus())};T.useEffect(()=>()=>window.clearTimeout(I.current),[]),A1();const j=T.useCallback(U=>{var Y,J;return M.current===((Y=L.current)==null?void 0:Y.side)&&Mte(U,(J=L.current)==null?void 0:J.area)},[]);return u.jsx(vte,{scope:t,searchRef:R,onItemEnter:T.useCallback(U=>{j(U)&&U.preventDefault()},[j]),onItemLeave:T.useCallback(U=>{var X;j(U)||((X=_.current)==null||X.focus(),D(null))},[j]),onTriggerLeave:T.useCallback(U=>{j(U)&&U.preventDefault()},[j]),pointerGraceTimerRef:N,onPointerGraceIntentChange:T.useCallback(U=>{L.current=U},[]),children:u.jsx(V,{...$,children:u.jsx(Yy,{asChild:!0,trapped:r,onMountAutoFocus:ie(i,U=>{var X;U.preventDefault(),(X=_.current)==null||X.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:u.jsx(xd,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:c,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:f,onDismiss:m,children:u.jsx(n4,{asChild:!0,...w,dir:x.dir,orientation:"vertical",loop:s,currentTabStopId:C,onCurrentTabStopIdChange:D,onEntryFocus:ie(l,U=>{x.isUsingKeyboardRef.current||U.preventDefault()}),preventScrollOnEntryFocus:!0,children:u.jsx(TS,{role:"menu","aria-orientation":"vertical","data-state":D4(v.open),"data-radix-menu-content":"",dir:x.dir,...E,...y,ref:S,style:{outline:"none",...y.style},onKeyDown:ie(y.onKeyDown,U=>{const Y=U.target.closest("[data-radix-menu-content]")===U.currentTarget,J=U.ctrlKey||U.altKey||U.metaKey,ae=U.key.length===1;Y&&(U.key==="Tab"&&U.preventDefault(),!J&&ae&&F(U.key));const he=_.current;if(U.target!==he||!cte.includes(U.key))return;U.preventDefault();const ge=b().filter(re=>!re.disabled).map(re=>re.ref.current);h4.includes(U.key)&&ge.reverse(),kte(ge)}),onBlur:ie(n.onBlur,U=>{U.currentTarget.contains(U.target)||(window.clearTimeout(I.current),R.current="")}),onPointerMove:ie(n.onPointerMove,Lf(U=>{const X=U.target,Y=G.current!==U.clientX;if(U.currentTarget.contains(X)&&Y){const J=U.clientX>G.current?"right":"left";M.current=J,G.current=U.clientX}}))})})})})})})});v4.displayName=gr;var Tte="MenuGroup",N1=T.forwardRef((n,e)=>{const{__scopeMenu:t,...s}=n;return u.jsx(Se.div,{role:"group",...s,ref:e})});N1.displayName=Tte;var bte="MenuLabel",x4=T.forwardRef((n,e)=>{const{__scopeMenu:t,...s}=n;return u.jsx(Se.div,{...s,ref:e})});x4.displayName=bte;var T0="MenuItem",dP="menu.itemSelect",tv=T.forwardRef((n,e)=>{const{disabled:t=!1,onSelect:s,...r}=n,i=T.useRef(null),o=ym(T0,n.__scopeMenu),a=P1(T0,n.__scopeMenu),l=ze(e,i),c=T.useRef(!1),d=()=>{const h=i.current;if(!t&&h){const f=new CustomEvent(dP,{bubbles:!0,cancelable:!0});h.addEventListener(dP,m=>s==null?void 0:s(m),{once:!0}),sS(h,f),f.defaultPrevented?c.current=!1:o.onClose()}};return u.jsx(E4,{...r,ref:l,disabled:t,onClick:ie(n.onClick,d),onPointerDown:h=>{var f;(f=n.onPointerDown)==null||f.call(n,h),c.current=!0},onPointerUp:ie(n.onPointerUp,h=>{var f;c.current||(f=h.currentTarget)==null||f.click()}),onKeyDown:ie(n.onKeyDown,h=>{const f=a.searchRef.current!=="";t||f&&h.key===" "||iT.includes(h.key)&&(h.currentTarget.click(),h.preventDefault())})})});tv.displayName=T0;var E4=T.forwardRef((n,e)=>{const{__scopeMenu:t,disabled:s=!1,textValue:r,...i}=n,o=P1(T0,t),a=m4(t),l=T.useRef(null),c=ze(e,l),[d,h]=T.useState(!1),[f,m]=T.useState("");return T.useEffect(()=>{const p=l.current;p&&m((p.textContent??"").trim())},[i.children]),u.jsx(Nf.ItemSlot,{scope:t,disabled:s,textValue:r??f,children:u.jsx(s4,{asChild:!0,...a,focusable:!s,children:u.jsx(Se.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":s||void 0,"data-disabled":s?"":void 0,...i,ref:c,onPointerMove:ie(n.onPointerMove,Lf(p=>{s?o.onItemLeave(p):(o.onItemEnter(p),p.defaultPrevented||p.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:ie(n.onPointerLeave,Lf(p=>o.onItemLeave(p))),onFocus:ie(n.onFocus,()=>h(!0)),onBlur:ie(n.onBlur,()=>h(!1))})})})}),Ste="MenuCheckboxItem",w4=T.forwardRef((n,e)=>{const{checked:t=!1,onCheckedChange:s,...r}=n;return u.jsx(A4,{scope:n.__scopeMenu,checked:t,children:u.jsx(tv,{role:"menuitemcheckbox","aria-checked":b0(t)?"mixed":t,...r,ref:e,"data-state":D1(t),onSelect:ie(r.onSelect,()=>s==null?void 0:s(b0(t)?!0:!t),{checkForDefaultPrevented:!1})})})});w4.displayName=Ste;var T4="MenuRadioGroup",[_te,Ate]=pc(T4,{value:void 0,onValueChange:()=>{}}),b4=T.forwardRef((n,e)=>{const{value:t,onValueChange:s,...r}=n,i=Bn(s);return u.jsx(_te,{scope:n.__scopeMenu,value:t,onValueChange:i,children:u.jsx(N1,{...r,ref:e})})});b4.displayName=T4;var S4="MenuRadioItem",_4=T.forwardRef((n,e)=>{const{value:t,...s}=n,r=Ate(S4,n.__scopeMenu),i=t===r.value;return u.jsx(A4,{scope:n.__scopeMenu,checked:i,children:u.jsx(tv,{role:"menuitemradio","aria-checked":i,...s,ref:e,"data-state":D1(i),onSelect:ie(s.onSelect,()=>{var o;return(o=r.onValueChange)==null?void 0:o.call(r,t)},{checkForDefaultPrevented:!1})})})});_4.displayName=S4;var L1="MenuItemIndicator",[A4,Ite]=pc(L1,{checked:!1}),I4=T.forwardRef((n,e)=>{const{__scopeMenu:t,forceMount:s,...r}=n,i=Ite(L1,t);return u.jsx(wr,{present:s||b0(i.checked)||i.checked===!0,children:u.jsx(Se.span,{...r,ref:e,"data-state":D1(i.checked)})})});I4.displayName=L1;var Rte="MenuSeparator",R4=T.forwardRef((n,e)=>{const{__scopeMenu:t,...s}=n;return u.jsx(Se.div,{role:"separator","aria-orientation":"horizontal",...s,ref:e})});R4.displayName=Rte;var Cte="MenuArrow",C4=T.forwardRef((n,e)=>{const{__scopeMenu:t,...s}=n,r=ev(t);return u.jsx(bS,{...r,...s,ref:e})});C4.displayName=Cte;var Pte="MenuSub",[Fpe,P4]=pc(Pte),Rh="MenuSubTrigger",k4=T.forwardRef((n,e)=>{const t=gc(Rh,n.__scopeMenu),s=ym(Rh,n.__scopeMenu),r=P4(Rh,n.__scopeMenu),i=P1(Rh,n.__scopeMenu),o=T.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:l}=i,c={__scopeMenu:n.__scopeMenu},d=T.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return T.useEffect(()=>d,[d]),T.useEffect(()=>{const h=a.current;return()=>{window.clearTimeout(h),l(null)}},[a,l]),u.jsx(R1,{asChild:!0,...c,children:u.jsx(E4,{id:r.triggerId,"aria-haspopup":"menu","aria-expanded":t.open,"aria-controls":r.contentId,"data-state":D4(t.open),...n,ref:dy(e,r.onTriggerChange),onClick:h=>{var f;(f=n.onClick)==null||f.call(n,h),!(n.disabled||h.defaultPrevented)&&(h.currentTarget.focus(),t.open||t.onOpenChange(!0))},onPointerMove:ie(n.onPointerMove,Lf(h=>{i.onItemEnter(h),!h.defaultPrevented&&!n.disabled&&!t.open&&!o.current&&(i.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{t.onOpenChange(!0),d()},100))})),onPointerLeave:ie(n.onPointerLeave,Lf(h=>{var m,p;d();const f=(m=t.content)==null?void 0:m.getBoundingClientRect();if(f){const y=(p=t.content)==null?void 0:p.dataset.side,v=y==="right",x=v?-5:5,E=f[v?"left":"right"],w=f[v?"right":"left"];i.onPointerGraceIntentChange({area:[{x:h.clientX+x,y:h.clientY},{x:E,y:f.top},{x:w,y:f.top},{x:w,y:f.bottom},{x:E,y:f.bottom}],side:y}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>i.onPointerGraceIntentChange(null),300)}else{if(i.onTriggerLeave(h),h.defaultPrevented)return;i.onPointerGraceIntentChange(null)}})),onKeyDown:ie(n.onKeyDown,h=>{var m;const f=i.searchRef.current!=="";n.disabled||f&&h.key===" "||ute[s.dir].includes(h.key)&&(t.onOpenChange(!0),(m=t.content)==null||m.focus(),h.preventDefault())})})})});k4.displayName=Rh;var N4="MenuSubContent",L4=T.forwardRef((n,e)=>{const t=g4(gr,n.__scopeMenu),{forceMount:s=t.forceMount,...r}=n,i=gc(gr,n.__scopeMenu),o=ym(gr,n.__scopeMenu),a=P4(N4,n.__scopeMenu),l=T.useRef(null),c=ze(e,l);return u.jsx(Nf.Provider,{scope:n.__scopeMenu,children:u.jsx(wr,{present:s||i.open,children:u.jsx(Nf.Slot,{scope:n.__scopeMenu,children:u.jsx(k1,{id:a.contentId,"aria-labelledby":a.triggerId,...r,ref:c,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:d=>{var h;o.isUsingKeyboardRef.current&&((h=l.current)==null||h.focus()),d.preventDefault()},onCloseAutoFocus:d=>d.preventDefault(),onFocusOutside:ie(n.onFocusOutside,d=>{d.target!==a.trigger&&i.onOpenChange(!1)}),onEscapeKeyDown:ie(n.onEscapeKeyDown,d=>{o.onClose(),d.preventDefault()}),onKeyDown:ie(n.onKeyDown,d=>{var m;const h=d.currentTarget.contains(d.target),f=dte[o.dir].includes(d.key);h&&f&&(i.onOpenChange(!1),(m=a.trigger)==null||m.focus(),d.preventDefault())})})})})})});L4.displayName=N4;function D4(n){return n?"open":"closed"}function b0(n){return n==="indeterminate"}function D1(n){return b0(n)?"indeterminate":n?"checked":"unchecked"}function kte(n){const e=document.activeElement;for(const t of n)if(t===e||(t.focus(),document.activeElement!==e))return}function Nte(n,e){return n.map((t,s)=>n[(e+s)%n.length])}function Lte(n,e,t){const r=e.length>1&&Array.from(e).every(c=>c===e[0])?e[0]:e,i=t?n.indexOf(t):-1;let o=Nte(n,Math.max(i,0));r.length===1&&(o=o.filter(c=>c!==t));const l=o.find(c=>c.toLowerCase().startsWith(r.toLowerCase()));return l!==t?l:void 0}function Dte(n,e){const{x:t,y:s}=n;let r=!1;for(let i=0,o=e.length-1;i<e.length;o=i++){const a=e[i].x,l=e[i].y,c=e[o].x,d=e[o].y;l>s!=d>s&&t<(c-a)*(s-l)/(d-l)+a&&(r=!r)}return r}function Mte(n,e){if(!e)return!1;const t={x:n.clientX,y:n.clientY};return Dte(t,e)}function Lf(n){return e=>e.pointerType==="mouse"?n(e):void 0}var Ote=p4,jte=R1,Fte=y4,Ute=v4,Vte=N1,$te=x4,Bte=tv,Gte=w4,Kte=b4,Hte=_4,Wte=I4,zte=R4,qte=C4,Yte=k4,Qte=L4,M1="DropdownMenu",[Xte,Upe]=Ds(M1,[f4]),gs=f4(),[Jte,M4]=Xte(M1),O4=n=>{const{__scopeDropdownMenu:e,children:t,dir:s,open:r,defaultOpen:i,onOpenChange:o,modal:a=!0}=n,l=gs(e),c=T.useRef(null),[d=!1,h]=Br({prop:r,defaultProp:i,onChange:o});return u.jsx(Jte,{scope:e,triggerId:mr(),triggerRef:c,contentId:mr(),open:d,onOpenChange:h,onOpenToggle:T.useCallback(()=>h(f=>!f),[h]),modal:a,children:u.jsx(Ote,{...l,open:d,onOpenChange:h,dir:s,modal:a,children:t})})};O4.displayName=M1;var j4="DropdownMenuTrigger",F4=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,disabled:s=!1,...r}=n,i=M4(j4,t),o=gs(t);return u.jsx(jte,{asChild:!0,...o,children:u.jsx(Se.button,{type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":s?"":void 0,disabled:s,...r,ref:dy(e,i.triggerRef),onPointerDown:ie(n.onPointerDown,a=>{!s&&a.button===0&&a.ctrlKey===!1&&(i.onOpenToggle(),i.open||a.preventDefault())}),onKeyDown:ie(n.onKeyDown,a=>{s||(["Enter"," "].includes(a.key)&&i.onOpenToggle(),a.key==="ArrowDown"&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});F4.displayName=j4;var Zte="DropdownMenuPortal",U4=n=>{const{__scopeDropdownMenu:e,...t}=n,s=gs(e);return u.jsx(Fte,{...s,...t})};U4.displayName=Zte;var V4="DropdownMenuContent",$4=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,r=M4(V4,t),i=gs(t),o=T.useRef(!1);return u.jsx(Ute,{id:r.contentId,"aria-labelledby":r.triggerId,...i,...s,ref:e,onCloseAutoFocus:ie(n.onCloseAutoFocus,a=>{var l;o.current||(l=r.triggerRef.current)==null||l.focus(),o.current=!1,a.preventDefault()}),onInteractOutside:ie(n.onInteractOutside,a=>{const l=a.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,d=l.button===2||c;(!r.modal||d)&&(o.current=!0)}),style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});$4.displayName=V4;var ene="DropdownMenuGroup",tne=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,r=gs(t);return u.jsx(Vte,{...r,...s,ref:e})});tne.displayName=ene;var nne="DropdownMenuLabel",B4=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,r=gs(t);return u.jsx($te,{...r,...s,ref:e})});B4.displayName=nne;var sne="DropdownMenuItem",G4=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,r=gs(t);return u.jsx(Bte,{...r,...s,ref:e})});G4.displayName=sne;var rne="DropdownMenuCheckboxItem",K4=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,r=gs(t);return u.jsx(Gte,{...r,...s,ref:e})});K4.displayName=rne;var ine="DropdownMenuRadioGroup",one=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,r=gs(t);return u.jsx(Kte,{...r,...s,ref:e})});one.displayName=ine;var ane="DropdownMenuRadioItem",H4=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,r=gs(t);return u.jsx(Hte,{...r,...s,ref:e})});H4.displayName=ane;var lne="DropdownMenuItemIndicator",W4=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,r=gs(t);return u.jsx(Wte,{...r,...s,ref:e})});W4.displayName=lne;var cne="DropdownMenuSeparator",z4=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,r=gs(t);return u.jsx(zte,{...r,...s,ref:e})});z4.displayName=cne;var une="DropdownMenuArrow",dne=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,r=gs(t);return u.jsx(qte,{...r,...s,ref:e})});dne.displayName=une;var hne="DropdownMenuSubTrigger",q4=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,r=gs(t);return u.jsx(Yte,{...r,...s,ref:e})});q4.displayName=hne;var fne="DropdownMenuSubContent",Y4=T.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,r=gs(t);return u.jsx(Qte,{...r,...s,ref:e,style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Y4.displayName=fne;var mne=O4,pne=F4,gne=U4,Q4=$4,X4=B4,J4=G4,Z4=K4,e3=H4,t3=W4,n3=z4,s3=q4,r3=Y4;const yne=mne,vne=pne,xne=T.forwardRef(({className:n,inset:e,children:t,...s},r)=>u.jsxs(s3,{ref:r,className:Ae("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",n),...s,children:[t,u.jsx(cs,{className:"ml-auto"})]}));xne.displayName=s3.displayName;const Ene=T.forwardRef(({className:n,...e},t)=>u.jsx(r3,{ref:t,className:Ae("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",n),...e}));Ene.displayName=r3.displayName;const i3=T.forwardRef(({className:n,sideOffset:e=4,...t},s)=>u.jsx(gne,{children:u.jsx(Q4,{ref:s,sideOffset:e,className:Ae("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",n),...t})}));i3.displayName=Q4.displayName;const oT=T.forwardRef(({className:n,inset:e,...t},s)=>u.jsx(J4,{ref:s,className:Ae("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",n),...t}));oT.displayName=J4.displayName;const wne=T.forwardRef(({className:n,children:e,checked:t,...s},r)=>u.jsxs(Z4,{ref:r,className:Ae("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),checked:t,...s,children:[u.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:u.jsx(t3,{children:u.jsx(aS,{className:"h-4 w-4"})})}),e]}));wne.displayName=Z4.displayName;const Tne=T.forwardRef(({className:n,children:e,...t},s)=>u.jsxs(e3,{ref:s,className:Ae("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...t,children:[u.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:u.jsx(t3,{children:u.jsx(tK,{className:"h-2 w-2 fill-current"})})}),e]}));Tne.displayName=e3.displayName;const bne=T.forwardRef(({className:n,inset:e,...t},s)=>u.jsx(X4,{ref:s,className:Ae("px-2 py-1.5 text-sm font-semibold",e&&"pl-8",n),...t}));bne.displayName=X4.displayName;const Sne=T.forwardRef(({className:n,...e},t)=>u.jsx(n3,{ref:t,className:Ae("-mx-1 my-1 h-px bg-muted",n),...e}));Sne.displayName=n3.displayName;function _ne({backgroundImage:n}){var w,b,C,D,_;const[e,t]=Ls(),[s,r]=T.useState(""),[i,o]=T.useState(!1),[a,l]=T.useState(!1),[c,d]=T.useState(!1),h=T.useRef(null),{currentUser:f,userProfile:m,logout:p}=Ms(),y=async()=>{await p(),t("/")},{data:v}=Zn({queryKey:["/api/search/suggestions",s],queryFn:async()=>{const S=await fetch(`/api/search/suggestions?q=${encodeURIComponent(s)}`);if(!S.ok)throw new Error("Failed to fetch suggestions");return S.json()},enabled:s.length>2&&i});T.useEffect(()=>{const S=I=>{h.current&&!h.current.contains(I.target)&&o(!1)};return document.addEventListener("mousedown",S),()=>document.removeEventListener("mousedown",S)},[]);const x=S=>{S.preventDefault(),s.trim()&&(window.location.href=`/search?q=${encodeURIComponent(s)}`,o(!1),r(""))},E=e==="/";return u.jsxs("nav",{className:"fixed top-0 left-0 right-0 z-50",children:[E&&n&&u.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[u.jsx("img",{src:n,alt:"",className:"w-full h-full object-cover blur-md scale-110 opacity-40"}),u.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-background/95 via-background/85 to-background/70"})]}),!E&&u.jsx("div",{className:"absolute inset-0 bg-background/98 backdrop-blur-xl border-b border-border/50"}),u.jsxs("div",{className:"relative container mx-auto px-4",children:[u.jsxs("div",{className:"flex items-center justify-between h-20",children:[u.jsx(be,{href:"/",children:u.jsx("div",{className:"flex items-center cursor-pointer group","data-testid":"link-home",children:u.jsx("img",{src:"/logo.png",alt:"AnimeBite Logo",className:`
                  h-11 w-auto          /* mobile default */
                  sm:h-12             /* small screens */
                  md:h-13             /* desktop */
                  lg:h-13             /* large desktop */
                  object-contain
                  transition-transform
                  group-hover:scale-105
                `})})}),u.jsxs("div",{className:"hidden md:flex items-center gap-4 flex-1 max-w-3xl mx-12",children:[u.jsxs("div",{className:"flex items-center gap-1",children:[u.jsx(be,{href:"/",children:u.jsxs(ne,{variant:"ghost",size:"sm",className:`gap-2 ${e==="/"?"text-primary bg-primary/10":"text-foreground/80 hover:text-foreground"}`,children:[u.jsx(Sw,{className:"w-4 h-4"}),"Home"]})}),u.jsx(be,{href:"/search",children:u.jsxs(ne,{variant:"ghost",size:"sm",className:`gap-2 ${e==="/search"?"text-primary bg-primary/10":"text-foreground/80 hover:text-foreground"}`,"data-testid":"button-advanced-search",children:[u.jsx(oR,{className:"w-4 h-4"}),"Explore"]})}),u.jsx(be,{href:"/azlist",children:u.jsxs(ne,{variant:"ghost",size:"sm",className:`gap-2 ${e==="/azlist"?"text-primary bg-primary/10":"text-foreground/80 hover:text-foreground"}`,"data-testid":"link-azlist",children:[u.jsx(aR,{className:"w-4 h-4"}),"A-Z List"]})}),u.jsx(be,{href:"/movies",children:u.jsxs(ne,{variant:"ghost",size:"sm",className:`gap-2 ${e==="/movies"?"text-primary bg-primary/10":"text-foreground/80 hover:text-foreground"}`,children:[u.jsx(Nr,{className:"w-4 h-4"}),"Movies"]})}),u.jsx(be,{href:"/tv-series",children:u.jsxs(ne,{variant:"ghost",size:"sm",className:`gap-2 ${e==="/tv-series"?"text-primary bg-primary/10":"text-foreground/80 hover:text-foreground"}`,children:[u.jsx(Xg,{className:"w-4 h-4"}),"TV Series"]})}),u.jsx(be,{href:"/forum",children:u.jsxs(ne,{variant:"ghost",size:"sm",className:`gap-2 ${e==="/forum"||e.startsWith("/forum/")?"text-primary bg-primary/10":"text-foreground/80 hover:text-foreground"}`,children:[u.jsx(li,{className:"w-4 h-4"}),"Forum"]})})]}),u.jsxs("div",{className:"relative flex-1",ref:h,children:[u.jsxs("form",{onSubmit:x,className:"relative",children:[u.jsx(gu,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),u.jsx(bn,{type:"search",placeholder:"Search anime...",className:"pl-11 pr-4 h-11 bg-background/40 backdrop-blur-sm border-border/50 rounded-full focus:bg-background/60 transition-all",value:s,onChange:S=>{r(S.target.value),o(!0)},onFocus:()=>o(!0),"data-testid":"input-search"})]}),i&&((w=v==null?void 0:v.data)==null?void 0:w.suggestions)&&v.data.suggestions.length>0&&u.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-popover/95 backdrop-blur-xl border border-popover-border rounded-lg shadow-2xl max-h-96 overflow-y-auto z-50",children:v.data.suggestions.map(S=>u.jsx(be,{href:`/anime/${S.id}`,children:u.jsxs("div",{className:"flex gap-3 p-3 hover-elevate active-elevate-2 cursor-pointer rounded-lg",onClick:()=>{o(!1),r("")},"data-testid":`suggestion-${S.id}`,children:[u.jsx("img",{src:S.poster,alt:S.name,className:"w-12 h-16 object-cover rounded-md"}),u.jsxs("div",{className:"flex-1 min-w-0",children:[u.jsx("h4",{className:"text-sm font-semibold text-popover-foreground line-clamp-1",children:S.name}),S.jname&&u.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1",children:S.jname}),S.moreInfo&&S.moreInfo.length>0&&u.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1",children:S.moreInfo.join("  ")})]})]})},S.id))})]})]}),u.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[u.jsx("a",{href:"https://discord.gg/V5AWy78VTv",target:"_blank",rel:"noopener noreferrer",children:u.jsx(ne,{variant:"ghost",size:"icon",className:"gap-2",children:u.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:u.jsx("path",{d:"M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"})})})}),f&&m?u.jsxs(yne,{children:[u.jsx(vne,{asChild:!0,children:u.jsxs(ne,{variant:"ghost",className:"gap-2",children:[u.jsxs(Ps,{className:"h-8 w-8",children:[u.jsx(ks,{src:m.avatarUrl}),u.jsx(Ns,{children:(b=m.username[0])==null?void 0:b.toUpperCase()})]}),u.jsx("span",{className:"hidden lg:inline",children:m.username})]})}),u.jsxs(i3,{align:"end",children:[u.jsx(oT,{onClick:()=>t(`/profile/${m.username}`),children:"Profile"}),u.jsxs(oT,{onClick:y,children:[u.jsx(ix,{className:"mr-2 h-4 w-4"}),"Logout"]})]})]}):u.jsxs(u.Fragment,{children:[u.jsx(be,{href:"/auth/login",children:u.jsxs(ne,{variant:"ghost",children:[u.jsx(ix,{className:"mr-2 h-4 w-4"}),"Login"]})}),u.jsx(be,{href:"/auth/signup",children:u.jsx(ne,{children:"Sign Up"})})]})]}),u.jsxs("div",{className:"flex md:hidden items-center gap-2",children:[u.jsx(be,{href:"/search",children:u.jsx(ne,{variant:"ghost",size:"icon",children:u.jsx(gu,{className:"h-5 w-5"})})}),u.jsx("a",{href:"https://discord.gg/V5AWy78VTv",target:"_blank",rel:"noopener noreferrer",children:u.jsx(ne,{variant:"ghost",size:"icon",children:u.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:u.jsx("path",{d:"M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"})})})}),f&&m?u.jsx(be,{href:`/profile/${m.username}`,children:u.jsx(ne,{variant:"ghost",size:"icon",children:u.jsxs(Ps,{className:"h-8 w-8",children:[u.jsx(ks,{src:m.avatarUrl}),u.jsx(Ns,{children:(C=m.username[0])==null?void 0:C.toUpperCase()})]})})}):u.jsx(be,{href:"/auth/login",children:u.jsx(ne,{variant:"ghost",size:"icon",children:u.jsx(dR,{className:"h-5 w-5"})})}),u.jsx(ne,{variant:"ghost",size:"icon",onClick:()=>l(!a),"data-testid":"button-mobile-menu",children:a?u.jsx(lr,{}):u.jsx(hK,{})})]})]}),c&&u.jsx("div",{className:"md:hidden fixed inset-0 z-[100] bg-background",children:u.jsxs("div",{className:"flex flex-col h-full",children:[u.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-border",children:[u.jsx(ne,{variant:"ghost",size:"icon",onClick:()=>{d(!1),o(!1),r("")},children:u.jsx(lr,{className:"h-5 w-5"})}),u.jsx("h2",{className:"text-lg font-semibold",children:"Search Anime"})]}),u.jsx("div",{className:"p-4",children:u.jsx("form",{onSubmit:S=>{x(S),d(!1)},children:u.jsxs("div",{className:"relative",children:[u.jsx(gu,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),u.jsx(bn,{type:"search",placeholder:"Search anime...",className:"pl-12 pr-4 h-12 text-base rounded-full",value:s,onChange:S=>{r(S.target.value),o(!0)},autoFocus:!0,"data-testid":"input-search-mobile"})]})})}),u.jsxs("div",{className:"flex-1 overflow-y-auto px-4",children:[i&&((D=v==null?void 0:v.data)==null?void 0:D.suggestions)&&v.data.suggestions.length>0&&u.jsx("div",{className:"space-y-2 pb-4",children:v.data.suggestions.map(S=>u.jsxs("a",{href:`/anime/${S.id}`,className:"flex gap-3 p-3 bg-card border border-border rounded-lg hover:bg-accent transition-colors active:scale-[0.98]","data-testid":`suggestion-${S.id}`,children:[u.jsx("img",{src:S.poster,alt:S.name,className:"w-16 h-20 object-cover rounded-md flex-shrink-0"}),u.jsxs("div",{className:"flex-1 min-w-0",children:[u.jsx("h4",{className:"text-base font-semibold text-foreground line-clamp-2 mb-1",children:S.name}),S.jname&&u.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1 mb-1",children:S.jname}),S.moreInfo&&S.moreInfo.length>0&&u.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1",children:S.moreInfo.join("  ")})]})]},S.id))}),i&&s.length>2&&(!((_=v==null?void 0:v.data)!=null&&_.suggestions)||v.data.suggestions.length===0)&&u.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:['No results found for "',s,'"']})]})]})}),a&&u.jsx("div",{className:"md:hidden absolute top-full left-0 right-0 mt-2 mx-4 bg-background/98 backdrop-blur-xl border border-border/50 rounded-2xl shadow-2xl overflow-hidden animate-in slide-in-from-top-2 duration-200",children:u.jsxs("div",{className:"p-3 space-y-1",children:[u.jsxs("div",{className:"space-y-1",children:[u.jsx(be,{href:"/",children:u.jsxs("button",{className:`w-full flex items-center gap-4 px-4 py-3.5 rounded-xl transition-all duration-200 ${e==="/"?"bg-primary/15 text-primary shadow-sm":"text-foreground/80 hover:bg-accent/50 hover:text-foreground active:scale-[0.98]"}`,onClick:()=>l(!1),children:[u.jsx("div",{className:`p-2 rounded-lg ${e==="/"?"bg-primary/20":"bg-accent/50"}`,children:u.jsx(Sw,{className:"w-5 h-5"})}),u.jsx("span",{className:"font-medium text-base",children:"Home"})]})}),u.jsx(be,{href:"/search",children:u.jsxs("button",{className:`w-full flex items-center gap-4 px-4 py-3.5 rounded-xl transition-all duration-200 ${e==="/search"?"bg-primary/15 text-primary shadow-sm":"text-foreground/80 hover:bg-accent/50 hover:text-foreground active:scale-[0.98]"}`,onClick:()=>l(!1),children:[u.jsx("div",{className:`p-2 rounded-lg ${e==="/search"?"bg-primary/20":"bg-accent/50"}`,children:u.jsx(oR,{className:"w-5 h-5"})}),u.jsx("span",{className:"font-medium text-base",children:"Explore"})]})}),u.jsx(be,{href:"/azlist",children:u.jsxs("button",{className:`w-full flex items-center gap-4 px-4 py-3.5 rounded-xl transition-all duration-200 ${e==="/azlist"?"bg-primary/15 text-primary shadow-sm":"text-foreground/80 hover:bg-accent/50 hover:text-foreground active:scale-[0.98]"}`,onClick:()=>l(!1),children:[u.jsx("div",{className:`p-2 rounded-lg ${e==="/azlist"?"bg-primary/20":"bg-accent/50"}`,children:u.jsx(aR,{className:"w-5 h-5"})}),u.jsx("span",{className:"font-medium text-base",children:"A-Z List"})]})})]}),u.jsx("div",{className:"h-px bg-border/50 my-2"}),u.jsxs("div",{className:"space-y-1",children:[u.jsx(be,{href:"/movies",children:u.jsxs("button",{className:`w-full flex items-center gap-4 px-4 py-3.5 rounded-xl transition-all duration-200 ${e==="/movies"?"bg-primary/15 text-primary shadow-sm":"text-foreground/80 hover:bg-accent/50 hover:text-foreground active:scale-[0.98]"}`,onClick:()=>l(!1),children:[u.jsx("div",{className:`p-2 rounded-lg ${e==="/movies"?"bg-primary/20":"bg-accent/50"}`,children:u.jsx(Nr,{className:"w-5 h-5"})}),u.jsx("span",{className:"font-medium text-base",children:"Movies"})]})}),u.jsx(be,{href:"/tv-series",children:u.jsxs("button",{className:`w-full flex items-center gap-4 px-4 py-3.5 rounded-xl transition-all duration-200 ${e==="/tv-series"?"bg-primary/15 text-primary shadow-sm":"text-foreground/80 hover:bg-accent/50 hover:text-foreground active:scale-[0.98]"}`,onClick:()=>l(!1),children:[u.jsx("div",{className:`p-2 rounded-lg ${e==="/tv-series"?"bg-primary/20":"bg-accent/50"}`,children:u.jsx(Xg,{className:"w-5 h-5"})}),u.jsx("span",{className:"font-medium text-base",children:"TV Series"})]})})]}),u.jsx("div",{className:"h-px bg-border/50 my-2"}),u.jsx("div",{className:"space-y-1",children:u.jsx(be,{href:"/forum",children:u.jsxs("button",{className:`w-full flex items-center gap-4 px-4 py-3.5 rounded-xl transition-all duration-200 ${e==="/forum"||e.startsWith("/forum/")?"bg-primary/15 text-primary shadow-sm":"text-foreground/80 hover:bg-accent/50 hover:text-foreground active:scale-[0.98]"}`,onClick:()=>l(!1),children:[u.jsx("div",{className:`p-2 rounded-lg ${e==="/forum"||e.startsWith("/forum/")?"bg-primary/20":"bg-accent/50"}`,children:u.jsx(li,{className:"w-5 h-5"})}),u.jsx("span",{className:"font-medium text-base",children:"Forum"})]})})}),!f&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"h-px bg-border/50 my-2"}),u.jsxs("div",{className:"space-y-2 pt-1",children:[u.jsx(be,{href:"/auth/login",children:u.jsxs("button",{className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-xl bg-accent/50 hover:bg-accent text-foreground font-medium transition-all duration-200 active:scale-[0.98]",onClick:()=>l(!1),children:[u.jsx(ix,{className:"w-5 h-5"}),"Login"]})}),u.jsx(be,{href:"/auth/signup",children:u.jsxs("button",{className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-xl bg-primary text-primary-foreground font-medium shadow-sm transition-all duration-200 active:scale-[0.98]",onClick:()=>l(!1),children:[u.jsx(dR,{className:"w-5 h-5"}),"Sign Up"]})})]})]})]})})]})]})}const o3=T.createContext(void 0);function Ane({children:n}){const[e,t]=T.useState(()=>localStorage.getItem("preferred-language")||"en");T.useEffect(()=>{localStorage.setItem("preferred-language",e)},[e]);const s=()=>{t(r=>r==="en"?"jp":"en")};return u.jsx(o3.Provider,{value:{language:e,toggleLanguage:s},children:n})}function nv(){const n=T.useContext(o3);if(n===void 0)throw new Error("useLanguage must be used within a LanguageProvider");return n}function Ine(){const{language:n,toggleLanguage:e}=nv();return u.jsx("footer",{className:"bg-background/95 border-t border-border/50 backdrop-blur-xl mt-20",children:u.jsxs("div",{className:"container mx-auto px-4 py-12",children:[u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-8",children:[u.jsxs("div",{className:"space-y-4",children:[u.jsx(be,{href:"/",children:u.jsx("div",{className:"flex items-center cursor-pointer group",children:u.jsx("img",{src:"/logo.png",alt:"AnimeBite Logo",className:"h-12 w-auto object-contain transition-transform group-hover:scale-105"})})}),u.jsx("p",{className:"text-sm text-muted-foreground max-w-xs",children:"Your ultimate destination for streaming anime. Watch thousands of anime series and movies in HD quality."}),u.jsxs("div",{className:"flex gap-3",children:[u.jsx("a",{href:"https://discord.com/invite/V5AWy78VTv",target:"_blank",rel:"noopener noreferrer",children:u.jsx(ne,{variant:"ghost",size:"icon",className:"h-8 w-8",children:u.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor",children:u.jsx("path",{d:"M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"})})})}),u.jsx("a",{href:"https://t.me/+8Wluy50R049kMmVk",target:"_blank",rel:"noopener noreferrer",children:u.jsx(ne,{variant:"ghost",size:"icon",className:"h-8 w-8",children:u.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor",children:u.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10s10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19c-.14.75-.42 1-.68 1.03c-.58.05-1.02-.38-1.58-.75c-.88-.58-1.38-.94-2.23-1.5c-.99-.65-.35-1.01.22-1.59c.15-.15 2.71-2.48 2.76-2.69a.2.2 0 0 0-.05-.18c-.06-.05-.14-.03-.21-.02c-.09.02-1.49.95-4.22 2.79c-.4.27-.76.41-1.08.4c-.36-.01-1.04-.2-1.55-.37c-.63-.2-1.12-.31-1.08-.66c.02-.18.27-.36.74-.55c2.92-1.27 4.86-2.11 5.83-2.51c2.78-1.16 3.35-1.36 3.73-1.36c.08 0 .27.02.39.12c.1.08.13.19.14.27c-.01.06.01.24 0 .38z"})})})}),u.jsx("a",{href:"https://www.reddit.com/user/ky0dan/",target:"_blank",rel:"noopener noreferrer",children:u.jsx(ne,{variant:"ghost",size:"icon",className:"h-8 w-8",children:u.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor",children:u.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10s10-4.48 10-10S17.52 2 12 2zm5.6 11.7c0 .7-.2 1.4-.6 1.9c-.9 1.3-2.7 2-4.9 2s-4.1-.7-5-2c-.4-.5-.6-1.2-.6-1.9c0-1.3.9-2.4 2.1-2.7c-.1-.2-.1-.4-.1-.6c0-.9.7-1.6 1.6-1.6c.5 0 .9.2 1.2.5c1.1-.8 2.6-1.3 4.2-1.3l.8-3.7l2.5.6l.1.1c.5-.4 1.1-.6 1.7-.6c1.3 0 2.4 1.1 2.4 2.4s-1.1 2.4-2.4 2.4s-2.4-1.1-2.4-2.4l-2.2-.5l-.7 3.1c1.5.1 2.9.6 4 1.3c.3-.3.7-.5 1.2-.5c.9 0 1.6.7 1.6 1.6c0 .2 0 .4-.1.6c1.2.3 2.1 1.4 2.1 2.7zm-3.6-6.5c0-.6-.5-1.1-1.1-1.1s-1.1.5-1.1 1.1s.5 1.1 1.1 1.1s1.1-.5 1.1-1.1zM8.9 11c-.6 0-1.1.5-1.1 1.1s.5 1.1 1.1 1.1s1.1-.5 1.1-1.1s-.5-1.1-1.1-1.1zm6.2 0c-.6 0-1.1.5-1.1 1.1s.5 1.1 1.1 1.1s1.1-.5 1.1-1.1s-.5-1.1-1.1-1.1zm-4.5 4.5c.3.3.7.5 1.2.6c.4.1.9.2 1.3.2s.9-.1 1.3-.2c.5-.1.9-.3 1.2-.6c.2-.2.2-.5 0-.7s-.5-.2-.7 0c-.4.4-1.1.6-1.8.6s-1.4-.2-1.8-.6c-.2-.2-.5-.2-.7 0s-.2.5 0 .7z"})})})})]})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsx("h3",{className:"font-semibold text-foreground",children:"Browse"}),u.jsxs("ul",{className:"space-y-2",children:[u.jsx("li",{children:u.jsx(be,{href:"/category/trending",className:"text-sm text-muted-foreground hover:text-primary transition-colors cursor-pointer",children:"Trending Anime"})}),u.jsx("li",{children:u.jsx(be,{href:"/category/recently-updated",className:"text-sm text-muted-foreground hover:text-primary transition-colors cursor-pointer",children:"Recent Releases"})}),u.jsx("li",{children:u.jsx(be,{href:"/category/top-airing",className:"text-sm text-muted-foreground hover:text-primary transition-colors cursor-pointer",children:"Top Airing"})}),u.jsx("li",{children:u.jsx(be,{href:"/category/top-upcoming",className:"text-sm text-muted-foreground hover:text-primary transition-colors cursor-pointer",children:"Top Upcoming"})})]})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsx("h3",{className:"font-semibold text-foreground",children:"Support"}),u.jsxs("ul",{className:"space-y-2",children:[u.jsx("li",{children:u.jsx(be,{href:"/forum",className:"text-sm text-muted-foreground hover:text-primary transition-colors cursor-pointer",children:"Community Forum"})}),u.jsx("li",{children:u.jsx(be,{href:"/contact",className:"text-sm text-muted-foreground hover:text-primary transition-colors cursor-pointer",children:"Contact Us"})}),u.jsx("li",{children:u.jsx(be,{href:"/report-issue",className:"text-sm text-muted-foreground hover:text-primary transition-colors cursor-pointer",children:"Report Issue"})}),u.jsx("li",{children:u.jsx(be,{href:"/faq",className:"text-sm text-muted-foreground hover:text-primary transition-colors cursor-pointer",children:"FAQ"})})]})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsx("h3",{className:"font-semibold text-foreground",children:"Legal"}),u.jsxs("ul",{className:"space-y-2",children:[u.jsx("li",{children:u.jsx(be,{href:"/terms",className:"text-sm text-muted-foreground hover:text-primary transition-colors cursor-pointer",children:"Terms of Service"})}),u.jsx("li",{children:u.jsx(be,{href:"/privacy",className:"text-sm text-muted-foreground hover:text-primary transition-colors cursor-pointer",children:"Privacy Policy"})}),u.jsx("li",{children:u.jsx(be,{href:"/dmca",className:"text-sm text-muted-foreground hover:text-primary transition-colors cursor-pointer",children:"DMCA"})}),u.jsx("li",{children:u.jsx(be,{href:"/disclaimer",className:"text-sm text-muted-foreground hover:text-primary transition-colors cursor-pointer",children:"Disclaimer"})}),u.jsx("li",{children:u.jsx(be,{href:"/about",className:"text-sm text-muted-foreground hover:text-primary transition-colors cursor-pointer",children:"About Us"})})]})]})]}),u.jsx("div",{className:"mb-8 p-6 rounded-xl bg-gradient-to-r from-primary/10 via-primary/5 to-transparent border border-primary/20",children:u.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsx("div",{className:"h-12 w-12 rounded-full bg-primary/20 flex items-center justify-center",children:u.jsx(lR,{className:"h-6 w-6 text-primary"})}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-semibold text-foreground mb-1",children:"Join our Discord Community"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Connect with fellow anime fans and stay updated!"})]})]}),u.jsx("a",{href:"https://discord.gg/V5AWy78VTv",target:"_blank",rel:"noopener noreferrer",children:u.jsxs(ne,{className:"gap-2 bg-[#5865F2] hover:bg-[#4752C4] text-white",children:[u.jsx(lR,{className:"h-4 w-4"}),"Join Discord"]})})]})}),u.jsx("div",{className:"mb-6 p-4 rounded-lg bg-muted/50 border border-border/50",children:u.jsx("p",{className:"text-xs text-muted-foreground text-center leading-relaxed",children:"AnimeBite does not host any files, it merely pulls streams from 3rd party services. Legal issues should be taken up with the file hosts and providers. AnimeBite is not responsible for any media files shown by the video providers."})}),u.jsx("div",{className:"pt-6 border-t border-border/50",children:u.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[u.jsxs("p",{className:"text-sm text-muted-foreground text-center sm:text-left",children:[" ",new Date().getFullYear()," AnimeBite. Made with"," ",u.jsx(cc,{className:"inline h-3 w-3 text-red-500 fill-red-500"})," for anime lovers. All rights reserved."]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(lK,{className:"h-4 w-4 text-muted-foreground"}),u.jsxs("button",{onClick:e,className:"text-sm font-medium text-muted-foreground hover:text-primary transition-colors flex items-center gap-2 px-3 py-1 rounded-md hover:bg-accent",children:[u.jsx("span",{className:n==="en"?"text-primary":"",children:"EN"}),u.jsx("span",{children:"/"}),u.jsx("span",{className:n==="jp"?"text-primary":"",children:"JP"})]})]})]})})]})})}function vm({title:n,description:e,keywords:t,image:s,url:r}){return T.useEffect(()=>{document.title=n;const i=(o,a,l=!1)=>{const c=l?"property":"name";let d=document.querySelector(`meta[${c}="${o}"]`);d?d.setAttribute("content",a):(d=document.createElement("meta"),d.setAttribute(c,o),d.setAttribute("content",a),document.head.appendChild(d))};i("description",e),t&&i("keywords",t),i("og:title",n,!0),i("og:description",e,!0),i("og:type","website",!0),s&&i("og:image",s,!0),r&&i("og:url",r,!0),i("twitter:card","summary_large_image"),i("twitter:title",n),i("twitter:description",e),s&&i("twitter:image",s)},[n,e,t,s,r]),null}const Rne=my("whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 hover-elevate ",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow-xs",secondary:"border-transparent bg-secondary text-secondary-foreground",destructive:"border-transparent bg-destructive text-destructive-foreground shadow-xs",outline:" border [border-color:var(--badge-outline)] shadow-xs"}},defaultVariants:{variant:"default"}});function qt({className:n,variant:e,...t}){return u.jsx("div",{className:Ae(Rne({variant:e}),n),...t})}function Cne({spotlights:n,onAnimeChange:e}){var m,p,y,v,x;Ls();const[t,s]=T.useState(0),[r,i]=T.useState(!1);if(T.useEffect(()=>{if(r||n.length===0)return;const E=setInterval(()=>{s(w=>(w+1)%n.length)},5e3);return()=>clearInterval(E)},[r,n.length]),!n||n.length===0)return null;const o=n[t];T.useEffect(()=>{e&&o&&e(o)},[o,e]);const{data:a}=Zn({queryKey:["/api/anime",o.id,"episodes"],enabled:!!o.id}),l=(y=(p=(m=a==null?void 0:a.data)==null?void 0:m.episodes)==null?void 0:p[0])==null?void 0:y.episodeId,c=()=>{s(E=>(E-1+n.length)%n.length)},d=()=>{s(E=>(E+1)%n.length)},h=(E,w=150)=>E.length<=w?E:E.slice(0,w).trim()+"...",f=(E,w=60)=>{if(E.length<=w)return E;const b=E.slice(0,w),C=b.lastIndexOf(" ");return C>w*.7?b.slice(0,C)+"...":b+"..."};return u.jsxs("div",{className:"relative w-full h-[45vh] sm:h-[55vh] md:h-[65vh] lg:h-[70vh] overflow-hidden group",onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),"data-testid":"section-hero-carousel",children:[u.jsxs("div",{className:"absolute inset-0",children:[u.jsx("img",{src:o.poster,alt:o.name,className:"w-full h-full object-cover object-[center_20%] sm:object-center"}),u.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-background via-background/90 to-transparent md:from-background/95 md:via-background/80 md:to-transparent"}),u.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background via-transparent to-transparent"})]}),u.jsx("div",{className:"relative z-10 container mx-auto px-3 sm:px-4 md:px-8 h-full flex items-end pb-16 sm:pb-18 md:pb-20 lg:pb-24",children:u.jsxs("div",{className:"max-w-xl md:max-w-2xl space-y-2 sm:space-y-2.5 md:space-y-3",children:[u.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-wrap",children:[u.jsxs(qt,{className:"bg-gradient-to-r from-purple-600 to-purple-500 text-white border-0 px-2 sm:px-3 py-0.5 sm:py-1 text-[10px] sm:text-xs font-bold uppercase tracking-wide shadow-lg shadow-purple-500/30",children:["#",o.rank," SPOTLIGHT"]}),((v=o.otherInfo)==null?void 0:v[0])&&u.jsxs("span",{className:"text-[10px] sm:text-xs text-foreground/70 font-medium flex items-center gap-1",children:[u.jsx(vM,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5"}),o.otherInfo[0]]}),((x=o.otherInfo)==null?void 0:x[1])&&u.jsxs("span",{className:"text-[10px] sm:text-xs text-foreground/70 font-medium flex items-center gap-1",children:[u.jsx(Xg,{className:"w-3 h-3 sm:w-3.5 sm:h-3.5"}),o.otherInfo[1]]})]}),u.jsx("h1",{className:"text-xl sm:text-2xl md:text-4xl lg:text-5xl xl:text-6xl font-black text-foreground leading-tight drop-shadow-2xl","data-testid":`text-hero-title-${o.id}`,children:f(o.name.split("(")[0].trim(),60)}),u.jsx("p",{className:"hidden md:block text-sm lg:text-base text-foreground/70 leading-relaxed max-w-2xl",children:h(o.description,150)}),u.jsxs("div",{className:"flex flex-wrap gap-2 sm:gap-2.5 md:gap-3 pt-2 sm:pt-2.5 md:pt-3",children:[l?u.jsx(be,{href:`/watch/${o.id}?ep=${l}`,children:u.jsxs(ne,{size:"sm",className:"h-9 sm:h-10 md:h-11 gap-1.5 sm:gap-2 px-4 sm:px-5 md:px-6 bg-white text-black hover:bg-white/90 border-0 shadow-xl transition-all hover:scale-105 font-bold text-xs sm:text-sm md:text-base","data-testid":`button-watch-${o.id}`,children:[u.jsx(fi,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 md:w-5 md:h-5 fill-current"}),"Watch Now"]})}):u.jsx(be,{href:`/anime/${o.id}`,children:u.jsxs(ne,{size:"sm",className:"h-9 sm:h-10 md:h-11 gap-1.5 sm:gap-2 px-4 sm:px-5 md:px-6 bg-white text-black hover:bg-white/90 border-0 shadow-xl transition-all hover:scale-105 font-bold text-xs sm:text-sm md:text-base","data-testid":`button-watch-${o.id}`,children:[u.jsx(fi,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 md:w-5 md:h-5 fill-current"}),"Watch Now"]})}),u.jsx(be,{href:`/anime/${o.id}`,children:u.jsxs(ne,{size:"sm",variant:"outline",className:"h-9 sm:h-10 md:h-11 gap-1.5 sm:gap-2 px-4 sm:px-5 md:px-6 backdrop-blur-md bg-white/10 border-white/30 text-white hover:bg-white/20 hover:border-white/50 transition-all hover:scale-105 font-semibold text-xs sm:text-sm md:text-base","data-testid":`button-details-${o.id}`,children:[u.jsx(aK,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 md:w-5 md:h-5"}),u.jsx("span",{className:"hidden sm:inline",children:"More Info"}),u.jsx("span",{className:"sm:hidden",children:"Info"})]})})]})]})}),u.jsx("div",{className:"absolute inset-x-0 top-1/2 -translate-y-1/2 z-20 px-3 sm:px-4 md:px-6 pointer-events-none md:opacity-0 md:group-hover:opacity-100 transition-opacity duration-300",children:u.jsxs("div",{className:"container mx-auto flex justify-between items-center pointer-events-none",children:[u.jsx("button",{onClick:c,className:"hidden md:block pointer-events-auto group/btn bg-black/40 hover:bg-black/60 backdrop-blur-sm rounded-lg p-3 transition-all duration-300 border border-white/20 hover:border-white/40","data-testid":"button-carousel-prev",children:u.jsx(uo,{className:"w-7 h-7 lg:w-8 lg:h-8 text-white transition-transform group-hover/btn:-translate-x-0.5"})}),u.jsx("button",{onClick:c,className:"md:hidden pointer-events-auto bg-gradient-to-br from-purple-600/80 to-purple-500/80 hover:from-purple-600 hover:to-purple-500 backdrop-blur-md rounded-full p-2 sm:p-2.5 active:scale-95 transition-all duration-200 border border-purple-400/30 shadow-lg shadow-purple-500/20 mb-20","data-testid":"button-carousel-prev",children:u.jsx(uo,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white"})}),u.jsx("button",{onClick:d,className:"hidden md:block pointer-events-auto group/btn bg-black/40 hover:bg-black/60 backdrop-blur-sm rounded-lg p-3 transition-all duration-300 border border-white/20 hover:border-white/40 ","data-testid":"button-carousel-next",children:u.jsx(cs,{className:"w-7 h-7 lg:w-8 lg:h-8 text-white transition-transform group-hover/btn:translate-x-0.5"})}),u.jsx("button",{onClick:d,className:"md:hidden pointer-events-auto bg-gradient-to-br from-purple-600/80 to-purple-500/80 hover:from-purple-600 hover:to-purple-500 backdrop-blur-md rounded-full p-2 sm:p-2.5 active:scale-95 transition-all duration-200 border border-purple-400/30 shadow-lg shadow-purple-500/20 mb-20","data-testid":"button-carousel-next",children:u.jsx(cs,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white"})})]})}),u.jsx("div",{className:"absolute bottom-4 sm:bottom-5 md:bottom-6 left-1/2 -translate-x-1/2 z-20 flex gap-1.5 sm:gap-2",children:n.map((E,w)=>u.jsx("button",{onClick:()=>s(w),className:`h-1 rounded-full transition-all duration-300 ${w===t?"w-6 sm:w-8 md:w-10 bg-purple-500 shadow-lg shadow-purple-500/50":"w-3 sm:w-4 bg-white/30 hover:bg-white/50"}`,"data-testid":`button-indicator-${w}`},w))})]})}const ad=n=>{let e=n;const t=/(https?:\/\/(?!animebite)[^\s]+)/gi;e=e.replace(t,"[link removed]");const s=["fuck","shit","bitch","ass","damn","hell","bastard","crap","dick","pussy","cock","nigger","nigga","fag","faggot","retard","whore","slut","cunt"],r=new RegExp(`\\b(${s.join("|")})\\b`,"gi");return e=e.replace(r,"***"),e=e.replace(/(.)\1{4,}/g,"$1$1$1"),e.trim()},a3=async(n,e,t,s)=>{const r=ot(pe,`users/${n}/watchlist/${e}`);await Ai(r,{animeId:e,title:t,posterUrl:s,addedAt:mn()})},l3=async(n,e)=>{const t=ot(pe,`users/${n}/watchlist/${e}`);await Eo(t)},c3=async(n,e)=>{const t=ot(pe,`users/${n}/watchlist/${e}`);return(await fs(t)).exists()},u3=async n=>{const e=ut(pe,`users/${n}/watchlist`);return(await Lt(e)).docs.map(s=>s.data())},d3=async(n,e,t,s,r=!1,i,o,a)=>{var h,f,m;const l=ot(pe,`users/${n}/progress/${e}`),c=await fs(l),d=c.exists()?c.data().completedEpisodes||[]:[];r&&!d.includes(t)&&d.push(t),await Ai(l,{animeId:e,title:i||((h=c.data())==null?void 0:h.title)||"",posterUrl:o||((f=c.data())==null?void 0:f.posterUrl)||"",lastEpisode:t,lastEpisodeId:a||((m=c.data())==null?void 0:m.lastEpisodeId)||"",lastTimestamp:s,isCompleted:r,completedEpisodes:d.sort((p,y)=>p-y),updatedAt:mn()},{merge:!0})},h3=async(n,e)=>{const t=ot(pe,`users/${n}/progress/${e}`),s=await fs(t);return s.exists()?s.data():null},O1=async n=>{const e=ut(pe,`users/${n}/progress`),t=us(e,Io("updatedAt","desc"),zy(20));return(await Lt(t)).docs.map(r=>r.data())},f3=async(n,e,t,s,r,i)=>{const o=ut(pe,`anime/${n}/reviews`),a={userId:e,username:t,avatarUrl:s,rating:r,reviewText:ad(i),createdAt:mn(),likes:0},l=await mc(o,a);return await j1("userPostedReview",e,t,s,n),l.id},m3=async n=>{const e=ut(pe,`anime/${n}/reviews`),t=us(e,Io("createdAt","desc"));return(await Lt(t)).docs.map(r=>({id:r.id,...r.data()}))},p3=async(n,e,t,s,r,i,o)=>{const a=ut(pe,`anime/${n}/episodes/${e}/comments`),l={userId:t,username:s,avatarUrl:r,text:ad(i),timestamp:mn(),likes:0,...o&&{replyTo:o}},c=await mc(a,l);return await j1("userPostedComment",t,s,r,n),c.id},g3=(n,e,t)=>{const s=ut(pe,`anime/${n}/episodes/${e}/comments`),r=us(s,Io("timestamp","desc"));return YZ(r,i=>{const o=i.docs.map(a=>({id:a.id,...a.data()}));t(o)})},y3=async(n,e,t)=>{const s=ot(pe,`anime/${n}/episodes/${e}/comments/${t}`);await wn(s,{likes:Qs(1)})},v3=async(n,e)=>{const t=ot(pe,`anime/${n}/reviews/${e}`);await wn(t,{likes:Qs(1)})},x3=async(n,e,t,s,r,i)=>{const o=ut(pe,`anime/${n}/threads`),a={title:ad(r),body:ad(i),userId:e,username:t,avatarUrl:s,createdAt:mn(),upvotes:0,downvotes:0};return await mc(o,a)},E3=async n=>{const e=ut(pe,`anime/${n}/threads`),t=us(e,Io("createdAt","desc"));return(await Lt(t)).docs.map(r=>({id:r.id,...r.data()}))},w3=async(n,e,t,s)=>{const r=ot(pe,`anime/${n}/threads/${e}/votes/${t}`),i=await fs(r),o=ot(pe,`anime/${n}/threads/${e}`);i.exists()?i.data().voteType===s?(await Eo(r),await wn(o,{[s==="up"?"upvotes":"downvotes"]:Qs(-1)})):(await Ai(r,{voteType:s,votedAt:mn()}),await wn(o,{[s==="up"?"upvotes":"downvotes"]:Qs(1),[s==="up"?"downvotes":"upvotes"]:Qs(-1)})):(await Ai(r,{voteType:s,votedAt:mn()}),await wn(o,{[s==="up"?"upvotes":"downvotes"]:Qs(1)}))},T3=async(n,e,t)=>{const s=ot(pe,`anime/${n}/threads/${e}/votes/${t}`),r=await fs(s);return r.exists()?r.data().voteType:null},b3=async(n,e,t,s,r,i)=>{const o=ut(pe,`anime/${n}/threads/${e}/replies`),a={text:ad(i),userId:t,username:s,avatarUrl:r,createdAt:mn()};return await mc(o,a)},S3=async(n,e)=>{const t=ut(pe,`anime/${n}/threads/${e}/replies`),s=us(t,Io("createdAt","asc"));return(await Lt(s)).docs.map(i=>({id:i.id,...i.data()}))},j1=async(n,e,t,s,r,i,o)=>{const a=ut(pe,"activity");await mc(a,{type:n,userId:e,username:t,avatarUrl:s,...r&&{animeId:r},...i,...o,timestamp:mn()})},aT=async(n,e)=>{const t=ot(pe,`users/${n}/following/${e}`),s=ot(pe,`users/${e}/followers/${n}`);await Ai(t,{userId:e,followedAt:mn()}),await Ai(s,{userId:n,followedAt:mn()})},Df=async(n,e)=>{const t=ot(pe,`users/${n}/following/${e}`),s=ot(pe,`users/${e}/followers/${n}`);await Eo(t),await Eo(s)},_3=async(n,e)=>{const t=ot(pe,`users/${n}/following/${e}`);return(await fs(t)).exists()},F1=async n=>{const e=ut(pe,`users/${n}/followers`);return(await Lt(e)).docs.map(s=>s.data().userId)},U1=async n=>{const e=ut(pe,`users/${n}/following`);return(await Lt(e)).docs.map(s=>s.data().userId)},Pne=async(n,e)=>{const t=ot(pe,"users",n);await wn(t,{totalWatchTime:Qs(e),lastWatchUpdate:mn()})},V1=async n=>{const e=ot(pe,"users",n),t=await fs(e);return t.exists()?t.data():null},A3=async n=>{const e=ut(pe,"users"),t=us(e,nu("username","==",n),zy(1)),s=await Lt(t);return s.empty?null:s.docs[0].data()},I3=async n=>{const e=ut(pe,`users/${n}/progress`),s=(await Lt(e)).docs.map(i=>Eo(i.ref));await Promise.all(s);const r=ot(pe,"users",n);await wn(r,{totalWatchTime:0,lastWatchUpdate:mn()})},R3=async n=>{const e=ut(pe,`users/${n}/watchlist`),s=(await Lt(e)).docs.map(r=>Eo(r.ref));await Promise.all(s)},C3=async n=>{const e=["watchlist","progress","following","followers"];for(const s of e){const r=ut(pe,`users/${n}/${s}`),o=(await Lt(r)).docs.map(a=>Eo(a.ref));await Promise.all(o)}const t=ot(pe,"users",n);await Eo(t)},P3=async(n,e)=>{const t=ot(pe,`users/${n}/muted/${e}`);await Ai(t,{userId:e,mutedAt:mn()})},k3=async(n,e)=>{const t=ot(pe,`users/${n}/muted/${e}`);await Eo(t)},kne=async n=>{const e=ut(pe,`users/${n}/muted`);return(await Lt(e)).docs.map(s=>s.data().userId)},N3=async(n,e)=>{const t=ot(pe,`users/${n}/blocked/${e}`);await Ai(t,{userId:e,blockedAt:mn()}),await Df(n,e),await Df(e,n)},L3=async(n,e)=>{const t=ot(pe,`users/${n}/blocked/${e}`);return(await fs(t)).exists()},Nne=async n=>{const e=ut(pe,`users/${n}/blocked`);return(await Lt(e)).docs.map(s=>s.data().userId)},D3=async n=>{const e=await F1(n),t=[];for(const s of e){const r=await V1(s);r&&t.push(r)}return t},M3=async n=>{const e=await U1(n),t=[];for(const s of e){const r=await V1(s);r&&t.push(r)}return t},Lne=async(n,e,t,s)=>{const r=await Lt(ut(pe,"anime"));for(const i of r.docs){const o=ut(pe,`anime/${i.id}/reviews`),a=us(o,nu("userId","==",n)),l=await Lt(a);for(const m of l.docs)await wn(m.ref,{username:t,avatarUrl:s});const c=ut(pe,`anime/${i.id}/threads`),d=us(c,nu("userId","==",n)),h=await Lt(d);for(const m of h.docs){await wn(m.ref,{username:t,avatarUrl:s});const p=ut(pe,`anime/${i.id}/threads/${m.id}/replies`),y=us(p,nu("userId","==",n)),v=await Lt(y);for(const x of v.docs)await wn(x.ref,{username:t,avatarUrl:s})}const f=await Lt(ut(pe,`anime/${i.id}/episodes`));for(const m of f.docs){const p=ut(pe,`anime/${i.id}/episodes/${m.id}/comments`),y=us(p,nu("userId","==",n)),v=await Lt(y);for(const x of v.docs)await wn(x.ref,{username:t,avatarUrl:s})}}};async function O3(n,e,t,s,r,i){const o=ut(pe,"forumPosts");return(await mc(o,{userId:n,username:e,avatarUrl:t,category:s,title:r,content:i,likes:0,reactions:{},views:0,replies:0,createdAt:mn(),updatedAt:mn()})).id}async function j3(n){const e=ut(pe,"forumPosts");let t=us(e,Io("createdAt","desc"));return(await Lt(t)).docs.map(r=>({id:r.id,...r.data()}))}async function F3(n){const e=ot(pe,"forumPosts",n),t=await fs(e);return t.exists()?{id:t.id,...t.data()}:null}async function U3(n){const e=ot(pe,"forumPosts",n);await wn(e,{views:Qs(1)})}async function V3(n,e){const t=ot(pe,"forumPosts",n),s=await fs(t);if(!s.exists())return;(s.data().likedBy||[]).includes(e)?await wn(t,{likes:Qs(-1),likedBy:jF(e)}):await wn(t,{likes:Qs(1),likedBy:OF(e)})}async function $3(n,e,t){const s=ot(pe,"forumPosts",n),r=await fs(s);if(!r.exists())return;const i=r.data().reactions||{},o=i[t]||[];o.includes(e)?(i[t]=o.filter(a=>a!==e),i[t].length===0&&delete i[t]):i[t]=[...o,e],await wn(s,{reactions:i})}async function B3(n,e,t,s,r){const i=ut(pe,"forumPosts",n,"replies");await mc(i,{postId:n,userId:e,username:t,avatarUrl:s,content:r,likes:0,reactions:{},createdAt:mn()});const o=ot(pe,"forumPosts",n);await wn(o,{replies:Qs(1),updatedAt:mn()})}async function G3(n){const e=ut(pe,"forumPosts",n,"replies"),t=us(e,Io("createdAt","asc"));return(await Lt(t)).docs.map(r=>({id:r.id,...r.data()}))}async function K3(n,e,t){const s=ot(pe,"forumPosts",n,"replies",e),r=await fs(s);if(!r.exists())return;(r.data().likedBy||[]).includes(t)?await wn(s,{likes:Qs(-1),likedBy:jF(t)}):await wn(s,{likes:Qs(1),likedBy:OF(t)})}async function H3(n,e,t,s){const r=ot(pe,"forumPosts",n,"replies",e),i=await fs(r);if(!i.exists())return;const o=i.data().reactions||{},a=o[s]||[];a.includes(t)?(o[s]=a.filter(l=>l!==t),o[s].length===0&&delete o[s]):o[s]=[...a,t],await wn(r,{reactions:o})}async function W3(n){const e=ut(pe,"forumPosts"),t=us(e,Io("createdAt","desc"),zy(50));return(await Lt(t)).docs.map(i=>({id:i.id,...i.data()})).filter(i=>i.title.toLowerCase().includes(n.toLowerCase())||i.content.toLowerCase().includes(n.toLowerCase()))}async function Dne(n=5){const e=ut(pe,"forumPosts"),t=us(e,Io("createdAt","desc"),zy(100));return(await Lt(t)).docs.map(a=>({id:a.id,...a.data()})).filter(a=>a.category==="discussions"||a.category==="off-topic").sort((a,l)=>{const c=(a.views||0)+(a.likes||0)*2+(a.replies||0)*3;return(l.views||0)+(l.likes||0)*2+(l.replies||0)*3-c}).slice(0,n)}async function Mne(n,e){const t=n.toLowerCase();if(t.includes("admin")||t==="administrator"||t==="moderator")return!1;const s=ut(pe,"users"),r=us(s,nu("username","==",n)),i=await Lt(r);return!!(i.empty||e&&i.docs[0].id===e)}const wi=Object.freeze(Object.defineProperty({__proto__:null,addActivity:j1,addComment:p3,addForumReply:B3,addReview:f3,addThread:x3,addThreadReply:b3,addToWatchlist:a3,blockUser:N3,clearUserWatchHistory:I3,clearUserWatchlist:R3,createForumPost:O3,deleteUserAccount:C3,followUser:aT,getBlockedUsers:Nne,getContinueWatching:O1,getFollowers:F1,getFollowersWithDetails:D3,getFollowing:U1,getFollowingWithDetails:M3,getForumPost:F3,getForumPosts:j3,getForumReplies:G3,getMutedUsers:kne,getProgress:h3,getReviews:m3,getThreadReplies:S3,getThreads:E3,getTrendingForumPosts:Dne,getUserByUsername:A3,getUserProfile:V1,getUserThreadVote:T3,getWatchlist:u3,incrementForumPostViews:U3,isBlocked:L3,isFollowing:_3,isInWatchlist:c3,isUsernameAvailable:Mne,likeComment:y3,likeForumPost:V3,likeForumReply:K3,likeReview:v3,muteUser:P3,reactToForumPost:$3,reactToForumReply:H3,removeFromWatchlist:l3,sanitizeComment:ad,searchForumPosts:W3,subscribeToComments:g3,unfollowUser:Df,unmuteUser:k3,updateProgress:d3,updateUsernameInContent:Lne,updateWatchTime:Pne,voteThread:w3},Symbol.toStringTag,{value:"Module"}));function $1(){const{currentUser:n}=Ms(),[e,t]=T.useState([]),[s,r]=T.useState(!0);T.useEffect(()=>{n?i():(t([]),r(!1))},[n]);const i=async()=>{if(n){r(!0);try{const c=await u3(n.uid);t(c)}catch(c){console.error("Error loading watchlist:",c)}finally{r(!1)}}};return{watchlist:e,loading:s,addAnime:async(c,d,h)=>{if(!n)throw new Error("Must be logged in");await a3(n.uid,c,d,h),await i()},removeAnime:async c=>{if(!n)throw new Error("Must be logged in");await l3(n.uid,c),await i()},checkInWatchlist:async c=>n?await c3(n.uid,c):!1,refresh:i}}function no({id:n,name:e,jname:t,poster:s,episodes:r,type:i,rank:o,className:a=""}){const{language:l}=nv(),{currentUser:c}=Ms(),{addAnime:d,removeAnime:h,checkInWatchlist:f}=$1(),[m,p]=T.useState(!1),[y,v]=T.useState(!1),[,x]=Ls();T.useEffect(()=>{c&&E()},[c,n]);const E=async()=>{const b=await f(n);p(b)},w=async b=>{if(b.preventDefault(),b.stopPropagation(),!c){x("/auth/login");return}v(!0);try{m?(await h(n),p(!1)):(await d(n,e,s),p(!0))}catch(C){console.error("Error toggling watchlist:",C)}finally{v(!1)}};return u.jsx(be,{href:`/anime/${n}`,children:u.jsxs("div",{className:`group relative aspect-[2/3] overflow-hidden rounded-xl cursor-pointer transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-primary/20 ${a}`,"data-testid":`card-anime-${n}`,children:[u.jsx("img",{src:s,alt:e,className:"w-full h-full object-cover transition-all duration-500 group-hover:scale-110"}),u.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all duration-500"}),u.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/95 via-black/40 to-transparent pointer-events-none"}),u.jsx("button",{onClick:w,disabled:y,className:"absolute top-2 left-2 z-20 w-9 h-9 rounded-full bg-black/50 backdrop-blur-md border border-white/30 flex items-center justify-center transition-all duration-300 opacity-0 group-hover:opacity-100 hover:bg-primary/80 hover:border-primary/50 hover:scale-110 active:scale-95 disabled:opacity-50",children:m?u.jsx(aS,{className:"w-4 h-4 text-white",strokeWidth:3}):u.jsx(xM,{className:"w-4 h-4 text-white",strokeWidth:3})}),o&&u.jsx("div",{className:"absolute top-2 right-2 z-10",children:u.jsxs("div",{className:"bg-gradient-to-br from-primary/90 to-primary/70 backdrop-blur-sm border border-white/20 text-white font-bold text-xs px-2 py-0.5 rounded-md shadow-lg",children:["#",o]})}),r&&!o&&u.jsxs("div",{className:"absolute top-2 right-2 z-10 flex flex-col gap-1",children:[r.sub>0&&u.jsxs("div",{className:"bg-black/60 backdrop-blur-sm border border-white/20 text-white text-[10px] px-1.5 py-0.5 rounded font-semibold shadow-md",children:["SUB ",r.sub]}),r.dub>0&&u.jsxs("div",{className:"bg-primary/70 backdrop-blur-sm border border-white/30 text-white text-[10px] px-1.5 py-0.5 rounded font-semibold shadow-md",children:["DUB ",r.dub]})]}),i&&!r&&!o&&u.jsx("div",{className:"absolute top-2 right-2 z-10",children:u.jsx("div",{className:"bg-black/60 backdrop-blur-sm border border-white/20 text-white text-[10px] px-1.5 py-0.5 rounded font-semibold shadow-md",children:i})}),u.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300 z-10",children:u.jsx("div",{className:"bg-white/95 backdrop-blur-md border border-white/40 rounded-full p-3 shadow-2xl hover:scale-110 transition-transform duration-200",children:u.jsx(fi,{className:"w-6 h-6 text-black fill-current"})})}),u.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-3 z-10",children:u.jsx("h3",{className:"text-white font-bold text-sm line-clamp-2 drop-shadow-2xl tracking-tight leading-tight","data-testid":`text-anime-title-${n}`,children:l==="jp"&&t?t:e})})]})})}function One(){var E;const[n,e]=T.useState(new Date),[t,s]=T.useState(!1),r=T.useMemo(()=>{const w=[],b=new Date(n),C=b.getDay(),D=new Date(b);D.setDate(b.getDate()-C+(C===0?-6:1));for(let _=0;_<7;_++){const S=new Date(D);S.setDate(D.getDate()+_),w.push(S)}return w},[n]),i=n.toISOString().split("T")[0],{data:o,isLoading:a,error:l}=Zn({queryKey:["/api/schedule",i]}),c=w=>{const b=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],C=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return{day:b[w.getDay()],date:w.getDate(),month:C[w.getMonth()],fullDate:w.toISOString().split("T")[0]}},d=(w,b)=>w.toDateString()===b.toDateString(),h=()=>{const w=new Date(n);w.setDate(w.getDate()-7),e(w),s(!1)},f=()=>{const w=new Date(n);w.setDate(w.getDate()+7),e(w),s(!1)},m=w=>w||"TBA",p=()=>{const w=-(new Date().getTimezoneOffset()/60),b=w>=0?"+":"-",C=Math.abs(w),D=Math.floor(C).toString().padStart(2,"0"),_=(C%1*60).toString().padStart(2,"0");return`GMT ${b}${D}:${_}`},y=((E=o==null?void 0:o.data)==null?void 0:E.scheduledAnimes)||[],v=t?y:y.slice(0,8),x=y.length>8;return u.jsxs("div",{className:"w-full bg-black/20 backdrop-blur-xl rounded-xl p-4 border border-purple-500/20 shadow-lg text-white",children:[u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 px-4 sm:px-6 lg:px-8 py-4 sm:py-6",children:[u.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold",children:"Estimated Schedule"}),u.jsxs("div",{className:"text-gray-400 text-xs sm:text-sm font-mono",children:["(",p(),")"," ",n.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})," ",new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})]})]}),u.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 px-4 sm:px-6 lg:px-8 mb-6 sm:mb-8",children:[u.jsx("button",{onClick:h,className:"flex-shrink-0 w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center bg-[#2a1a4a] hover:bg-[#3a2a5a] rounded-lg transition-colors",children:u.jsx(uo,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),u.jsx("div",{className:"flex-1 grid grid-cols-7 gap-1 sm:gap-2 lg:gap-3",children:r.map((w,b)=>{const{day:C,date:D,month:_}=c(w),S=d(w,n);return u.jsxs("button",{onClick:()=>{e(new Date(w)),s(!1)},className:`flex flex-col items-center justify-center py-2 sm:py-3 lg:py-4 rounded-lg sm:rounded-xl transition-all duration-200 ${S?"bg-[#610c93] text-white":"bg-[#1a1a2e] text-gray-400 hover:bg-[#2a2a3e]"}`,"data-testid":`button-day-${C.toLowerCase()}`,children:[u.jsx("span",{className:"text-[10px] sm:text-xs lg:text-sm font-semibold",children:C}),u.jsxs("span",{className:"text-[8px] sm:text-[10px] lg:text-xs mt-0.5 sm:mt-1",children:[u.jsxs("span",{className:"hidden sm:inline",children:[_," "]}),D]})]},b)})}),u.jsx("button",{onClick:f,className:"flex-shrink-0 w-8 h-8 sm:w-10 sm:h-10 flex items-center justify-center bg-[#2a1a4a] hover:bg-[#3a2a5a] rounded-lg transition-colors",children:u.jsx(cs,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),u.jsx("div",{className:"px-4 sm:px-6 lg:px-8 pb-6 sm:pb-8",children:a?u.jsxs("div",{className:"text-center py-12 sm:py-20",children:[u.jsx("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-purple-700 border-r-transparent"}),u.jsx("p",{className:"text-gray-400 mt-4 text-sm",children:"Loading schedule..."})]}):l?u.jsxs("div",{className:"text-center py-12 sm:py-20",children:[u.jsx("p",{className:"text-red-400 text-base sm:text-lg",children:"Error loading schedule"}),u.jsx("p",{className:"text-gray-600 text-xs sm:text-sm mt-2",children:l.message})]}):y&&y.length>0?u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"space-y-0",children:v.map((w,b)=>u.jsx(be,{href:`/anime/${w.id}`,children:u.jsxs("div",{className:"group flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-4 py-4 sm:py-6 border-b border-gray-800 hover:bg-[#0a0a0a] px-3 sm:px-4 -mx-3 sm:-mx-4 transition-colors cursor-pointer","data-testid":`card-schedule-${w.id}`,children:[u.jsxs("div",{className:"flex items-start sm:items-center gap-3 sm:gap-6 flex-1 min-w-0",children:[u.jsx("span",{className:"text-sm sm:text-base lg:text-lg font-medium text-purple-400 w-12 sm:w-16 flex-shrink-0",children:m(w.time)}),u.jsx("h3",{className:"text-sm sm:text-base lg:text-lg text-white flex-1 line-clamp-2 sm:truncate","data-testid":`text-schedule-title-${w.id}`,children:w.name})]}),u.jsx("div",{className:"flex items-center gap-2 ml-14 sm:ml-0",children:w.episode&&u.jsxs("span",{className:"text-xs sm:text-sm text-gray-400 bg-[#1a1a2e] px-2 py-1 rounded",children:[" EP ",w.episode]})})]})},b))}),x&&!t&&u.jsxs("button",{onClick:()=>s(!0),className:"w-full mt-6 py-3 sm:py-4 bg-[#2a1a4a] hover:bg-[#3a2a5a] text-white rounded-lg transition-colors text-sm sm:text-base font-medium",children:["Show More (",y.length-8," more)"]}),t&&x&&u.jsx("button",{onClick:()=>s(!1),className:"w-full mt-6 py-3 sm:py-4 bg-[#2a1a4a] hover:bg-[#3a2a5a] text-white rounded-lg transition-colors text-sm sm:text-base font-medium",children:"Show Less"})]}):u.jsxs("div",{className:"text-center py-12 sm:py-20",children:[u.jsx("p",{className:"text-gray-400 text-base sm:text-lg",children:"No anime scheduled for this day"}),u.jsx("p",{className:"text-gray-600 text-xs sm:text-sm mt-2",children:"Select another date to see upcoming releases"})]})})]})}function jne(){const{currentUser:n}=Ms(),[e,t]=T.useState([]),[s,r]=T.useState(!0);if(T.useEffect(()=>{(async()=>{if(!n){r(!1);return}try{const l=(await O1(n.uid)).filter(c=>!c.isCompleted&&c.title&&c.posterUrl&&c.lastEpisodeId);t(l)}catch(a){console.error("Error loading continue watching:",a)}finally{r(!1)}})()},[n]),!n||s||e.length===0)return null;const i=o=>{const a=Math.floor(o/3600),l=Math.floor(o%3600/60),c=Math.floor(o%60);return a>0?`${a}:${l.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`:`${l}:${c.toString().padStart(2,"0")}`};return u.jsxs("section",{className:"mb-8 md:mb-12","data-testid":"section-continue-watching",children:[u.jsx("div",{className:"flex items-center justify-between mb-4 md:mb-6",children:u.jsx("h2",{className:"text-xl md:text-2xl font-bold text-foreground",children:"Continue Watching"})}),u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3 md:gap-4",children:e.map(o=>u.jsx(be,{href:`/watch/${o.animeId}?ep=${o.lastEpisodeId}`,children:u.jsxs("div",{className:"group relative aspect-[2/3] overflow-hidden rounded-xl cursor-pointer transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-primary/20",children:[u.jsx("img",{src:o.posterUrl,alt:o.title,className:"w-full h-full object-cover transition-all duration-500 group-hover:scale-110"}),u.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all duration-500"}),u.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/95 via-black/40 to-transparent pointer-events-none"}),u.jsx("div",{className:"absolute top-2 right-2 z-10",children:u.jsxs("div",{className:"bg-black/60 backdrop-blur-sm border border-white/20 text-white text-[10px] px-1.5 py-0.5 rounded font-semibold shadow-md",children:["EP ",o.lastEpisode]})}),u.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300 z-10",children:u.jsx("div",{className:"bg-white/95 backdrop-blur-md border border-white/40 rounded-full p-3 shadow-2xl hover:scale-110 transition-transform duration-200",children:u.jsx(fi,{className:"w-6 h-6 text-black fill-current"})})}),u.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-3 z-10",children:[u.jsx("h3",{className:"text-white font-bold text-sm line-clamp-2 drop-shadow-2xl tracking-tight leading-tight mb-2",children:o.title}),u.jsx("div",{className:"w-full bg-white/20 h-1 rounded-full mb-1",children:u.jsx("div",{className:"bg-primary h-full rounded-full transition-all duration-300",style:{width:"30%"}})}),u.jsxs("div",{className:"flex items-center gap-1 text-xs text-white/80",children:[u.jsx(py,{className:"w-3 h-3"}),u.jsx("span",{children:i(o.lastTimestamp)})]})]})]})},o.animeId))})]})}function rn({className:n,...e}){return u.jsx("div",{className:Ae("relative overflow-hidden rounded-md bg-muted/30","before:absolute before:inset-0","before:-translate-x-full","before:animate-[shimmer_1.5s_infinite]","before:bg-gradient-to-r","before:from-transparent before:via-muted/40 before:to-transparent",n),...e})}function sv({className:n}){return u.jsxs("div",{className:Ae("group relative aspect-[2/3] overflow-hidden rounded-xl",n),children:[u.jsx(rn,{className:"w-full h-full rounded-xl"}),u.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent"}),u.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-3 space-y-2",children:[u.jsx(rn,{className:"h-4 w-3/4 bg-muted/50"}),u.jsx(rn,{className:"h-3 w-1/2 bg-muted/40"})]}),u.jsx("div",{className:"absolute top-2 right-2 space-y-1",children:u.jsx(rn,{className:"h-5 w-16 bg-muted/50"})})]})}function Fne(){return u.jsxs("div",{className:"relative w-full h-[60vh]",children:[u.jsx(rn,{className:"w-full h-full"}),u.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background via-background/50 to-transparent"}),u.jsxs("div",{className:"absolute bottom-8 left-8 right-8 space-y-4",children:[u.jsx(rn,{className:"h-12 w-2/3 max-w-2xl bg-muted/50"}),u.jsx(rn,{className:"h-6 w-1/2 max-w-xl bg-muted/40"}),u.jsxs("div",{className:"flex gap-3 pt-2",children:[u.jsx(rn,{className:"h-12 w-32 bg-muted/50"}),u.jsx(rn,{className:"h-12 w-32 bg-muted/40"})]})]})]})}function lT(){return u.jsxs("div",{className:"flex items-center justify-between mb-6",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(rn,{className:"h-6 w-1 bg-primary/50"}),u.jsx(rn,{className:"h-7 w-48 bg-muted/50"})]}),u.jsx(rn,{className:"h-5 w-20 bg-muted/40"})]})}function Cx(){return u.jsxs("section",{children:[u.jsx(lT,{}),u.jsx("div",{className:"flex gap-4 overflow-hidden",children:Array.from({length:8}).map((n,e)=>u.jsx("div",{className:"flex-shrink-0 w-[140px] sm:w-[160px] md:w-[180px]",children:u.jsx(sv,{})},e))})]})}function hP(){return u.jsxs("div",{className:"flex gap-3 p-2 rounded-lg",children:[u.jsx(rn,{className:"flex-shrink-0 w-8 h-8 rounded"}),u.jsx(rn,{className:"flex-shrink-0 w-12 h-16 rounded-md"}),u.jsxs("div",{className:"flex-1 space-y-2 flex flex-col justify-center",children:[u.jsx(rn,{className:"h-4 w-full"}),u.jsx(rn,{className:"h-3 w-2/3"})]}),u.jsx(rn,{className:"flex-shrink-0 w-12 h-6 rounded"})]})}function Un(n){const e=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&e==="[object Date]"?new n.constructor(+n):typeof n=="number"||e==="[object Number]"||typeof n=="string"||e==="[object String]"?new Date(n):new Date(NaN)}function Une(n,e){return n instanceof Date?new n.constructor(e):new Date(e)}const xp=43200,fP=1440;let Vne={};function $ne(){return Vne}function mP(n){const e=Un(n),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+n-+t}function fg(n,e){const t=Un(n),s=Un(e),r=t.getTime()-s.getTime();return r<0?-1:r>0?1:r}function Bne(n){return Une(n,Date.now())}function Gne(n,e){const t=Un(n),s=Un(e),r=t.getFullYear()-s.getFullYear(),i=t.getMonth()-s.getMonth();return r*12+i}function Kne(n){return e=>{const s=(n?Math[n]:Math.trunc)(e);return s===0?0:s}}function Hne(n,e){return+Un(n)-+Un(e)}function Wne(n){const e=Un(n);return e.setHours(23,59,59,999),e}function zne(n){const e=Un(n),t=e.getMonth();return e.setFullYear(e.getFullYear(),t+1,0),e.setHours(23,59,59,999),e}function qne(n){const e=Un(n);return+Wne(e)==+zne(e)}function Yne(n,e){const t=Un(n),s=Un(e),r=fg(t,s),i=Math.abs(Gne(t,s));let o;if(i<1)o=0;else{t.getMonth()===1&&t.getDate()>27&&t.setDate(30),t.setMonth(t.getMonth()-r*i);let a=fg(t,s)===-r;qne(Un(n))&&i===1&&fg(n,s)===1&&(a=!1),o=r*(i-Number(a))}return o===0?0:o}function Qne(n,e,t){const s=Hne(n,e)/1e3;return Kne(t==null?void 0:t.roundingMethod)(s)}const Xne={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Jne=(n,e,t)=>{let s;const r=Xne[n];return typeof r=="string"?s=r:e===1?s=r.one:s=r.other.replace("{{count}}",e.toString()),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"in "+s:s+" ago":s};function Px(n){return(e={})=>{const t=e.width?String(e.width):n.defaultWidth;return n.formats[t]||n.formats[n.defaultWidth]}}const Zne={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},ese={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},tse={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},nse={date:Px({formats:Zne,defaultWidth:"full"}),time:Px({formats:ese,defaultWidth:"full"}),dateTime:Px({formats:tse,defaultWidth:"full"})},sse={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},rse=(n,e,t,s)=>sse[n];function fh(n){return(e,t)=>{const s=t!=null&&t.context?String(t.context):"standalone";let r;if(s==="formatting"&&n.formattingValues){const o=n.defaultFormattingWidth||n.defaultWidth,a=t!=null&&t.width?String(t.width):o;r=n.formattingValues[a]||n.formattingValues[o]}else{const o=n.defaultWidth,a=t!=null&&t.width?String(t.width):n.defaultWidth;r=n.values[a]||n.values[o]}const i=n.argumentCallback?n.argumentCallback(e):e;return r[i]}}const ise={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},ose={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},ase={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},lse={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},cse={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},use={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},dse=(n,e)=>{const t=Number(n),s=t%100;if(s>20||s<10)switch(s%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},hse={ordinalNumber:dse,era:fh({values:ise,defaultWidth:"wide"}),quarter:fh({values:ose,defaultWidth:"wide",argumentCallback:n=>n-1}),month:fh({values:ase,defaultWidth:"wide"}),day:fh({values:lse,defaultWidth:"wide"}),dayPeriod:fh({values:cse,defaultWidth:"wide",formattingValues:use,defaultFormattingWidth:"wide"})};function mh(n){return(e,t={})=>{const s=t.width,r=s&&n.matchPatterns[s]||n.matchPatterns[n.defaultMatchWidth],i=e.match(r);if(!i)return null;const o=i[0],a=s&&n.parsePatterns[s]||n.parsePatterns[n.defaultParseWidth],l=Array.isArray(a)?mse(a,h=>h.test(o)):fse(a,h=>h.test(o));let c;c=n.valueCallback?n.valueCallback(l):l,c=t.valueCallback?t.valueCallback(c):c;const d=e.slice(o.length);return{value:c,rest:d}}}function fse(n,e){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&e(n[t]))return t}function mse(n,e){for(let t=0;t<n.length;t++)if(e(n[t]))return t}function pse(n){return(e,t={})=>{const s=e.match(n.matchPattern);if(!s)return null;const r=s[0],i=e.match(n.parsePattern);if(!i)return null;let o=n.valueCallback?n.valueCallback(i[0]):i[0];o=t.valueCallback?t.valueCallback(o):o;const a=e.slice(r.length);return{value:o,rest:a}}}const gse=/^(\d+)(th|st|nd|rd)?/i,yse=/\d+/i,vse={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},xse={any:[/^b/i,/^(a|c)/i]},Ese={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},wse={any:[/1/i,/2/i,/3/i,/4/i]},Tse={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},bse={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Sse={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},_se={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Ase={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Ise={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Rse={ordinalNumber:pse({matchPattern:gse,parsePattern:yse,valueCallback:n=>parseInt(n,10)}),era:mh({matchPatterns:vse,defaultMatchWidth:"wide",parsePatterns:xse,defaultParseWidth:"any"}),quarter:mh({matchPatterns:Ese,defaultMatchWidth:"wide",parsePatterns:wse,defaultParseWidth:"any",valueCallback:n=>n+1}),month:mh({matchPatterns:Tse,defaultMatchWidth:"wide",parsePatterns:bse,defaultParseWidth:"any"}),day:mh({matchPatterns:Sse,defaultMatchWidth:"wide",parsePatterns:_se,defaultParseWidth:"any"}),dayPeriod:mh({matchPatterns:Ase,defaultMatchWidth:"any",parsePatterns:Ise,defaultParseWidth:"any"})},Cse={code:"en-US",formatDistance:Jne,formatLong:nse,formatRelative:rse,localize:hse,match:Rse,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Pse(n,e,t){const s=$ne(),r=(t==null?void 0:t.locale)??s.locale??Cse,i=2520,o=fg(n,e);if(isNaN(o))throw new RangeError("Invalid time value");const a=Object.assign({},t,{addSuffix:t==null?void 0:t.addSuffix,comparison:o});let l,c;o>0?(l=Un(e),c=Un(n)):(l=Un(n),c=Un(e));const d=Qne(c,l),h=(mP(c)-mP(l))/1e3,f=Math.round((d-h)/60);let m;if(f<2)return t!=null&&t.includeSeconds?d<5?r.formatDistance("lessThanXSeconds",5,a):d<10?r.formatDistance("lessThanXSeconds",10,a):d<20?r.formatDistance("lessThanXSeconds",20,a):d<40?r.formatDistance("halfAMinute",0,a):d<60?r.formatDistance("lessThanXMinutes",1,a):r.formatDistance("xMinutes",1,a):f===0?r.formatDistance("lessThanXMinutes",1,a):r.formatDistance("xMinutes",f,a);if(f<45)return r.formatDistance("xMinutes",f,a);if(f<90)return r.formatDistance("aboutXHours",1,a);if(f<fP){const p=Math.round(f/60);return r.formatDistance("aboutXHours",p,a)}else{if(f<i)return r.formatDistance("xDays",1,a);if(f<xp){const p=Math.round(f/fP);return r.formatDistance("xDays",p,a)}else if(f<xp*2)return m=Math.round(f/xp),r.formatDistance("aboutXMonths",m,a)}if(m=Yne(c,l),m<12){const p=Math.round(f/xp);return r.formatDistance("xMonths",p,a)}else{const p=m%12,y=Math.trunc(m/12);return p<3?r.formatDistance("aboutXYears",y,a):p<9?r.formatDistance("overXYears",y,a):r.formatDistance("almostXYears",y+1,a)}}function Wa(n,e){return Pse(n,Bne(n),e)}function kse(){const[n,e]=T.useState(null),{data:t,isLoading:s}=Zn({queryKey:["/api/home"]});if(s)return u.jsxs("div",{className:"min-h-screen bg-background",children:[u.jsx(Fne,{}),u.jsxs("div",{className:"container mx-auto px-4 md:px-6 lg:px-8 py-8 space-y-12",children:[u.jsx(Cx,{}),u.jsx(Cx,{}),u.jsx(Cx,{}),u.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[u.jsxs("section",{children:[u.jsx(lT,{}),u.jsx("div",{className:"space-y-3",children:Array.from({length:10}).map((o,a)=>u.jsx(hP,{},a))})]}),u.jsxs("section",{children:[u.jsx(lT,{}),u.jsx("div",{className:"space-y-3",children:Array.from({length:10}).map((o,a)=>u.jsx(hP,{},a))})]})]})]})]});const r=t==null?void 0:t.data,i=o=>{e(o)};return u.jsxs("div",{className:"min-h-screen bg-background",children:[u.jsx(vm,{title:"AnimeBite - Watch Anime online with DUB and SUB for FREE",description:"Watch anime online free in HD quality. Stream 10,000+ anime series, latest episodes, movies with English sub and dub. Fast streaming, no ads, updated daily.",keywords:"watch anime online, anime streaming, free anime, anime episodes, anime movies, latest anime, trending anime, top anime, anime sub, anime dub, HD anime, AnimeBite",image:"https://animebite.cc/logo.png",url:"https://animebite.cc/"}),(r==null?void 0:r.spotlightAnimes)&&u.jsx(Cne,{spotlights:r.spotlightAnimes,onAnimeChange:i}),u.jsxs("div",{className:"container mx-auto px-4 md:px-6 lg:px-8 py-8 space-y-12",children:[u.jsx(jne,{}),(r==null?void 0:r.latestEpisodeAnimes)&&r.latestEpisodeAnimes.length>0&&u.jsxs("section",{children:[u.jsxs("div",{className:"flex items-center justify-between mb-6",children:[u.jsxs("h2",{className:"text-xl md:text-2xl font-bold text-foreground flex items-center gap-2",children:[u.jsx("span",{className:"text-primary",children:"|"})," Recently Updated"]}),u.jsx(be,{href:"/category/recently-updated",children:u.jsxs("button",{className:"flex items-center gap-1 text-sm text-muted-foreground hover:text-primary transition-colors","data-testid":"link-view-all-latest",children:["View all",u.jsx(cs,{className:"w-4 h-4"})]})})]}),u.jsx("div",{className:"relative",children:u.jsx("div",{className:"flex gap-4 overflow-x-auto pb-4 hide-scrollbar snap-x snap-mandatory",children:r.latestEpisodeAnimes.slice(0,15).map((o,a)=>u.jsx("div",{className:"flex-shrink-0 w-[140px] sm:w-[160px] md:w-[180px] snap-start",children:u.jsx(no,{...o})},`latest-${a}-${o.id}`))})})]}),(r==null?void 0:r.trendingAnimes)&&r.trendingAnimes.length>0&&u.jsxs("section",{children:[u.jsxs("div",{className:"flex items-center justify-between mb-6",children:[u.jsxs("h2",{className:"text-xl md:text-2xl font-bold text-foreground flex items-center gap-2",children:[u.jsx("span",{className:"text-primary",children:"|"})," Trending Anime"]}),u.jsx(be,{href:"/category/trending",children:u.jsxs("button",{className:"flex items-center gap-1 text-sm text-muted-foreground hover:text-primary transition-colors",children:["View all",u.jsx(cs,{className:"w-4 h-4"})]})})]}),u.jsx("div",{className:"relative",children:u.jsx("div",{className:"flex gap-4 overflow-x-auto pb-4 hide-scrollbar snap-x snap-mandatory",children:r.trendingAnimes.slice(0,15).map((o,a)=>u.jsx("div",{className:"flex-shrink-0 w-[140px] sm:w-[160px] md:w-[180px] snap-start",children:u.jsx(no,{...o,rank:o.rank})},`trending-${a}-${o.id}`))})})]}),(r==null?void 0:r.topAiringAnimes)&&r.topAiringAnimes.length>0&&u.jsxs("section",{children:[u.jsxs("div",{className:"flex items-center justify-between mb-6",children:[u.jsxs("h2",{className:"text-xl md:text-2xl font-bold text-foreground flex items-center gap-2",children:[u.jsx("span",{className:"text-primary",children:"|"})," Top Airing"]}),u.jsx(be,{href:"/category/top-airing",children:u.jsxs("button",{className:"flex items-center gap-1 text-sm text-muted-foreground hover:text-primary transition-colors","data-testid":"link-view-all-airing",children:["View all",u.jsx(cs,{className:"w-4 h-4"})]})})]}),u.jsx("div",{className:"relative",children:u.jsx("div",{className:"flex gap-4 overflow-x-auto pb-4 hide-scrollbar snap-x snap-mandatory",children:r.topAiringAnimes.slice(0,15).map((o,a)=>u.jsx("div",{className:"flex-shrink-0 w-[140px] sm:w-[160px] md:w-[180px] snap-start",children:u.jsx(no,{...o})},`airing-${a}-${o.id}`))})})]}),u.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(r==null?void 0:r.topUpcomingAnimes)&&r.topUpcomingAnimes.length>0&&u.jsxs("section",{children:[u.jsxs("div",{className:"flex items-center justify-between mb-6",children:[u.jsxs("h2",{className:"text-xl md:text-2xl font-bold text-foreground flex items-center gap-2",children:[u.jsx("span",{className:"text-primary",children:"|"})," Seasonal Anime"]}),u.jsx(be,{href:"/category/top-upcoming",children:u.jsxs("button",{className:"flex items-center gap-1 text-sm text-muted-foreground hover:text-primary transition-colors","data-testid":"link-view-all-upcoming",children:["View all",u.jsx(cs,{className:"w-4 h-4"})]})})]}),u.jsx("div",{className:"space-y-3",children:r.topUpcomingAnimes.slice(0,10).map((o,a)=>u.jsx(be,{href:`/anime/${o.id}`,children:u.jsxs("div",{className:"flex gap-3 p-2 rounded-lg hover:bg-accent/50 transition-all cursor-pointer group",children:[u.jsx("div",{className:"flex-shrink-0 w-8 flex items-center justify-center",children:u.jsxs("span",{className:"text-lg font-bold text-muted-foreground group-hover:text-primary transition-colors",children:["#",a+1]})}),u.jsx("div",{className:"flex-shrink-0 w-12 h-16 rounded-md overflow-hidden",children:u.jsx("img",{src:o.poster,alt:o.name,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"})}),u.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-center",children:[u.jsx("h3",{className:"text-sm font-semibold text-foreground line-clamp-1 group-hover:text-primary transition-colors",children:o.name}),u.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[o.episodes&&u.jsx("span",{className:"text-xs px-2 py-0.5 bg-primary/20 text-primary rounded-full font-medium",children:o.episodes.sub>0?`${o.episodes.sub} EP`:"NEW"}),o.type&&u.jsx("span",{className:"text-xs text-muted-foreground",children:o.type})]})]}),u.jsx("div",{className:"flex-shrink-0 flex items-center",children:u.jsx("span",{className:"text-xs px-2 py-1 bg-secondary rounded text-secondary-foreground font-medium",children:o.rating||"N/A"})})]})},`seasonal-${a}-${o.id}`))})]}),(r==null?void 0:r.top10Animes)&&u.jsxs("section",{children:[u.jsx("div",{className:"flex items-center justify-between mb-6",children:u.jsxs("h2",{className:"text-xl md:text-2xl font-bold text-foreground flex items-center gap-2",children:[u.jsx("span",{className:"text-primary",children:"|"})," All Time Anime"]})}),u.jsx("div",{className:"space-y-3",children:r.top10Animes.today.slice(0,10).map((o,a)=>u.jsx(be,{href:`/anime/${o.id}`,children:u.jsxs("div",{className:"flex gap-3 p-2 rounded-lg hover:bg-accent/50 transition-all cursor-pointer group",children:[u.jsx("div",{className:"flex-shrink-0 w-8 flex items-center justify-center",children:u.jsxs("span",{className:"text-lg font-bold text-muted-foreground group-hover:text-primary transition-colors",children:["#",a+1]})}),u.jsx("div",{className:"flex-shrink-0 w-12 h-16 rounded-md overflow-hidden",children:u.jsx("img",{src:o.poster,alt:o.name,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"})}),u.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-center",children:[u.jsx("h3",{className:"text-sm font-semibold text-foreground line-clamp-1 group-hover:text-primary transition-colors",children:o.name}),u.jsx("div",{className:"flex items-center gap-2 mt-1",children:o.episodes&&u.jsx("span",{className:"text-xs px-2 py-0.5 bg-primary/20 text-primary rounded-full font-medium",children:o.episodes.sub>0?`${o.episodes.sub} EP`:"NEW"})})]}),u.jsx("div",{className:"flex-shrink-0 flex items-center",children:u.jsx("span",{className:"text-xs px-2 py-1 bg-secondary rounded text-secondary-foreground font-medium",children:"TV Show"})})]})},`alltime-${a}-${o.id}`))})]})]}),u.jsx("section",{children:u.jsx(One,{})}),u.jsx(Nse,{})]})]})}function Nse(){const[,n]=Ls(),[e,t]=T.useState([]),[s,r]=T.useState(!0);T.useEffect(()=>{i()},[]);const i=async()=>{r(!0);try{const{getTrendingForumPosts:c}=await pi(async()=>{const{getTrendingForumPosts:h}=await Promise.resolve().then(()=>wi);return{getTrendingForumPosts:h}},void 0),d=await c(5);t(d)}catch(c){console.error("Error loading trending posts:",c)}finally{r(!1)}},o=c=>({discussions:"bg-blue-500","off-topic":"bg-purple-500"})[c]||"bg-gray-500",a=c=>({discussions:"Discussions","off-topic":"Off Topic"})[c]||c,l=c=>c?Wa(c.toDate(),{addSuffix:!0}):"Just now";return s||e.length===0?null:u.jsxs("section",{className:"w-full",children:[u.jsxs("div",{className:"flex items-center justify-between mb-6",children:[u.jsxs("h2",{className:"text-xl md:text-2xl font-bold text-foreground flex items-center gap-2",children:[u.jsx("span",{className:"text-primary",children:"|"})," Trending Forum Posts"]}),u.jsx(be,{href:"/forum",children:u.jsxs("button",{className:"flex items-center gap-1 text-sm text-muted-foreground hover:text-primary transition-colors",children:["View all",u.jsx(cs,{className:"w-4 h-4"})]})})]}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-1 gap-4",children:e.map((c,d)=>{var h;return u.jsxs("div",{onClick:()=>n(`/forum/post/${c.id}`),className:"group relative bg-black/20 backdrop-blur-xl rounded-xl p-4 border border-purple-500/20 shadow-lg transition-all cursor-pointer overflow-hidden",children:[u.jsxs("div",{className:"absolute top-2 right-2 w-8 h-8 bg-primary/20 text-primary rounded-full flex items-center justify-center text-sm font-bold",children:["#",d+1]}),u.jsxs("div",{className:"flex gap-3 mb-3",children:[u.jsxs(Ps,{className:"h-10 w-10 flex-shrink-0",children:[u.jsx(ks,{src:c.avatarUrl}),u.jsx(Ns,{children:(h=c.username[0])==null?void 0:h.toUpperCase()})]}),u.jsxs("div",{className:"flex-1 min-w-0",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[u.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full text-white ${o(c.category)}`,children:a(c.category)}),u.jsxs("span",{className:"text-xs text-muted-foreground",children:["by ",u.jsx("span",{className:"font-medium",children:c.username})]})]}),u.jsx("h3",{className:"text-base font-semibold text-foreground line-clamp-1 group-hover:text-primary transition-colors",children:c.title})]})]}),u.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2 mb-3",children:c.content}),u.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[u.jsxs("div",{className:"flex items-center gap-1",children:[u.jsx(uS,{className:"w-3 h-3"}),u.jsx("span",{children:c.views||0})]}),u.jsxs("div",{className:"flex items-center gap-1",children:[u.jsx(li,{className:"w-3 h-3"}),u.jsx("span",{children:c.replies||0})]}),u.jsxs("div",{className:"flex items-center gap-1",children:[u.jsx(cc,{className:"w-3 h-3"}),u.jsx("span",{children:c.likes||0})]}),u.jsx("span",{className:"ml-auto",children:l(c.createdAt)})]}),u.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"})]},c.id)})})]})}const Oe=T.forwardRef(({className:n,...e},t)=>u.jsx("div",{ref:t,className:Ae("shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm",n),...e}));Oe.displayName="Card";const yc=T.forwardRef(({className:n,...e},t)=>u.jsx("div",{ref:t,className:Ae("flex flex-col space-y-1.5 p-6",n),...e}));yc.displayName="CardHeader";const vc=T.forwardRef(({className:n,...e},t)=>u.jsx("div",{ref:t,className:Ae("text-2xl font-semibold leading-none tracking-tight",n),...e}));vc.displayName="CardTitle";const rv=T.forwardRef(({className:n,...e},t)=>u.jsx("div",{ref:t,className:Ae("text-sm text-muted-foreground",n),...e}));rv.displayName="CardDescription";const jt=T.forwardRef(({className:n,...e},t)=>u.jsx("div",{ref:t,className:Ae("p-6 pt-0",n),...e}));jt.displayName="CardContent";const z3=T.forwardRef(({className:n,...e},t)=>u.jsx("div",{ref:t,className:Ae("flex items-center p-6 pt-0",n),...e}));z3.displayName="CardFooter";var B1="Tabs",[Lse,Vpe]=Ds(B1,[Xy]),q3=Xy(),[Dse,G1]=Lse(B1),Y3=T.forwardRef((n,e)=>{const{__scopeTabs:t,value:s,onValueChange:r,defaultValue:i,orientation:o="horizontal",dir:a,activationMode:l="automatic",...c}=n,d=Nd(a),[h,f]=Br({prop:s,onChange:r,defaultProp:i});return u.jsx(Dse,{scope:t,baseId:mr(),value:h,onValueChange:f,orientation:o,dir:d,activationMode:l,children:u.jsx(Se.div,{dir:d,"data-orientation":o,...c,ref:e})})});Y3.displayName=B1;var Q3="TabsList",X3=T.forwardRef((n,e)=>{const{__scopeTabs:t,loop:s=!0,...r}=n,i=G1(Q3,t),o=q3(t);return u.jsx(n4,{asChild:!0,...o,orientation:i.orientation,dir:i.dir,loop:s,children:u.jsx(Se.div,{role:"tablist","aria-orientation":i.orientation,...r,ref:e})})});X3.displayName=Q3;var J3="TabsTrigger",Z3=T.forwardRef((n,e)=>{const{__scopeTabs:t,value:s,disabled:r=!1,...i}=n,o=G1(J3,t),a=q3(t),l=nU(o.baseId,s),c=sU(o.baseId,s),d=s===o.value;return u.jsx(s4,{asChild:!0,...a,focusable:!r,active:d,children:u.jsx(Se.button,{type:"button",role:"tab","aria-selected":d,"aria-controls":c,"data-state":d?"active":"inactive","data-disabled":r?"":void 0,disabled:r,id:l,...i,ref:e,onMouseDown:ie(n.onMouseDown,h=>{!r&&h.button===0&&h.ctrlKey===!1?o.onValueChange(s):h.preventDefault()}),onKeyDown:ie(n.onKeyDown,h=>{[" ","Enter"].includes(h.key)&&o.onValueChange(s)}),onFocus:ie(n.onFocus,()=>{const h=o.activationMode!=="manual";!d&&!r&&h&&o.onValueChange(s)})})})});Z3.displayName=J3;var eU="TabsContent",tU=T.forwardRef((n,e)=>{const{__scopeTabs:t,value:s,forceMount:r,children:i,...o}=n,a=G1(eU,t),l=nU(a.baseId,s),c=sU(a.baseId,s),d=s===a.value,h=T.useRef(d);return T.useEffect(()=>{const f=requestAnimationFrame(()=>h.current=!1);return()=>cancelAnimationFrame(f)},[]),u.jsx(wr,{present:r||d,children:({present:f})=>u.jsx(Se.div,{"data-state":d?"active":"inactive","data-orientation":a.orientation,role:"tabpanel","aria-labelledby":l,hidden:!f,id:c,tabIndex:0,...o,ref:e,style:{...n.style,animationDuration:h.current?"0s":void 0},children:f&&i})})});tU.displayName=eU;function nU(n,e){return`${n}-trigger-${e}`}function sU(n,e){return`${n}-content-${e}`}var Mse=Y3,rU=X3,iU=Z3,oU=tU;const aU=Mse,K1=T.forwardRef(({className:n,...e},t)=>u.jsx(rU,{ref:t,className:Ae("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",n),...e}));K1.displayName=rU.displayName;const Rl=T.forwardRef(({className:n,...e},t)=>u.jsx(iU,{ref:t,className:Ae("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",n),...e}));Rl.displayName=iU.displayName;const Cl=T.forwardRef(({className:n,...e},t)=>u.jsx(oU,{ref:t,className:Ae("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",n),...e}));Cl.displayName=oU.displayName;function Ose({animeId:n,animeTitle:e,posterUrl:t}){const{currentUser:s}=Ms(),{addAnime:r,removeAnime:i,checkInWatchlist:o}=$1(),[a,l]=T.useState(!1),[c,d]=T.useState(!1),[,h]=Ls();T.useEffect(()=>{s&&f()},[s,n]);const f=async()=>{const p=await o(n);l(p)},m=async()=>{if(!s){h("/auth/login");return}d(!0);try{a?(await i(n),l(!1)):(await r(n,e,t),l(!0))}catch(p){console.error("Error toggling watchlist:",p)}finally{d(!1)}};return u.jsx(ne,{onClick:m,disabled:c,variant:a?"default":"outline",children:a?u.jsxs(u.Fragment,{children:[u.jsx(YG,{className:"mr-2 h-4 w-4"}),"In Watchlist"]}):u.jsxs(u.Fragment,{children:[u.jsx(QG,{className:"mr-2 h-4 w-4"}),"Add to Watchlist"]})})}const Ii=T.forwardRef(({className:n,...e},t)=>u.jsx("textarea",{className:Ae("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),ref:t,...e}));Ii.displayName="Textarea";function jse({animeId:n,animeTitle:e}){const{currentUser:t,userProfile:s}=Ms(),[r,i]=T.useState([]),[o,a]=T.useState(5),[l,c]=T.useState(""),[d,h]=T.useState(!1),[f,m]=T.useState(!1);T.useEffect(()=>{v()},[n]);const[p,y]=T.useState([]);T.useEffect(()=>{(async()=>{if(t){const{getMutedUsers:C}=await pi(async()=>{const{getMutedUsers:_}=await Promise.resolve().then(()=>wi);return{getMutedUsers:_}},void 0),D=await C(t.uid);y(D)}})()},[t]);const v=async()=>{try{const b=await m3(n);i(b)}catch(b){console.error("Error loading reviews:",b)}},x=async b=>{if(b.preventDefault(),!(!t||!s||!l.trim())){h(!0);try{await f3(n,t.uid,s.username,s.avatarUrl,o,l),c(""),a(5),m(!1),await v()}catch(C){console.error("Error posting review:",C)}finally{h(!1)}}},E=async b=>{try{await v3(n,b),await v()}catch(C){console.error("Error liking review:",C)}},w=r.length>0?r.reduce((b,C)=>b+C.rating,0)/r.length:0;return u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsxs("h2",{className:"text-2xl font-bold",children:["Reviews (",r.length,")"]}),r.length>0&&u.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[u.jsx("div",{className:"flex",children:Array.from({length:5}).map((b,C)=>u.jsx(_w,{className:`h-4 w-4 ${C<Math.round(w)?"fill-yellow-400 text-yellow-400":"text-gray-400"}`},C))}),u.jsxs("span",{className:"text-sm text-muted-foreground",children:[w.toFixed(1)," average rating"]})]})]}),t&&!f&&u.jsx(ne,{onClick:()=>m(!0),children:"Write a Review"})]}),u.jsx("div",{className:"space-y-4",children:r.filter(b=>!p.includes(b.userId)).map(b=>{var C;return u.jsx(Oe,{children:u.jsx(jt,{className:"p-6",children:u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsxs(Ps,{className:"h-12 w-12 cursor-pointer hover:ring-2 ring-primary transition-all",onClick:()=>window.location.href=`/profile/${b.username}`,children:[u.jsx(ks,{src:b.avatarUrl}),u.jsx(Ns,{children:(C=b.username[0])==null?void 0:C.toUpperCase()})]}),u.jsxs("div",{className:"flex-1",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("span",{className:"font-semibold cursor-pointer hover:text-primary transition-colors",onClick:()=>window.location.href=`/profile/${b.username}`,children:b.username}),u.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[u.jsx("div",{className:"flex",children:Array.from({length:5}).map((D,_)=>u.jsx(_w,{className:`h-4 w-4 ${_<b.rating/2?"fill-yellow-400 text-yellow-400":"text-gray-400"}`},_))}),u.jsxs("span",{className:"text-sm text-muted-foreground",children:[b.rating,"/10"]})]})]}),u.jsx("span",{className:"text-xs text-muted-foreground",children:b.createdAt&&Wa(b.createdAt.toDate(),{addSuffix:!0})})]}),u.jsx("p",{className:"mt-3 text-sm",children:b.reviewText}),u.jsxs(ne,{variant:"ghost",size:"sm",onClick:()=>E(b.id),className:"mt-2",children:[u.jsx(cc,{className:"mr-1 h-4 w-4"}),b.likes," helpful"]})]})]})})},b.id)})}),f&&t&&u.jsxs(Oe,{className:"mt-6",children:[u.jsx(yc,{children:u.jsxs(vc,{children:["Write a Review for ",e]})}),u.jsx(jt,{children:u.jsxs("form",{onSubmit:x,className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium mb-2",children:"Rating"}),u.jsx("div",{className:"flex gap-2",children:Array.from({length:10}).map((b,C)=>u.jsx("button",{type:"button",onClick:()=>a(C+1),className:`h-10 w-10 rounded-full ${C<o?"bg-primary text-primary-foreground":"bg-muted"}`,children:C+1},C))})]}),u.jsx(Ii,{placeholder:"Share your thoughts about this anime...",value:l,onChange:b=>c(b.target.value),className:"min-h-[150px]",required:!0}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx(ne,{type:"submit",disabled:d||!l.trim(),children:d?"Posting...":"Post Review"}),u.jsx(ne,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancel"})]})]})})]}),!t&&!f&&u.jsx("div",{className:"text-center py-8 text-muted-foreground mt-6",children:"Please sign in to write a review"})]})}function Fse({animeId:n,animeTitle:e}){const{currentUser:t,userProfile:s}=Ms(),[r,i]=T.useState([]),[o,a]=T.useState(""),[l,c]=T.useState(""),[d,h]=T.useState(!1),[f,m]=T.useState(!1),[p,y]=T.useState({}),[v,x]=T.useState(null);T.useEffect(()=>{b()},[n,t]);const[E,w]=T.useState([]);T.useEffect(()=>{(async()=>{if(t){const{getMutedUsers:R}=await pi(async()=>{const{getMutedUsers:L}=await Promise.resolve().then(()=>wi);return{getMutedUsers:L}},void 0),N=await R(t.uid);w(N)}})()},[t]);const b=async()=>{try{const I=await E3(n),R=await Promise.all(I.map(async N=>{const L=await S3(n,N.id),M=t?await T3(n,N.id,t.uid):null;return{...N,replies:L,userVote:M,showReplies:!1}}));i(R)}catch(I){console.error("Error loading threads:",I)}},C=async I=>{if(I.preventDefault(),!(!t||!s||!o.trim()||!l.trim())){h(!0);try{await x3(n,t.uid,s.username,s.avatarUrl,o,l),a(""),c(""),m(!1),await b()}catch(R){console.error("Error creating thread:",R)}finally{h(!1)}}},D=async(I,R)=>{if(t)try{await w3(n,I,t.uid,R),await b()}catch(N){console.error("Error voting:",N)}},_=async I=>{var R;if(!(!t||!s||!((R=p[I])!=null&&R.trim())))try{await b3(n,I,t.uid,s.username,s.avatarUrl,p[I]),y({...p,[I]:""}),x(null),await b()}catch(N){console.error("Error posting reply:",N)}},S=I=>{i(r.map(R=>R.id===I?{...R,showReplies:!R.showReplies}:R))};return u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("h2",{className:"text-2xl font-bold",children:["Discussions (",r.length,")"]}),t&&!f&&u.jsx(ne,{onClick:()=>m(!0),children:"Start Discussion"})]}),u.jsx("div",{className:"space-y-4",children:r.filter(I=>!E.includes(I.userId)).map(I=>{var R,N;return u.jsx(Oe,{children:u.jsx(jt,{className:"p-6",children:u.jsxs("div",{className:"flex gap-4",children:[u.jsxs("div",{className:"flex flex-col items-center gap-2",children:[u.jsx(ne,{variant:I.userVote==="up"?"default":"ghost",size:"sm",onClick:()=>D(I.id,"up"),className:"h-8 w-8 p-0",disabled:!t,children:u.jsx(wM,{className:"h-4 w-4"})}),u.jsx("span",{className:"text-sm font-bold",children:I.upvotes-I.downvotes}),u.jsx(ne,{variant:I.userVote==="down"?"default":"ghost",size:"sm",onClick:()=>D(I.id,"down"),className:"h-8 w-8 p-0",disabled:!t,children:u.jsx(TK,{className:"h-4 w-4"})})]}),u.jsxs("div",{className:"flex-1",children:[u.jsx("h3",{className:"text-lg font-semibold mb-2",children:I.title}),u.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:I.body}),u.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[u.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[u.jsxs(Ps,{className:"cursor-pointer hover:ring-2 ring-primary transition-all",onClick:()=>window.location.href=`/profile/${I.username}`,children:[u.jsx(ks,{src:I.avatarUrl}),u.jsx(Ns,{children:(R=I.username[0])==null?void 0:R.toUpperCase()})]}),u.jsxs("div",{children:[u.jsx("p",{className:"font-medium cursor-pointer hover:text-primary transition-colors",onClick:()=>window.location.href=`/profile/${I.username}`,children:I.username}),u.jsx("p",{className:"text-xs text-muted-foreground",children:I.createdAt&&Wa(I.createdAt.toDate(),{addSuffix:!0})})]})]}),u.jsxs(ne,{variant:"ghost",size:"sm",onClick:()=>S(I.id),className:"text-xs ml-auto",children:[u.jsx(li,{className:"mr-1 h-3 w-3"}),I.replies.length," ",I.replies.length===1?"Reply":"Replies"]})]}),I.showReplies&&u.jsxs("div",{className:"space-y-3 mt-4 pl-4 border-l-2 border-muted",children:[I.replies.map(L=>{var M;return u.jsx("div",{className:"space-y-2",children:u.jsxs("div",{className:"flex items-start gap-2",children:[u.jsxs(Ps,{className:"h-6 w-6",children:[u.jsx(ks,{src:L.avatarUrl}),u.jsx(Ns,{children:(M=L.username[0])==null?void 0:M.toUpperCase()})]}),u.jsxs("div",{className:"flex-1",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"text-sm font-medium",children:L.username}),u.jsx("span",{className:"text-xs text-muted-foreground",children:L.createdAt&&Wa(L.createdAt.toDate(),{addSuffix:!0})})]}),u.jsx("p",{className:"text-sm mt-1",children:L.text})]})]})},L.id)}),t&&u.jsxs("div",{className:"flex gap-2 mt-3",children:[u.jsx(Ii,{placeholder:"Write a reply...",value:p[I.id]||"",onChange:L=>y({...p,[I.id]:L.target.value}),className:"min-h-[80px]"}),u.jsx(ne,{onClick:()=>_(I.id),disabled:!((N=p[I.id])!=null&&N.trim()),size:"sm",children:"Reply"})]})]}),!I.showReplies&&t&&u.jsx(ne,{variant:"outline",size:"sm",onClick:()=>{S(I.id),x(I.id)},className:"text-xs",children:"Reply to discussion"})]})]})})},I.id)})}),f&&t&&u.jsxs(Oe,{className:"mt-6",children:[u.jsx(yc,{children:u.jsxs(vc,{children:["Start a Discussion about ",e]})}),u.jsx(jt,{children:u.jsxs("form",{onSubmit:C,className:"space-y-4",children:[u.jsx(bn,{placeholder:"Discussion title...",value:o,onChange:I=>a(I.target.value),required:!0}),u.jsx(Ii,{placeholder:"What's on your mind?",value:l,onChange:I=>c(I.target.value),className:"min-h-[150px]",required:!0}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx(ne,{type:"submit",disabled:d||!o.trim()||!l.trim(),children:d?"Posting...":"Post Discussion"}),u.jsx(ne,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancel"})]})]})})]}),!t&&!f&&u.jsx("div",{className:"text-center py-8 text-muted-foreground mt-6",children:"Please sign in to start a discussion"})]})}function Use(){var o,a,l,c,d,h;const{id:n}=pd(),{language:e}=nv(),{data:t,isLoading:s}=Zn({queryKey:["/api/anime",n]}),{data:r}=Zn({queryKey:["/api/anime",n,"episodes"]});if(s)return u.jsxs("div",{className:"min-h-screen bg-background",children:[u.jsx(rn,{className:"w-full h-[50vh]"}),u.jsx("div",{className:"container mx-auto px-4 py-6",children:u.jsx(rn,{className:"h-64 w-full"})})]});if(!(t!=null&&t.data))return u.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:u.jsxs("div",{className:"text-center space-y-3",children:[u.jsx("h1",{className:"text-2xl font-bold",children:"Anime Not Found"}),u.jsx(be,{href:"/",children:u.jsx(ne,{children:"Back to Home"})})]})});const i=t.data.anime;return u.jsxs("div",{className:"min-h-screen bg-background",children:[u.jsxs("div",{className:"relative w-full h-[45vh] sm:h-[50vh] md:h-[60vh] overflow-hidden",children:[u.jsxs("div",{className:"absolute inset-0",children:[u.jsx("img",{src:i.info.poster,alt:i.info.name,className:"w-full h-full object-cover object-center"}),u.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background via-background/90 to-background/40"}),u.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-background/95 via-background/70 to-transparent"})]}),u.jsx("div",{className:"relative z-10 container mx-auto px-4 md:px-6 h-full flex items-end pb-6 md:pb-8",children:u.jsxs("div",{className:"flex gap-4 md:gap-6 items-end w-full max-w-6xl",children:[u.jsx("img",{src:i.info.poster,alt:i.info.name,className:"hidden md:block w-32 h-44 lg:w-40 lg:h-56 object-cover rounded-lg shadow-2xl flex-shrink-0"}),u.jsxs("div",{className:"flex-1 min-w-0 space-y-2 md:space-y-3",children:[u.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-black text-foreground leading-tight","data-testid":`text-anime-title-${n}`,children:e==="jp"&&i.info.jname?i.info.jname.split("(")[0].trim():i.info.name.split("(")[0].trim()}),u.jsxs("div",{className:"flex items-center gap-2 md:gap-3 flex-wrap text-xs sm:text-sm",children:[((o=i.info.stats)==null?void 0:o.rating)&&u.jsxs("div",{className:"flex items-center gap-1 font-bold",children:[u.jsx(_w,{className:"w-3.5 h-3.5 md:w-4 md:h-4 fill-yellow-500 text-yellow-500"}),i.info.stats.rating]}),((a=i.info.stats)==null?void 0:a.type)&&u.jsx(qt,{variant:"secondary",className:"font-semibold",children:i.info.stats.type}),((l=i.info.stats)==null?void 0:l.duration)&&u.jsxs(qt,{variant:"secondary",className:"flex items-center gap-1 font-semibold",children:[u.jsx(py,{className:"w-3 h-3"}),i.info.stats.duration]}),((c=i.info.stats)==null?void 0:c.quality)&&u.jsx(qt,{className:"bg-purple-600 text-white font-semibold",children:i.info.stats.quality})]}),u.jsxs("div",{className:"flex gap-2 md:gap-3 pt-1 md:pt-2 flex-wrap",children:[((d=r==null?void 0:r.data)==null?void 0:d.episodes)&&r.data.episodes.length>0&&u.jsx(be,{href:`/watch/${n}?ep=${r.data.episodes[0].episodeId}`,children:u.jsxs(ne,{size:"lg",className:"h-9 md:h-11 px-4 md:px-6 gap-2 bg-purple-600 hover:bg-purple-700 text-white font-bold text-sm md:text-base","data-testid":"button-watch-now",children:[u.jsx(fi,{className:"w-4 h-4 md:w-5 md:h-5 fill-current"}),"Watch Now"]})}),u.jsx(Ose,{animeId:n||"",animeTitle:i.info.name,posterUrl:i.info.poster})]})]})]})})]}),u.jsxs("div",{className:"container mx-auto px-4 md:px-6 py-6 md:py-8",children:[u.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 max-w-7xl mx-auto",children:[u.jsx("div",{className:"lg:col-span-3 space-y-6",children:u.jsxs(aU,{defaultValue:"episodes",className:"w-full",children:[u.jsxs(K1,{className:"w-full justify-start bg-muted/50 h-auto p-0.5 overflow-x-auto flex-nowrap",children:[u.jsx(Rl,{value:"episodes",className:"data-[state=active]:bg-background font-bold text-sm md:text-base px-4 md:px-6 h-10 whitespace-nowrap","data-testid":"tab-episodes",children:"Episodes"}),u.jsx(Rl,{value:"overview",className:"data-[state=active]:bg-background font-bold text-sm md:text-base px-4 md:px-6 h-10 whitespace-nowrap","data-testid":"tab-overview",children:"Details"}),u.jsx(Rl,{value:"reviews",className:"data-[state=active]:bg-background font-bold text-sm md:text-base px-4 md:px-6 h-10 whitespace-nowrap",children:"Reviews"}),u.jsx(Rl,{value:"discussions",className:"data-[state=active]:bg-background font-bold text-sm md:text-base px-4 md:px-6 h-10 whitespace-nowrap",children:"Discussions"})]}),u.jsx(Cl,{value:"episodes",className:"mt-4 md:mt-6",children:(h=r==null?void 0:r.data)!=null&&h.episodes&&r.data.episodes.length>0?u.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-5 md:grid-cols-6 lg:grid-cols-8 xl:grid-cols-10 gap-2 md:gap-3",children:r.data.episodes.map(f=>u.jsx(be,{href:`/watch/${n}?ep=${f.episodeId}`,children:u.jsxs("div",{className:"group relative aspect-square rounded-lg overflow-hidden border border-border hover:border-purple-500 transition-all cursor-pointer bg-muted/50 hover:bg-muted","data-testid":`card-episode-${f.number}`,children:[u.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:u.jsx("span",{className:"text-2xl md:text-3xl font-black text-foreground/20 group-hover:text-foreground/30 transition-colors",children:f.number})}),u.jsx("div",{className:"absolute inset-0 bg-purple-600/0 group-hover:bg-purple-600/90 transition-all flex items-center justify-center",children:u.jsx(fi,{className:"w-6 h-6 md:w-8 md:h-8 text-white fill-current opacity-0 group-hover:opacity-100 scale-50 group-hover:scale-100 transition-all"})}),f.isFiller&&u.jsx("div",{className:"absolute top-1 right-1",children:u.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-orange-500"})})]})},f.episodeId))}):u.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No episodes available"})}),u.jsxs(Cl,{value:"overview",className:"mt-4 md:mt-6 space-y-6",children:[i.info.description&&u.jsxs("div",{children:[u.jsx("h2",{className:"text-lg md:text-xl font-bold mb-2",children:"Synopsis"}),u.jsx("p",{className:"text-sm md:text-base text-foreground/80 leading-relaxed",children:i.info.description})]}),i.moreInfo&&Object.keys(i.moreInfo).length>0&&u.jsxs("div",{children:[u.jsx("h2",{className:"text-lg md:text-xl font-bold mb-3",children:"Information"}),u.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 md:gap-4",children:Object.entries(i.moreInfo).map(([f,m])=>u.jsxs("div",{children:[u.jsx("dt",{className:"text-xs text-muted-foreground font-semibold mb-1",children:f}),u.jsx("dd",{className:"text-sm text-foreground font-medium",children:Array.isArray(m)?m.join(", "):m})]},f))})]})]}),u.jsx(Cl,{value:"reviews",className:"mt-4 md:mt-6",children:u.jsx(jse,{animeId:n||"",animeTitle:i.info.name})}),u.jsx(Cl,{value:"discussions",className:"mt-4 md:mt-6",children:u.jsx(Fse,{animeId:n||"",animeTitle:i.info.name})})]})}),u.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[t.data.seasons&&t.data.seasons.length>1&&u.jsxs("div",{children:[u.jsxs("h3",{className:"text-base md:text-lg font-bold mb-3 flex items-center gap-2",children:[u.jsx(vM,{className:"w-4 h-4"}),"Seasons"]}),u.jsx("div",{className:"space-y-2",children:t.data.seasons.map(f=>u.jsx(be,{href:`/anime/${f.id}`,children:u.jsx("div",{className:`p-3 rounded-lg cursor-pointer transition-all text-sm ${f.isCurrent?"bg-purple-600/20 border border-purple-600/50":"bg-muted/50 hover:bg-muted border border-transparent"}`,"data-testid":`card-season-${f.id}`,children:u.jsx("p",{className:"font-bold text-foreground line-clamp-1",children:f.name})})},f.id))})]}),t.data.relatedAnimes&&t.data.relatedAnimes.length>0&&u.jsxs("div",{className:"mt-4 md:mt-6",children:[u.jsxs("h3",{className:"text-base md:text-lg font-bold mb-3 flex items-center gap-2",children:[u.jsx(fi,{className:"w-4 h-4"}),"Related Anime"]}),u.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-3",children:t.data.relatedAnimes.slice(0,3).map(f=>u.jsx(be,{href:`/anime/${f.id}`,children:u.jsxs(Oe,{className:"group relative flex items-center p-3 rounded-lg cursor-pointer transition-all duration-300 hover:shadow-xl hover:shadow-primary/20 bg-muted/50 hover:bg-muted",children:[u.jsx("img",{src:f.poster,alt:f.name,className:"w-20 h-28 object-cover rounded-md mr-3 flex-shrink-0"}),u.jsxs("div",{className:"flex-1 min-w-0",children:[u.jsx("h4",{className:"text-foreground font-bold text-sm line-clamp-2 leading-tight",children:e==="jp"&&f.jname?f.jname:f.name}),u.jsx("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-3",children:e==="jp"&&f.jdescription?f.jdescription:f.description})]})]})},f.id))})]})]})]}),t.data.recommendedAnimes&&t.data.recommendedAnimes.length>0&&u.jsxs("div",{className:"mt-8 md:mt-12 max-w-7xl mx-auto",children:[u.jsx("h2",{className:"text-xl md:text-2xl font-bold mb-4",children:"You Might Also Like"}),u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3 md:gap-4",children:t.data.recommendedAnimes.slice(0,12).map(f=>u.jsx(no,{...f},f.id))})]})]})]})}function S0(n,[e,t]){return Math.min(t,Math.max(e,n))}function lU(n){const e=T.useRef({value:n,previous:n});return T.useMemo(()=>(e.current.value!==n&&(e.current.previous=e.current.value,e.current.value=n),e.current.previous),[n])}var cU=["PageUp","PageDown"],uU=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],dU={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Ld="Slider",[cT,Vse,$se]=vd(Ld),[hU,$pe]=Ds(Ld,[$se]),[Bse,iv]=hU(Ld),fU=T.forwardRef((n,e)=>{const{name:t,min:s=0,max:r=100,step:i=1,orientation:o="horizontal",disabled:a=!1,minStepsBetweenThumbs:l=0,defaultValue:c=[s],value:d,onValueChange:h=()=>{},onValueCommit:f=()=>{},inverted:m=!1,form:p,...y}=n,v=T.useRef(new Set),x=T.useRef(0),w=o==="horizontal"?Gse:Kse,[b=[],C]=Br({prop:d,defaultProp:c,onChange:N=>{var M;(M=[...v.current][x.current])==null||M.focus(),h(N)}}),D=T.useRef(b);function _(N){const L=Yse(b,N);R(N,L)}function S(N){R(N,x.current)}function I(){const N=D.current[x.current];b[x.current]!==N&&f(b)}function R(N,L,{commit:M}={commit:!1}){const G=Zse(i),V=ere(Math.round((N-s)/i)*i+s,G),$=S0(V,[s,r]);C((F=[])=>{const j=zse(F,$,L);if(Jse(j,l*i)){x.current=j.indexOf($);const U=String(j)!==String(F);return U&&M&&f(j),U?j:F}else return F})}return u.jsx(Bse,{scope:n.__scopeSlider,name:t,disabled:a,min:s,max:r,valueIndexToChangeRef:x,thumbs:v.current,values:b,orientation:o,form:p,children:u.jsx(cT.Provider,{scope:n.__scopeSlider,children:u.jsx(cT.Slot,{scope:n.__scopeSlider,children:u.jsx(w,{"aria-disabled":a,"data-disabled":a?"":void 0,...y,ref:e,onPointerDown:ie(y.onPointerDown,()=>{a||(D.current=b)}),min:s,max:r,inverted:m,onSlideStart:a?void 0:_,onSlideMove:a?void 0:S,onSlideEnd:a?void 0:I,onHomeKeyDown:()=>!a&&R(s,0,{commit:!0}),onEndKeyDown:()=>!a&&R(r,b.length-1,{commit:!0}),onStepKeyDown:({event:N,direction:L})=>{if(!a){const V=cU.includes(N.key)||N.shiftKey&&uU.includes(N.key)?10:1,$=x.current,F=b[$],j=i*V*L;R(F+j,$,{commit:!0})}}})})})})});fU.displayName=Ld;var[mU,pU]=hU(Ld,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Gse=T.forwardRef((n,e)=>{const{min:t,max:s,dir:r,inverted:i,onSlideStart:o,onSlideMove:a,onSlideEnd:l,onStepKeyDown:c,...d}=n,[h,f]=T.useState(null),m=ze(e,w=>f(w)),p=T.useRef(void 0),y=Nd(r),v=y==="ltr",x=v&&!i||!v&&i;function E(w){const b=p.current||h.getBoundingClientRect(),C=[0,b.width],_=H1(C,x?[t,s]:[s,t]);return p.current=b,_(w-b.left)}return u.jsx(mU,{scope:n.__scopeSlider,startEdge:x?"left":"right",endEdge:x?"right":"left",direction:x?1:-1,size:"width",children:u.jsx(gU,{dir:y,"data-orientation":"horizontal",...d,ref:m,style:{...d.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:w=>{const b=E(w.clientX);o==null||o(b)},onSlideMove:w=>{const b=E(w.clientX);a==null||a(b)},onSlideEnd:()=>{p.current=void 0,l==null||l()},onStepKeyDown:w=>{const C=dU[x?"from-left":"from-right"].includes(w.key);c==null||c({event:w,direction:C?-1:1})}})})}),Kse=T.forwardRef((n,e)=>{const{min:t,max:s,inverted:r,onSlideStart:i,onSlideMove:o,onSlideEnd:a,onStepKeyDown:l,...c}=n,d=T.useRef(null),h=ze(e,d),f=T.useRef(void 0),m=!r;function p(y){const v=f.current||d.current.getBoundingClientRect(),x=[0,v.height],w=H1(x,m?[s,t]:[t,s]);return f.current=v,w(y-v.top)}return u.jsx(mU,{scope:n.__scopeSlider,startEdge:m?"bottom":"top",endEdge:m?"top":"bottom",size:"height",direction:m?1:-1,children:u.jsx(gU,{"data-orientation":"vertical",...c,ref:h,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:y=>{const v=p(y.clientY);i==null||i(v)},onSlideMove:y=>{const v=p(y.clientY);o==null||o(v)},onSlideEnd:()=>{f.current=void 0,a==null||a()},onStepKeyDown:y=>{const x=dU[m?"from-bottom":"from-top"].includes(y.key);l==null||l({event:y,direction:x?-1:1})}})})}),gU=T.forwardRef((n,e)=>{const{__scopeSlider:t,onSlideStart:s,onSlideMove:r,onSlideEnd:i,onHomeKeyDown:o,onEndKeyDown:a,onStepKeyDown:l,...c}=n,d=iv(Ld,t);return u.jsx(Se.span,{...c,ref:e,onKeyDown:ie(n.onKeyDown,h=>{h.key==="Home"?(o(h),h.preventDefault()):h.key==="End"?(a(h),h.preventDefault()):cU.concat(uU).includes(h.key)&&(l(h),h.preventDefault())}),onPointerDown:ie(n.onPointerDown,h=>{const f=h.target;f.setPointerCapture(h.pointerId),h.preventDefault(),d.thumbs.has(f)?f.focus():s(h)}),onPointerMove:ie(n.onPointerMove,h=>{h.target.hasPointerCapture(h.pointerId)&&r(h)}),onPointerUp:ie(n.onPointerUp,h=>{const f=h.target;f.hasPointerCapture(h.pointerId)&&(f.releasePointerCapture(h.pointerId),i(h))})})}),yU="SliderTrack",vU=T.forwardRef((n,e)=>{const{__scopeSlider:t,...s}=n,r=iv(yU,t);return u.jsx(Se.span,{"data-disabled":r.disabled?"":void 0,"data-orientation":r.orientation,...s,ref:e})});vU.displayName=yU;var uT="SliderRange",xU=T.forwardRef((n,e)=>{const{__scopeSlider:t,...s}=n,r=iv(uT,t),i=pU(uT,t),o=T.useRef(null),a=ze(e,o),l=r.values.length,c=r.values.map(f=>wU(f,r.min,r.max)),d=l>1?Math.min(...c):0,h=100-Math.max(...c);return u.jsx(Se.span,{"data-orientation":r.orientation,"data-disabled":r.disabled?"":void 0,...s,ref:a,style:{...n.style,[i.startEdge]:d+"%",[i.endEdge]:h+"%"}})});xU.displayName=uT;var dT="SliderThumb",EU=T.forwardRef((n,e)=>{const t=Vse(n.__scopeSlider),[s,r]=T.useState(null),i=ze(e,a=>r(a)),o=T.useMemo(()=>s?t().findIndex(a=>a.ref.current===s):-1,[t,s]);return u.jsx(Hse,{...n,ref:i,index:o})}),Hse=T.forwardRef((n,e)=>{const{__scopeSlider:t,index:s,name:r,...i}=n,o=iv(dT,t),a=pU(dT,t),[l,c]=T.useState(null),d=ze(e,E=>c(E)),h=l?o.form||!!l.closest("form"):!0,f=WM(l),m=o.values[s],p=m===void 0?0:wU(m,o.min,o.max),y=qse(s,o.values.length),v=f==null?void 0:f[a.size],x=v?Qse(v,p,a.direction):0;return T.useEffect(()=>{if(l)return o.thumbs.add(l),()=>{o.thumbs.delete(l)}},[l,o.thumbs]),u.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${p}% + ${x}px)`},children:[u.jsx(cT.ItemSlot,{scope:n.__scopeSlider,children:u.jsx(Se.span,{role:"slider","aria-label":n["aria-label"]||y,"aria-valuemin":o.min,"aria-valuenow":m,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...i,ref:d,style:m===void 0?{display:"none"}:n.style,onFocus:ie(n.onFocus,()=>{o.valueIndexToChangeRef.current=s})})}),h&&u.jsx(Wse,{name:r??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:m},s)]})});EU.displayName=dT;var Wse=n=>{const{value:e,...t}=n,s=T.useRef(null),r=lU(e);return T.useEffect(()=>{const i=s.current,o=window.HTMLInputElement.prototype,l=Object.getOwnPropertyDescriptor(o,"value").set;if(r!==e&&l){const c=new Event("input",{bubbles:!0});l.call(i,e),i.dispatchEvent(c)}},[r,e]),u.jsx("input",{style:{display:"none"},...t,ref:s,defaultValue:e})};function zse(n=[],e,t){const s=[...n];return s[t]=e,s.sort((r,i)=>r-i)}function wU(n,e,t){const i=100/(t-e)*(n-e);return S0(i,[0,100])}function qse(n,e){return e>2?`Value ${n+1} of ${e}`:e===2?["Minimum","Maximum"][n]:void 0}function Yse(n,e){if(n.length===1)return 0;const t=n.map(r=>Math.abs(r-e)),s=Math.min(...t);return t.indexOf(s)}function Qse(n,e,t){const s=n/2,i=H1([0,50],[0,s]);return(s-i(e)*t)*t}function Xse(n){return n.slice(0,-1).map((e,t)=>n[t+1]-e)}function Jse(n,e){if(e>0){const t=Xse(n);return Math.min(...t)>=e}return!0}function H1(n,e){return t=>{if(n[0]===n[1]||e[0]===e[1])return e[0];const s=(e[1]-e[0])/(n[1]-n[0]);return e[0]+s*(t-n[0])}}function Zse(n){return(String(n).split(".")[1]||"").length}function ere(n,e){const t=Math.pow(10,e);return Math.round(n*t)/t}var TU=fU,tre=vU,nre=xU,sre=EU;const bU=T.forwardRef(({className:n,...e},t)=>u.jsxs(TU,{ref:t,className:Ae("relative flex w-full touch-none select-none items-center",n),...e,children:[u.jsx(tre,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:u.jsx(nre,{className:"absolute h-full bg-primary"})}),u.jsx(sre,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));bU.displayName=TU.displayName;const le=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},rre=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=ire},ire=Number.MAX_SAFE_INTEGER||9007199254740991;let Te=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),W=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n}({}),P=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n}({});var We={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},de={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Dc{constructor(e,t=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}sample(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class ore{constructor(e,t,s,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Dc(e),this.fast_=new Dc(t),this.defaultTTFB_=r,this.ttfb_=new Dc(e)}update(e,t){const{slow_:s,fast_:r,ttfb_:i}=this;s.halfLife!==e&&(this.slow_=new Dc(e,s.getEstimate(),s.getTotalWeight())),r.halfLife!==t&&(this.fast_=new Dc(t,r.getEstimate(),r.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new Dc(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const s=8*t,r=e/1e3,i=s/r;this.fast_.sample(r,i),this.slow_.sample(r,i)}sampleTTFB(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function are(n,e,t){return(e=cre(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Et(){return Et=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},Et.apply(null,arguments)}function pP(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,s)}return t}function ft(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?pP(Object(t),!0).forEach(function(s){are(n,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):pP(Object(t)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(t,s))})}return n}function lre(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var s=t.call(n,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function cre(n){var e=lre(n,"string");return typeof e=="symbol"?e:e+""}class Tr{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${e}]:`;this.trace=Zo,this.debug=t.debug.bind(null,s),this.log=t.log.bind(null,s),this.warn=t.warn.bind(null,s),this.info=t.info.bind(null,s),this.error=t.error.bind(null,s)}}const Zo=function(){},ure={trace:Zo,debug:Zo,log:Zo,warn:Zo,info:Zo,error:Zo};function hT(){return Et({},ure)}function dre(n,e){const t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):Zo}function gP(n,e,t){return e[n]?e[n].bind(e):dre(n,t)}const fT=hT();function hre(n,e,t){const s=hT();if(typeof console=="object"&&n===!0||typeof n=="object"){const r=["debug","log","info","warn","error"];r.forEach(i=>{s[i]=gP(i,n,t)});try{s.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return hT()}r.forEach(i=>{fT[i]=gP(i,n)})}else Et(fT,s);return s}const mt=fT;function za(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function fre(n){return typeof self<"u"&&n===self.ManagedMediaSource}function SU(n,e){const t=Object.keys(n),s=Object.keys(e),r=t.length,i=s.length;return!r||!i||r===i&&!t.some(o=>s.indexOf(o)===-1)}function Zs(n,e=!1){if(typeof TextDecoder<"u"){const c=new TextDecoder("utf-8").decode(n);if(e){const d=c.indexOf("\0");return d!==-1?c.substring(0,d):c}return c.replace(/\0/g,"")}const t=n.length;let s,r,i,o="",a=0;for(;a<t;){if(s=n[a++],s===0&&e)return o;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(s);break;case 12:case 13:r=n[a++],o+=String.fromCharCode((s&31)<<6|r&63);break;case 14:r=n[a++],i=n[a++],o+=String.fromCharCode((s&15)<<12|(r&63)<<6|(i&63)<<0);break}}return o}function Mn(n){let e="";for(let t=0;t<n.length;t++){let s=n[t].toString(16);s.length<2&&(s="0"+s),e+=s}return e}function _U(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function mre(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var kx={exports:{}},yP;function pre(){return yP||(yP=1,function(n,e){(function(t){var s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,c,d){if(d=d||{},l=l.trim(),c=c.trim(),!c){if(!d.alwaysNormalize)return l;var h=a.parseURL(l);if(!h)throw new Error("Error trying to parse base URL.");return h.path=a.normalizePath(h.path),a.buildURLFromParts(h)}var f=a.parseURL(c);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return d.alwaysNormalize?(f.path=a.normalizePath(f.path),a.buildURLFromParts(f)):c;var m=a.parseURL(l);if(!m)throw new Error("Error trying to parse base URL.");if(!m.netLoc&&m.path&&m.path[0]!=="/"){var p=r.exec(m.path);m.netLoc=p[1],m.path=p[2]}m.netLoc&&!m.path&&(m.path="/");var y={scheme:m.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(y.netLoc=m.netLoc,f.path[0]!=="/"))if(!f.path)y.path=m.path,f.params||(y.params=m.params,f.query||(y.query=m.query));else{var v=m.path,x=v.substring(0,v.lastIndexOf("/")+1)+f.path;y.path=a.normalizePath(x)}return y.path===null&&(y.path=d.alwaysNormalize?a.normalizePath(f.path):f.path),a.buildURLFromParts(y)},parseURL:function(l){var c=s.exec(l);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(i,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};n.exports=a})()}(kx)),kx.exports}var W1=pre();class z1{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var bt={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class AU{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,yre(this,"stats")}setByteRange(e,t){const s=e.split("@",2);let r;s.length===1?r=(t==null?void 0:t.byteRangeEndOffset)||0:r=parseInt(s[1]),this._byteRange=[r,parseInt(s[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[bt.AUDIO]:null,[bt.VIDEO]:null,[bt.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new z1),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=W1.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[bt.AUDIO]=null,e[bt.VIDEO]=null,e[bt.AUDIOVIDEO]=null}}function sn(n){return n.sn!=="initSegment"}class Nx extends AU{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(le(e)&&le(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const s=Object.keys(t);if(s.length===1){const r=this._decryptdata=t[s[0]]||null;r&&(this._decryptdata=r.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=le(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const s=Object.keys(this.levelkeys),r=s.length;if(r>1||r===1&&(t=this.levelkeys[s[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!le(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return sn(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var s;const r=t[e];r&&!((s=this._decryptdata)!=null&&s.keyId)&&(this._decryptdata=r.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,s,r,i,o=!1){const{elementaryStreams:a}=this,l=a[e];if(!l){a[e]={startPTS:t,endPTS:s,startDTS:r,endDTS:i,partial:o};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,s),l.startDTS=Math.min(l.startDTS,r),l.endDTS=Math.max(l.endDTS,i)}}class gre extends AU{constructor(e,t,s,r,i){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function IU(n,e){const t=Object.getPrototypeOf(n);if(t){const s=Object.getOwnPropertyDescriptor(t,e);return s||IU(t,e)}}function yre(n,e){const t=IU(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}const vP=Math.pow(2,32)-1,vre=[].push,RU={video:1,audio:2,id3:3,text:4};function yn(n){return String.fromCharCode.apply(null,n)}function CU(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function ke(n,e){const t=PU(n,e);return t<0?4294967296+t:t}function xP(n,e){let t=ke(n,e);return t*=Math.pow(2,32),t+=ke(n,e+4),t}function PU(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function xre(n){const e=n.byteLength;for(let t=0;t<e;){const s=ke(n,t);if(s>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=s>1?t+s:e}return!1}function He(n,e){const t=[];if(!e.length)return t;const s=n.byteLength;for(let r=0;r<s;){const i=ke(n,r),o=yn(n.subarray(r+4,r+8)),a=i>1?r+i:s;if(o===e[0])if(e.length===1)t.push(n.subarray(r+8,a));else{const l=He(n.subarray(r+8,a),e.slice(1));l.length&&vre.apply(t,l)}r=a}return t}function Ere(n){const e=[],t=n[0];let s=8;const r=ke(n,s);s+=4;let i=0,o=0;t===0?(i=ke(n,s),o=ke(n,s+4),s+=8):(i=xP(n,s),o=xP(n,s+8),s+=16),s+=2;let a=n.length+o;const l=CU(n,s);s+=2;for(let c=0;c<l;c++){let d=s;const h=ke(n,d);d+=4;const f=h&2147483647;if((h&2147483648)>>>31===1)return mt.warn("SIDX has hierarchical references (not supported)"),null;const p=ke(n,d);d+=4,e.push({referenceSize:f,subsegmentDuration:p,info:{duration:p/r,start:a,end:a+f-1}}),a+=f,d+=4,s=d}return{earliestPresentationTime:i,timescale:r,version:t,referencesCount:l,references:e}}function kU(n){const e=[],t=He(n,["moov","trak"]);for(let r=0;r<t.length;r++){const i=t[r],o=He(i,["tkhd"])[0];if(o){let a=o[0];const l=ke(o,a===0?12:20),c=He(i,["mdia","mdhd"])[0];if(c){a=c[0];const d=ke(c,a===0?12:20),h=He(i,["mdia","hdlr"])[0];if(h){const f=yn(h.subarray(8,12)),m={soun:bt.AUDIO,vide:bt.VIDEO}[f],p=He(i,["mdia","minf","stbl","stsd"])[0],y=wre(p);m?(e[l]={timescale:d,type:m,stsd:y},e[m]=ft({timescale:d,id:l},y)):e[l]={timescale:d,type:f,stsd:y}}}}}return He(n,["moov","mvex","trex"]).forEach(r=>{const i=ke(r,4),o=e[i];o&&(o.default={duration:ke(r,12),flags:ke(r,20)})}),e}function wre(n){const e=n.subarray(8),t=e.subarray(86),s=yn(e.subarray(4,8));let r=s,i;const o=s==="enca"||s==="encv";if(o){const c=He(e,[s])[0].subarray(s==="enca"?28:78);He(c,["sinf"]).forEach(h=>{const f=He(h,["schm"])[0];if(f){const m=yn(f.subarray(4,8));if(m==="cbcs"||m==="cenc"){const p=He(h,["frma"])[0];p&&(r=yn(p))}}})}const a=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const l=He(t,["avcC"])[0];l&&l.length>3&&(r+="."+wp(l[1])+wp(l[2])+wp(l[3]),i=Ep(a==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=He(e,[s])[0],c=He(l.subarray(28),["esds"])[0];if(c&&c.length>7){let d=4;if(c[d++]!==3)break;d=Lx(c,d),d+=2;const h=c[d++];if(h&128&&(d+=2),h&64&&(d+=c[d++]),c[d++]!==4)break;d=Lx(c,d);const f=c[d++];if(f===64)r+="."+wp(f);else break;if(d+=12,c[d++]!==5)break;d=Lx(c,d);const m=c[d++];let p=(m&248)>>3;p===31&&(p+=1+((m&7)<<3)+((c[d]&224)>>5)),r+="."+p}break}case"hvc1":case"hev1":{const l=He(t,["hvcC"])[0];if(l&&l.length>12){const c=l[1],d=["","A","B","C"][c>>6],h=c&31,f=ke(l,2),m=(c&32)>>5?"H":"L",p=l[12],y=l.subarray(6,12);r+="."+d+h,r+="."+Tre(f).toString(16).toUpperCase(),r+="."+m+p;let v="";for(let x=y.length;x--;){const E=y[x];(E||v)&&(v="."+E.toString(16).toUpperCase()+v)}r+=v}i=Ep(a=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=Ep(r,t)||r;break}case"vp09":{const l=He(t,["vpcC"])[0];if(l&&l.length>6){const c=l[4],d=l[5],h=l[6]>>4&15;r+="."+Zr(c)+"."+Zr(d)+"."+Zr(h)}break}case"av01":{const l=He(t,["av1C"])[0];if(l&&l.length>2){const c=l[1]>>>5,d=l[1]&31,h=l[2]>>>7?"H":"M",f=(l[2]&64)>>6,m=(l[2]&32)>>5,p=c===2&&f?m?12:10:f?10:8,y=(l[2]&16)>>4,v=(l[2]&8)>>3,x=(l[2]&4)>>2,E=l[2]&3;r+="."+c+"."+Zr(d)+h+"."+Zr(p)+"."+y+"."+v+x+E+"."+Zr(1)+"."+Zr(1)+"."+Zr(1)+"."+0,i=Ep("dav1",t)}break}}return{codec:r,encrypted:o,supplemental:i}}function Ep(n,e){const t=He(e,["dvvC"]),s=t.length?t[0]:He(e,["dvcC"])[0];if(s){const r=s[2]>>1&127,i=s[2]<<5&32|s[3]>>3&31;return n+"."+Zr(r)+"."+Zr(i)}}function Tre(n){let e=0;for(let t=0;t<32;t++)e|=(n>>t&1)<<31-t;return e>>>0}function Lx(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function wp(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function Zr(n){return(n<10?"0":"")+n}function bre(n,e){if(!n||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&NU(n,(s,r)=>{const i=s.subarray(8,24);i.some(o=>o!==0)||(mt.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${Mn(i)} -> ${Mn(t)}`),s.set(t,8))})}function Sre(n){const e=[];return NU(n,t=>e.push(t.subarray(8,24))),e}function NU(n,e){He(n,["moov","trak"]).forEach(s=>{const r=He(s,["mdia","minf","stbl","stsd"])[0];if(!r)return;const i=r.subarray(8);let o=He(i,["enca"]);const a=o.length>0;a||(o=He(i,["encv"])),o.forEach(l=>{const c=a?l.subarray(28):l.subarray(78);He(c,["sinf"]).forEach(h=>{const f=LU(h);f&&e(f,a)})})})}function LU(n){const e=He(n,["schm"])[0];if(e){const t=yn(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const s=He(n,["schi","tenc"])[0];if(s)return s}}}function _re(n,e,t){const s={},r=He(n,["moof","traf"]);for(let i=0;i<r.length;i++){const o=r[i],a=He(o,["tfhd"])[0],l=ke(a,4),c=e[l];if(!c)continue;s[l]||(s[l]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type});const d=s[l],h=He(o,["tfdt"])[0];if(h){const w=h[0];let b=ke(h,4);w===1&&(b===vP?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(b*=vP+1,b+=ke(h,8))),le(b)&&(!le(d.start)||b<d.start)&&(d.start=b)}const f=c.default,m=ke(a,0)|(f==null?void 0:f.flags);let p=(f==null?void 0:f.duration)||0;m&8&&(m&2?p=ke(a,12):p=ke(a,8));const y=He(o,["trun"]);let v=d.start||0,x=0,E=p;for(let w=0;w<y.length;w++){const b=y[w],C=ke(b,4),D=d.sampleCount;d.sampleCount+=C;const _=b[3]&1,S=b[3]&4,I=b[2]&1,R=b[2]&2,N=b[2]&4,L=b[2]&8;let M=8,G=C;for(_&&(M+=4),S&&C&&(!(b[M+1]&1)&&d.keyFrameIndex===void 0&&(d.keyFrameIndex=D),M+=4,I?(E=ke(b,M),M+=4):E=p,R&&(M+=4),L&&(M+=4),v+=E,x+=E,G--);G--;)I?(E=ke(b,M),M+=4):E=p,R&&(M+=4),N&&(b[M+1]&1||d.keyFrameIndex===void 0&&(d.keyFrameIndex=d.sampleCount-(G+1),d.keyFrameStart=v),M+=4),L&&(M+=4),v+=E,x+=E;!x&&p&&(x+=p*C)}d.duration+=x}if(!Object.keys(s).some(i=>s[i].duration)){let i=1/0,o=0;const a=He(n,["sidx"]);for(let l=0;l<a.length;l++){const c=Ere(a[l]);if(c!=null&&c.references){i=Math.min(i,c.earliestPresentationTime/c.timescale);const d=c.references.reduce((h,f)=>h+f.info.duration||0,0);o=Math.max(o,d+c.earliestPresentationTime/c.timescale)}}o&&le(o)&&Object.keys(s).forEach(l=>{s[l].duration||(s[l].duration=o*s[l].timescale-s[l].start)})}return s}function Are(n){const e={valid:null,remainder:null},t=He(n,["moof"]);if(t.length<2)return e.remainder=n,e;const s=t[t.length-1];return e.valid=n.slice(0,s.byteOffset-8),e.remainder=n.slice(s.byteOffset-8),e}function Er(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function EP(n,e){const t=[],s=e.samples,r=e.timescale,i=e.id;let o=!1;return He(s,["moof"]).map(l=>{const c=l.byteOffset-8;He(l,["traf"]).map(h=>{const f=He(h,["tfdt"]).map(m=>{const p=m[0];let y=ke(m,4);return p===1&&(y*=Math.pow(2,32),y+=ke(m,8)),y/r})[0];return f!==void 0&&(n=f),He(h,["tfhd"]).map(m=>{const p=ke(m,4),y=ke(m,0)&16777215,v=(y&1)!==0,x=(y&2)!==0,E=(y&8)!==0;let w=0;const b=(y&16)!==0;let C=0;const D=(y&32)!==0;let _=8;p===i&&(v&&(_+=8),x&&(_+=4),E&&(w=ke(m,_),_+=4),b&&(C=ke(m,_),_+=4),D&&(_+=4),e.type==="video"&&(o=ov(e.codec)),He(h,["trun"]).map(S=>{const I=S[0],R=ke(S,0)&16777215,N=(R&1)!==0;let L=0;const M=(R&4)!==0,G=(R&256)!==0;let V=0;const $=(R&512)!==0;let F=0;const j=(R&1024)!==0,U=(R&2048)!==0;let X=0;const Y=ke(S,4);let J=8;N&&(L=ke(S,J),J+=4),M&&(J+=4);let ae=L+c;for(let he=0;he<Y;he++){if(G?(V=ke(S,J),J+=4):V=w,$?(F=ke(S,J),J+=4):F=C,j&&(J+=4),U&&(I===0?X=ke(S,J):X=PU(S,J),J+=4),e.type===bt.VIDEO){let ve=0;for(;ve<F;){const ge=ke(s,ae);if(ae+=4,Ire(o,s[ae])){const re=s.subarray(ae,ae+ge);q1(re,o?2:1,n+X/r,t)}ae+=ge,ve+=ge+4}}n+=V/r}}))})})}),t}function ov(n){if(!n)return!1;const e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function Ire(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function q1(n,e,t,s){const r=DU(n);let i=0;i+=e;let o=0,a=0,l=0;for(;i<r.length;){o=0;do{if(i>=r.length)break;l=r[i++],o+=l}while(l===255);a=0;do{if(i>=r.length)break;l=r[i++],a+=l}while(l===255);const c=r.length-i;let d=i;if(a<c)i+=a;else if(a>c){mt.error(`Malformed SEI payload. ${a} is too small, only ${c} bytes left to parse.`);break}if(o===4){if(r[d++]===181){const f=CU(r,d);if(d+=2,f===49){const m=ke(r,d);if(d+=4,m===1195456820){const p=r[d++];if(p===3){const y=r[d++],v=31&y,x=64&y,E=x?2+v*3:0,w=new Uint8Array(E);if(x){w[0]=y;for(let b=1;b<E;b++)w[b]=r[d++]}s.push({type:p,payloadType:o,pts:t,bytes:w})}}}}}else if(o===5&&a>16){const h=[];for(let p=0;p<16;p++){const y=r[d++].toString(16);h.push(y.length==1?"0"+y:y),(p===3||p===5||p===7||p===9)&&h.push("-")}const f=a-16,m=new Uint8Array(f);for(let p=0;p<f;p++)m[p]=r[d++];s.push({payloadType:o,pts:t,uuid:h.join(""),userData:Zs(m),userDataBytes:m})}}}function DU(n){const e=n.byteLength,t=[];let s=1;for(;s<e-2;)n[s]===0&&n[s+1]===0&&n[s+2]===3?(t.push(s+2),s+=2):s++;if(t.length===0)return n;const r=e-t.length,i=new Uint8Array(r);let o=0;for(s=0;s<r;o++,s++)o===t[0]&&(o++,t.shift()),i[s]=n[o];return i}function Rre(n){const e=n[0];let t="",s="",r=0,i=0,o=0,a=0,l=0,c=0;if(e===0){for(;yn(n.subarray(c,c+1))!=="\0";)t+=yn(n.subarray(c,c+1)),c+=1;for(t+=yn(n.subarray(c,c+1)),c+=1;yn(n.subarray(c,c+1))!=="\0";)s+=yn(n.subarray(c,c+1)),c+=1;s+=yn(n.subarray(c,c+1)),c+=1,r=ke(n,12),i=ke(n,16),a=ke(n,20),l=ke(n,24),c=28}else if(e===1){c+=4,r=ke(n,c),c+=4;const h=ke(n,c);c+=4;const f=ke(n,c);for(c+=4,o=2**32*h+f,rre(o)||(o=Number.MAX_SAFE_INTEGER,mt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=ke(n,c),c+=4,l=ke(n,c),c+=4;yn(n.subarray(c,c+1))!=="\0";)t+=yn(n.subarray(c,c+1)),c+=1;for(t+=yn(n.subarray(c,c+1)),c+=1;yn(n.subarray(c,c+1))!=="\0";)s+=yn(n.subarray(c,c+1)),c+=1;s+=yn(n.subarray(c,c+1)),c+=1}const d=n.subarray(c,n.byteLength);return{schemeIdUri:t,value:s,timeScale:r,presentationTime:o,presentationTimeDelta:i,eventDuration:a,id:l,payload:d}}function Cre(n,...e){const t=e.length;let s=8,r=t;for(;r--;)s+=e[r].byteLength;const i=new Uint8Array(s);for(i[0]=s>>24&255,i[1]=s>>16&255,i[2]=s>>8&255,i[3]=s&255,i.set(n,4),r=0,s=8;r<t;r++)i.set(e[r],s),s+=e[r].byteLength;return i}function Pre(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let s,r;s=0,r=new Uint8Array;let i;s>0?(i=new Uint8Array(4),e.length>0&&new DataView(i.buffer).setUint32(0,e.length,!1)):i=new Uint8Array;const o=new Uint8Array(4);return t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),Cre([112,115,115,104],new Uint8Array([s,0,0,0]),n,i,r,o,t)}function kre(n){const e=[];if(n instanceof ArrayBuffer){const t=n.byteLength;let s=0;for(;s+32<t;){const r=new DataView(n,s),i=Nre(r);e.push(i),s+=i.size}}return e}function Nre(n){const e=n.getUint32(0),t=n.byteOffset,s=n.byteLength;if(s<e)return{offset:t,size:s};if(n.getUint32(4)!==1886614376)return{offset:t,size:e};const i=n.getUint32(8)>>>24;if(i!==0&&i!==1)return{offset:t,size:e};const o=n.buffer,a=Mn(new Uint8Array(o,t+12,16));let l=null,c=null,d=0;if(i===0)d=28;else{const f=n.getUint32(28);if(!f||s<32+f*16)return{offset:t,size:e};l=[];for(let m=0;m<f;m++)l.push(new Uint8Array(o,t+32+m*16,16));d=32+f*16}if(!d)return{offset:t,size:e};const h=n.getUint32(d);return e-32<h?{offset:t,size:e}:(c=new Uint8Array(o,t+d+4,h),{version:i,systemId:a,kids:l,data:c,offset:t,size:e})}const MU=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),ld={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Y1(n,e){const t=ld[e];return!!t&&!!t[n.slice(0,4)]}function Mf(n,e,t=!0){return!n.split(",").some(s=>!Q1(s,e,t))}function Q1(n,e,t=!0){var s;const r=za(t);return(s=r==null?void 0:r.isTypeSupported(Of(n,e)))!=null?s:!1}function Of(n,e){return`${e}/mp4;codecs=${n}`}function wP(n){if(n){const e=n.substring(0,4);return ld.video[e]}return 2}function _0(n){const e=MU();return n.split(",").reduce((t,s)=>{const i=e&&ov(s)?9:ld.video[s];return i?(i*2+t)/(t?3:2):(ld.audio[s]+t)/(t?2:1)},0)}const Dx={};function Lre(n,e=!0){if(Dx[n])return Dx[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let r=0;r<t.length;r++){var s;if(Q1(t[r],"audio",e))return Dx[n]=t[r],t[r];if(t[r]==="mp3"&&(s=za(e))!=null&&s.isTypeSupported("audio/mpeg"))return""}return n}const Dre=/flac|opus|mp4a\.40\.34/i;function A0(n,e=!0){return n.replace(Dre,t=>Lre(t.toLowerCase(),e))}function Mre(n,e){const t=[];if(n){const s=n.split(",");for(let r=0;r<s.length;r++)Y1(s[r],"video")||t.push(s[r])}return e&&t.push(e),t.join(",")}function mg(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1)&&(TP(n,"audio")||TP(n,"video")))return n;if(e){const t=e.split(",");if(t.length>1){if(n){for(let s=t.length;s--;)if(t[s].substring(0,4)===n.substring(0,4))return t[s]}return t[0]}}return e||n}function TP(n,e){return Y1(n,e)&&Q1(n,e)}function Ore(n){const e=n.split(",");for(let t=0;t<e.length;t++){const s=e[t].split(".");s.length>2&&s[0]==="avc1"&&(e[t]=`avc1.${parseInt(s[1]).toString(16)}${("000"+parseInt(s[2]).toString(16)).slice(-4)}`)}return e.join(",")}function jre(n){if(n.startsWith("av01.")){const e=n.split("."),t=["0","111","01","01","01","0"];for(let s=e.length;s>4&&s<10;s++)e[s]=t[s-4];return e.join(".")}return n}function bP(n){const e=za(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function mT(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const Fre={supported:!0,powerEfficient:!0,smooth:!0},Ure={supported:!1,smooth:!1,powerEfficient:!1},OU={supported:!0,configurations:[],decodingInfoResults:[Fre]};function jU(n,e){return{supported:!1,configurations:e,decodingInfoResults:[Ure],error:n}}function Vre(n,e,t,s,r,i){const o=n.videoCodec,a=n.audioCodec?n.audioGroups:null,l=i==null?void 0:i.audioCodec,c=i==null?void 0:i.channels,d=c?parseInt(c):l?1/0:2;let h=null;if(a!=null&&a.length)try{a.length===1&&a[0]?h=e.groups[a[0]].channels:h=a.reduce((f,m)=>{if(m){const p=e.groups[m];if(!p)throw new Error(`Audio track group ${m} not found`);Object.keys(p.channels).forEach(y=>{f[y]=(f[y]||0)+p.channels[y]})}return f},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(f=>ov(f))||n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(s,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(r,8e6))||!!h&&le(d)&&Object.keys(h).some(f=>parseInt(f)>d)}function FU(n,e,t,s={}){const r=n.videoCodec;if(!r&&!n.audioCodec||!t)return Promise.resolve(OU);const i=[],o=$re(n),a=o.length,l=Bre(n,e,a>0),c=l.length;for(let d=a||1*c||1;d--;){const h={type:"media-source"};if(a&&(h.video=o[d%a]),c){h.audio=l[d%c];const f=h.audio.bitrate;h.video&&f&&(h.video.bitrate-=f)}i.push(h)}if(r){const d=navigator.userAgent;if(r.split(",").some(h=>ov(h))&&MU())return Promise.resolve(jU(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${d})`),i))}return Promise.all(i.map(d=>{const h=Kre(d);return s[h]||(s[h]=t.decodingInfo(d))})).then(d=>({supported:!d.some(h=>!h.supported),configurations:i,decodingInfoResults:d})).catch(d=>({supported:!1,configurations:i,decodingInfoResults:[],error:d}))}function $re(n){var e;const t=(e=n.videoCodec)==null?void 0:e.split(","),s=UU(n),r=n.width||640,i=n.height||480,o=n.frameRate||30,a=n.videoRange.toLowerCase();return t?t.map(l=>{const c={contentType:Of(jre(l),"video"),width:r,height:i,bitrate:s,framerate:o};return a!=="sdr"&&(c.transferFunction=a),c}):[]}function Bre(n,e,t){var s;const r=(s=n.audioCodec)==null?void 0:s.split(","),i=UU(n);return r&&n.audioGroups?n.audioGroups.reduce((o,a)=>{var l;const c=a?(l=e.groups[a])==null?void 0:l.tracks:null;return c?c.reduce((d,h)=>{if(h.groupId===a){const f=parseFloat(h.channels||"");r.forEach(m=>{const p={contentType:Of(m,"audio"),bitrate:t?Gre(m,i):i};f&&(p.channels=""+f),d.push(p)})}return d},o):o},[]):[]}function Gre(n,e){if(e<=1)return 1;let t=128e3;return n==="ec-3"?t=768e3:n==="ac-3"&&(t=64e4),Math.min(e/2,t)}function UU(n){return Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)/1e3)*1e3||1}function Kre(n){let e="";const{audio:t,video:s}=n;if(s){const r=mT(s.contentType);e+=`${r}_r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${Math.ceil(s.bitrate/1e5)}`}if(t){const r=mT(t.contentType);e+=`${s?"_":""}${r}_c${t.channels}`}return e}const pT=["NONE","TYPE-0","TYPE-1",null];function Hre(n){return pT.indexOf(n)>-1}const I0=["SDR","PQ","HLG"];function Wre(n){return!!n&&I0.indexOf(n)>-1}var pg={No:"",Yes:"YES",v2:"v2"};function SP(n){const{canSkipUntil:e,canSkipDateRanges:t,age:s}=n,r=s<e/2;return e&&r?t?pg.v2:pg.Yes:pg.No}class _P{constructor(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class jf{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(s=>!!s).map(s=>s.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const s=(t=e.supplemental)==null?void 0:t.videoCodec;s&&s!==e.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return AP(this._audioGroups,e)}hasSubtitleGroup(e){return AP(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let s=this._audioGroups;s||(s=this._audioGroups=[]),s.indexOf(t)===-1&&s.push(t)}else if(e==="text"){let s=this._subtitleGroups;s||(s=this._subtitleGroups=[]),s.indexOf(t)===-1&&s.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function AP(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function zre(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function qre(n,e){let t=!1,s=[];if(n&&(t=n!=="SDR",s=[n]),e){s=e.allowedVideoRanges||I0.slice(0);const r=s.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:r&&zre(),t||(s=["SDR"])}return{preferHDR:t,allowedVideoRanges:s}}const Yre=n=>{const e=new WeakSet;return(t,s)=>{if(n&&(s=n(t,s)),typeof s=="object"&&s!==null){if(e.has(s))return;e.add(s)}return s}},St=(n,e)=>JSON.stringify(n,Yre(e));function Qre(n,e,t,s,r){const i=Object.keys(n),o=s==null?void 0:s.channels,a=s==null?void 0:s.audioCodec,l=r==null?void 0:r.videoCodec,c=o&&parseInt(o)===2;let d=!1,h=!1,f=1/0,m=1/0,p=1/0,y=1/0,v=0,x=[];const{preferHDR:E,allowedVideoRanges:w}=qre(e,r);for(let S=i.length;S--;){const I=n[i[S]];d||(d=I.channels[2]>0),f=Math.min(f,I.minHeight),m=Math.min(m,I.minFramerate),p=Math.min(p,I.minBitrate),w.filter(N=>I.videoRanges[N]>0).length>0&&(h=!0)}f=le(f)?f:0,m=le(m)?m:0;const b=Math.max(1080,f),C=Math.max(30,m);p=le(p)?p:t,t=Math.max(p,t),h||(e=void 0);const D=i.length>1;return{codecSet:i.reduce((S,I)=>{const R=n[I];if(I===S)return S;if(x=h?w.filter(N=>R.videoRanges[N]>0):[],D){if(R.minBitrate>t)return Qr(I,`min bitrate of ${R.minBitrate} > current estimate of ${t}`),S;if(!R.hasDefaultAudio)return Qr(I,"no renditions with default or auto-select sound found"),S;if(a&&I.indexOf(a.substring(0,4))%5!==0)return Qr(I,`audio codec preference "${a}" not found`),S;if(o&&!c){if(!R.channels[o])return Qr(I,`no renditions with ${o} channel sound found (channels options: ${Object.keys(R.channels)})`),S}else if((!a||c)&&d&&R.channels[2]===0)return Qr(I,"no renditions with stereo sound found"),S;if(R.minHeight>b)return Qr(I,`min resolution of ${R.minHeight} > maximum of ${b}`),S;if(R.minFramerate>C)return Qr(I,`min framerate of ${R.minFramerate} > maximum of ${C}`),S;if(!x.some(N=>R.videoRanges[N]>0))return Qr(I,`no variants with VIDEO-RANGE of ${St(x)} found`),S;if(l&&I.indexOf(l.substring(0,4))%5!==0)return Qr(I,`video codec preference "${l}" not found`),S;if(R.maxScore<v)return Qr(I,`max score of ${R.maxScore} < selected max of ${v}`),S}return S&&(_0(I)>=_0(S)||R.fragmentError>n[S].fragmentError)?S:(y=R.minIndex,v=R.maxScore,I)},void 0),videoRanges:x,preferHDR:E,minFramerate:m,minBitrate:p,minIndex:y}}function Qr(n,e){mt.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function VU(n){return n.reduce((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(t);const r=t.channels||"2";return s.channels[r]=(s.channels[r]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Xre(n,e,t,s){return n.slice(t,s+1).reduce((r,i,o)=>{if(!i.codecSet)return r;const a=i.audioGroups;let l=r[i.codecSet];l||(r[i.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,i.bitrate);const c=Math.min(i.height,i.width);return l.minHeight=Math.min(l.minHeight,c),l.minFramerate=Math.min(l.minFramerate,i.frameRate),l.minIndex=Math.min(l.minIndex,o),l.maxScore=Math.max(l.maxScore,i.score),l.fragmentError+=i.fragmentError,l.videoRanges[i.videoRange]=(l.videoRanges[i.videoRange]||0)+1,a&&a.forEach(d=>{if(!d)return;const h=e.groups[d];h&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?h.hasDefault:h.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(h.channels).forEach(f=>{l.channels[f]=(l.channels[f]||0)+h.channels[f]}))}),r},{})}function IP(n){if(!n)return n;const{lang:e,assocLang:t,characteristics:s,channels:r,audioCodec:i}=n;return{lang:e,assocLang:t,characteristics:s,channels:r,audioCodec:i}}function ci(n,e,t){if("attrs"in n){const s=e.indexOf(n);if(s!==-1)return s}for(let s=0;s<e.length;s++){const r=e[s];if(Bl(n,r,t))return s}return-1}function Bl(n,e,t){const{groupId:s,name:r,lang:i,assocLang:o,default:a}=n,l=n.forced;return(s===void 0||e.groupId===s)&&(r===void 0||e.name===r)&&(i===void 0||Jre(i,e.lang))&&(i===void 0||e.assocLang===o)&&(a===void 0||e.default===a)&&(l===void 0||e.forced===l)&&(!("characteristics"in n)||Zre(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function Jre(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function Zre(n,e=""){const t=n.split(","),s=e.split(",");return t.length===s.length&&!t.some(r=>s.indexOf(r)===-1)}function xl(n,e){const{audioCodec:t,channels:s}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(s===void 0||s===(e.channels||"2"))}function eie(n,e,t,s,r){const i=e[s],a=e.reduce((f,m,p)=>{const y=m.uri;return(f[y]||(f[y]=[])).push(p),f},{})[i.uri];a.length>1&&(s=Math.max.apply(Math,a));const l=i.videoRange,c=i.frameRate,d=i.codecSet.substring(0,4),h=RP(e,s,f=>{if(f.videoRange!==l||f.frameRate!==c||f.codecSet.substring(0,4)!==d)return!1;const m=f.audioGroups,p=t.filter(y=>!m||m.indexOf(y.groupId)!==-1);return ci(n,p,r)>-1});return h>-1?h:RP(e,s,f=>{const m=f.audioGroups,p=t.filter(y=>!m||m.indexOf(y.groupId)!==-1);return ci(n,p,r)>-1})}function RP(n,e,t){for(let s=e;s>-1;s--)if(t(n[s]))return s;for(let s=e+1;s<n.length;s++)if(t(n[s]))return s;return-1}function R0(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}class tie extends Tr{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var s;const{fragCurrent:r,partCurrent:i,hls:o}=this,{autoLevelEnabled:a,media:l}=o;if(!r||!l)return;const c=performance.now(),d=i?i.stats:r.stats,h=i?i.duration:r.duration,f=c-d.loading.start,m=o.minAutoLevel,p=r.level,y=this._nextAutoLevel;if(d.aborted||d.loaded&&d.loaded===d.total||p<=m){this.clearTimer(),this._nextAutoLevel=-1;return}if(!a)return;const v=y>-1&&y!==p,x=!!t||v;if(!x&&(l.paused||!l.playbackRate||!l.readyState))return;const E=o.mainForwardBufferInfo;if(!x&&E===null)return;const w=this.bwEstimator.getEstimateTTFB(),b=Math.abs(l.playbackRate);if(f<=Math.max(w,1e3*(h/(b*2))))return;const C=E?E.len/b:0,D=d.loading.first?d.loading.first-d.loading.start:-1,_=d.loaded&&D>-1,S=this.getBwEstimate(),I=o.levels,R=I[p],N=Math.max(d.loaded,Math.round(h*(r.bitrate||R.averageBitrate)/8));let L=_?f-D:f;L<1&&_&&(L=Math.min(f,d.loaded*8/S));const M=_?d.loaded*1e3/L:0,G=w/1e3,V=M?(N-d.loaded)/M:N*8/S+G;if(V<=C)return;const $=M?M*8:S,F=((s=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:s.live)===!0,j=this.hls.config.abrBandWidthUpFactor;let U=Number.POSITIVE_INFINITY,X;for(X=p-1;X>m;X--){const he=I[X].maxBitrate,ve=!I[X].details||F;if(U=this.getTimeToLoadFrag(G,$,h*he,ve),U<Math.min(C,h+G))break}if(U>=V||U>h*10)return;_?this.bwEstimator.sample(f-Math.min(w,D),d.loaded):this.bwEstimator.sampleTTFB(f);const Y=I[X].maxBitrate;this.getBwEstimate()*j>Y&&this.resetEstimator(Y);const J=this.findBestLevel(Y,m,X,0,C,1,1);J>-1&&(X=J),this.warn(`Fragment ${r.sn}${i?" part "+i.index:""} of level ${p} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${C.toFixed(3)} s
      Estimated load time for current fragment: ${V.toFixed(3)} s
      Estimated load time for down switch fragment: ${U.toFixed(3)} s
      TTFB estimate: ${D|0} ms
      Current BW estimate: ${le(S)?S|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${X} @ ${Y|0} bps`),o.nextLoadLevel=o.nextAutoLevel=X,this.clearTimer();const ae=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===X&&X>0){const he=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${X>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${he.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,X>m){let ve=this.findBestLevel(this.hls.levels[m].bitrate,m,X,0,he,1,1);ve===-1&&(ve=m),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ve,this.resetEstimator(this.hls.levels[ve].bitrate)}}};v||V>U*2?ae():this.timer=self.setInterval(ae,U*1e3),o.trigger(P.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:i,stats:d})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new ore(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.FRAG_LOADING,this.onFragLoading,this),e.on(P.FRAG_LOADED,this.onFragLoaded,this),e.on(P.FRAG_BUFFERED,this.onFragBuffered,this),e.on(P.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(P.LEVEL_LOADED,this.onLevelLoaded,this),e.on(P.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(P.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(P.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.FRAG_LOADING,this.onFragLoading,this),e.off(P.FRAG_LOADED,this.onFragLoaded,this),e.off(P.FRAG_BUFFERED,this.onFragBuffered,this),e.off(P.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(P.LEVEL_LOADED,this.onLevelLoaded,this),e.off(P.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(P.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(P.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const s=t.frag;if(!this.ignoreFragment(s)){if(!s.bitrateTest){var r;this.fragCurrent=s,this.partCurrent=(r=t.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case W.BUFFER_ADD_CODEC_ERROR:case W.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case W.FRAG_LOAD_TIMEOUT:{const s=t.frag,{fragCurrent:r,partCurrent:i}=this;if(s&&r&&s.sn===r.sn&&s.level===r.level){const o=performance.now(),a=i?i.stats:s.stats,l=o-a.loading.start,c=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&c>-1){const h=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(h,c),a.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,s,r){const i=e+s/t,o=r?e+this.lastLevelLoadSec:0;return i+o}onLevelLoaded(e,t){const s=this.hls.config,{loading:r}=t.stats,i=r.end-r.first;le(i)&&(this.lastLevelLoadSec=i/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:s}){const r=s?s.stats:t.stats;if(t.type===de.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const i=s?s.duration:t.duration,o=this.hls.levels[t.level],a=(o.loaded?o.loaded.bytes:0)+r.loaded,l=(o.loaded?o.loaded.duration:0)+i;o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}if(t.bitrateTest){const i={stats:r,frag:t,part:s,id:t.type};this.onFragBuffered(P.FRAG_BUFFERED,i),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:s,part:r}=t,i=r!=null&&r.stats.loaded?r.stats:s.stats;if(i.aborted||this.ignoreFragment(s))return;const o=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,i.loaded),i.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==de.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,s=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,i=this.findBestLevel(s,t,e,0,r,1,1);if(i>-1)return i;const o=this.hls.firstLevel,a=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,s=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!s||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const i=s&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,i)&&o[e].loadError<=o[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:r,config:i,minAutoLevel:o}=s,a=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),c=this.getStarvationDelay();let d=i.abrBandWidthFactor,h=i.abrBandWidthUpFactor;if(c){const v=this.findBestLevel(l,o,r,c,0,d,h);if(v>=0)return this.rebufferNotice=-1,v}let f=a?Math.min(a,i.maxStarvationDelay):i.maxStarvationDelay;if(!c){const v=this.bitrateTestDelay;v&&(f=(a?Math.min(a,i.maxLoadingDelay):i.maxLoadingDelay)-v,this.info(`bitrate test took ${Math.round(1e3*v)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),d=h=1)}const m=this.findBestLevel(l,o,r,c,f,d,h);if(this.rebufferNotice!==m&&(this.rebufferNotice=m,this.info(`${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${m}`)),m>-1)return m;const p=s.levels[o],y=s.loadLevelObj;return y&&(p==null?void 0:p.bitrate)<y.bitrate?o:s.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,s,r,i,o,a){var l;const c=r+i,d=this.lastLoadedFragLevel,h=d===-1?this.hls.firstLevel:d,{fragCurrent:f,partCurrent:m}=this,{levels:p,allAudioTracks:y,loadLevel:v,config:x}=this.hls;if(p.length===1)return 0;const E=p[h],w=!!((l=this.hls.latestLevelDetails)!=null&&l.live),b=v===-1||d===-1;let C,D="SDR",_=(E==null?void 0:E.frameRate)||0;const{audioPreference:S,videoPreference:I}=x,R=this.audioTracksByGroup||(this.audioTracksByGroup=VU(y));let N=-1;if(b){if(this.firstSelection!==-1)return this.firstSelection;const $=this.codecTiers||(this.codecTiers=Xre(p,R,t,s)),F=Qre($,D,e,S,I),{codecSet:j,videoRanges:U,minFramerate:X,minBitrate:Y,minIndex:J,preferHDR:ae}=F;N=J,C=j,D=ae?U[U.length-1]:U[0],_=X,e=Math.max(e,Y),this.log(`picked start tier ${St(F)}`)}else C=E==null?void 0:E.codecSet,D=E==null?void 0:E.videoRange;const L=m?m.duration:f?f.duration:0,M=this.bwEstimator.getEstimateTTFB()/1e3,G=[];for(let $=s;$>=t;$--){var V;const F=p[$],j=$>h;if(!F)continue;if(x.useMediaCapabilities&&!F.supportedResult&&!F.supportedPromise){const ve=navigator.mediaCapabilities;typeof(ve==null?void 0:ve.decodingInfo)=="function"&&Vre(F,R,D,_,e,S)?(F.supportedPromise=FU(F,R,ve,this.supportedCache),F.supportedPromise.then(ge=>{if(!this.hls)return;F.supportedResult=ge;const re=this.hls.levels,Ee=re.indexOf(F);ge.error?this.warn(`MediaCapabilities decodingInfo error: "${ge.error}" for level ${Ee} ${St(ge)}`):ge.supported?ge.decodingInfoResults.some(xe=>xe.smooth===!1||xe.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Ee} not smooth or powerEfficient: ${St(ge)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Ee} ${St(ge)}`),Ee>-1&&re.length>1&&(this.log(`Removing unsupported level ${Ee}`),this.hls.removeLevel(Ee),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(ge=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${ge}`)})):F.supportedResult=OU}if((C&&F.codecSet!==C||D&&F.videoRange!==D||j&&_>F.frameRate||!j&&_>0&&_<F.frameRate||(V=F.supportedResult)!=null&&(V=V.decodingInfoResults)!=null&&V.some(ve=>ve.smooth===!1))&&(!b||$!==N)){G.push($);continue}const U=F.details,X=(m?U==null?void 0:U.partTarget:U==null?void 0:U.averagetargetduration)||L;let Y;j?Y=a*e:Y=o*e;const J=L&&r>=L*2&&i===0?F.averageBitrate:F.maxBitrate,ae=this.getTimeToLoadFrag(M,Y,J*X,U===void 0);if(Y>=J&&($===d||F.loadError===0&&F.fragmentError===0)&&(ae<=M||!le(ae)||w&&!this.bitrateTestDelay||ae<c)){const ve=this.forcedAutoLevel;return $!==v&&(ve===-1||ve!==v)&&(G.length&&this.trace(`Skipped level(s) ${G.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${p[G[0]].codecs}" ${p[G[0]].videoRange}; not compatible with "${C}" ${D}`),this.info(`switch candidate:${h}->${$} adjustedbw(${Math.round(Y)})-bitrate=${Math.round(Y-J)} ttfb:${M.toFixed(1)} avgDuration:${X.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${ae.toFixed(1)} firstSelection:${b} codecSet:${F.codecSet} videoRange:${F.videoRange} hls.loadLevel:${v}`)),b&&(this.firstSelection=$),$}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:s}=this.hls;return Math.min(Math.max(e,s),t)}}const $U={search:function(n,e){let t=0,s=n.length-1,r=null,i=null;for(;t<=s;){r=(t+s)/2|0,i=n[r];const o=e(i);if(o>0)t=r+1;else if(o<0)s=r-1;else return i}return null}};function nie(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!le(e))return null;const s=n[0].programDateTime;if(e<(s||0))return null;const r=n[n.length-1].endProgramDateTime;if(e>=(r||0))return null;for(let i=0;i<n.length;++i){const o=n[i];if(rie(e,t,o))return o}return null}function sc(n,e,t=0,s=0,r=.005){let i=null;if(n){i=e[1+n.sn-e[0].sn]||null;const a=n.endDTS-t;a>0&&a<15e-7&&(t+=15e-7),i&&n.level!==i.level&&i.end<=n.end&&(i=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(i=e[0]);if(i&&((!n||n.level===i.level)&&CP(t,s,i)===0||sie(i,n,Math.min(r,s))))return i;const o=$U.search(e,CP.bind(null,t,s));return o&&(o!==n||!i)?o:i}function sie(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const s=e.tagList.reduce((r,i)=>(i[0]==="INF"&&(r+=parseFloat(i[1])),r),t);return n.start<=s}return!1}function CP(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-s<=n?1:t.start-s>n&&t.start?-1:0}function rie(n,e,t){const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-s>n}function BU(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){let s=n.fragments;const{fragmentHint:r}=n;r&&(s=s.concat(r));let i;return $U.search(s,o=>o.cc<e?1:o.cc>e?-1:(i=o,o.end<=t?1:o.start>t?-1:0)),i||null}return null}function C0(n){switch(n.details){case W.FRAG_LOAD_TIMEOUT:case W.KEY_LOAD_TIMEOUT:case W.LEVEL_LOAD_TIMEOUT:case W.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function GU(n){return n.details.startsWith("key")}function KU(n){return GU(n)&&!!n.frag&&!n.frag.decryptdata}function PP(n,e){const t=C0(e);return n.default[`${t?"timeout":"error"}Retry`]}function X1(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function kP(n){return ft(ft({},n),{errorRetry:null,timeoutRetry:null})}function P0(n,e,t,s){if(!n)return!1;const r=s==null?void 0:s.code,i=e<n.maxNumRetry&&(iie(r)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,s,i):i}function iie(n){return gT(n)||!!n&&(n<400||n>499)}function gT(n){return n===0&&navigator.onLine===!1}var Ln={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},Vs={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4,SwitchToSDR:8};class oie extends Tr{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(P.ERROR,this.onError,this),e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(P.ERROR,this.onError,this),e.off(P.ERROR,this.onErrorOut,this),e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===de.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,s=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||s===-1?t.loadLevel:s}variantHasKey(e,t){if(e){var s;if((s=e.details)!=null&&s.hasKey(t))return!0;const r=e.audioGroups;if(r)return this.hls.allAudioTracks.filter(o=>r.indexOf(o.groupId)>=0).some(o=>{var a;return(a=o.details)==null?void 0:a.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var s;if(t.fatal)return;const r=this.hls,i=t.context;switch(t.details){case W.FRAG_LOAD_ERROR:case W.FRAG_LOAD_TIMEOUT:case W.KEY_LOAD_ERROR:case W.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case W.FRAG_PARSING_ERROR:if((s=t.frag)!=null&&s.gap){t.errorAction=Su();return}case W.FRAG_GAP:case W.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Ln.SendAlternateToPenaltyBox;return}case W.LEVEL_EMPTY_ERROR:case W.LEVEL_PARSING_ERROR:{var o;const l=t.parent===de.MAIN?t.level:r.loadLevel;t.details===W.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(o=o.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case W.LEVEL_LOAD_ERROR:case W.LEVEL_LOAD_TIMEOUT:typeof(i==null?void 0:i.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.level));return;case W.AUDIO_TRACK_LOAD_ERROR:case W.AUDIO_TRACK_LOAD_TIMEOUT:case W.SUBTITLE_LOAD_ERROR:case W.SUBTITLE_TRACK_LOAD_TIMEOUT:if(i){const l=r.loadLevelObj;if(l&&(i.type===We.AUDIO_TRACK&&l.hasAudioGroup(i.groupId)||i.type===We.SUBTITLE_TRACK&&l.hasSubtitleGroup(i.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=Ln.SendAlternateToPenaltyBox,t.errorAction.flags=Vs.MoveAllAlternatesMatchingHost;return}}return;case W.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Ln.SendAlternateToPenaltyBox,flags:Vs.MoveAllAlternatesMatchingHDCP};return;case W.KEY_SYSTEM_SESSION_UPDATE_FAILED:case W.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case W.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Ln.SendAlternateToPenaltyBox,flags:Vs.MoveAllAlternatesMatchingKey};return;case W.BUFFER_ADD_CODEC_ERROR:case W.REMUX_ALLOC_ERROR:case W.BUFFER_APPEND_ERROR:if(!t.errorAction){var a;t.errorAction=this.getLevelSwitchAction(t,(a=t.level)!=null?a:r.loadLevel)}return;case W.INTERNAL_EXCEPTION:case W.BUFFER_APPENDING_ERROR:case W.BUFFER_FULL_ERROR:case W.LEVEL_SWITCH_ERROR:case W.BUFFER_STALLED_ERROR:case W.BUFFER_SEEK_OVER_HOLE:case W.BUFFER_NUDGE_ON_STALL:t.errorAction=Su();return}t.type===Te.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Su())}getPlaylistRetryOrSwitchAction(e,t){const s=this.hls,r=PP(s.config.playlistLoadPolicy,e),i=this.playlistError++;if(P0(r,i,C0(e),e.response))return{action:Ln.RetryRequest,flags:Vs.None,retryConfig:r,retryCount:i};const a=this.getLevelSwitchAction(e,t);return r&&(a.retryConfig=r,a.retryCount=i),a}getFragRetryOrSwitchAction(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),r=t.levels[s],{fragLoadPolicy:i,keyLoadPolicy:o}=t.config,a=PP(GU(e)?o:i,e),l=t.levels.reduce((d,h)=>d+h.fragmentError,0);if(r&&(e.details!==W.FRAG_GAP&&r.fragmentError++,!KU(e)&&P0(a,l,C0(e),e.response)))return{action:Ln.RetryRequest,flags:Vs.None,retryConfig:a,retryCount:l};const c=this.getLevelSwitchAction(e,s);return a&&(c.retryConfig=a,c.retryCount=l),c}getLevelSwitchAction(e,t){const s=this.hls;t==null&&(t=s.loadLevel);const r=this.hls.levels[t];if(r){var i,o;const c=e.details;r.loadError++,c===W.BUFFER_APPEND_ERROR&&r.fragmentError++;let d=-1;const{levels:h,loadLevel:f,minAutoLevel:m,maxAutoLevel:p}=s;!s.autoLevelEnabled&&!s.config.preserveManualLevelOnError&&(s.loadLevel=-1);const y=(i=e.frag)==null?void 0:i.type,x=(y===de.AUDIO&&c===W.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===W.BUFFER_ADD_CODEC_ERROR||c===W.BUFFER_APPEND_ERROR))&&h.some(({audioCodec:D})=>r.audioCodec!==D),w=e.sourceBufferName==="video"&&(c===W.BUFFER_ADD_CODEC_ERROR||c===W.BUFFER_APPEND_ERROR)&&h.some(({codecSet:D,audioCodec:_})=>r.codecSet!==D&&r.audioCodec===_),{type:b,groupId:C}=(o=e.context)!=null?o:{};for(let D=h.length;D--;){const _=(D+f)%h.length;if(_!==f&&_>=m&&_<=p&&h[_].loadError===0){var a,l;const S=h[_];if(c===W.FRAG_GAP&&y===de.MAIN&&e.frag){const I=h[_].details;if(I){const R=sc(e.frag,I.fragments,e.frag.start);if(R!=null&&R.gap)continue}}else{if(b===We.AUDIO_TRACK&&S.hasAudioGroup(C)||b===We.SUBTITLE_TRACK&&S.hasSubtitleGroup(C))continue;if(y===de.AUDIO&&(a=r.audioGroups)!=null&&a.some(I=>S.hasAudioGroup(I))||y===de.SUBTITLE&&(l=r.subtitleGroups)!=null&&l.some(I=>S.hasSubtitleGroup(I))||x&&r.audioCodec===S.audioCodec||w&&r.codecSet===S.codecSet||!x&&r.codecSet!==S.codecSet)continue}d=_;break}}if(d>-1&&s.loadLevel!==d)return e.levelRetry=!0,this.playlistError=0,{action:Ln.SendAlternateToPenaltyBox,flags:Vs.None,nextAutoLevel:d}}return{action:Ln.SendAlternateToPenaltyBox,flags:Vs.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var s;switch((s=t.errorAction)==null?void 0:s.action){case Ln.DoNothing:break;case Ln.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==W.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,s=e.errorAction;if(!s)return;const{flags:r}=s,i=s.nextAutoLevel;switch(r){case Vs.None:this.switchLevel(e,i);break;case Vs.MoveAllAlternatesMatchingHDCP:{const l=this.getVariantLevelIndex(e.frag),c=t.levels[l],d=c==null?void 0:c.attrs["HDCP-LEVEL"];if(s.hdcpLevel=d,d==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(d){t.maxHdcpLevel=pT[pT.indexOf(d)-1],s.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Vs.MoveAllAlternatesMatchingKey:{const l=e.decryptdata;if(l){const c=this.hls.levels,d=c.length;for(let f=d;f--;)if(this.variantHasKey(c[f],l)){var o,a;this.log(`Banned key found in level ${f} (${c[f].bitrate}bps) or audio group "${(o=c[f].audioGroups)==null?void 0:o.join(",")}" (${(a=e.frag)==null?void 0:a.type} fragment) ${Mn(l.keyId||[])}`),c[f].fragmentError++,c[f].loadError++,this.log(`Removing level ${f} with key error (${e.error})`),this.hls.removeLevel(f)}const h=e.frag;if(this.hls.levels.length<d)s.resolved=!0;else if(h&&h.type!==de.MAIN){const f=h.decryptdata;f&&!l.matches(f)&&(s.resolved=!0)}}break}}s.resolved||this.switchLevel(e,i)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===W.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const s=mT(e.mimeType),r=this.hls.levels;for(let i=r.length;i--;)r[i][`${e.sourceBufferName}Codec`]===s&&(this.log(`Removing level ${i} for ${e.details} ("${s}" not supported)`),this.hls.removeLevel(i))}}}function Su(n){const e={action:Ln.DoNothing,flags:Vs.None};return n&&(e.resolved=!0),e}var xn={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class aie{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.BUFFER_APPENDED,this.onBufferAppended,this),e.on(P.FRAG_BUFFERED,this.onFragBuffered,this),e.on(P.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.BUFFER_APPENDED,this.onBufferAppended,this),e.off(P.FRAG_BUFFERED,this.onFragBuffered,this),e.off(P.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const s=this.activePartLists[t];if(s)for(let r=s.length;r--;){const i=s[r];if(!i)break;if(i.start<=e&&e<=i.end&&i.loaded)return i}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,s){const{fragments:r}=this,i=Object.keys(r);for(let o=i.length;o--;){const a=r[i[o]];if((a==null?void 0:a.body.type)===t&&(!s||a.buffered)){const l=a.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,s,r,i){this.timeRanges&&(this.timeRanges[e]=t);const o=(r==null?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(a=>{const l=this.fragments[a];if(!l||o>=l.body.sn)return;if(!l.buffered&&(!l.loaded||i)){l.body.type===s&&this.removeFragment(l.body);return}const c=l.range[e];if(c){if(c.time.length===0){this.removeFragment(l.body);return}c.time.some(d=>{const h=!this.isTimeBuffered(d.startPTS,d.endPTS,t);return h&&this.removeFragment(l.body),h})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const s=e.frag,r=Mc(s),i=this.fragments[r];if(!i||i.buffered&&s.gap)return;const o=!s.relurl;Object.keys(t).forEach(a=>{const l=s.elementaryStreams[a];if(!l)return;const c=t[a],d=o||l.partial===!0;i.range[a]=this.getBufferedTimes(s,e.part,d,c)}),i.loaded=null,Object.keys(i.range).length?(this.bufferedEnd(i,s),Tp(i)||this.removeParts(s.sn-1,s.type)):this.removeFragment(i.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=NP(s,r=>r.fragment.sn>=e))}fragBuffered(e,t){const s=Mc(e);let r=this.fragments[s];!r&&t&&(r=this.fragments[s]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,this.bufferedEnd(r,e))}getBufferedTimes(e,t,s,r){const i={time:[],partial:s},o=e.start,a=e.end,l=e.minEndPTS||a,c=e.maxStartPTS||o;for(let d=0;d<r.length;d++){const h=r.start(d)-this.bufferPadding,f=r.end(d)+this.bufferPadding;if(c>=h&&l<=f){i.time.push({startPTS:Math.max(o,r.start(d)),endPTS:Math.min(a,r.end(d))});break}else if(o<f&&a>h){const m=Math.max(o,r.start(d)),p=Math.min(a,r.end(d));p>m&&(i.partial=!0,i.time.push({startPTS:m,endPTS:p}))}else if(a<=h)break}return i}getPartialFragment(e){let t=null,s,r,i,o=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(c=>{const d=l[c];d&&Tp(d)&&(r=d.body.start-a,i=d.body.end+a,e>=r&&e<=i&&(s=Math.min(e-r,i-e),o<=s&&(t=d.body,o=s)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Tp(t))}getState(e){const t=Mc(e),s=this.fragments[t];return s?s.buffered?Tp(s)?xn.PARTIAL:xn.OK:xn.APPENDING:xn.NOT_LOADED}isTimeBuffered(e,t,s){let r,i;for(let o=0;o<s.length;o++){if(r=s.start(o)-this.bufferPadding,i=s.end(o)+this.bufferPadding,e>=r&&t<=i)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const s=t.frag,r=t.part?null:t,i=Mc(s);this.fragments[i]={body:s,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:s,part:r,timeRanges:i,type:o}=t;if(s.sn==="initSegment")return;const a=s.type;if(r){let c=this.activePartLists[a];c||(this.activePartLists[a]=c=[]),c.push(r)}this.timeRanges=i;const l=i[o];this.detectEvictedFragments(o,l,a,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Mc(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,s=Object.keys(t);if(!e)return s.length>0;for(let r=s.length;r--;){const i=t[s[r]];if((i==null?void 0:i.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,s,r,i){r&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a)return;const l=a.body;l.type!==s||r&&!l.gap||l.start<t&&l.end>e&&(a.buffered||i)&&this.removeFragment(l)})}removeFragment(e){const t=Mc(e);e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const r=e.sn;this.activePartLists[e.type]=NP(s,i=>i.fragment.sn!==r)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(s=>s.clearElementaryStreamInfo())}}function Tp(n){var e,t,s;return n.buffered&&!!(n.body.gap||(e=n.range.video)!=null&&e.partial||(t=n.range.audio)!=null&&t.partial||(s=n.range.audiovideo)!=null&&s.partial)}function Mc(n){return`${n.type}_${n.level}_${n.sn}`}function NP(n,e){return n.filter(t=>{const s=e(t);return s||t.clearElementaryStreamInfo(),s})}var qa={cbc:0,ctr:1};class lie{constructor(e,t,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=s}decrypt(e,t){switch(this.aesMode){case qa.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case qa.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function cie(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}class uie{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let r=0;r<4;r++)s[r]=t.getUint32(r*4);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,r=s[0],i=s[1],o=s[2],a=s[3],l=this.invSubMix,c=l[0],d=l[1],h=l[2],f=l[3],m=new Uint32Array(256);let p=0,y=0,v=0;for(v=0;v<256;v++)v<128?m[v]=v<<1:m[v]=v<<1^283;for(v=0;v<256;v++){let x=y^y<<1^y<<2^y<<3^y<<4;x=x>>>8^x&255^99,e[p]=x,t[x]=p;const E=m[p],w=m[E],b=m[w];let C=m[x]*257^x*16843008;r[p]=C<<24|C>>>8,i[p]=C<<16|C>>>16,o[p]=C<<8|C>>>24,a[p]=C,C=b*16843009^w*65537^E*257^p*16843008,c[x]=C<<24|C>>>8,d[x]=C<<16|C>>>16,h[x]=C<<8|C>>>24,f[x]=C,p?(p=E^m[m[m[b^E]]],y^=m[m[y]]):p=y=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,r=0;for(;r<t.length&&s;)s=t[r]===this.key[r],r++;if(s)return;this.key=t;const i=this.keySize=t.length;if(i!==4&&i!==6&&i!==8)throw new Error("Invalid aes key size="+i);const o=this.ksRows=(i+6+1)*4;let a,l;const c=this.keySchedule=new Uint32Array(o),d=this.invKeySchedule=new Uint32Array(o),h=this.sBox,f=this.rcon,m=this.invSubMix,p=m[0],y=m[1],v=m[2],x=m[3];let E,w;for(a=0;a<o;a++){if(a<i){E=c[a]=t[a];continue}w=E,a%i===0?(w=w<<8|w>>>24,w=h[w>>>24]<<24|h[w>>>16&255]<<16|h[w>>>8&255]<<8|h[w&255],w^=f[a/i|0]<<24):i>6&&a%i===4&&(w=h[w>>>24]<<24|h[w>>>16&255]<<16|h[w>>>8&255]<<8|h[w&255]),c[a]=E=(c[a-i]^w)>>>0}for(l=0;l<o;l++)a=o-l,l&3?w=c[a]:w=c[a-4],l<4||a<=4?d[l]=w:d[l]=p[h[w>>>24]]^y[h[w>>>16&255]]^v[h[w>>>8&255]]^x[h[w&255]],d[l]=d[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,s){const r=this.keySize+6,i=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],c=a[1],d=a[2],h=a[3],f=this.uint8ArrayToUint32Array_(s);let m=f[0],p=f[1],y=f[2],v=f[3];const x=new Int32Array(e),E=new Int32Array(x.length);let w,b,C,D,_,S,I,R,N,L,M,G,V,$;const F=this.networkToHostOrderSwap;for(;t<x.length;){for(N=F(x[t]),L=F(x[t+1]),M=F(x[t+2]),G=F(x[t+3]),_=N^i[0],S=G^i[1],I=M^i[2],R=L^i[3],V=4,$=1;$<r;$++)w=l[_>>>24]^c[S>>16&255]^d[I>>8&255]^h[R&255]^i[V],b=l[S>>>24]^c[I>>16&255]^d[R>>8&255]^h[_&255]^i[V+1],C=l[I>>>24]^c[R>>16&255]^d[_>>8&255]^h[S&255]^i[V+2],D=l[R>>>24]^c[_>>16&255]^d[S>>8&255]^h[I&255]^i[V+3],_=w,S=b,I=C,R=D,V=V+4;w=o[_>>>24]<<24^o[S>>16&255]<<16^o[I>>8&255]<<8^o[R&255]^i[V],b=o[S>>>24]<<24^o[I>>16&255]<<16^o[R>>8&255]<<8^o[_&255]^i[V+1],C=o[I>>>24]<<24^o[R>>16&255]<<16^o[_>>8&255]<<8^o[S&255]^i[V+2],D=o[R>>>24]<<24^o[_>>16&255]<<16^o[S>>8&255]<<8^o[I&255]^i[V+3],E[t]=F(w^m),E[t+1]=F(D^p),E[t+2]=F(C^y),E[t+3]=F(b^v),m=N,p=L,y=M,v=G,t=t+4}return E.buffer}}class die{constructor(e,t,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=s}expandKey(){const e=hie(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function hie(n){switch(n){case qa.cbc:return"AES-CBC";case qa.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}const fie=16;class J1{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?cie(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,s,r){return this.useSoftware?new Promise((i,o)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,s,r);const l=this.flush();l?i(l.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,s,r)}softwareDecrypt(e,t,s,r){const{currentIV:i,currentResult:o,remainderData:a}=this;if(r!==qa.cbc||t.byteLength!==16)return mt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=Er(a,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;i&&(s=i);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new uie),c.expandKey(t);const d=o;return this.currentResult=c.decrypt(l.buffer,0,s),this.currentIV=l.slice(-16).buffer,d||null}webCryptoDecrypt(e,t,s,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s,r));this.key=t,this.fastAesKey=new die(this.subtle,t,r)}return this.fastAesKey.expandKey().then(i=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new lie(this.subtle,new Uint8Array(s),r).decrypt(e.buffer,i)):Promise.reject(new Error("web crypto not initialized"))).catch(i=>(mt.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,s,r)))}onWebCryptoError(e,t,s,r){const i=this.enableSoftwareAES;if(i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s,r);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(i?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const s=e.length-e.length%fie;return s!==e.length&&(t=e.slice(0,s),this.remainderData=e.slice(s)),t}logOnce(e){this.logEnabled&&(mt.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const LP=Math.pow(2,17);class mie{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const s=e.url;if(!s)return Promise.reject(new Ki({type:Te.NETWORK_ERROR,details:W.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${s?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,i=r.fLoader,o=r.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(p=>p[0]==="GAP")){l(MP(e));return}else e.gap=!1;const c=this.loader=i?new i(r):new o(r),d=DP(e);e.loader=c;const h=kP(r.fragLoadPolicy.default),f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:LP};e.stats=c.stats;const m={onSuccess:(p,y,v,x)=>{this.resetLoader(e,c);let E=p.data;v.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(E.slice(0,16)),E=E.slice(16)),a({frag:e,part:null,payload:E,networkDetails:x})},onError:(p,y,v,x)=>{this.resetLoader(e,c),l(new Ki({type:Te.NETWORK_ERROR,details:W.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:ft({url:s,data:void 0},p),error:new Error(`HTTP Error ${p.code} ${p.text}`),networkDetails:v,stats:x}))},onAbort:(p,y,v)=>{this.resetLoader(e,c),l(new Ki({type:Te.NETWORK_ERROR,details:W.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:v,stats:p}))},onTimeout:(p,y,v)=>{this.resetLoader(e,c),l(new Ki({type:Te.NETWORK_ERROR,details:W.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:v,stats:p}))}};t&&(m.onProgress=(p,y,v,x)=>t({frag:e,part:null,payload:v,networkDetails:x})),c.load(d,f,m)})}loadPart(e,t,s){this.abort();const r=this.config,i=r.fLoader,o=r.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(MP(e,t));return}const c=this.loader=i?new i(r):new o(r),d=DP(e,t);e.loader=c;const h=kP(r.fragLoadPolicy.default),f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:LP};t.stats=c.stats,c.load(d,f,{onSuccess:(m,p,y,v)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const x={frag:e,part:t,payload:m.data,networkDetails:v};s(x),a(x)},onError:(m,p,y,v)=>{this.resetLoader(e,c),l(new Ki({type:Te.NETWORK_ERROR,details:W.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:ft({url:d.url,data:void 0},m),error:new Error(`HTTP Error ${m.code} ${m.text}`),networkDetails:y,stats:v}))},onAbort:(m,p,y)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),l(new Ki({type:Te.NETWORK_ERROR,details:W.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:y,stats:m}))},onTimeout:(m,p,y)=>{this.resetLoader(e,c),l(new Ki({type:Te.NETWORK_ERROR,details:W.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:y,stats:m}))}})})}updateStatsFromPart(e,t){const s=e.stats,r=t.stats,i=r.total;if(s.loaded+=r.loaded,i){const l=Math.round(e.duration/t.duration),c=Math.min(Math.round(s.loaded/i),l),h=(l-c)*Math.round(s.loaded/c);s.total=s.loaded+h}else s.total=Math.max(s.loaded,s.total);const o=s.loading,a=r.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function DP(n,e=null){const t=e||n,s={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},r=t.byteRangeStartOffset,i=t.byteRangeEndOffset;if(le(r)&&le(i)){var o;let a=r,l=i;if(n.sn==="initSegment"&&pie((o=n.decryptdata)==null?void 0:o.method)){const c=i-r;c%16&&(l=i+(16-c%16)),r!==0&&(s.resetIV=!0,a=r-16)}s.rangeStart=a,s.rangeEnd=l}return s}function MP(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),s={type:Te.MEDIA_ERROR,details:W.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(s.part=e),(e||n).stats.aborted=!0,new Ki(s)}function pie(n){return n==="AES-128"||n==="AES-256"}class Ki extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class HU extends Tr{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Z1{constructor(e,t,s,r=0,i=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=bp(),this.buffering={audio:bp(),video:bp(),audiovideo:bp()},this.level=e,this.sn=t,this.id=s,this.size=r,this.part=i,this.partial=o}}function bp(){return{start:0,executeStart:0,executeEnd:0,end:0}}const OP={length:0,start:()=>0,end:()=>0};class Ue{static isBuffered(e,t){if(e){const s=Ue.getBuffered(e);for(let r=s.length;r--;)if(t>=s.start(r)&&t<=s.end(r))return!0}return!1}static bufferedRanges(e){if(e){const t=Ue.getBuffered(e);return Ue.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let s=0;s<e.length;s++)t.push({start:e.start(s),end:e.end(s)});return t}static bufferInfo(e,t,s){if(e){const r=Ue.bufferedRanges(e);if(r.length)return Ue.bufferedInfo(r,t,s)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,s){t=Math.max(0,t),e.length>1&&e.sort((d,h)=>d.start-h.start||h.end-d.end);let r=-1,i=[];if(s)for(let d=0;d<e.length;d++){t>=e[d].start&&t<=e[d].end&&(r=d);const h=i.length;if(h){const f=i[h-1].end;e[d].start-f<s?e[d].end>f&&(i[h-1].end=e[d].end):i.push(e[d])}else i.push(e[d])}else i=e;let o=0,a,l=t,c=t;for(let d=0;d<i.length;d++){const h=i[d].start,f=i[d].end;if(r===-1&&t>=h&&t<=f&&(r=d),t+s>=h&&t<f)l=h,c=f,o=c-t;else if(t+s<h){a=h;break}}return{len:o,start:l||0,end:c||0,nextStart:a,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||OP}catch(t){return mt.log("failed to get media.buffered",t),OP}}}const WU=/\{\$([a-zA-Z0-9-_]+)\}/g;function jP(n){return WU.test(n)}function yT(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(WU,s=>{const r=s.substring(2,s.length-1),i=t==null?void 0:t[r];return i===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),s):i})}return e}function FP(n,e,t){let s=n.variableList;s||(n.variableList=s={});let r,i;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(r))i=o.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${t}"`)}catch(o){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else r=e.NAME,i=e.VALUE;r in s?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):s[r]=i||""}function gie(n,e,t){const s=e.IMPORT;if(t&&s in t){let r=n.variableList;r||(n.variableList=r={}),r[s]=t[s]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${s}"`))}const yie=/^(\d+)x(\d+)$/,UP=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Mt{constructor(e,t){typeof e=="string"&&(e=Mt.parseAttrList(e,t)),Et(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const s=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)s[r]=parseInt(t.slice(r*2,r*2+2),16);return s}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const s=this[e];return s?parseFloat(s):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const s=this[e];return(s?s.split(/[ ,]+/):[]).reduce((r,i)=>(r[i.toLowerCase()]=!0,r),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=yie.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let s;const r={},i='"';for(UP.lastIndex=0;(s=UP.exec(e))!==null;){const o=s[1].trim();let a=s[2];const l=a.indexOf(i)===0&&a.lastIndexOf(i)===a.length-1;let c=!1;if(l)a=a.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":c=!0}if(t&&(l||c))a=yT(t,a);else if(!c&&!l)switch(o){case"CLOSED-CAPTIONS":if(a==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":mt.warn(`${e}: attribute ${o} is missing quotes`)}r[o]=a}return r}}const vie="com.apple.hls.interstitial";function xie(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function Eie(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}class zU{constructor(e,t,s=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(r=t==null?void 0:t.tagOrder)!=null?r:s,t){const i=t.attr;for(const o in i)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==i[o]){mt.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=Et(new Mt({}),i,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const i=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);le(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(mt.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(le(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===vie}get isValid(){return!!this.id&&!this._badValueForSameId&&le(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const wie=10;class Tie{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&s>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let s=t.decryptdata;return s||(t.setKeyFormat(e.keyFormat),s=t.decryptdata),!!s&&e.matches(s)})}get hasProgramDateTime(){return this.fragments.length?le(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||wie}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let s=e.length;s--;)if(e[s].index>t)return e[s].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function k0(n,e){return n.length===e.length?!n.some((t,s)=>t!==e[s]):!1}function VP(n,e){return!n&&!e?!0:!n||!e?!1:k0(n,e)}function _u(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function e_(n){switch(n){case"AES-128":case"AES-256":return qa.cbc;case"AES-256-CTR":return qa.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function t_(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function vT(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function bie(n){const e=vT(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function qU(n){const e=function(s,r,i){const o=s[r];s[r]=s[i],s[i]=o};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function YU(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const s=e[1].split(";"),r=s[s.length-1].split(",");if(r.length===2){const i=r[0]==="base64",o=r[1];i?(s.splice(-1,1),t=t_(o)):t=bie(o)}}return t}const N0=typeof self<"u"?self:void 0;var Ft={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},jn={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function gg(n){switch(n){case jn.FAIRPLAY:return Ft.FAIRPLAY;case jn.PLAYREADY:return Ft.PLAYREADY;case jn.WIDEVINE:return Ft.WIDEVINE;case jn.CLEARKEY:return Ft.CLEARKEY}}function Mx(n){switch(n){case Ft.FAIRPLAY:return jn.FAIRPLAY;case Ft.PLAYREADY:return jn.PLAYREADY;case Ft.WIDEVINE:return jn.WIDEVINE;case Ft.CLEARKEY:return jn.CLEARKEY}}function Ch(n){const{drmSystems:e,widevineLicenseUrl:t}=n,s=e?[Ft.FAIRPLAY,Ft.WIDEVINE,Ft.PLAYREADY,Ft.CLEARKEY].filter(r=>!!e[r]):[];return!s[Ft.WIDEVINE]&&t&&s.push(Ft.WIDEVINE),s}const QU=function(n){return N0!=null&&(n=N0.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function Sie(n,e,t,s){let r;switch(n){case Ft.FAIRPLAY:r=["cenc","sinf"];break;case Ft.WIDEVINE:case Ft.PLAYREADY:r=["cenc"];break;case Ft.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return _ie(r,e,t,s)}function _ie(n,e,t,s){return[{initDataTypes:n,persistentState:s.persistentState||"optional",distinctiveIdentifier:s.distinctiveIdentifier||"optional",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:e.map(i=>({contentType:`audio/mp4; codecs=${i}`,robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null})),videoCapabilities:t.map(i=>({contentType:`video/mp4; codecs=${i}`,robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null}))}]}function Aie(n){var e;return!!n&&(n.sessionType==="persistent-license"||!!((e=n.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function XU(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),s=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(o){const a=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(a){const l=t_(a).subarray(0,16);return qU(l),l}}return null}let Oc={};class Na{static clearKeyUriToKeyIdMap(){Oc={}}static setKeyIdForUri(e,t){Oc[e]=t}static addKeyIdForUri(e){const t=Object.keys(Oc).length%Number.MAX_SAFE_INTEGER,s=new Uint8Array(16);return new DataView(s.buffer,12,4).setUint32(0,t),Oc[e]=s,s}constructor(e,t,s,r=[1],i=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=r,this.iv=i,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!_u(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(_U(o)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&k0(e.keyFormatVersions,this.keyFormatVersions)&&VP(e.iv,this.iv)&&VP(e.keyId,this.keyId)}isSupported(){if(this.method){if(_u(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case jn.FAIRPLAY:case jn.WIDEVINE:case jn.PLAYREADY:case jn.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(_u(this.method)){let i=this.iv;return i||(typeof e!="number"&&(mt.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),i=Rie(e)),new Na(this.method,this.uri,"identity",this.keyFormatVersions,i)}if(this.keyId){const i=Oc[this.uri];if(i&&!k0(this.keyId,i)&&Na.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const s=YU(this.uri);if(s)switch(this.keyFormat){case jn.WIDEVINE:if(this.pssh=s,!this.keyId){const i=kre(s.buffer);if(i.length){var r;const o=i[0];this.keyId=(r=o.kids)!=null&&r.length?o.kids[0]:null}}this.keyId||(this.keyId=$P(t));break;case jn.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Pre(i,null,s),this.keyId=XU(s);break}default:{let i=s.subarray(0,16);if(i.length!==16){const o=new Uint8Array(16);o.set(i,16-i.length),i=o}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i;i=Iie(t),i||(i=$P(t),i||(i=Oc[this.uri])),i&&(this.keyId=i,Na.setKeyIdForUri(this.uri,i))}return this}}function Iie(n){const e=n==null?void 0:n[jn.WIDEVINE];return e?e.keyId:null}function $P(n){const e=n==null?void 0:n[jn.PLAYREADY];if(e){const t=YU(e.uri);if(t)return XU(t)}return null}function Rie(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const BP=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,GP=/#EXT-X-MEDIA:(.*)/g,Cie=/^#EXT(?:INF|-X-TARGETDURATION):/m,Ox=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Pie=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class ui{static findGroup(e,t){for(let s=0;s<e.length;s++){const r=e[s];if(r.id===t)return r}}static resolve(e,t){return W1.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return Cie.test(e)}static parseMasterPlaylist(e,t){const s=jP(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:s},i=[];if(BP.lastIndex=0,!e.startsWith("#EXTM3U"))return r.playlistParsingError=new Error("no EXTM3U delimiter"),r;let o;for(;(o=BP.exec(e))!=null;)if(o[1]){var a;const c=new Mt(o[1],r),d=yT(r,o[2]),h={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:ui.resolve(d,t)},f=c.decimalResolution("RESOLUTION");f&&(h.width=f.width,h.height=f.height),WP(c.CODECS,h);const m=c["SUPPLEMENTAL-CODECS"];m&&(h.supplemental={},WP(m,h.supplemental)),(a=h.unknownCodecs)!=null&&a.length||i.push(h),r.levels.push(h)}else if(o[3]){const c=o[3],d=o[4];switch(c){case"SESSION-DATA":{const h=new Mt(d,r),f=h["DATA-ID"];f&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[f]=h);break}case"SESSION-KEY":{const h=KP(d,t,r);h.encrypted&&h.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(h)):mt.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${d}"`);break}case"DEFINE":{{const h=new Mt(d,r);FP(r,h,t)}break}case"CONTENT-STEERING":{const h=new Mt(d,r);r.contentSteering={uri:ui.resolve(h["SERVER-URI"],t),pathwayId:h["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=HP(d);break}}}const l=i.length>0&&i.length<r.levels.length;return r.levels=l?i:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,s){let r;const i={},o=s.levels,a={AUDIO:o.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:o.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(GP.lastIndex=0;(r=GP.exec(e))!==null;){const c=new Mt(r[1],s),d=c.TYPE;if(d){const h=a[d],f=i[d]||[];i[d]=f;const m=c.LANGUAGE,p=c["ASSOC-LANGUAGE"],y=c.CHANNELS,v=c.CHARACTERISTICS,x=c["INSTREAM-ID"],E={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"]||"",name:c.NAME||m||"",type:d,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:m,url:c.URI?ui.resolve(c.URI,t):""};if(p&&(E.assocLang=p),y&&(E.channels=y),v&&(E.characteristics=v),x&&(E.instreamId=x),h!=null&&h.length){const w=ui.findGroup(h,E.groupId)||h[0];zP(E,w,"audioCodec"),zP(E,w,"textCodec")}f.push(E)}}return i}static parseLevelPlaylist(e,t,s,r,i,o){var a;const l={url:t},c=new Tie(t),d=c.fragments,h=[];let f=null,m=0,p=0,y=0,v=0,x=0,E=null,w=new Nx(r,l),b,C,D,_=-1,S=!1,I=null,R;if(Ox.lastIndex=0,c.m3u8=e,c.hasVariableRefs=jP(e),((a=Ox.exec(e))==null?void 0:a[0])!=="#EXTM3U")return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;(b=Ox.exec(e))!==null;){S&&(S=!1,w=new Nx(r,l),w.playlistOffset=y,w.setStart(y),w.sn=m,w.cc=v,x&&(w.bitrate=x),w.level=s,f&&(w.initSegment=f,f.rawProgramDateTime&&(w.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null),I&&(w.setByteRange(I),I=null)));const G=b[1];if(G){w.duration=parseFloat(G);const V=(" "+b[2]).slice(1);w.title=V||null,w.tagList.push(V?["INF",G,V]:["INF",G])}else if(b[3]){if(le(w.duration)){w.playlistOffset=y,w.setStart(y),D&&YP(w,D,c),w.sn=m,w.level=s,w.cc=v,d.push(w);const V=(" "+b[3]).slice(1);w.relurl=yT(c,V),xT(w,E,h),E=w,y+=w.duration,m++,p=0,S=!0}}else{if(b=b[0].match(Pie),!b){mt.warn("No matches on slow regex match for level playlist!");continue}for(C=1;C<b.length&&b[C]===void 0;C++);const V=(" "+b[C]).slice(1),$=(" "+b[C+1]).slice(1),F=b[C+2]?(" "+b[C+2]).slice(1):null;switch(V){case"BYTERANGE":E?w.setByteRange($,E):w.setByteRange($);break;case"PROGRAM-DATE-TIME":w.rawProgramDateTime=$,w.tagList.push(["PROGRAM-DATE-TIME",$]),_===-1&&(_=d.length);break;case"PLAYLIST-TYPE":c.type&&ji(c,V,b),c.type=$.toUpperCase();break;case"MEDIA-SEQUENCE":c.startSN!==0?ji(c,V,b):d.length>0&&QP(c,V,b),m=c.startSN=parseInt($);break;case"SKIP":{c.skippedSegments&&ji(c,V,b);const j=new Mt($,c),U=j.decimalInteger("SKIPPED-SEGMENTS");if(le(U)){c.skippedSegments+=U;for(let Y=U;Y--;)d.push(null);m+=U}const X=j.enumeratedString("RECENTLY-REMOVED-DATERANGES");X&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(X.split("	")));break}case"TARGETDURATION":c.targetduration!==0&&ji(c,V,b),c.targetduration=Math.max(parseInt($),1);break;case"VERSION":c.version!==null&&ji(c,V,b),c.version=parseInt($);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||ji(c,V,b),c.live=!1;break;case"#":($||F)&&w.tagList.push(F?[$,F]:[$]);break;case"DISCONTINUITY":v++,w.tagList.push(["DIS"]);break;case"GAP":w.gap=!0,w.tagList.push([V]);break;case"BITRATE":w.tagList.push([V,$]),x=parseInt($)*1e3,le(x)?w.bitrate=x:x=0;break;case"DATERANGE":{const j=new Mt($,c),U=new zU(j,c.dateRanges[j.ID],c.dateRangeTagCount);c.dateRangeTagCount++,U.isValid||c.skippedSegments?c.dateRanges[U.id]=U:mt.warn(`Ignoring invalid DATERANGE tag: "${$}"`),w.tagList.push(["EXT-X-DATERANGE",$]);break}case"DEFINE":{{const j=new Mt($,c);"IMPORT"in j?gie(c,j,o):FP(c,j,t)}break}case"DISCONTINUITY-SEQUENCE":c.startCC!==0?ji(c,V,b):d.length>0&&QP(c,V,b),c.startCC=v=parseInt($);break;case"KEY":{const j=KP($,t,c);if(j.isSupported()){if(j.method==="NONE"){D=void 0;break}D||(D={});const U=D[j.keyFormat];U!=null&&U.matches(j)||(U&&(D=Et({},D)),D[j.keyFormat]=j)}else mt.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${$}"`);break}case"START":c.startTimeOffset=HP($);break;case"MAP":{const j=new Mt($,c);if(w.duration){const U=new Nx(r,l);qP(U,j,s,D),f=U,w.initSegment=f,f.rawProgramDateTime&&!w.rawProgramDateTime&&(w.rawProgramDateTime=f.rawProgramDateTime)}else{const U=w.byteRangeEndOffset;if(U){const X=w.byteRangeStartOffset;I=`${U-X}@${X}`}else I=null;qP(w,j,s,D),f=w,S=!0}f.cc=v;break}case"SERVER-CONTROL":{R&&ji(c,V,b),R=new Mt($),c.canBlockReload=R.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=R.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&R.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=R.optionalFloat("PART-HOLD-BACK",0),c.holdBack=R.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{c.partTarget&&ji(c,V,b);const j=new Mt($);c.partTarget=j.decimalFloatingPoint("PART-TARGET");break}case"PART":{let j=c.partList;j||(j=c.partList=[]);const U=p>0?j[j.length-1]:void 0,X=p++,Y=new Mt($,c),J=new gre(Y,w,l,X,U);j.push(J),w.duration+=J.duration;break}case"PRELOAD-HINT":{const j=new Mt($,c);c.preloadHint=j;break}case"RENDITION-REPORT":{const j=new Mt($,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(j);break}default:mt.warn(`line parsed but not handled: ${b}`);break}}}E&&!E.relurl?(d.pop(),y-=E.duration,c.partList&&(c.fragmentHint=E)):c.partList&&(xT(w,E,h),w.cc=v,c.fragmentHint=w,D&&YP(w,D,c)),c.targetduration||(c.playlistParsingError=new Error("Missing Target Duration"));const N=d.length,L=d[0],M=d[N-1];if(y+=c.skippedSegments*c.targetduration,y>0&&N&&M){c.averagetargetduration=y/N;const G=M.sn;c.endSN=G!=="initSegment"?G:0,c.live||(M.endList=!0),_>0&&(Nie(d,_),L&&h.unshift(L))}return c.fragmentHint&&(y+=c.fragmentHint.duration),c.totalduration=y,h.length&&c.dateRangeTagCount&&L&&JU(h,c),c.endCC=v,c}}function JU(n,e){let t=n.length;if(!t)if(e.hasProgramDateTime){const a=e.fragments[e.fragments.length-1];n.push(a),t++}else return;const s=n[t-1],r=e.live?1/0:e.totalduration,i=Object.keys(e.dateRanges);for(let a=i.length;a--;){const l=e.dateRanges[i[a]],c=l.startDate.getTime();l.tagAnchor=s.ref;for(let d=t;d--;){var o;if(((o=n[d])==null?void 0:o.sn)<e.startSN)break;const h=kie(e,c,n,d,r);if(h!==-1){l.tagAnchor=e.fragments[h].ref;break}}}}function kie(n,e,t,s,r){const i=t[s];if(i){const a=i.programDateTime;if(e>=a||s===0){var o;const l=(((o=t[s+1])==null?void 0:o.start)||r)-i.start;if(e<=a+l*1e3){const c=t[s].sn-n.startSN;if(c<0)return-1;const d=n.fragments;if(d.length>t.length){const f=(t[s+1]||d[d.length-1]).sn-n.startSN;for(let m=f;m>c;m--){const p=d[m].programDateTime;if(e>=p&&e<p+d[m].duration*1e3)return m}}return c}}}return-1}function KP(n,e,t){var s,r;const i=new Mt(n,t),o=(s=i.METHOD)!=null?s:"",a=i.URI,l=i.hexadecimalInteger("IV"),c=i.KEYFORMATVERSIONS,d=(r=i.KEYFORMAT)!=null?r:"identity";a&&i.IV&&!l&&mt.error(`Invalid IV: ${i.IV}`);const h=a?ui.resolve(a,e):"",f=(c||"1").split("/").map(Number).filter(Number.isFinite);return new Na(o,h,d,f,l,i.KEYID)}function HP(n){const t=new Mt(n).decimalFloatingPoint("TIME-OFFSET");return le(t)?t:null}function WP(n,e){let t=(n||"").split(/[ ,]+/).filter(s=>s);["video","audio","text"].forEach(s=>{const r=t.filter(i=>Y1(i,s));r.length&&(e[`${s}Codec`]=r.map(i=>i.split("/")[0]).join(","),t=t.filter(i=>r.indexOf(i)===-1))}),e.unknownCodecs=t}function zP(n,e,t){const s=e[t];s&&(n[t]=s)}function Nie(n,e){let t=n[e];for(let s=e;s--;){const r=n[s];if(!r)return;r.programDateTime=t.programDateTime-r.duration*1e3,t=r}}function xT(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function qP(n,e,t,s){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",s&&(n.levelkeys=s),n.initSegment=null}function YP(n,e,t){n.levelkeys=e;const{encryptedFragments:s}=t;(!s.length||s[s.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&s.push(n)}function ji(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function QP(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function jx(n,e){const t=e.startPTS;if(le(t)){let s=0,r;e.sn>n.sn?(s=t-n.start,r=n):(s=n.start-t,r=e),r.duration!==s&&r.setDuration(s)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function ZU(n,e,t,s,r,i,o){s-t<=0&&(o.warn("Fragment should have a positive duration",e),s=t+e.duration,i=r+e.duration);let l=t,c=s;const d=e.startPTS,h=e.endPTS;if(le(d)){const x=Math.abs(d-t);n&&x>n.totalduration?o.warn(`media timestamps and playlist times differ by ${x}s for level ${e.level} ${n.url}`):le(e.deltaPTS)?e.deltaPTS=Math.max(x,e.deltaPTS):e.deltaPTS=x,l=Math.max(t,d),t=Math.min(t,d),r=e.startDTS!==void 0?Math.min(r,e.startDTS):r,c=Math.min(s,h),s=Math.max(s,h),i=e.endDTS!==void 0?Math.max(i,e.endDTS):i}const f=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(s-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=r,e.endPTS=s,e.minEndPTS=c,e.endDTS=i;const m=e.sn;if(!n||m<n.startSN||m>n.endSN)return 0;let p;const y=m-n.startSN,v=n.fragments;for(v[y]=e,p=y;p>0;p--)jx(v[p],v[p-1]);for(p=y;p<v.length-1;p++)jx(v[p],v[p+1]);return n.fragmentHint&&jx(v[v.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,f}function Lie(n,e,t){if(n===e)return;let s=null;const r=n.fragments;for(let d=r.length-1;d>=0;d--){const h=r[d].initSegment;if(h){s=h;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let i;Oie(n,e,(d,h,f,m)=>{if((!e.startCC||e.skippedSegments)&&h.cc!==d.cc){const p=d.cc-h.cc;for(let y=f;y<m.length;y++)m[y].cc+=p;e.endCC=m[m.length-1].cc}le(d.startPTS)&&le(d.endPTS)&&(h.setStart(h.startPTS=d.startPTS),h.startDTS=d.startDTS,h.maxStartPTS=d.maxStartPTS,h.endPTS=d.endPTS,h.endDTS=d.endDTS,h.minEndPTS=d.minEndPTS,h.setDuration(d.endPTS-d.startPTS),h.duration&&(i=h),e.PTSKnown=e.alignedSliding=!0),d.hasStreams&&(h.elementaryStreams=d.elementaryStreams),h.loader=d.loader,d.hasStats&&(h.stats=d.stats),d.initSegment&&(h.initSegment=d.initSegment,s=d.initSegment)});const o=e.fragments,a=e.fragmentHint?o.concat(e.fragmentHint):o;if(s&&a.forEach(d=>{var h;d&&(!d.initSegment||d.initSegment.relurl===((h=s)==null?void 0:h.relurl))&&(d.initSegment=s)}),e.skippedSegments){if(e.deltaUpdateFailed=o.some(d=>!d),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let d=e.skippedSegments;d--;)o.shift();e.startSN=o[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=Die(n.dateRanges,e,t));const d=n.fragments.filter(h=>h.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let h=1;h<a.length;h++)a[h].programDateTime===null&&xT(a[h],a[h-1],d);JU(d,e)}e.endCC=o[o.length-1].cc}if(!e.startCC){var l;const d=nV(n,e.startSN-1);e.startCC=(l=d==null?void 0:d.cc)!=null?l:o[0].cc}Mie(n.partList,e.partList,(d,h)=>{h.elementaryStreams=d.elementaryStreams,h.stats=d.stats}),i?ZU(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS,t):eV(n,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const c=e.advancedDateTime;if(e.advanced&&c){const d=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=d),e.driftEndTime=c,e.driftEnd=d}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function Die(n,e,t){const{dateRanges:s,recentlyRemovedDateranges:r}=e,i=Et({},n);r&&r.forEach(l=>{delete i[l]});const a=Object.keys(i).length;return a?(Object.keys(s).forEach(l=>{const c=i[l],d=new zU(s[l].attr,c);d.isValid?(i[l]=d,c||(d.tagOrder+=a)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${St(s[l].attr)}"`)}),i):s}function Mie(n,e,t){if(n&&e){let s=0;for(let r=0,i=n.length;r<=i;r++){const o=n[r],a=e[r+s];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?t(o,a):s--}}}function Oie(n,e,t){const s=e.skippedSegments,r=Math.max(n.startSN,e.startSN)-e.startSN,i=(n.fragmentHint?1:0)+(s?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,o=e.startSN-n.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let c=r;c<=i;c++){const d=l[o+c];let h=a[c];if(s&&!h&&d&&(h=e.fragments[c]=d),d&&h){t(d,h,c,a);const f=d.relurl,m=h.relurl;if(f&&jie(f,m)){e.playlistParsingError=XP(`media sequence mismatch ${h.sn}:`,n,e,d,h);return}else if(d.cc!==h.cc){e.playlistParsingError=XP(`discontinuity sequence mismatch (${d.cc}!=${h.cc})`,n,e,d,h);return}}}}function XP(n,e,t,s,r){return new Error(`${n} ${r.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function eV(n,e,t=!0){const s=e.startSN+e.skippedSegments-n.startSN,r=n.fragments,i=s>=0;let o=0;if(i&&s<r.length)o=r[s].start;else if(i&&e.startSN===n.endSN+1)o=n.fragmentEnd;else if(i&&t)o=n.fragmentStart+s*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=n.fragmentStart;else return;ET(e,o)}function ET(n,e){if(e){const t=n.fragments;for(let s=n.skippedSegments;s<t.length;s++)t[s].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function tV(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const s=n.fragments;if(s.length&&t*4>e){const i=s[s.length-1].duration*1e3;i<t&&(t=i)}}else t/=2;return Math.round(t)}function nV(n,e,t){if(!n)return null;let s=n.fragments[e-n.startSN];return s||(s=n.fragmentHint,s&&s.sn===e)?s:e<n.startSN&&t&&t.sn===e?t:null}function JP(n,e,t){return n?sV(n.partList,e,t):null}function sV(n,e,t){if(n)for(let s=n.length;s--;){const r=n[s];if(r.index===t&&r.fragment.sn===e)return r}return null}function rV(n){n.forEach((e,t)=>{var s;(s=e.details)==null||s.fragments.forEach(r=>{r.level=t,r.initSegment&&(r.initSegment.level=t)})})}function jie(n,e){return n!==e&&e?ZP(n)!==ZP(e):!1}function ZP(n){return n.replace(/\?[^?]*$/,"")}function Yh(n,e){for(let s=0,r=n.length;s<r;s++){var t;if(((t=n[s])==null?void 0:t.cc)===e)return n[s]}return null}function Fie(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function ek(n,e){const t=n.start+e;n.startPTS=t,n.setStart(t),n.endPTS=t+n.duration}function iV(n,e){const t=e.fragments;for(let s=0,r=t.length;s<r;s++)ek(t[s],n);e.fragmentHint&&ek(e.fragmentHint,n),e.alignedSliding=!0}function Uie(n,e){n&&(oV(e,n),e.alignedSliding||L0(e,n),!e.alignedSliding&&!e.skippedSegments&&eV(n,e,!1))}function oV(n,e){if(!Fie(e,n))return;const t=Math.min(e.endCC,n.endCC),s=Yh(e.fragments,t),r=Yh(n.fragments,t);if(!s||!r)return;mt.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const i=s.start-r.start;iV(i,n)}function L0(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,s=e.fragments;if(!t.length||!s.length)return;let r,i;const o=Math.min(e.endCC,n.endCC);e.startCC<o&&n.startCC<o&&(r=Yh(s,o),i=Yh(t,o)),(!r||!i)&&(r=s[Math.floor(s.length/2)],i=Yh(t,r.cc)||t[Math.floor(t.length/2)]);const a=r.programDateTime,l=i.programDateTime;if(!a||!l)return;const c=(l-a)/1e3-(i.start-r.start);iV(c,n)}function ds(n,e,t){_s(n,e,t),n.addEventListener(e,t)}function _s(n,e,t){n.removeEventListener(e,t)}const Vie={toString:function(n){let e="";const t=n.length;for(let s=0;s<t;s++)e+=`[${n.start(s).toFixed(3)}-${n.end(s).toFixed(3)}]`;return e}},Z={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class n_ extends HU{constructor(e,t,s,r,i){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=Z.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:a,media:l,mediaBuffer:c,state:d}=this,h=l?l.currentTime:0,f=Ue.bufferInfo(c||l,h,o.maxBufferHole),m=!f.len;if(this.log(`Media seeking to ${le(h)?h.toFixed(3):h}, state: ${d}, ${m?"out of":"in"} buffer`),this.state===Z.ENDED)this.resetLoadingState();else if(a){const p=o.maxFragLookUpTolerance,y=a.start-p,v=a.start+a.duration+p;if(m||v<f.start||y>f.end){const x=h>v;(h<y||x)&&(x&&a.loader&&(this.log(`Cancelling fragment load for seek (sn: ${a.sn})`),a.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(h,1/0,this.playlistType,!0);const p=this.lastCurrentTime;if(h>p&&(this.lastCurrentTime=h),!this.loadingParts){const y=Math.max(f.end,h),v=this.shouldLoadParts(this.getLevelDetails(),y);v&&(this.log(`LL-Part loading ON after seeking to ${h.toFixed(2)} with buffer @${y.toFixed(2)}`),this.loadingParts=v)}}this.hls.hasEnoughToStart||(this.log(`Setting ${m?"startPosition":"nextLoadPosition"} to ${h} for seek without enough to start`),this.nextLoadPosition=h,m&&(this.startPosition=h)),m&&this.state===Z.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=i,this.hls=e,this.fragmentLoader=new mie(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new J1(e.config)}registerListeners(){const{hls:e}=this;e.on(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(P.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(P.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===Z.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Z.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const s=e.end||0,r=this.config.timelineOffset||0;if(s<=r)return!1;const i=e.buffered;this.config.maxBufferHole&&i&&i.length>1&&(e=Ue.bufferedInfo(i,e.start,0));const o=e.nextStart;if(o&&o>r&&o<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const d=l[l.length-1];return Ue.isBuffered(this.media,d.start+d.duration/2)}const c=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(c)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const s=this.media=this.mediaBuffer=t.media;ds(s,"seeking",this.onMediaSeeking),ds(s,"ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===Z.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){const s=!!t.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),_s(r,"seeking",this.onMediaSeeking),_s(r,"ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=Z.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,s){this.startFragRequested=!0,this._loadFragForPlayback(e,t,s)}_loadFragForPlayback(e,t,s){const r=i=>{const o=i.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${i.part?" part: "+i.part.index:""} of ${this.fragInfo(o,!1,i.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(i)};this._doFragLoad(e,t,s,r).then(i=>{if(!i)return;const o=this.state,a=i.frag;if(this.fragContextChanged(a)){(o===Z.FRAG_LOADING||!this.fragCurrent&&o===Z.PARSING)&&(this.fragmentTracker.removeFragment(a),this.state=Z.IDLE);return}"payload"in i&&(this.log(`Loaded ${a.type} sn: ${a.sn} of ${this.playlistLabel()} ${a.level}`),this.hls.trigger(P.FRAG_LOADED,i)),this._handleFragmentLoadComplete(i)}).catch(i=>{this.state===Z.STOPPED||this.state===Z.ERROR||(this.warn(`Frag error: ${(i==null?void 0:i.message)||i}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:s}=this;if(s.getState(e)===xn.APPENDING){const i=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,i),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(a,e.duration))&&s.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),s.getState(e)===xn.PARTIAL&&s.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,s=null){if(!(e-t))return;const r={startOffset:e,endOffset:t,type:s};this.hls.trigger(P.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(s=>{const r=s==null?void 0:s.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return s}).then(s=>{const{hls:r}=this,{frag:i,payload:o}=s,a=i.decryptdata;if(o&&o.byteLength>0&&a!=null&&a.key&&a.iv&&_u(a.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),a.key.buffer,a.iv.buffer,e_(a.method)).catch(c=>{throw r.trigger(P.ERROR,{type:Te.MEDIA_ERROR,details:W.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:i}),c}).then(c=>{const d=self.performance.now();return r.trigger(P.FRAG_DECRYPTED,{frag:i,payload:c,stats:{tstart:l,tdecrypt:d}}),s.payload=c,this.completeInitSegmentLoad(s)})}return this.completeInitSegmentLoad(s)}).catch(s=>{this.state===Z.STOPPED||this.state===Z.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state!==Z.STOPPED&&(this.state=Z.IDLE),e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var s,r;const i=e.tracks;if(i&&!t.encrypted&&((s=i.audio)!=null&&s.encrypted||(r=i.video)!=null&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,a=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(a.message),!o||o.mediaKeys?!1:(this.hls.trigger(P.ERROR,{type:Te.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_NO_KEYS,fatal:!1,error:a,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${s?Vie.toString(Ue.getBuffered(s)):"(detached)"})`),sn(e)){var r;if(e.type!==de.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(a=>!!o[a])){this.state=Z.IDLE;return}}const i=(r=this.levels)==null?void 0:r[e.level];i!=null&&i.fragmentError&&(this.log(`Resetting level fragment error count of ${i.fragmentError} on frag buffered`),i.fragmentError=0)}this.state=Z.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:s,part:r,partsLoaded:i}=e,o=!i||i.length===0||i.some(l=>!l),a=new Z1(s.level,s.sn,s.stats.chunkCount+1,0,r?r.index:-1,!o);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,s=null,r){var i;this.fragCurrent=e;const o=t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;if(e.encrypted&&!((i=e.decryptdata)!=null&&i.key)){if(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=Z.KEY_LOADING,this.fragCurrent=e,a=this.keyLoader.load(e).then(f=>{if(!this.fragContextChanged(f.frag))return this.hls.trigger(P.KEY_LOADED,f),this.state===Z.KEY_LOADING&&(this.state=Z.IDLE),f}),this.hls.trigger(P.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(a=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(sn(e)&&(!l||e.sn!==l.sn)){const f=this.shouldLoadParts(t.details,e.end);f!==this.loadingParts&&(this.log(`LL-Part loading ${f?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=f)}if(s=Math.max(e.start,s||0),this.loadingParts&&sn(e)){const f=o.partList;if(f&&r){s>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);const m=this.getNextPart(f,e,s);if(m>-1){const p=f[m];e=this.fragCurrent=p.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${p.index} (${m}/${f.length-1}) of ${this.fragInfo(e,!1,p)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=p.start+p.duration,this.state=Z.FRAG_LOADING;let y;return a?y=a.then(v=>!v||this.fragContextChanged(v.frag)?null:this.doFragPartsLoad(e,p,t,r)).catch(v=>this.handleFragLoadError(v)):y=this.doFragPartsLoad(e,p,t,r).catch(v=>this.handleFragLoadError(v)),this.hls.trigger(P.FRAG_LOADING,{frag:e,part:p,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):y}else if(!e.url||this.loadedEndOfParts(f,s))return Promise.resolve(null)}}if(sn(e)&&this.loadingParts){var c;this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(c=o.partList)==null?void 0:c.filter(f=>f.loaded).map(f=>`[${f.start}-${f.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(s.toFixed(3))}`),le(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Z.FRAG_LOADING;const d=this.config.progressive&&e.type!==de.SUBTITLE;let h;return d&&a?h=a.then(f=>!f||this.fragContextChanged(f.frag)?null:this.fragmentLoader.load(e,r)).catch(f=>this.handleFragLoadError(f)):h=Promise.all([this.fragmentLoader.load(e,d?r:void 0),a]).then(([f])=>(!d&&r&&r(f),f)).catch(f=>this.handleFragLoadError(f)),this.hls.trigger(P.FRAG_LOADING,{frag:e,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):h}doFragPartsLoad(e,t,s,r){return new Promise((i,o)=>{var a;const l=[],c=(a=s.details)==null?void 0:a.partList,d=h=>{this.fragmentLoader.loadPart(e,h,r).then(f=>{l[h.index]=f;const m=f.part;this.hls.trigger(P.FRAG_LOADED,f);const p=JP(s.details,e.sn,h.index+1)||sV(c,e.sn,h.index+1);if(p)d(p);else return i({frag:e,part:m,partsLoaded:l})}).catch(o)};d(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===W.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===Te.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(P.ERROR,t)}else this.hls.trigger(P.ERROR,{type:Te.OTHER_ERROR,details:W.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==Z.PARSING){!this.fragCurrent&&this.state!==Z.STOPPED&&this.state!==Z.ERROR&&(this.state=Z.IDLE);return}const{frag:s,part:r,level:i}=t,o=self.performance.now();s.stats.parsing.end=o,r&&(r.stats.parsing.end=o);const a=this.getLevelDetails(),c=a&&s.sn>a.endSN||this.shouldLoadParts(a,s.end);c!==this.loadingParts&&(this.log(`LL-Part loading ${c?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=c),this.updateLevelTiming(s,r,i,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var s;const i=e.partList[0];if(i.fragment.type===de.SUBTITLE)return!1;const o=i.end+(((s=e.fragmentHint)==null?void 0:s.duration)||0);if(t>=o){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>i.start-i.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:s}=this,{level:r,sn:i,part:o}=e;if(!(t!=null&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${i} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const a=t[r],l=a.details,c=o>-1?JP(l,i,o):null,d=c?c.fragment:nV(l,i,s);return d?(s&&s!==d&&(d.stats=s.stats),{frag:d,part:c,level:a}):null}bufferFragmentData(e,t,s,r,i){if(this.state!==Z.PARSING)return;const{data1:o,data2:a}=e;let l=o;if(a&&(l=Er(o,a)),!l.length)return;const c=this.initPTS[t.cc],d=c?-c.baseTime/c.timescale:void 0,h={type:e.type,frag:t,part:s,chunkMeta:r,offset:d,parent:t.type,data:l};if(this.hls.trigger(P.BUFFER_APPENDING,h),e.dropped&&e.independent&&!s){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Ue.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const s=t.currentTime,r=Ue.bufferInfo(t,s,0),i=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,i*.25),a=Math.max(Math.min(e.start-o,r.end-o),s+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var s;const r=this.getLoadPosition();if(!le(r))return null;const o=this.lastCurrentTime>r||(s=this.media)!=null&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,o)}getFwdBufferInfoAtPos(e,t,s,r){const i=Ue.bufferInfo(e,t,r);if(i.len===0&&i.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,s);if(o&&(i.nextStart<=o.end||o.gap)){const a=Math.max(Math.min(i.nextStart,o.end)-t,r);return Ue.bufferInfo(e,t,a)}}return i}getMaxBufferLength(e){const{config:t}=this;let s;return e?s=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):s=t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const s=this.config,r=Math.max(Math.min(e-t,s.maxBufferLength),t),i=Math.max(e-t*3,s.maxMaxBufferLength/2,r);return i>=r?(s.maxMaxBufferLength=i,this.warn(`Reduce max buffer length to ${i}s`),!0):!1}getAppendedFrag(e,t=de.MAIN){const s=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return s&&"fragment"in s?s.fragment:s}getNextFragment(e,t){const s=t.fragments,r=s.length;if(!r)return null;const{config:i}=this,o=s[0].start,a=i.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const h=i.initialLiveManifestSize;if(r<h)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${h})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var c;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const f=this.hls.startPosition,m=this.hls.liveSyncPosition,p=l?(f!==-1&&f>=o?f:m)||l.start:e;this.log(`Setting startPosition to ${p} to match start frag at live edge. mainStart: ${f} liveSyncPosition: ${m} frag.start: ${(c=l)==null?void 0:c.start}`),this.startPosition=this.nextLoadPosition=p}}else e<=o&&(l=s[0]);if(!l){const h=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,h,t)}let d=this.filterReplacedPrimary(l,t);if(!d&&l){const h=l.sn-t.startSN;d=this.filterReplacedPrimary(s[h+1]||null,t)}return this.mapToInitFragWhenRequired(d)}isLoopLoading(e,t){const s=this.fragmentTracker.getState(e);return(s===xn.OK||s===xn.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,s,r,i){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&s.nextStart)){const a=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,r,0);if(a!==null&&s.len+a.len>=i){const l=o.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(tk(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(tk(this.config)&&e.type!==de.SUBTITLE){const s=this.hls.interstitialsManager,r=s==null?void 0:s.bufferingItem;if(r){const o=r.event;if(o){if(o.appendInPlace||Math.abs(e.start-r.start)>1||r.start===0)return null}else if(e.end<=r.start&&(t==null?void 0:t.live)===!1||e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}const i=s==null?void 0:s.playerQueue;if(i)for(let o=i.length;o--;){const a=i[o].interstitial;if(a.appendInPlace&&e.start>=a.startTime&&e.end<=a.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,s){let r=-1,i=!1,o=!0;for(let a=0,l=e.length;a<l;a++){const c=e[a];if(o=o&&!c.independent,r>-1&&s<c.start)break;const d=c.loaded;d?r=-1:(i||(c.independent||o)&&c.fragment===t)&&(c.fragment!==t&&this.warn(`Need buffer at ${s} but next unloaded part starts at ${c.start}`),r=a),i=d}return r}loadedEndOfParts(e,t){let s;for(let r=e.length;r--;){if(s=e[r],!s.loaded)return!1;if(t>s.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,s=this.fragPrevious;let r=null;if(s){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),r=nie(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const i=s.sn+1;if(i>=e.startSN&&i<=e.endSN){const o=t[i-e.startSN];s.cc===o.cc&&(r=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=BU(e,s.cc,s.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const i=this.hls.liveSyncPosition;i!==null&&(r=this.getFragmentAtPosition(i,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,s){const{config:r}=this;let{fragPrevious:i}=this,{fragments:o,endSN:a}=s;const{fragmentHint:l}=s,{maxFragLookUpTolerance:c}=r,d=s.partList,h=!!(this.loadingParts&&d!=null&&d.length&&l);h&&!this.bitrateTest&&d[d.length-1].fragment.sn===l.sn&&(o=o.concat(l),a=l.sn);let f;if(e<t){var m;const y=e<this.lastCurrentTime||e>t-c||(m=this.media)!=null&&m.paused||!this.startFragRequested?0:c;f=sc(i,o,e,y)}else f=o[o.length-1];if(f){const p=f.sn-s.startSN,y=this.fragmentTracker.getState(f);if((y===xn.OK||y===xn.PARTIAL&&f.gap)&&(i=f),i&&f.sn===i.sn&&(!h||d[0].fragment.sn>f.sn||!s.live)&&f.level===i.level){const x=o[p+1];f.sn<a&&this.fragmentTracker.getState(x)!==xn.OK?f=x:f=null}}return f}alignPlaylists(e,t,s){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const i=e.fragmentStart,o=!t,a=e.alignedSliding&&le(i);if(o||!a&&!i){Uie(s,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${r}`),l}return i}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let s=this.startPosition;s<t&&(s=-1);const r=this.timelineOffset;if(s===-1){const i=this.startTimeOffset!==null,o=i?this.startTimeOffset:e.startTimeOffset;o!==null&&le(o)?(s=t+o,o<0&&(s+=e.edge),s=Math.min(Math.max(t,s),t+e.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${o} found in ${i?"multivariant":"media"} playlist`),this.startPosition=s):e.live?(s=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+r}this.nextLoadPosition=s+r}getLoadPosition(){var e;const{media:t}=this;let s=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?s=t.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&sn(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==Z.FRAG_LOADING_WAITING_RETRY)&&(this.state=Z.IDLE)}onFragmentOrKeyLoadError(e,t){var s;if(t.chunkMeta&&!t.frag){const x=this.getCurrentContext(t.chunkMeta);x&&(t.frag=x.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var i;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}const o=t.details===W.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(r,!0);const a=t.errorAction;if(!a){this.state=Z.ERROR;return}const{action:l,flags:c,retryCount:d=0,retryConfig:h}=a,f=!!h,m=f&&l===Ln.RetryRequest,p=f&&!a.resolved&&c===Vs.MoveAllAlternatesMatchingHost,y=(s=this.hls.latestLevelDetails)==null?void 0:s.live;if(!m&&p&&sn(r)&&!r.endList&&y&&!KU(t))this.resetFragmentErrors(e),this.treatAsGap(r),a.resolved=!0;else if((m||p)&&d<h.maxNumRetry){var v;const x=gT((v=t.response)==null?void 0:v.code),E=X1(h,d);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+E,this.state=Z.FRAG_LOADING_WAITING_RETRY,a.resolved=!0,x){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${d+1}/${h.maxNumRetry} in ${E}ms`)}else if(h)if(this.resetFragmentErrors(e),d<h.maxNumRetry)!o&&l!==Ln.RemoveAlternatePermanently&&(a.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${d})`);return}else l===Ln.SendAlternateToPenaltyBox?this.state=Z.WAITING_LEVEL:this.state=Z.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,s=t===1/0;(!t||e>=t||s&&!gT(0))&&(s&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=Z.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===Z.PARSING||this.state===Z.PARSED){const t=e.frag,s=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,s),i=r&&r.len>.5;i&&this.reduceMaxBufferLength(r.len,(t==null?void 0:t.duration)||10);const o=!i;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${s} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===de.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==Z.STOPPED&&(this.state=Z.IDLE)}afterBufferFlushed(e,t,s){if(!e)return;const r=Ue.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,s),this.state===Z.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==Z.STOPPED&&(this.state=Z.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,s,r){const i=s.details;if(!i){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,c)=>{const d=e.elementaryStreams[c];if(d){const h=d.endPTS-d.startPTS;if(h<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${h})`),l||!1;const f=r?0:ZU(i,e,d.startPTS,d.endPTS,d.startDTS,d.endDTS,this);return this.hls.trigger(P.LEVEL_PTS_UPDATED,{details:i,level:s,drift:f,type:c,frag:e,start:d.startPTS,end:d.endPTS}),!0}return l},!1)){var a;const l=((a=this.transmuxer)==null?void 0:a.error)===null;if((s.fragmentError===0||l&&(s.fragmentError<2||e.endList))&&this.treatAsGap(e,s),l){const c=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(c.message),this.hls.trigger(P.ERROR,{type:Te.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,fatal:!1,error:c,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=Z.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(P.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===de.MAIN?"level":"track"}fragInfo(e,t=!0,s){var r,i;return`${this.playlistLabel()} ${e.level} (${s?"part":"frag"}:[${((r=t&&!s?e.startPTS:(s||e).start)!=null?r:NaN).toFixed(3)}-${((i=t&&!s?e.endPTS:(s||e).end)!=null?i:NaN).toFixed(3)}]${s&&e.type==="main"?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function tk(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}class aV{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let s;if(e.length)e.length===1?s=e[0]:s=$ie(e,t);else return new Uint8Array(0);return this.reset(),s}reset(){this.chunks.length=0,this.dataLength=0}}function $ie(n,e){const t=new Uint8Array(e);let s=0;for(let r=0;r<n.length;r++){const i=n[r];t.set(i,s),s+=i.length}return t}var Fx={exports:{}},nk;function Bie(){return nk||(nk=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function r(l,c,d){this.fn=l,this.context=c,this.once=d||!1}function i(l,c,d,h,f){if(typeof d!="function")throw new TypeError("The listener must be a function");var m=new r(d,h||l,f),p=t?t+c:c;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],m]:l._events[p].push(m):(l._events[p]=m,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new s:delete l._events[c]}function a(){this._events=new s,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],d,h;if(this._eventsCount===0)return c;for(h in d=this._events)e.call(d,h)&&c.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(d)):c},a.prototype.listeners=function(c){var d=t?t+c:c,h=this._events[d];if(!h)return[];if(h.fn)return[h.fn];for(var f=0,m=h.length,p=new Array(m);f<m;f++)p[f]=h[f].fn;return p},a.prototype.listenerCount=function(c){var d=t?t+c:c,h=this._events[d];return h?h.fn?1:h.length:0},a.prototype.emit=function(c,d,h,f,m,p){var y=t?t+c:c;if(!this._events[y])return!1;var v=this._events[y],x=arguments.length,E,w;if(v.fn){switch(v.once&&this.removeListener(c,v.fn,void 0,!0),x){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,d),!0;case 3:return v.fn.call(v.context,d,h),!0;case 4:return v.fn.call(v.context,d,h,f),!0;case 5:return v.fn.call(v.context,d,h,f,m),!0;case 6:return v.fn.call(v.context,d,h,f,m,p),!0}for(w=1,E=new Array(x-1);w<x;w++)E[w-1]=arguments[w];v.fn.apply(v.context,E)}else{var b=v.length,C;for(w=0;w<b;w++)switch(v[w].once&&this.removeListener(c,v[w].fn,void 0,!0),x){case 1:v[w].fn.call(v[w].context);break;case 2:v[w].fn.call(v[w].context,d);break;case 3:v[w].fn.call(v[w].context,d,h);break;case 4:v[w].fn.call(v[w].context,d,h,f);break;default:if(!E)for(C=1,E=new Array(x-1);C<x;C++)E[C-1]=arguments[C];v[w].fn.apply(v[w].context,E)}}return!0},a.prototype.on=function(c,d,h){return i(this,c,d,h,!1)},a.prototype.once=function(c,d,h){return i(this,c,d,h,!0)},a.prototype.removeListener=function(c,d,h,f){var m=t?t+c:c;if(!this._events[m])return this;if(!d)return o(this,m),this;var p=this._events[m];if(p.fn)p.fn===d&&(!f||p.once)&&(!h||p.context===h)&&o(this,m);else{for(var y=0,v=[],x=p.length;y<x;y++)(p[y].fn!==d||f&&!p[y].once||h&&p[y].context!==h)&&v.push(p[y]);v.length?this._events[m]=v.length===1?v[0]:v:o(this,m)}return this},a.prototype.removeAllListeners=function(c){var d;return c?(d=t?t+c:c,this._events[d]&&o(this,d)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a}(Fx)),Fx.exports}var Gie=Bie(),s_=mre(Gie);const Ff="1.6.15",cd={};function Kie(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Hie(){const n=cd[Ff];if(n)return n.clientCount++,n;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),r={worker:new self.Worker(t),objectURL:t,clientCount:1};return cd[Ff]=r,r}function Wie(n){const e=cd[n];if(e)return e.clientCount++,e;const t=new self.URL(n,self.location.href).href,r={worker:new self.Worker(t),scriptURL:t,clientCount:1};return cd[n]=r,r}function zie(n){const e=cd[n||Ff];if(e&&e.clientCount--===1){const{worker:s,objectURL:r}=e;delete cd[n||Ff],r&&self.URL.revokeObjectURL(r),s.terminate()}}function lV(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function r_(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function av(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function Uf(n,e){const t=e;let s=0;for(;r_(n,e);){s+=10;const r=av(n,e+6);s+=r,lV(n,e+10)&&(s+=10),e+=s}if(s>0)return n.subarray(t,t+s)}function qie(n,e,t,s){const r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],i=e[t+2],o=i>>2&15;if(o>12){const m=new Error(`invalid ADTS sampling index:${o}`);n.emit(P.ERROR,P.ERROR,{type:Te.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,fatal:!0,error:m,reason:m.message});return}const a=(i>>6&3)+1,l=e[t+3]>>6&3|(i&1)<<2,c="mp4a.40."+a,d=r[o];let h=o;(a===5||a===29)&&(h-=3);const f=[a<<3|(h&14)>>1,(h&1)<<7|l<<3];return mt.log(`manifest codec:${s}, parsed codec:${c}, channels:${l}, rate:${d} (ADTS object type:${a} sampling index:${o})`),{config:f,samplerate:d,channelCount:l,codec:c,parsedCodec:c,manifestCodec:s}}function cV(n,e){return n[e]===255&&(n[e+1]&246)===240}function uV(n,e){return n[e+1]&1?7:9}function i_(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function Yie(n,e){return e+5<n.length}function D0(n,e){return e+1<n.length&&cV(n,e)}function Qie(n,e){return Yie(n,e)&&cV(n,e)&&i_(n,e)<=n.length-e}function Xie(n,e){if(D0(n,e)){const t=uV(n,e);if(e+t>=n.length)return!1;const s=i_(n,e);if(s<=t)return!1;const r=e+s;return r===n.length||D0(n,r)}return!1}function dV(n,e,t,s,r){if(!n.samplerate){const i=qie(e,t,s,r);if(!i)return;Et(n,i)}}function hV(n){return 1024*9e4/n}function Jie(n,e){const t=uV(n,e);if(e+t<=n.length){const s=i_(n,e)-t;if(s>0)return{headerLength:t,frameLength:s}}}function fV(n,e,t,s,r){const i=hV(n.samplerate),o=s+r*i,a=Jie(e,t);let l;if(a){const{frameLength:h,headerLength:f}=a,m=f+h,p=Math.max(0,t+m-e.length);p?(l=new Uint8Array(m-f),l.set(e.subarray(t+f,e.length),0)):l=e.subarray(t+f,t+m);const y={unit:l,pts:o};return p||n.samples.push(y),{sample:y,length:m,missing:p}}const c=e.length-t;return l=new Uint8Array(c),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:o},length:c,missing:-1}}function Zie(n,e){return r_(n,e)&&av(n,e+6)+10<=n.length-e}function eoe(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function Ux(n,e=0,t=1/0){return toe(n,e,t,Uint8Array)}function toe(n,e,t,s){const r=noe(n);let i=1;"BYTES_PER_ELEMENT"in s&&(i=s.BYTES_PER_ELEMENT);const o=soe(n)?n.byteOffset:0,a=(o+n.byteLength)/i,l=(o+e)/i,c=Math.floor(Math.max(0,Math.min(l,a))),d=Math.floor(Math.min(c+Math.max(t,0),a));return new s(r,c,d-c)}function noe(n){return n instanceof ArrayBuffer?n:n.buffer}function soe(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function roe(n){const e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const s=n.data.subarray(1).indexOf(0);if(s===-1)return;const r=Zs(Ux(n.data,1,s)),i=n.data[2+s],o=n.data.subarray(3+s).indexOf(0);if(o===-1)return;const a=Zs(Ux(n.data,3+s,o));let l;return r==="-->"?l=Zs(Ux(n.data,4+s+o)):l=eoe(n.data.subarray(4+s+o)),e.mimeType=r,e.pictureType=i,e.description=a,e.data=l,e}function ioe(n){if(n.size<2)return;const e=Zs(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function ooe(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1;const s=Zs(n.data.subarray(t),!0);t+=s.length+1;const r=Zs(n.data.subarray(t));return{key:n.type,info:s,data:r}}const e=Zs(n.data.subarray(1));return{key:n.type,info:"",data:e}}function aoe(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1;const s=Zs(n.data.subarray(t),!0);t+=s.length+1;const r=Zs(n.data.subarray(t));return{key:n.type,info:s,data:r}}const e=Zs(n.data);return{key:n.type,info:"",data:e}}function loe(n){return n.type==="PRIV"?ioe(n):n.type[0]==="W"?aoe(n):n.type==="APIC"?roe(n):ooe(n)}function coe(n){const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=av(n,4),s=10;return{type:e,size:t,data:n.subarray(s,s+t)}}const Sp=10,uoe=10;function mV(n){let e=0;const t=[];for(;r_(n,e);){const s=av(n,e+6);n[e+5]>>6&1&&(e+=Sp),e+=Sp;const r=e+s;for(;e+uoe<r;){const i=coe(n.subarray(e)),o=loe(i);o&&t.push(o),e+=i.size+Sp}lV(n,e)&&(e+=Sp)}return t}function pV(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function doe(n){if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let s=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return s/=45,t&&(s+=4772185884e-2),Math.round(s)}}function o_(n){const e=mV(n);for(let t=0;t<e.length;t++){const s=e[t];if(pV(s))return doe(s)}}let Hs=function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n}({});function ii(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class a_{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,s,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,s){}demux(e,t){this.cachedData&&(e=Er(this.cachedData,e),this.cachedData=null);let s=Uf(e,0),r=s?s.length:0,i;const o=this._audioTrack,a=this._id3Track,l=s?o_(s):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&le(l))&&(this.basePTS=hoe(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),s&&s.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:Hs.audioId3,duration:Number.POSITIVE_INFINITY});r<c;){if(this.canParse(e,r)){const d=this.appendFrame(o,e,r);d?(this.frameIndex++,this.lastPTS=d.sample.pts,r+=d.length,i=r):r=c}else Zie(e,r)?(s=Uf(e,r),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:Hs.audioId3,duration:Number.POSITIVE_INFINITY}),r+=s.length,i=r):r++;if(r===c&&i!==c){const d=e.slice(i);this.cachedData?this.cachedData=Er(this.cachedData,d):this.cachedData=d}}return{audioTrack:o,videoTrack:ii(),id3Track:a,textTrack:ii()}}demuxSampleAes(e,t,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:ii(),id3Track:this._id3Track,textTrack:ii()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const hoe=(n,e,t)=>{if(le(n))return n*90;const s=t?t.baseTime*9e4/t.timescale:0;return e*9e4+s};let _p=null;const foe=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],moe=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],poe=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],goe=[0,1,1,4];function gV(n,e,t,s,r){if(t+24>e.length)return;const i=yV(e,t);if(i&&t+i.frameLength<=e.length){const o=i.samplesPerFrame*9e4/i.sampleRate,a=s+r*o,l={unit:e.subarray(t,t+i.frameLength),pts:a,dts:a};return n.config=[],n.channelCount=i.channelCount,n.samplerate=i.sampleRate,n.samples.push(l),{sample:l,length:i.frameLength,missing:0}}}function yV(n,e){const t=n[e+1]>>3&3,s=n[e+1]>>1&3,r=n[e+2]>>4&15,i=n[e+2]>>2&3;if(t!==1&&r!==0&&r!==15&&i!==3){const o=n[e+2]>>1&1,a=n[e+3]>>6,l=t===3?3-s:s===3?3:4,c=foe[l*14+r-1]*1e3,h=moe[(t===3?0:t===2?1:2)*3+i],f=a===3?1:2,m=poe[t][s],p=goe[s],y=m*8*p,v=Math.floor(m*c/h+o)*p;if(_p===null){const w=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);_p=w?parseInt(w[1]):0}return!!_p&&_p<=87&&s===2&&c>=224e3&&a===0&&(n[e+3]=n[e+3]|128),{sampleRate:h,channelCount:f,frameLength:v,samplesPerFrame:y}}}function l_(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function vV(n,e){return e+1<n.length&&l_(n,e)}function yoe(n,e){return l_(n,e)&&4<=n.length-e}function xV(n,e){if(e+1<n.length&&l_(n,e)){const s=yV(n,e);let r=4;s!=null&&s.frameLength&&(r=s.frameLength);const i=e+r;return i===n.length||vV(n,i)}return!1}class voe extends a_{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,s,r){super.resetInitSegment(e,t,s,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const s=Uf(e,0);let r=(s==null?void 0:s.length)||0;if(xV(e,r))return!1;for(let i=e.length;r<i;r++)if(Xie(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return Qie(e,t)}appendFrame(e,t,s){dV(e,this.observer,t,s,e.manifestCodec);const r=fV(e,t,s,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const EV=(n,e)=>{let t=0,s=5;e+=s;const r=new Uint32Array(1),i=new Uint32Array(1),o=new Uint8Array(1);for(;s>0;){o[0]=n[e];const a=Math.min(s,8),l=8-a;i[0]=4278190080>>>24+l<<l,r[0]=(o[0]&i[0])>>l,t=t?t<<a|r[0]:r[0],e+=1,s-=a}return t};class xoe extends a_{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,s,r){super.resetInitSegment(e,t,s,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,s){const r=wV(e,t,s,this.basePTS,this.frameIndex);if(r!==-1)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;const t=Uf(e,0);if(!t)return!1;const s=t.length;return e[s]===11&&e[s+1]===119&&o_(t)!==void 0&&EV(e,s)<16}}function wV(n,e,t,s,r){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const i=e[t+4]>>6;if(i>=3)return-1;const a=[48e3,44100,32e3][i],l=e[t+4]&63,d=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+i]*2;if(t+d>e.length)return-1;const h=e[t+6]>>5;let f=0;h===2?f+=2:(h&1&&h!==1&&(f+=2),h&4&&(f+=2));const m=(e[t+6]<<8|e[t+7])>>12-f&1,y=[2,1,2,3,3,4,4,5][h]+m,v=e[t+5]>>3,x=e[t+5]&7,E=new Uint8Array([i<<6|v<<1|x>>2,(x&3)<<6|h<<3|m<<2|l>>4,l<<4&224]),w=1536/a*9e4,b=s+r*w,C=e.subarray(t,t+d);return n.config=E,n.channelCount=y,n.samplerate=a,n.samples.push({unit:C,pts:b}),d}class Eoe extends a_{resetInitSegment(e,t,s,r){super.resetInitSegment(e,t,s,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Uf(e,0);let s=(t==null?void 0:t.length)||0;if(t&&e[s]===11&&e[s+1]===119&&o_(t)!==void 0&&EV(e,s)<=16)return!1;for(let r=e.length;s<r;s++)if(xV(e,s))return mt.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return yoe(e,t)}appendFrame(e,t,s){if(this.basePTS!==null)return gV(e,t,s,this.basePTS,this.frameIndex)}}const woe=/\/emsg[-/]ID3/i;class Toe{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,s,r){const i=this.videoTrack=ii("video",1),o=this.audioTrack=ii("audio",1),a=this.txtTrack=ii("text",1);if(this.id3Track=ii("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=kU(e);if(l.video){const{id:c,timescale:d,codec:h,supplemental:f}=l.video;i.id=c,i.timescale=a.timescale=d,i.codec=h,i.supplemental=f}if(l.audio){const{id:c,timescale:d,codec:h}=l.audio;o.id=c,o.timescale=d,o.codec=h}a.id=RU.text,i.sampleDuration=0,i.duration=o.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return xre(e)}demux(e,t){this.timeOffset=t;let s=e;const r=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=Er(this.remainderData,e));const a=Are(s);this.remainderData=a.remainder,r.samples=a.valid||new Uint8Array}else r.samples=s;const o=this.extractID3Track(r,t);return i.samples=EP(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return s.samples=EP(e,t),{videoTrack:t,audioTrack:ii(),id3Track:r,textTrack:ii()}}extractID3Track(e,t){const s=this.id3Track;if(e.samples.length){const r=He(e.samples,["emsg"]);r&&r.forEach(i=>{const o=Rre(i);if(woe.test(o.schemeIdUri)){const a=sk(o,t);let l=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const c=o.payload;s.samples.push({data:c,len:c.byteLength,dts:a,pts:a,type:Hs.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const a=sk(o,t);s.samples.push({data:o.payload,len:o.payload.byteLength,dts:a,pts:a,type:Hs.misbklv,duration:Number.POSITIVE_INFINITY})}})}return s}demuxSampleAes(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function sk(n,e){return le(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}class boe{constructor(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new J1(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,qa.cbc)}decryptAacSample(e,t,s){const r=e[t].unit;if(r.length<=16)return;const i=r.subarray(16,r.length-r.length%16),o=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(o).then(a=>{const l=new Uint8Array(a);r.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)}).catch(s)}decryptAacSamples(e,t,s){for(;;t++){if(t>=e.length){s();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,s=new Int8Array(t);let r=0;for(let i=32;i<e.length-16;i+=160,r+=16)s.set(e.subarray(i,i+16),r);return s}getAvcDecryptedUnit(e,t){const s=new Uint8Array(t);let r=0;for(let i=32;i<e.length-16;i+=160,r+=16)e.set(s.subarray(r,r+16),i);return e}decryptAvcSample(e,t,s,r,i){const o=DU(i.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{i.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,r)}).catch(r)}decryptAvcSamples(e,t,s,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length){r();return}const i=e[t].units;for(;!(s>=i.length);s++){const o=i[s];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,s,r,o),!this.decrypter.isSync()))return}}}}class TV{constructor(){this.VideoSample=null}createVideoSample(e,t,s){return{key:e,frame:!1,pts:t,dts:s,units:[],length:0}}getLastNalUnit(e){var t;let s=this.VideoSample,r;if((!s||s.units.length===0)&&(s=e[e.length-1]),(t=s)!=null&&t.units){const i=s.units;r=i[i.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const s=t.samples,r=s.length;if(r){const i=s[r-1];e.pts=i.pts,e.dts=i.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,s){const r=t.byteLength;let i=e.naluState||0;const o=i,a=[];let l=0,c,d,h,f=-1,m=0;for(i===-1&&(f=0,m=this.getNALuType(t,0),i=0,l=1);l<r;){if(c=t[l++],!i){i=c?0:1;continue}if(i===1){i=c?0:2;continue}if(!c)i=3;else if(c===1){if(d=l-i-1,f>=0){const p={data:t.subarray(f,d),type:m};a.push(p)}else{const p=this.getLastNalUnit(e.samples);p&&(o&&l<=4-o&&p.state&&(p.data=p.data.subarray(0,p.data.byteLength-o)),d>0&&(p.data=Er(p.data,t.subarray(0,d)),p.state=0))}l<r?(h=this.getNALuType(t,l),f=l,m=h,i=0):i=-1}else i=0}if(f>=0&&i>=0){const p={data:t.subarray(f,r),type:m,state:i};a.push(p)}if(a.length===0){const p=this.getLastNalUnit(e.samples);p&&(p.data=Er(p.data,t))}return e.naluState=i,a}}class Qh{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,r=new Uint8Array(4),i=Math.min(4,t);if(i===0)throw new Error("no bytes available");r.set(e.subarray(s,s+i)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=i*8,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&mt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class Soe extends TV{parsePES(e,t,s,r){const i=this.parseNALu(e,s.data,r);let o=this.VideoSample,a,l=!1;s.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),i.forEach(c=>{var d,h;switch(c.type){case 1:{let y=!1;a=!0;const v=c.data;if(l&&v.length>4){const x=this.readSliceType(v);(x===2||x===4||x===7||x===9)&&(y=!0)}if(y){var f;(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.frame=!0,o.key=y;break}case 5:a=!0,(d=o)!=null&&d.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0,o.frame=!0;break;case 6:{a=!0,q1(c.data,1,s.pts,t.samples);break}case 7:{var m,p;a=!0,l=!0;const y=c.data,v=this.readSPS(y);if(!e.sps||e.width!==v.width||e.height!==v.height||((m=e.pixelRatio)==null?void 0:m[0])!==v.pixelRatio[0]||((p=e.pixelRatio)==null?void 0:p[1])!==v.pixelRatio[1]){e.width=v.width,e.height=v.height,e.pixelRatio=v.pixelRatio,e.sps=[y];const x=y.subarray(1,4);let E="avc1.";for(let w=0;w<3;w++){let b=x[w].toString(16);b.length<2&&(b="0"+b),E+=b}e.codec=E}break}case 8:a=!0,e.pps=[c.data];break;case 9:a=!0,e.audFound=!0,(h=o)!=null&&h.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:a=!0;break;default:a=!1;break}o&&a&&o.units.push(c)}),r&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Qh(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let s=8,r=8,i;for(let o=0;o<e;o++)r!==0&&(i=t.readEG(),r=(s+i+256)%256),s=r===0?s:r}readSPS(e){const t=new Qh(e);let s=0,r=0,i=0,o=0,a,l,c;const d=t.readUByte.bind(t),h=t.readBits.bind(t),f=t.readUEG.bind(t),m=t.readBoolean.bind(t),p=t.skipBits.bind(t),y=t.skipEG.bind(t),v=t.skipUEG.bind(t),x=this.skipScalingList.bind(this);d();const E=d();if(h(5),p(3),d(),v(),E===100||E===110||E===122||E===244||E===44||E===83||E===86||E===118||E===128){const S=f();if(S===3&&p(1),v(),v(),p(1),m())for(l=S!==3?8:12,c=0;c<l;c++)m()&&(c<6?x(16,t):x(64,t))}v();const w=f();if(w===0)f();else if(w===1)for(p(1),y(),y(),a=f(),c=0;c<a;c++)y();v(),p(1);const b=f(),C=f(),D=h(1);D===0&&p(1),p(1),m()&&(s=f(),r=f(),i=f(),o=f());let _=[1,1];if(m()&&m())switch(d()){case 1:_=[1,1];break;case 2:_=[12,11];break;case 3:_=[10,11];break;case 4:_=[16,11];break;case 5:_=[40,33];break;case 6:_=[24,11];break;case 7:_=[20,11];break;case 8:_=[32,11];break;case 9:_=[80,33];break;case 10:_=[18,11];break;case 11:_=[15,11];break;case 12:_=[64,33];break;case 13:_=[160,99];break;case 14:_=[4,3];break;case 15:_=[3,2];break;case 16:_=[2,1];break;case 255:{_=[d()<<8|d(),d()<<8|d()];break}}return{width:Math.ceil((b+1)*16-s*2-r*2),height:(2-D)*(C+1)*16-(D?2:4)*(i+o),pixelRatio:_}}}class _oe extends TV{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,s,r){const i=this.parseNALu(e,s.data,r);let o=this.VideoSample,a,l=!1;s.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),i.forEach(c=>{var d,h;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),o.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:if(a=!0,l){var f;(f=o)!=null&&f.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:a=!0,(d=o)!=null&&d.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0,o.frame=!0;break;case 39:a=!0,q1(c.data,2,s.pts,t.samples);break;case 32:a=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Et(e.params,this.readVPS(c.data)),this.initVPS=c.data),e.vps=[c.data];break;case 33:if(a=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],c.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const m=this.readSPS(c.data);e.width=m.width,e.height=m.height,e.pixelRatio=m.pixelRatio,e.codec=m.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const p in m.params)e.params[p]=m.params[p]}this.pushParameterSet(e.sps,c.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0;break;case 34:if(a=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const m=this.readPPS(c.data);for(const p in m)e.params[p]=m[p]}this.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:a=!0,e.audFound=!0,(h=o)!=null&&h.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:a=!1;break}o&&a&&o.units.push(c)}),r&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,s){(s&&s[0]===this.initVPS||!s&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let s=0;for(let r=0;r<e.byteLength;r++)r>=2&&e[r]===3&&e[r-1]===0&&e[r-2]===0||(t[s]=e[r],s++);return new Uint8Array(t.buffer,0,s)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Qh(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const s=t.readBits(3),r=t.readBoolean();return{numTemporalLayers:s+1,temporalIdNested:r}}readSPS(e){const t=new Qh(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const s=t.readBits(3);t.readBoolean();const r=t.readBits(2),i=t.readBoolean(),o=t.readBits(5),a=t.readUByte(),l=t.readUByte(),c=t.readUByte(),d=t.readUByte(),h=t.readUByte(),f=t.readUByte(),m=t.readUByte(),p=t.readUByte(),y=t.readUByte(),v=t.readUByte(),x=t.readUByte(),E=[],w=[];for(let De=0;De<s;De++)E.push(t.readBoolean()),w.push(t.readBoolean());if(s>0)for(let De=s;De<8;De++)t.readBits(2);for(let De=0;De<s;De++)E[De]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),w[De]&&t.readUByte();t.readUEG();const b=t.readUEG();b==3&&t.skipBits(1);const C=t.readUEG(),D=t.readUEG(),_=t.readBoolean();let S=0,I=0,R=0,N=0;_&&(S+=t.readUEG(),I+=t.readUEG(),R+=t.readUEG(),N+=t.readUEG());const L=t.readUEG(),M=t.readUEG(),G=t.readUEG(),V=t.readBoolean();for(let De=V?0:s;De<=s;De++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let ct=0;ct<4;ct++)for(let Gt=0;Gt<(ct===3?2:6);Gt++)if(!t.readBoolean())t.readUEG();else{const at=Math.min(64,1<<4+(ct<<1));ct>1&&t.readEG();for(let Kn=0;Kn<at;Kn++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const j=t.readUEG();let U=0;for(let De=0;De<j;De++){let ct=!1;if(De!==0&&(ct=t.readBoolean()),ct){De===j&&t.readUEG(),t.readBoolean(),t.readUEG();let Gt=0;for(let rt=0;rt<=U;rt++){const at=t.readBoolean();let Kn=!1;at||(Kn=t.readBoolean()),(at||Kn)&&Gt++}U=Gt}else{const Gt=t.readUEG(),rt=t.readUEG();U=Gt+rt;for(let at=0;at<Gt;at++)t.readUEG(),t.readBoolean();for(let at=0;at<rt;at++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const De=t.readUEG();for(let ct=0;ct<De;ct++){for(let Gt=0;Gt<G+4;Gt++)t.readBits(1);t.readBits(1)}}let Y=0,J=1,ae=1,he=!0,ve=1,ge=0;t.readBoolean(),t.readBoolean();let re=!1;if(t.readBoolean()){if(t.readBoolean()){const vs=t.readUByte(),br=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],on=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];vs>0&&vs<16?(J=br[vs-1],ae=on[vs-1]):vs===255&&(J=t.readBits(16),ae=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),re=t.readBoolean(),re&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(ve=t.readBits(32),ge=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const on=t.readBoolean(),an=t.readBoolean();let q=!1;(on||an)&&(q=t.readBoolean(),q&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),q&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Pe=0;Pe<=s;Pe++){he=t.readBoolean();const Xe=he||t.readBoolean();let $e=!1;Xe?t.readEG():$e=t.readBoolean();const Os=$e?1:t.readUEG()+1;if(on)for(let rs=0;rs<Os;rs++)t.readUEG(),t.readUEG(),q&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(an)for(let rs=0;rs<Os;rs++)t.readUEG(),t.readUEG(),q&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),Y=t.readUEG())}let xe=C,Ne=D;if(_){let De=1,ct=1;b===1?De=ct=2:b==2&&(De=2),xe=C-De*I-De*S,Ne=D-ct*N-ct*R}const Le=r?["A","B","C"][r]:"",qe=a<<24|l<<16|c<<8|d;let gt=0;for(let De=0;De<32;De++)gt=(gt|(qe>>De&1)<<31-De)>>>0;let Jt=gt.toString(16);return o===1&&Jt==="2"&&(Jt="6"),{codecString:`hvc1.${Le}${o}.${Jt}.${i?"H":"L"}${x}.B0`,params:{general_tier_flag:i,general_profile_idc:o,general_profile_space:r,general_profile_compatibility_flags:[a,l,c,d],general_constraint_indicator_flags:[h,f,m,p,y,v],general_level_idc:x,bit_depth:L+8,bit_depth_luma_minus8:L,bit_depth_chroma_minus8:M,min_spatial_segmentation_idc:Y,chroma_format_idc:b,frame_rate:{fixed:he,fps:ge/ve}},width:xe,height:Ne,pixelRatio:[J,ae]}}readPPS(e){const t=new Qh(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const r=t.readBoolean(),i=t.readBoolean();let o=1;return i&&r?o=0:i?o=3:r&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const _n=188;class ea{constructor(e,t,s,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=r,this.videoParser=null}static probe(e,t){const s=ea.syncOffset(e);return s>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),s!==-1}static syncOffset(e){const t=e.length;let s=Math.min(_n*5,t-_n)+1,r=0;for(;r<s;){let i=!1,o=-1,a=0;for(let l=r;l<t;l+=_n)if(e[l]===71&&(t-l===_n||e[l+_n]===71)){if(a++,o===-1&&(o=l,o!==0&&(s=Math.min(o+_n*99,e.length-_n)+1)),i||(i=wT(e,l)===0),i&&a>1&&(o===0&&a>2||l+_n>s))return o}else{if(a)return-1;break}r++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:RU[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,s,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=ea.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=ea.createTrack("audio",r),this._id3Track=ea.createTrack("id3"),this._txtTrack=ea.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,s=!1,r=!1){s||(this.sampleAes=null);let i;const o=this._videoTrack,a=this._audioTrack,l=this._id3Track,c=this._txtTrack;let d=o.pid,h=o.pesData,f=a.pid,m=l.pid,p=a.pesData,y=l.pesData,v=null,x=this.pmtParsed,E=this._pmtId,w=e.length;if(this.remainderData&&(e=Er(this.remainderData,e),w=e.length,this.remainderData=null),w<_n&&!r)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};const b=Math.max(0,ea.syncOffset(e));w-=(w-b)%_n,w<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,w,e.buffer.byteLength-w));let C=0;for(let _=b;_<w;_+=_n)if(e[_]===71){const S=!!(e[_+1]&64),I=wT(e,_),R=(e[_+3]&48)>>4;let N;if(R>1){if(N=_+5+e[_+4],N===_+_n)continue}else N=_+4;switch(I){case d:S&&(h&&(i=jc(h,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,c,i,!1)),h={data:[],size:0}),h&&(h.data.push(e.subarray(N,_+_n)),h.size+=_+_n-N);break;case f:if(S){if(p&&(i=jc(p,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,i);break;case"mp3":this.parseMPEGPES(a,i);break;case"ac3":this.parseAC3PES(a,i);break}p={data:[],size:0}}p&&(p.data.push(e.subarray(N,_+_n)),p.size+=_+_n-N);break;case m:S&&(y&&(i=jc(y,this.logger))&&this.parseID3PES(l,i),y={data:[],size:0}),y&&(y.data.push(e.subarray(N,_+_n)),y.size+=_+_n-N);break;case 0:S&&(N+=e[N]+1),E=this._pmtId=Aoe(e,N);break;case E:{S&&(N+=e[N]+1);const L=Ioe(e,N,this.typeSupported,s,this.observer,this.logger);d=L.videoPid,d>0&&(o.pid=d,o.segmentCodec=L.segmentVideoCodec),f=L.audioPid,f>0&&(a.pid=f,a.segmentCodec=L.segmentAudioCodec),m=L.id3Pid,m>0&&(l.pid=m),v!==null&&!x&&(this.logger.warn(`MPEG-TS PMT found at ${_} after unknown PID '${v}'. Backtracking to sync byte @${b} to parse all TS packets.`),v=null,_=b-188),x=this.pmtParsed=!0;break}case 17:case 8191:break;default:v=I;break}}else C++;C>0&&TT(this.observer,new Error(`Found ${C} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=h,a.pesData=p,l.pesData=y;const D={audioTrack:a,videoTrack:o,id3Track:l,textTrack:c};return r&&this.extractRemainingSamples(D),D}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:s,id3Track:r,textTrack:i}=e,o=s.pesData,a=t.pesData,l=r.pesData;let c;if(o&&(c=jc(o,this.logger))?(this.readyVideoParser(s.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(s,i,c,!0),s.pesData=null)):s.pesData=o,a&&(c=jc(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else a!=null&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;l&&(c=jc(l,this.logger))?(this.parseID3PES(r,c),r.pesData=null):r.pesData=l}demuxSampleAes(e,t,s){const r=this.demux(e,s,!0,!this.config.progressive),i=this.sampleAes=new boe(this.observer,this.config,t);return this.decrypt(r,i)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new Soe:e==="hevc"&&(this.videoParser=new _oe))}decrypt(e,t){return new Promise(s=>{const{audioTrack:r,videoTrack:i}=e;r.samples&&r.segmentCodec==="aac"?t.decryptAacSamples(r.samples,0,()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,()=>{s(e)}):s(e)}):i.samples&&t.decryptAvcSamples(i.samples,0,0,()=>{s(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let s=0;const r=this.aacOverFlow;let i=t.data;if(r){this.aacOverFlow=null;const h=r.missing,f=r.sample.unit.byteLength;if(h===-1)i=Er(r.sample.unit,i);else{const m=f-h;r.sample.unit.set(i.subarray(0,h),m),e.samples.push(r.sample),s=r.missing}}let o,a;for(o=s,a=i.length;o<a-1&&!D0(i,o);o++);if(o!==s){let h;const f=o<a-1;if(f?h=`AAC PES did not start with ADTS header,offset:${o}`:h="No ADTS header found in AAC PES",TT(this.observer,new Error(h),f,this.logger),!f)return}dV(e,this.observer,i,o,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(r){const h=hV(e.samplerate);l=r.sample.pts+h}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,d;for(;o<a;)if(d=fV(e,i,o,l,c),o+=d.length,d.missing){this.aacOverFlow=d;break}else for(c++;o<a-1&&!D0(i,o);o++);}parseMPEGPES(e,t){const s=t.data,r=s.length;let i=0,o=0;const a=t.pts;if(a===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<r;)if(vV(s,o)){const l=gV(e,s,o,a,i);if(l)o+=l.length,i++;else break}else o++}parseAC3PES(e,t){{const s=t.data,r=t.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const i=s.length;let o=0,a=0,l;for(;a<i&&(l=wV(e,s,a,r,o++))>0;)a+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const s=Et({},t,{type:this._videoTrack?Hs.emsg:Hs.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(s)}}function wT(n,e){return((n[e+1]&31)<<8)+n[e+2]}function Aoe(n,e){return(n[e+10]&31)<<8|n[e+11]}function Ioe(n,e,t,s,r,i){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=(n[e+1]&15)<<8|n[e+2],l=e+3+a-4,c=(n[e+10]&15)<<8|n[e+11];for(e+=12+c;e<l;){const d=wT(n,e),h=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!s){Vx("ADTS AAC",i);break}case 15:o.audioPid===-1&&(o.audioPid=d);break;case 21:o.id3Pid===-1&&(o.id3Pid=d);break;case 219:if(!s){Vx("H.264",i);break}case 27:o.videoPid===-1&&(o.videoPid=d);break;case 3:case 4:!t.mpeg&&!t.mp3?i.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=d,o.segmentAudioCodec="mp3");break;case 193:if(!s){Vx("AC-3",i);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=d,o.segmentAudioCodec="ac3"):i.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&h>0){let f=e+5,m=h;for(;m>2;){switch(n[f]){case 106:t.ac3!==!0?i.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=d,o.segmentAudioCodec="ac3");break}const y=n[f+1]+2;f+=y,m-=y}}break;case 194:case 135:return TT(r,new Error("Unsupported EC-3 in M2TS found"),void 0,i),o;case 36:o.videoPid===-1&&(o.videoPid=d,o.segmentVideoCodec="hevc",i.log("HEVC in M2TS found"));break}e+=h+5}return o}function TT(n,e,t,s){s.warn(`parsing error: ${e.message}`),n.emit(P.ERROR,P.ERROR,{type:Te.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Vx(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function jc(n,e){let t=0,s,r,i,o,a;const l=n.data;if(!n||n.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=Er(l[0],l[1]),l.splice(1,1);if(s=l[0],(s[0]<<16)+(s[1]<<8)+s[2]===1){if(r=(s[4]<<8)+s[5],r&&r>n.size-6)return null;const d=s[7];d&192&&(o=(s[9]&14)*536870912+(s[10]&255)*4194304+(s[11]&254)*16384+(s[12]&255)*128+(s[13]&254)/2,d&64?(a=(s[14]&14)*536870912+(s[15]&255)*4194304+(s[16]&254)*16384+(s[17]&255)*128+(s[18]&254)/2,o-a>60*9e4&&(e.warn(`${Math.round((o-a)/9e4)}s delta between PTS and DTS, align them`),o=a)):a=o),i=s[8];let h=i+9;if(n.size<=h)return null;n.size-=h;const f=new Uint8Array(n.size);for(let m=0,p=l.length;m<p;m++){s=l[m];let y=s.byteLength;if(h)if(h>y){h-=y;continue}else s=s.subarray(h),y-=h,h=0;f.set(s,t),t+=y}return r&&(r-=i+3),{data:f,pts:o,dts:a,len:r}}return null}class Roe{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Wo=Math.pow(2,32)-1;class H{static init(){H.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in H.types)H.types.hasOwnProperty(e)&&(H.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);H.HDLR_TYPES={video:t,audio:s};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);H.STTS=H.STSC=H.STCO=i,H.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),H.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),H.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),H.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);H.FTYP=H.box(H.types.ftyp,o,l,o,a),H.DINF=H.box(H.types.dinf,H.box(H.types.dref,r))}static box(e,...t){let s=8,r=t.length;const i=r;for(;r--;)s+=t[r].byteLength;const o=new Uint8Array(s);for(o[0]=s>>24&255,o[1]=s>>16&255,o[2]=s>>8&255,o[3]=s&255,o.set(e,4),r=0,s=8;r<i;r++)o.set(t[r],s),s+=t[r].byteLength;return o}static hdlr(e){return H.box(H.types.hdlr,H.HDLR_TYPES[e])}static mdat(e){return H.box(H.types.mdat,e)}static mdhd(e,t){t*=e;const s=Math.floor(t/(Wo+1)),r=Math.floor(t%(Wo+1));return H.box(H.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(e){return H.box(H.types.mdia,H.mdhd(e.timescale||0,e.duration||0),H.hdlr(e.type),H.minf(e))}static mfhd(e){return H.box(H.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?H.box(H.types.minf,H.box(H.types.smhd,H.SMHD),H.DINF,H.stbl(e)):H.box(H.types.minf,H.box(H.types.vmhd,H.VMHD),H.DINF,H.stbl(e))}static moof(e,t,s){return H.box(H.types.moof,H.mfhd(e),H.traf(s,t))}static moov(e){let t=e.length;const s=[];for(;t--;)s[t]=H.trak(e[t]);return H.box.apply(null,[H.types.moov,H.mvhd(e[0].timescale||0,e[0].duration||0)].concat(s).concat(H.mvex(e)))}static mvex(e){let t=e.length;const s=[];for(;t--;)s[t]=H.trex(e[t]);return H.box.apply(null,[H.types.mvex,...s])}static mvhd(e,t){t*=e;const s=Math.floor(t/(Wo+1)),r=Math.floor(t%(Wo+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return H.box(H.types.mvhd,i)}static sdtp(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let r,i;for(r=0;r<t.length;r++)i=t[r].flags,s[r+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return H.box(H.types.sdtp,s)}static stbl(e){return H.box(H.types.stbl,H.stsd(e),H.box(H.types.stts,H.STTS),H.box(H.types.stsc,H.STSC),H.box(H.types.stsz,H.STSZ),H.box(H.types.stco,H.STCO))}static avc1(e){let t=[],s=[],r,i,o;for(r=0;r<e.sps.length;r++)i=e.sps[r],o=i.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(i));for(r=0;r<e.pps.length;r++)i=e.pps[r],o=i.byteLength,s.push(o>>>8&255),s.push(o&255),s=s.concat(Array.prototype.slice.call(i));const a=H.box(H.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(s))),l=e.width,c=e.height,d=e.pixelRatio[0],h=e.pixelRatio[1];return H.box(H.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,H.box(H.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),H.box(H.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,d&255,h>>24,h>>16&255,h>>8&255,h&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return H.box(H.types.mp4a,H.audioStsd(e),H.box(H.types.esds,H.esds(e)))}static mp3(e){return H.box(H.types[".mp3"],H.audioStsd(e))}static ac3(e){return H.box(H.types["ac-3"],H.audioStsd(e),H.box(H.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return H.box(H.types.stsd,H.STSD,H.mp4a(e));if(t==="ac3"&&e.config)return H.box(H.types.stsd,H.STSD,H.ac3(e));if(t==="mp3"&&e.codec==="mp3")return H.box(H.types.stsd,H.STSD,H.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return H.box(H.types.stsd,H.STSD,H.avc1(e));if(t==="hevc"&&e.vps)return H.box(H.types.stsd,H.STSD,H.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,s=(e.duration||0)*(e.timescale||0),r=e.width||0,i=e.height||0,o=Math.floor(s/(Wo+1)),a=Math.floor(s%(Wo+1));return H.box(H.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,i>>8&255,i&255,0,0]))}static traf(e,t){const s=H.sdtp(e),r=e.id,i=Math.floor(t/(Wo+1)),o=Math.floor(t%(Wo+1));return H.box(H.types.traf,H.box(H.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),H.box(H.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,o>>24,o>>16&255,o>>8&255,o&255])),H.trun(e,s.length+16+20+8+16+8+8),s)}static trak(e){return e.duration=e.duration||4294967295,H.box(H.types.trak,H.tkhd(e),H.mdia(e))}static trex(e){const t=e.id;return H.box(H.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const s=e.samples||[],r=s.length,i=12+16*r,o=new Uint8Array(i);let a,l,c,d,h,f;for(t+=8+i,o.set([e.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),a=0;a<r;a++)l=s[a],c=l.duration,d=l.size,h=l.flags,f=l.cts,o.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,h.degradPrio&61440,h.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*a);return H.box(H.types.trun,o)}static initSegment(e){H.types||H.init();const t=H.moov(e);return Er(H.FTYP,t)}static hvc1(e){const t=e.params,s=[e.vps,e.sps,e.pps],r=4,i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),r-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),s.length]);let o=i.length;for(let p=0;p<s.length;p+=1){o+=3;for(let y=0;y<s[p].length;y+=1)o+=2+s[p][y].length}const a=new Uint8Array(o);a.set(i,0),o=i.length;const l=s.length-1;for(let p=0;p<s.length;p+=1){a.set(new Uint8Array([32+p|(p===l?128:0),0,s[p].length]),o),o+=3;for(let y=0;y<s[p].length;y+=1)a.set(new Uint8Array([s[p][y].length>>8,s[p][y].length&255]),o),o+=2,a.set(s[p][y],o),o+=s[p][y].length}const c=H.box(H.types.hvcC,a),d=e.width,h=e.height,f=e.pixelRatio[0],m=e.pixelRatio[1];return H.box(H.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,d&255,h>>8&255,h&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,H.box(H.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),H.box(H.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,m>>24,m>>16&255,m>>8&255,m&255])))}}H.types=void 0;H.HDLR_TYPES=void 0;H.STTS=void 0;H.STSC=void 0;H.STCO=void 0;H.STSZ=void 0;H.VMHD=void 0;H.SMHD=void 0;H.STSD=void 0;H.FTYP=void 0;H.DINF=void 0;const bV=9e4;function c_(n,e,t=1,s=!1){const r=n*e*t;return s?Math.round(r):r}function Coe(n,e,t=1,s=!1){return c_(n,e,1/t,s)}function ph(n,e=!1){return c_(n,1e3,1/bV,e)}function Poe(n,e=1){return c_(n,bV,1/e)}function rk(n){const{baseTime:e,timescale:t,trackId:s}=n;return`${e/t} (${e}/${t}) trackId: ${s}`}const koe=10*1e3,Noe=1024,Loe=1152,Doe=1536;let Fc=null,$x=null;function ik(n,e,t,s){return{duration:e,size:t,cts:s,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}class yg extends Tr{constructor(e,t,s,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.ISGenerated=!1,Fc===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Fc=o?parseInt(o[1]):0}if($x===null){const i=navigator.userAgent.match(/Safari\/(\d+)/i);$x=i?parseInt(i[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&rk(t)} > ${e&&rk(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const s=e[0].pts,r=e.reduce((i,o)=>{let a=o.pts,l=a-i;return l<-4294967296&&(t=!0,a=Bs(a,s),l=a-i),l>0?i:a},s);return t&&this.debug("PTS rollover detected"),r}remux(e,t,s,r,i,o,a,l){let c,d,h,f,m,p,y=i,v=i;const x=e.pid>-1,E=t.pid>-1,w=t.samples.length,b=e.samples.length>0,C=a&&w>0||w>1;if((!x||b)&&(!E||C)||this.ISGenerated||a){if(this.ISGenerated){var _,S,I,R;const G=this.videoTrackConfig;(G&&(t.width!==G.width||t.height!==G.height||((_=t.pixelRatio)==null?void 0:_[0])!==((S=G.pixelRatio)==null?void 0:S[0])||((I=t.pixelRatio)==null?void 0:I[1])!==((R=G.pixelRatio)==null?void 0:R[1]))||!G&&C||this.nextAudioTs===null&&b)&&this.resetInitSegment()}this.ISGenerated||(h=this.generateIS(e,t,i,o));const N=this.isVideoContiguous;let L=-1,M;if(C&&(L=Moe(t.samples),!N&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,L>0){this.warn(`Dropped ${L} out of ${w} video samples due to a missing keyframe`);const G=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(L),t.dropped+=L,v+=(t.samples[0].pts-G)/t.inputTimeScale,M=v}else L===-1&&(this.warn(`No keyframe found out of ${w} video samples`),p=!1);if(this.ISGenerated){if(b&&C){const G=this.getVideoStartPts(t.samples),$=(Bs(e.samples[0].pts,G)-G)/t.inputTimeScale;y+=Math.max(0,$),v+=Math.max(0,-$)}if(b){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),h=this.generateIS(e,t,i,o)),d=this.remuxAudio(e,y,this.isAudioContiguous,o,E||C||l===de.AUDIO?v:void 0),C){const G=d?d.endPTS-d.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),h=this.generateIS(e,t,i,o)),c=this.remuxVideo(t,v,N,G)}}else C&&(c=this.remuxVideo(t,v,N,0));c&&(c.firstKeyFrame=L,c.independent=L!==-1,c.firstKeyFramePTS=M)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(m=SV(s,i,this._initPTS,this._initDTS)),r.samples.length&&(f=_V(r,i,this._initPTS))),{audio:d,video:c,initSegment:h,independent:p,text:f,id3:m}}computeInitPts(e,t,s,r){const i=Math.round(s*t);let o=Bs(e,i);if(o<i+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(i-o)/t} ${r}`);o<i+t;)o+=8589934592;return o-i}generateIS(e,t,s,r){const i=e.samples,o=t.samples,a=this.typeSupported,l={},c=this._initPTS;let d=!c||r,h="audio/mp4",f,m,p,y=-1;if(d&&(f=m=1/0),e.config&&i.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(h="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:h,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):H.initSegment([e]),metadata:{channelCount:e.channelCount}},d&&(y=e.id,p=e.inputTimeScale,!c||p!==c.timescale?f=m=this.computeInitPts(i[0].pts,p,s,"audio"):d=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:H.initSegment([t]),metadata:{width:t.width,height:t.height}},d)if(y=t.id,p=t.inputTimeScale,!c||p!==c.timescale){const v=this.getVideoStartPts(o),x=Bs(o[0].dts,v),E=this.computeInitPts(x,p,s,"video"),w=this.computeInitPts(v,p,s,"video");m=Math.min(m,E),f=Math.min(f,w)}else d=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,d?(c&&this.warn(`Timestamps at playlist time: ${r?"":"~"}${s} ${f/p} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${f/p} (${f}/${p}) trackId: ${y}`),this._initPTS={baseTime:f,timescale:p,trackId:y},this._initDTS={baseTime:m,timescale:p,trackId:y}):f=p=void 0,{tracks:l,initPTS:f,timescale:p,trackId:y}}remuxVideo(e,t,s,r){const i=e.inputTimeScale,o=e.samples,a=[],l=o.length,c=this._initPTS,d=c.baseTime*i/c.timescale;let h=this.nextVideoTs,f=8,m=this.videoSampleDuration,p,y,v=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,E=!1;if(!s||h===null){const Y=d+t*i,J=o[0].pts-Bs(o[0].dts,o[0].pts);Fc&&h!==null&&Math.abs(Y-J-(h+d))<15e3?s=!0:h=Y-J-d}const w=h+d;for(let Y=0;Y<l;Y++){const J=o[Y];J.pts=Bs(J.pts,w),J.dts=Bs(J.dts,w),J.dts<o[Y>0?Y-1:Y].dts&&(E=!0)}E&&o.sort(function(Y,J){const ae=Y.dts-J.dts,he=Y.pts-J.pts;return ae||he}),p=o[0].dts,y=o[o.length-1].dts;const b=y-p,C=b?Math.round(b/(l-1)):m||e.inputTimeScale/30;if(s){const Y=p-w,J=Y>C,ae=Y<-1;if((J||ae)&&(J?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ph(Y,!0)} ms (${Y}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ph(-Y,!0)} ms (${Y}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!ae||w>=o[0].pts||Fc)){p=w;const he=o[0].pts-Y;if(J)o[0].dts=p,o[0].pts=he;else{let ve=!0;for(let ge=0;ge<o.length&&!(o[ge].dts>he&&ve);ge++){const re=o[ge].pts;if(o[ge].dts-=Y,o[ge].pts-=Y,ge<o.length-1){const Ee=o[ge+1].pts,xe=o[ge].pts,Ne=Ee<=xe,Le=Ee<=re;ve=Ne==Le}}}this.log(`Video: Initial PTS/DTS adjusted: ${ph(he,!0)}/${ph(p,!0)}, delta: ${ph(Y,!0)} ms`)}}p=Math.max(0,p);let D=0,_=0,S=p;for(let Y=0;Y<l;Y++){const J=o[Y],ae=J.units,he=ae.length;let ve=0;for(let ge=0;ge<he;ge++)ve+=ae[ge].data.length;_+=ve,D+=he,J.length=ve,J.dts<S?(J.dts=S,S+=C/4|0||1):S=J.dts,v=Math.min(J.pts,v),x=Math.max(J.pts,x)}y=o[l-1].dts;const I=_+4*D+8;let R;try{R=new Uint8Array(I)}catch(Y){this.observer.emit(P.ERROR,P.ERROR,{type:Te.MUX_ERROR,details:W.REMUX_ALLOC_ERROR,fatal:!1,error:Y,bytes:I,reason:`fail allocating video mdat ${I}`});return}const N=new DataView(R.buffer);N.setUint32(0,I),R.set(H.types.mdat,4);let L=!1,M=Number.POSITIVE_INFINITY,G=Number.POSITIVE_INFINITY,V=Number.NEGATIVE_INFINITY,$=Number.NEGATIVE_INFINITY;for(let Y=0;Y<l;Y++){const J=o[Y],ae=J.units;let he=0;for(let re=0,Ee=ae.length;re<Ee;re++){const xe=ae[re],Ne=xe.data,Le=xe.data.byteLength;N.setUint32(f,Le),f+=4,R.set(Ne,f),f+=Le,he+=4+Le}let ve;if(Y<l-1)m=o[Y+1].dts-J.dts,ve=o[Y+1].pts-J.pts;else{const re=this.config,Ee=Y>0?J.dts-o[Y-1].dts:C;if(ve=Y>0?J.pts-o[Y-1].pts:C,re.stretchShortVideoTrack&&this.nextAudioTs!==null){const xe=Math.floor(re.maxBufferHole*i),Ne=(r?v+r*i:this.nextAudioTs+d)-J.pts;Ne>xe?(m=Ne-Ee,m<0?m=Ee:L=!0,this.log(`It is approximately ${Ne/90} ms to the next segment; using duration ${m/90} ms for the last video frame.`)):m=Ee}else m=Ee}const ge=Math.round(J.pts-J.dts);M=Math.min(M,m),V=Math.max(V,m),G=Math.min(G,ve),$=Math.max($,ve),a.push(ik(J.key,m,he,ge))}if(a.length){if(Fc){if(Fc<70){const Y=a[0].flags;Y.dependsOn=2,Y.isNonSync=0}}else if($x&&$-G<V-M&&C/V<.025&&a[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let Y=p;for(let J=0,ae=a.length;J<ae;J++){const he=Y+a[J].duration,ve=Y+a[J].cts;if(J<ae-1){const ge=he+a[J+1].cts;a[J].duration=ge-ve}else a[J].duration=J?a[J-1].duration:C;a[J].cts=0,Y=he}}}m=L||!m?C:m;const F=y+m;this.nextVideoTs=h=F-d,this.videoSampleDuration=m,this.isVideoContiguous=!0;const X={data1:H.moof(e.sequenceNumber++,p,Et(e,{samples:a})),data2:R,startPTS:(v-d)/i,endPTS:(x+m-d)/i,startDTS:(p-d)/i,endDTS:h/i,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,X}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return Loe;case"ac3":return Doe;default:return Noe}}remuxAudio(e,t,s,r,i){const o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,l=o/a,c=this.getSamplesPerFrame(e),d=c*l,h=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,m=[],p=i!==void 0;let y=e.samples,v=f?0:8,x=this.nextAudioTs||-1;const E=h.baseTime*o/h.timescale,w=E+t*o;if(this.isAudioContiguous=s=s||y.length&&x>0&&(r&&Math.abs(w-(x+E))<9e3||Math.abs(Bs(y[0].pts,w)-(x+E))<20*d),y.forEach(function($){$.pts=Bs($.pts,w)}),!s||x<0){const $=y.length;if(y=y.filter(F=>F.pts>=0),$!==y.length&&this.warn(`Removed ${y.length-$} of ${$} samples (initPTS ${E} / ${o})`),!y.length)return;i===0?x=0:r&&!p?x=Math.max(0,w-E):x=y[0].pts-E}if(e.segmentCodec==="aac"){const $=this.config.maxAudioFramesDrift;for(let F=0,j=x+E;F<y.length;F++){const U=y[F],X=U.pts,Y=X-j,J=Math.abs(1e3*Y/o);if(Y<=-$*d&&p)F===0&&(this.warn(`Audio frame @ ${(X/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*Y/o)} ms.`),this.nextAudioTs=x=X-E,j=X);else if(Y>=$*d&&J<koe&&p){let ae=Math.round(Y/d);for(j=X-ae*d;j<0&&ae&&d;)ae--,j+=d;F===0&&(this.nextAudioTs=x=j-E),this.warn(`Injecting ${ae} audio frames @ ${((j-E)/o).toFixed(3)}s due to ${Math.round(1e3*Y/o)} ms gap.`);for(let he=0;he<ae;he++){let ve=Roe.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ve||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ve=U.unit.subarray()),y.splice(F,0,{unit:ve,pts:j}),j+=d,F++}}U.pts=j,j+=d}}let b=null,C=null,D,_=0,S=y.length;for(;S--;)_+=y[S].unit.byteLength;for(let $=0,F=y.length;$<F;$++){const j=y[$],U=j.unit;let X=j.pts;if(C!==null){const J=m[$-1];J.duration=Math.round((X-C)/l)}else if(s&&e.segmentCodec==="aac"&&(X=x+E),b=X,_>0){_+=v;try{D=new Uint8Array(_)}catch(J){this.observer.emit(P.ERROR,P.ERROR,{type:Te.MUX_ERROR,details:W.REMUX_ALLOC_ERROR,fatal:!1,error:J,bytes:_,reason:`fail allocating audio mdat ${_}`});return}f||(new DataView(D.buffer).setUint32(0,_),D.set(H.types.mdat,4))}else return;D.set(U,v);const Y=U.byteLength;v+=Y,m.push(ik(!0,c,Y,0)),C=X}const I=m.length;if(!I)return;const R=m[m.length-1];x=C-E,this.nextAudioTs=x+l*R.duration;const N=f?new Uint8Array(0):H.moof(e.sequenceNumber++,b/l,Et({},e,{samples:m}));e.samples=[];const L=(b-E)/o,M=this.nextAudioTs/o,V={data1:N,data2:D,startPTS:L,endPTS:M,startDTS:L,endDTS:M,type:"audio",hasAudio:!0,hasVideo:!1,nb:I};return this.isAudioContiguous=!0,V}}function Bs(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function Moe(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function SV(n,e,t,s){const r=n.samples.length;if(!r)return;const i=n.inputTimeScale;for(let a=0;a<r;a++){const l=n.samples[a];l.pts=Bs(l.pts-t.baseTime*i/t.timescale,e*i)/i,l.dts=Bs(l.dts-s.baseTime*i/s.timescale,e*i)/i}const o=n.samples;return n.samples=[],{samples:o}}function _V(n,e,t){const s=n.samples.length;if(!s)return;const r=n.inputTimeScale;for(let o=0;o<s;o++){const a=n.samples[o];a.pts=Bs(a.pts-t.baseTime*r/t.timescale,e*r)/r}n.samples.sort((o,a)=>o.pts-a.pts);const i=n.samples;return n.samples=[],{samples:i}}class Ooe extends Tr{constructor(e,t,s,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,s,r){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment(e,r),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:s,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:i,video:o}=this.initData=kU(e);if(t)bre(e,t);else{const l=i||o;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}i&&(s=ok(i,bt.AUDIO,this)),o&&(r=ok(o,bt.VIDEO,this));const a={};i&&o?a.audiovideo={container:"video/mp4",codec:s+","+r,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:i?a.audio={container:"audio/mp4",codec:s,encrypted:i.encrypted,initSegment:e,id:"audio"}:o?a.video={container:"video/mp4",codec:r,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(e,t,s,r,i,o){var a,l;let{initPTS:c,lastEndTime:d}=this;const h={audio:void 0,video:void 0,text:r,id3:s,initSegment:void 0};le(d)||(d=this.lastEndTime=i||0);const f=t.samples;if(!f.length)return h;const m={initPTS:void 0,timescale:void 0,trackId:void 0};let p=this.initData;if((a=p)!=null&&a.length||(this.generateInitSegment(f),p=this.initData),!((l=p)!=null&&l.length))return this.warn("Failed to generate initSegment."),h;this.emitInitSegment&&(m.tracks=this.initTracks,this.emitInitSegment=!1);const y=_re(f,p,this),v=p.audio?y[p.audio.id]:null,x=p.video?y[p.video.id]:null,E=Ap(x,1/0),w=Ap(v,1/0),b=Ap(x,0,!0),C=Ap(v,0,!0);let D=i,_=0;const S=v&&(!x||!c&&w<E||c&&c.trackId===p.audio.id),I=S?v:x;if(I){const j=I.timescale,U=I.start-i*j,X=S?p.audio.id:p.video.id;D=I.start/j,_=S?C-w:b-E,(o||!c)&&(joe(c,D,i,_)||j!==c.timescale)&&(c&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${i} ${U/j} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${D-i} (${U}/${j}) trackId: ${X}`),c=null,m.initPTS=U,m.timescale=j,m.trackId=X)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${i}`);c?(m.initPTS=c.baseTime,m.timescale=c.timescale,m.trackId=c.trackId):((!m.timescale||m.trackId===void 0||m.initPTS===void 0)&&(this.warn("Could not set initPTS"),m.initPTS=D,m.timescale=1,m.trackId=-1),this.initPTS=c={baseTime:m.initPTS,timescale:m.timescale,trackId:m.trackId});const R=D-c.baseTime/c.timescale,N=R+_;_>0?this.lastEndTime=N:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const L=!!p.audio,M=!!p.video;let G="";L&&(G+="audio"),M&&(G+="video");const V=(p.audio?p.audio.encrypted:!1)||(p.video?p.video.encrypted:!1),$={data1:f,startPTS:R,startDTS:R,endPTS:N,endDTS:N,type:G,hasAudio:L,hasVideo:M,nb:1,dropped:0,encrypted:V};h.audio=L&&!M?$:void 0,h.video=M?$:void 0;const F=x==null?void 0:x.sampleCount;if(F){const j=x.keyFrameIndex,U=j!==-1;$.nb=F,$.dropped=j===0||this.isVideoContiguous?0:U?j:F,$.independent=U,$.firstKeyFrame=j,U&&x.keyFrameStart&&($.firstKeyFramePTS=(x.keyFrameStart-c.baseTime)/c.timescale),this.isVideoContiguous||(h.independent=U),this.isVideoContiguous||(this.isVideoContiguous=U),$.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${j}/${F} dropped: ${$.dropped} start: ${$.firstKeyFramePTS||"NA"}`)}return h.initSegment=m,h.id3=SV(s,i,c,c),r.samples.length&&(h.text=_V(r,i,c)),h}}function Ap(n,e,t=!1){return(n==null?void 0:n.start)!==void 0?(n.start+(t?n.duration:0))/n.timescale:e}function joe(n,e,t,s){if(n===null)return!0;const r=Math.max(s,1),i=e-n.baseTime/n.timescale;return Math.abs(i-t)>r}function ok(n,e,t){const s=n.codec;return s&&s.length>4?s:e===bt.AUDIO?s==="ec-3"||s==="ac-3"||s==="alac"?s:s==="fLaC"||s==="Opus"?A0(s,!1):(t.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"):(t.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1")}let Hi;try{Hi=self.performance.now.bind(self.performance)}catch{Hi=Date.now}const vg=[{demux:Toe,remux:Ooe},{demux:ea,remux:yg},{demux:voe,remux:yg},{demux:Eoe,remux:yg}];vg.splice(2,0,{demux:xoe,remux:yg});class ak{constructor(e,t,s,r,i,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.id=i,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,s,r){const i=s.transmuxing;i.executeStart=Hi();let o=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:l}=this;r&&(this.currentTransmuxState=r);const{contiguous:c,discontinuity:d,trackSwitch:h,accurateTimeOffset:f,timeOffset:m,initSegmentChange:p}=r||a,{audioCodec:y,videoCodec:v,defaultInitPts:x,duration:E,initSegmentData:w}=l,b=Foe(o,t);if(b&&_u(b.method)){const S=this.getDecrypter(),I=e_(b.method);if(S.isSync()){let R=S.softwareDecrypt(o,b.key.buffer,b.iv.buffer,I);if(s.part>-1){const L=S.flush();R=L&&L.buffer}if(!R)return i.executeEnd=Hi(),Bx(s);o=new Uint8Array(R)}else return this.asyncResult=!0,this.decryptionPromise=S.webCryptoDecrypt(o,b.key.buffer,b.iv.buffer,I).then(R=>{const N=this.push(R,null,s);return this.decryptionPromise=null,N}),this.decryptionPromise}const C=this.needsProbing(d,h);if(C){const S=this.configureTransmuxer(o);if(S)return this.logger.warn(`[transmuxer] ${S.message}`),this.observer.emit(P.ERROR,P.ERROR,{type:Te.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,fatal:!1,error:S,reason:S.message}),i.executeEnd=Hi(),Bx(s)}(d||h||p||C)&&this.resetInitSegment(w,y,v,E,t),(d||p||C)&&this.resetInitialTimestamp(x),c||this.resetContiguity();const D=this.transmux(o,b,m,f,s);this.asyncResult=Vf(D);const _=this.currentTransmuxState;return _.contiguous=!0,_.discontinuity=!1,_.trackSwitch=!1,i.executeEnd=Hi(),D}flush(e){const t=e.transmuxing;t.executeStart=Hi();const{decrypter:s,currentTransmuxState:r,decryptionPromise:i}=this;if(i)return this.asyncResult=!0,i.then(()=>this.flush(e));const o=[],{timeOffset:a}=r;if(s){const h=s.flush();h&&o.push(this.push(h.buffer,null,e))}const{demuxer:l,remuxer:c}=this;if(!l||!c){t.executeEnd=Hi();const h=[Bx(e)];return this.asyncResult?Promise.resolve(h):h}const d=l.flush(a);return Vf(d)?(this.asyncResult=!0,d.then(h=>(this.flushRemux(o,h,e),o))):(this.flushRemux(o,d,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,s){const{audioTrack:r,videoTrack:i,id3Track:o,textTrack:a}=t,{accurateTimeOffset:l,timeOffset:c}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===de.MAIN?"level":"track"} ${s.level}`);const d=this.remuxer.remux(r,i,o,a,c,l,!0,this.id);e.push({remuxResult:d,chunkMeta:s}),s.transmuxing.executeEnd=Hi()}resetInitialTimestamp(e){const{demuxer:t,remuxer:s}=this;!t||!s||(t.resetTimeStamp(e),s.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,s,r,i){const{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,t,s,r),a.resetInitSegment(e,t,s,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,s,r,i){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,s,r,i):o=this.transmuxUnencrypted(e,s,r,i),o}transmuxUnencrypted(e,t,s,r){const{audioTrack:i,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,o,a,l,t,s,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,s,r,i){return this.demuxer.demuxSampleAes(e,t,s).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,s,r,!1,this.id),chunkMeta:i}))}configureTransmuxer(e){const{config:t,observer:s,typeSupported:r}=this;let i;for(let h=0,f=vg.length;h<f;h++){var o;if((o=vg[h].demux)!=null&&o.probe(e,this.logger)){i=vg[h];break}}if(!i)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,l=this.remuxer,c=i.remux,d=i.demux;(!l||!(l instanceof c))&&(this.remuxer=new c(s,t,r,this.logger)),(!a||!(a instanceof d))&&(this.demuxer=new d(s,t,r,this.logger),this.probe=d.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new J1(this.config)),e}}function Foe(n,e){let t=null;return n.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Bx=n=>({remuxResult:{},chunkMeta:n});function Vf(n){return"then"in n&&n.then instanceof Function}class Uoe{constructor(e,t,s,r,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=r,this.defaultInitPts=i||null}}class Voe{constructor(e,t,s,r,i,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=r,this.timeOffset=i,this.initSegmentChange=o}}let lk=0;class AV{constructor(e,t,s,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=lk++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const c=l.data,d=this.hls;if(!(!d||!(c!=null&&c.event)||c.instanceNo!==this.instanceNo))switch(c.event){case"init":{var h;const f=(h=this.workerContext)==null?void 0:h.objectURL;f&&self.URL.revokeObjectURL(f);break}case"transmuxComplete":{this.handleTransmuxComplete(c.data);break}case"flush":{this.onFlush(c.data);break}case"workerLog":{d.logger[c.data.logType]&&d.logger[c.data.logType](c.data.message);break}default:{c.data=c.data||{},c.data.frag=this.frag,c.data.part=this.part,c.data.id=this.id,d.trigger(c.event,c.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const c=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(P.ERROR,{type:Te.OTHER_ERROR,details:W.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})};const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=s,this.onFlush=r;const o=(l,c)=>{c=c||{},c.frag=this.frag||void 0,l===P.ERROR&&(c=c,c.parent=this.id,c.part=this.part,this.error=c.error),this.hls.trigger(l,c)};this.observer=new s_,this.observer.on(P.FRAG_DECRYPTED,o),this.observer.on(P.ERROR,o);const a=bP(i.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(i.workerPath||Kie()){try{i.workerPath?(l.log(`loading Web Worker ${i.workerPath} for "${t}"`),this.workerContext=Wie(i.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=Hie());const{worker:d}=this.workerContext;d.addEventListener("message",this.onWorkerMessage),d.addEventListener("error",this.onWorkerError),d.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:St(i)})}catch(d){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,d),this.terminateWorker(),this.error=null,this.transmuxer=new ak(this.observer,a,i,"",t,e.logger)}return}}this.transmuxer=new ak(this.observer,a,i,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=lk++;const t=this.hls.config,s=bP(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:s,id:this.id,config:St(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),zie(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,s,r,i,o,a,l,c,d){var h,f;c.transmuxing.start=self.performance.now();const{instanceNo:m,transmuxer:p}=this,y=o?o.start:i.start,v=i.decryptdata,x=this.frag,E=!(x&&i.cc===x.cc),w=!(x&&c.level===x.level),b=x?c.sn-x.sn:-1,C=this.part?c.part-this.part.index:-1,D=b===0&&c.id>1&&c.id===(x==null?void 0:x.stats.chunkCount),_=!w&&(b===1||b===0&&(C===1||D&&C<=0)),S=self.performance.now();(w||b||i.stats.parsing.start===0)&&(i.stats.parsing.start=S),o&&(C||!_)&&(o.stats.parsing.start=S);const I=!(x&&((h=i.initSegment)==null?void 0:h.url)===((f=x.initSegment)==null?void 0:f.url)),R=new Voe(E,_,l,w,y,I);if(!_||E||I){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${i.type} sn: ${c.sn}${c.part>-1?" part: "+c.part:""} ${this.id===de.MAIN?"level":"track"}: ${c.level} id: ${c.id}
        discontinuity: ${E}
        trackSwitch: ${w}
        contiguous: ${_}
        accurateTimeOffset: ${l}
        timeOffset: ${y}
        initSegmentChange: ${I}`);const N=new Uoe(s,r,t,a,d);this.configureTransmuxer(N)}if(this.frag=i,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:m,cmd:"demux",data:e,decryptdata:v,chunkMeta:c,state:R},e instanceof ArrayBuffer?[e]:[]);else if(p){const N=p.push(e,v,c,R);Vf(N)?N.then(L=>{this.handleTransmuxComplete(L)}).catch(L=>{this.transmuxerError(L,c,"transmuxer-interface push error")}):this.handleTransmuxComplete(N)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(s){const r=s.flush(e);Vf(r)?r.then(i=>{this.handleFlushResult(i,e)}).catch(i=>{this.transmuxerError(i,e,"transmuxer-interface flush error")}):this.handleFlushResult(r,e)}}transmuxerError(e,t,s){this.hls&&(this.error=e,this.hls.trigger(P.ERROR,{type:Te.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:s}))}handleFlushResult(e,t){e.forEach(s=>{this.handleTransmuxComplete(s)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):s&&s.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const ck=100;class $oe extends n_{constructor(e,t,s){super(e,t,s,"audio-stream-controller",de.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(P.LEVEL_LOADED,this.onLevelLoaded,this),e.on(P.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(P.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(P.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(P.BUFFER_RESET,this.onBufferReset,this),e.on(P.BUFFER_CREATED,this.onBufferCreated,this),e.on(P.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(P.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(P.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(P.FRAG_LOADING,this.onFragLoading,this),e.on(P.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(P.LEVEL_LOADED,this.onLevelLoaded,this),e.off(P.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(P.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(P.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(P.BUFFER_RESET,this.onBufferReset,this),e.off(P.BUFFER_CREATED,this.onBufferCreated,this),e.off(P.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(P.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(P.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(P.FRAG_LOADING,this.onFragLoading,this),e.off(P.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:s,initPTS:r,timescale:i,trackId:o}){if(s===de.MAIN){const a=t.cc,l=this.fragCurrent;if(this.initPTS[a]={baseTime:r,timescale:i,trackId:o},this.log(`InitPTS for cc: ${a} found from main: ${r/i} (${r}/${i}) trackId: ${o}`),this.mainAnchor=t,this.state===Z.WAITING_INIT_PTS){const c=this.waitingData;(!c&&!this.loadingParts||c&&c.frag.cc!==a)&&this.syncWithAnchor(t,c==null?void 0:c.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==a?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===Z.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var s;const r=((s=this.mainFragLoading)==null?void 0:s.frag)||null;if(t&&(r==null?void 0:r.cc)===t.cc)return;const i=(r||e).cc,o=this.getLevelDetails(),a=this.getLoadPosition(),l=BU(o,i,a);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===Z.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=Z.STOPPED;return}const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(ck),s>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s,this.state=Z.IDLE):this.state=Z.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case Z.IDLE:this.doTickIdle();break;case Z.WAITING_TRACK:{const{levels:e,trackId:t}=this,s=e==null?void 0:e[t],r=s==null?void 0:s.details;if(r&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(r))break;this.state=Z.WAITING_INIT_PTS}break}case Z.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case Z.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:s,cache:r,complete:i}=e,o=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=Z.FRAG_LOADING;const a=r.flush().buffer,l={frag:t,part:s,payload:a,networkDetails:null};this._handleFragmentLoadProgress(l),i&&super._handleFragmentLoadComplete(l)}else o&&o.cc!==e.frag.cc&&this.syncWithAnchor(o,e.frag)}else this.state=Z.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:s,media:r,trackId:i}=this,o=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(s!=null&&s[i]))return;const a=s[i],l=a.details;if(!l||this.waitForLive(a)||this.waitForCdnTuneIn(l)){this.state=Z.WAITING_TRACK,this.startFragRequested=!1;return}const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,bt.AUDIO,de.AUDIO));const d=this.getFwdBufferInfo(c,de.AUDIO);if(d===null)return;if(!this.switchingTrack&&this._streamEnded(d,l)){t.trigger(P.BUFFER_EOS,{type:"audio"}),this.state=Z.ENDED;return}const h=d.len,f=t.maxBufferLength,m=l.fragments,p=m[0].start,y=this.getLoadPosition(),v=this.flushing?y:d.end;if(this.switchingTrack&&r){const w=y;l.PTSKnown&&w<p&&(d.end>p||d.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=p+.05)}if(h>=f&&!this.switchingTrack&&v<m[m.length-1].start)return;let x=this.getNextFragment(v,l);if(x&&this.isLoopLoading(x,v)&&(x=this.getNextFragmentLoopLoading(x,l,d,de.MAIN,f)),!x){this.bufferFlushed=!0;return}let E=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&E&&sn(x)&&!x.endList&&(!l.live||!this.loadingParts&&v<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(E)===xn.OK&&(this.mainFragLoading=E=null),E&&sn(E))){if(x.start>E.end){const b=this.fragmentTracker.getFragAtPos(v,de.MAIN);b&&b.end>E.end&&(E=b,this.mainFragLoading={frag:b,targetBufferTime:null})}if(x.start>E.end)return}this.loadFragment(x,a,v)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(s=>new jf(s))}onAudioTrackSwitching(e,t){const s=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),s?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==Z.STOPPED&&(this.setInterval(ck),this.state=Z.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(P.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(e,t){var s;const{levels:r}=this,{details:i,id:o,groupId:a,track:l}=t;if(!r){this.warn(`Audio tracks reset while loading track ${o} "${l.name}" of "${a}"`);return}const c=this.mainDetails;if(!c||i.endCC>c.endCC||c.expired){this.cachedTrackLoadedData=t,this.state!==Z.STOPPED&&(this.state=Z.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${l.name}" of "${a}" loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const d=r[o];let h=0;if(i.live||(s=d.details)!=null&&s.live){if(this.checkLiveUpdate(i),i.deltaUpdateFailed)return;if(d.details){var f;h=this.alignPlaylists(i,d.details,(f=this.levelLastLoaded)==null?void 0:f.details)}i.alignedSliding||(oV(i,c),i.alignedSliding||L0(i,c),h=i.fragmentStart)}d.details=i,this.levelLastLoaded=d,this.startFragRequested||this.setStartPosition(c,h),this.hls.trigger(P.AUDIO_TRACK_UPDATED,{details:i,id:o,groupId:t.groupId}),this.state===Z.WAITING_TRACK&&!this.waitForCdnTuneIn(i)&&(this.state=Z.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:r,payload:i}=e,{config:o,trackId:a,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const c=l[a];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const d=c.details;if(!d){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(s.start);return}const h=o.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new AV(this.hls,de.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const m=this.initPTS[s.cc],p=(t=s.initSegment)==null?void 0:t.data;if(m!==void 0){const v=r?r.index:-1,x=v!==-1,E=new Z1(s.level,s.sn,s.stats.chunkCount,i.byteLength,v,x);f.push(i,p,h,"",s,r,d.totalduration,!1,E,m)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${d.startSN} ,${d.endSN}],track ${a}`);const{cache:y}=this.waitingData=this.waitingData||{frag:s,part:r,cache:new aV,complete:!1};y.push(new Uint8Array(i)),this.state!==Z.STOPPED&&(this.state=Z.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===de.MAIN&&sn(t.frag)&&(this.mainFragLoading=t,this.state===Z.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:s,part:r}=t;if(s.type!==de.AUDIO){!this.audioOnly&&s.type===de.MAIN&&!s.elementaryStreams.video&&!s.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${r?" p: "+r.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(sn(s)){this.fragPrevious=s;const i=this.switchingTrack;i&&(this.bufferedTrack=i,this.switchingTrack=null,this.hls.trigger(P.AUDIO_TRACK_SWITCHED,ft({},i)))}this.fragBufferedComplete(s,r),this.media&&this.tick()}onError(e,t){var s;if(t.fatal){this.state=Z.ERROR;return}switch(t.details){case W.FRAG_GAP:case W.FRAG_PARSING_ERROR:case W.FRAG_DECRYPT_ERROR:case W.FRAG_LOAD_ERROR:case W.FRAG_LOAD_TIMEOUT:case W.KEY_LOAD_ERROR:case W.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(de.AUDIO,t);break;case W.AUDIO_TRACK_LOAD_ERROR:case W.AUDIO_TRACK_LOAD_TIMEOUT:case W.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===Z.WAITING_TRACK&&((s=t.context)==null?void 0:s.type)===We.AUDIO_TRACK&&(this.state=Z.IDLE);break;case W.BUFFER_ADD_CODEC_ERROR:case W.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case W.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case W.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==bt.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==bt.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===Z.ENDED&&(this.state=Z.IDLE);const s=this.mediaBuffer||this.media;s&&(this.afterBufferFlushed(s,t,de.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const s="audio",{hls:r}=this,{remuxResult:i,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:c,level:d}=a,{details:h}=d,{audio:f,text:m,id3:p,initSegment:y}=i;if(this.fragContextChanged(l)||!h){this.fragmentTracker.removeFragment(l);return}if(this.state=Z.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),y!=null&&y.tracks){const v=l.initSegment||l;if(this.unhandledEncryptionError(y,l))return;this._bufferInitSegment(d,y.tracks,v,o),r.trigger(P.FRAG_PARSING_INIT_SEGMENT,{frag:v,id:s,tracks:y.tracks})}if(f){const{startPTS:v,endPTS:x,startDTS:E,endDTS:w}=f;c&&(c.elementaryStreams[bt.AUDIO]={startPTS:v,endPTS:x,startDTS:E,endDTS:w}),l.setElementaryStreamInfo(bt.AUDIO,v,x,E,w),this.bufferFragmentData(f,l,c,o)}if(p!=null&&(t=p.samples)!=null&&t.length){const v=Et({id:s,frag:l,details:h},p);r.trigger(P.FRAG_PARSING_METADATA,v)}if(m){const v=Et({id:s,frag:l,details:h},m);r.trigger(P.FRAG_PARSING_USERDATA,v)}}_bufferInitSegment(e,t,s,r){if(this.state!==Z.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const i=t.audio;i.id=de.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${i.container}, codecs[level/parsed]=[${o}/${i.codec}]`),o&&o.split(",").length===1&&(i.levelCodec=o),this.hls.trigger(P.BUFFER_CODECS,t);const a=i.initSegment;if(a!=null&&a.byteLength){const l={type:"audio",frag:s,part:null,chunkMeta:r,parent:s.type,data:a};this.hls.trigger(P.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,s){const r=this.fragmentTracker.getState(e);if(this.switchingTrack||r===xn.NOT_LOADED||r===xn.PARTIAL){var i;if(!sn(e))this._loadInitSegment(e,t);else if((i=t.details)!=null&&i.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=Z.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&L0(t.details,o)}else super.loadFragment(e,t,s)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:s,assocLang:r,characteristics:i,audioCodec:o,channels:a}=this.bufferedTrack;Bl({name:t,lang:s,assocLang:r,characteristics:i,audioCodec:o,channels:a},e,xl)||(R0(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(P.AUDIO_TRACK_SWITCHED,ft({},e))}}class u_ extends Tr{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,s){const r=t==null?void 0:t.renditionReports;if(r){let i=-1;for(let o=0;o<r.length;o++){const a=r[o];let l;try{l=new self.URL(a.URI,t.url).href}catch(c){this.warn(`Could not construct new URL for Rendition Report: ${c}`),l=a.URI||""}if(l===e){i=o;break}else l===e.substring(0,l.length)&&(i=o)}if(i!==-1){const o=r[i],a=parseInt(o["LAST-MSN"])||t.lastPartSn;let l=parseInt(o["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const d=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&d>t.partTarget&&(l+=1)}const c=s&&SP(s);return new _P(a,l>=0?l:void 0,c)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}return e}playlistLoaded(e,t,s){const{details:r,stats:i}=t,o=self.performance.now(),a=i.loading.first?Math.max(0,o-i.loading.first):0;r.advancedDateTime=Date.now()-a;const l=this.hls.config.timelineOffset;if(l!==r.appliedTimelineOffset){const d=Math.max(l||0,0);r.appliedTimelineOffset=d,r.fragments.forEach(h=>{h.setStart(h.playlistOffset+d)})}if(r.live||s!=null&&s.live){const d="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(s),s&&r.fragments.length>0){Lie(s,r,this);const E=r.playlistParsingError;if(E){this.warn(E);const w=this.hls;if(!w.config.ignorePlaylistParsingErrors){var c;const{networkDetails:b}=t;w.trigger(P.ERROR,{type:Te.NETWORK_ERROR,details:W.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:E,reason:E.message,level:t.level||void 0,parent:(c=r.fragments[0])==null?void 0:c.type,networkDetails:b,stats:i});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=i.loading.start);const h=this.hls.mainForwardBufferInfo,f=h?h.end-h.len:0,m=(r.edge-f)*1e3,p=tV(r,m);if(r.requestScheduled+p<o?r.requestScheduled=o:r.requestScheduled+=p,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let y,v,x;if(r.canBlockReload&&r.endSN&&r.advanced){const E=this.hls.config.lowLatencyMode,w=r.lastPartSn,b=r.endSN,C=r.lastPartIndex,D=C!==-1,_=w===b;D?_?(v=b+1,x=E?0:C):(v=w,x=E?C+1:r.maxPartIndex):v=b+1;const S=r.age,I=S+r.ageHeader;let R=Math.min(I-r.partTarget,r.targetduration*1.5);if(R>0){if(I>r.targetduration*3)this.log(`Playlist last advanced ${S.toFixed(2)}s ago. Omitting segment and part directives.`),v=void 0,x=void 0;else if(s!=null&&s.tuneInGoal&&I-r.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${R} with playlist age: ${r.age}`),R=0;else{const N=Math.floor(R/r.targetduration);if(v+=N,x!==void 0){const L=Math.round(R%r.targetduration/r.partTarget);x+=L}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${S.toFixed(2)}s goal: ${R} skip sn ${N} to part ${x}`)}r.tuneInGoal=R}if(y=this.getDeliveryDirectives(r,t.deliveryDirectives,v,x),E||!_){r.requestScheduled=o,this.loadingPlaylist(d,y);return}}else(r.canBlockReload||r.canSkipUntil)&&(y=this.getDeliveryDirectives(r,t.deliveryDirectives,v,x));y&&v!==void 0&&r.canBlockReload&&(r.requestScheduled=i.loading.first+Math.max(p-a*2,p/2)),this.scheduleLoading(d,y,r)}else this.clearTimer()}scheduleLoading(e,t,s){const r=s||e.details;if(!r){this.loadingPlaylist(e,t);return}const i=self.performance.now(),o=r.requestScheduled;if(i>=o){this.loadingPlaylist(e,t);return}const a=o-i;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,s,r){let i=SP(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,r=t.part,i=pg.No),new _P(s,r,i)}checkRetry(e){const t=e.details,s=C0(e),r=e.errorAction,{action:i,retryCount:o=0,retryConfig:a}=r||{},l=!!r&&!!a&&(i===Ln.RetryRequest||!r.resolved&&i===Ln.SendAlternateToPenaltyBox);if(l){var c;if(o>=a.maxNumRetry)return!1;if(s&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const d=X1(a,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),d),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" in ${d}ms`)}e.levelRetry=!0,r.resolved=!0}return l}}function IV(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!$f(n[t].attrs,e[t].attrs))return!1;return!0}function $f(n,e,t){const s=n["STABLE-RENDITION-ID"];return s&&!t?s===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>n[r]!==e[r])}function bT(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class Boe extends u_{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.MANIFEST_PARSED,this.onManifestParsed,this),e.on(P.LEVEL_LOADING,this.onLevelLoading,this),e.on(P.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(P.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(P.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.MANIFEST_PARSED,this.onManifestParsed,this),e.off(P.LEVEL_LOADING,this.onLevelLoading,this),e.off(P.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(P.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(P.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:s,groupId:r,details:i}=t,o=this.tracksInGroup[s];if(!o||o.groupId!==r){this.warn(`Audio track with id:${s} and group:${r} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Audio track ${s} "${o.name}" lang:${o.lang} group:${r} loaded [${i.startSN}-${i.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,r=this.groupIds;let i=this.currentTrack;if(!s||(r==null?void 0:r.length)!==(s==null?void 0:s.length)||s!=null&&s.some(a=>(r==null?void 0:r.indexOf(a))===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(f=>!s||s.indexOf(f.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(f=>f.default)&&(this.selectDefaultTrack=!1),a.forEach((f,m)=>{f.id=m});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const l=this.hls.config.audioPreference;if(!i&&l){const f=ci(l,a,xl);if(f>-1)i=a[f];else{const m=ci(l,this.tracks);i=this.tracks[m]}}let c=this.findTrackId(i);c===-1&&i&&(c=this.findTrackId(null));const d={audioTracks:a};this.log(`Updating audio tracks, ${a.length} track(s) found in group(s): ${s==null?void 0:s.join(",")}`),this.hls.trigger(P.AUDIO_TRACKS_UPDATED,d);const h=this.trackId;if(c!==-1&&h===-1)this.setAudioTrack(c);else if(a.length&&h===-1){var o;const f=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${a.length}`);this.warn(f.message),this.hls.trigger(P.ERROR,{type:Te.MEDIA_ERROR,details:W.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}}onError(e,t){t.fatal||!t.context||t.context.type===We.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const r=this.currentTrack;if(r&&Bl(e,r,xl))return r;const i=ci(e,this.tracksInGroup,xl);if(i>-1){const o=this.tracksInGroup[i];return this.setAudioTrack(i),o}else if(r){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const a=eie(e,t.levels,s,o,xl);if(a===-1)return null;t.nextLoadLevel=a}if(e.channels||e.audioCodec){const o=ci(e,s);if(o>-1)return s[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,r=t[e],i=r.details&&!r.details.live;if(e===this.trackId&&r===s&&i||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(P.AUDIO_TRACK_SWITCHING,ft({},r)),i))return;const o=this.switchParams(r.url,s==null?void 0:s.details,r.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const r=t[s];if(!(this.selectDefaultTrack&&!r.default)&&(!e||Bl(e,r,xl)))return s}if(e){const{name:s,lang:r,assocLang:i,characteristics:o,audioCodec:a,channels:l}=e;for(let c=0;c<t.length;c++){const d=t[c];if(Bl({name:s,lang:r,assocLang:i,characteristics:o,audioCodec:a,channels:l},d,xl))return c}for(let c=0;c<t.length;c++){const d=t[c];if($f(e.attrs,d.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const d=t[c];if($f(e.attrs,d.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&R0(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,r=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading audio-track ${s} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(P.AUDIO_TRACK_LOADING,{url:i,id:s,groupId:r,deliveryDirectives:t||null,track:e})}}class Goe{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,s){if(this.queues===null||this.tracks===null)return;const r=this.queues[t];r.push(e),r.length===1&&!s&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const s={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const s={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(s)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const s=(t=e[0])==null?void 0:t.label;(s==="async-blocker"||s==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(i){var s;if(r.onError(i),this.queues===null||this.tracks===null)return;const o=(s=this.tracks[e])==null?void 0:s.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,s;return(t=this.queues)!=null&&t[e]||(s=this.tracks)!=null&&s[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const s=(t=this.tracks)==null?void 0:t[e],r=s==null?void 0:s.buffer;return r?`SourceBuffer${r.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(s=>s.label).join(", "))||""}}const uk=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,RV="HlsJsTrackRemovedError";class Koe extends Error{constructor(e){super(e),this.name=RV}}class Hoe extends Tr{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=s=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=s=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=s=>{const{media:r,mediaSource:i}=this;s&&this.log("Media source opened"),!(!r||!i)&&(i.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(P.MEDIA_ATTACHED,{media:r,mediaSource:i}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:s,_objectUrl:r}=this;s!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${s})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=fre(za(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(P.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.MANIFEST_PARSED,this.onManifestParsed,this),e.on(P.BUFFER_RESET,this.onBufferReset,this),e.on(P.BUFFER_APPENDING,this.onBufferAppending,this),e.on(P.BUFFER_CODECS,this.onBufferCodecs,this),e.on(P.BUFFER_EOS,this.onBufferEos,this),e.on(P.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(P.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(P.FRAG_PARSED,this.onFragParsed,this),e.on(P.FRAG_CHANGED,this.onFragChanged,this),e.on(P.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(P.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.MANIFEST_PARSED,this.onManifestParsed,this),e.off(P.BUFFER_RESET,this.onBufferReset,this),e.off(P.BUFFER_APPENDING,this.onBufferAppending,this),e.off(P.BUFFER_CODECS,this.onBufferCodecs,this),e.off(P.BUFFER_EOS,this.onBufferEos,this),e.off(P.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(P.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(P.FRAG_PARSED,this.onFragParsed,this),e.off(P.FRAG_CHANGED,this.onFragChanged,this),e.off(P.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const s={};if(this.operationQueue){const i=this.isUpdating();i||this.operationQueue.removeBlockers();const o=this.isQueued();(i||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${i?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?Et(s,r.tracks):this.sourceBuffers.forEach(i=>{const[o]=i;o&&(s[o]=Et({},this.tracks[o]),this.removeBuffer(o)),i[0]=i[1]=null}),{media:e,mediaSource:t,tracks:s}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var s;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(s=this.transferData)!=null&&s.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){const s=this.media=t.media;this.transferData=this.overrides=void 0;const r=za(this.appendSource);if(r){const i=!!t.mediaSource;(i||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(o),i)this._objectUrl=s.src,this.attachTransferred();else{const a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{s.removeAttribute("src");const l=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||l&&o instanceof l,dk(s),Woe(s,a),s.load()}catch{s.src=a}else s.src=a}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,s;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(s=e.constructor)==null?void 0:s.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const s=this.tracks,r=t.tracks,i=r?Object.keys(r):null,o=i?i.length:0,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&i&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${St(s,(l,c)=>l==="initSegment"?void 0:c)};
transfer tracks: ${St(r,(l,c)=>l==="initSegment"?void 0:c)}}`),!SU(r,s)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,c=this.details,d=Math.max(l,(c==null?void 0:c.fragments[0].start)||0);if(d-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${d}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(s)}") start time: ${d} currentTime: ${l}`),this.onMediaDetaching(P.MEDIA_DETACHING,{}),this.onMediaAttaching(P.MEDIA_ATTACHING,t),e.currentTime=d;return}this.transferData=void 0,i.forEach(l=>{const c=l,d=r[c];if(d){const h=d.buffer;if(h){const f=this.fragmentTracker,m=d.id;if(f.hasFragments(m)||f.hasParts(m)){const v=Ue.getBuffered(h);f.detectEvictedFragments(c,v,m,null,!0)}const p=Gx(c),y=[c,h];this.sourceBuffers[p]=y,h.updating&&this.operationQueue&&this.operationQueue.prependBlocker(c),this.trackSourceBuffer(c,d)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const s=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:i,_objectUrl:o}=this;if(i){if(this.log(`media source ${s?"transferring":"detaching"}`),s)this.sourceBuffers.forEach(([a])=>{a&&this.removeBuffer(a)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const a=i.readyState==="open";try{const l=i.sourceBuffers;for(let c=l.length;c--;)a&&l[c].abort(),i.removeSourceBuffer(l[c]);a&&i.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),s||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(r.removeAttribute("src"),this.appendSource&&dk(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(P.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const s=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),s)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(i){this.warn(`onBufferReset ${e}`,i)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Gx(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new Goe(this.tracks)}onBufferCodecs(e,t){var s;const r=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const o="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),a=!o&&this.sourceBufferCount&&this.media&&i.some(l=>!r[l]);if(o||a){this.warn(`Unsupported transition between "${Object.keys(r)}" and "${i}" SourceBuffers`);return}i.forEach(l=>{var c,d;const h=t[l],{id:f,codec:m,levelCodec:p,container:y,metadata:v,supplemental:x}=h;let E=r[l];const w=(c=this.transferData)==null||(c=c.tracks)==null?void 0:c[l],b=w!=null&&w.buffer?w:E,C=(b==null?void 0:b.pendingCodec)||(b==null?void 0:b.codec),D=b==null?void 0:b.levelCodec;E||(E=r[l]={buffer:void 0,listeners:[],codec:m,supplemental:x,container:y,levelCodec:p,metadata:v,id:f});const _=mg(C,D),S=_==null?void 0:_.replace(uk,"$1");let I=mg(m,p);const R=(d=I)==null?void 0:d.replace(uk,"$1");I&&_&&S!==R&&(l.slice(0,5)==="audio"&&(I=A0(I,this.appendSource)),this.log(`switching codec ${C} to ${I}`),I!==(E.pendingCodec||E.codec)&&(E.pendingCodec=I),E.container=y,this.appendChangeType(l,y,I))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((s=t.audio)==null?void 0:s.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const s=this.tracks[t];return e[t]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},e},{})}appendChangeType(e,t,s){const r=`${t};codecs=${s}`,i={label:`change-type=${r}`,execute:()=>{const o=this.tracks[e];if(o){const a=o.buffer;a!=null&&a.changeType&&(this.log(`changing ${e} sourceBuffer type to ${r}`),a.changeType(r),o.codec=s,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(i,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const s=e.start,r=s+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(s,de.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var a;const l=this.tracks.video;(this.lastVideoAppendEnd>r||l!=null&&l.buffer&&Ue.isBuffered(l.buffer,r)||((a=this.fragmentTracker.getAppendedFrag(r,de.MAIN))==null?void 0:a.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn("Error executing block-audio operation",a)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:s}=this,{data:r,type:i,parent:o,frag:a,part:l,chunkMeta:c,offset:d}=t,h=c.buffering[i],{sn:f,cc:m}=a,p=self.performance.now();h.start=p;const y=a.stats.buffering,v=l?l.stats.buffering:null;y.start===0&&(y.start=p),v&&v.start===0&&(v.start=p);const x=s.audio;let E=!1;i==="audio"&&(x==null?void 0:x.container)==="audio/mpeg"&&(E=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const w=s.video,b=w==null?void 0:w.buffer;if(b&&f!=="initSegment"){const _=l||a,S=this.blockedAudioAppend;if(i==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(w.ending||w.ended)){const R=_.start+_.duration*.05,N=b.buffered,L=this.currentOp("video");!N.length&&!L?this.blockAudio(_):!L&&!Ue.isBuffered(b,R)&&this.lastVideoAppendEnd<R&&this.blockAudio(_)}else if(i==="video"){const I=_.end;if(S){const R=S.frag.start;(I>R||I<this.lastVideoAppendEnd||Ue.isBuffered(b,R))&&this.unblockAudio()}this.lastVideoAppendEnd=I}}const C=(l||a).start,D={label:`append-${i}`,execute:()=>{var _;h.executeStart=self.performance.now();const S=(_=this.tracks[i])==null?void 0:_.buffer;S&&(E?this.updateTimestampOffset(S,C,.1,i,f,m):d!==void 0&&le(d)&&this.updateTimestampOffset(S,d,1e-6,i,f,m)),this.appendExecutor(r,i)},onStart:()=>{},onComplete:()=>{const _=self.performance.now();h.executeEnd=h.end=_,y.first===0&&(y.first=_),v&&v.first===0&&(v.first=_);const S={};this.sourceBuffers.forEach(([I,R])=>{I&&(S[I]=Ue.getBuffered(R))}),this.appendErrors[i]=0,i==="audio"||i==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(P.BUFFER_APPENDED,{type:i,frag:a,part:l,chunkMeta:c,parent:a.type,timeRanges:S})},onError:_=>{var S;const I={type:Te.MEDIA_ERROR,parent:a.type,details:W.BUFFER_APPEND_ERROR,sourceBufferName:i,frag:a,part:l,chunkMeta:c,error:_,err:_,fatal:!1},R=(S=this.media)==null?void 0:S.error;if(_.code===DOMException.QUOTA_EXCEEDED_ERR||_.name=="QuotaExceededError"||"quota"in _)I.details=W.BUFFER_FULL_ERROR;else if(_.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!R)I.errorAction=Su(!0);else if(_.name===RV&&this.sourceBufferCount===0)I.errorAction=Su(!0);else{const N=++this.appendErrors[i];this.warn(`Failed ${N}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${i}" sourceBuffer (${R||"no media error"})`),(N>=this.hls.config.appendErrorMaxRetry||R)&&(I.fatal=!0)}this.hls.trigger(P.ERROR,I)}};this.log(`queuing "${i}" append sn: ${f}${l?" p: "+l.index:""} of ${a.type===de.MAIN?"level":"track"} ${a.level} cc: ${m}`),this.append(D,i,this.isPending(this.tracks[i]))}getFlushOp(e,t,s){return this.log(`queuing "${e}" remove ${t}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(P.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn(`Failed to remove ${t}-${s} from "${e}" SourceBuffer`,r)}}}onBufferFlushing(e,t){const{type:s,startOffset:r,endOffset:i}=t;s?this.append(this.getFlushOp(s,r,i),s):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,r,i),o)})}onFragParsed(e,t){const{frag:s,part:r}=t,i=[],o=r?r.elementaryStreams:s.elementaryStreams;o[bt.AUDIOVIDEO]?i.push("audiovideo"):(o[bt.AUDIO]&&i.push("audio"),o[bt.VIDEO]&&i.push("video"));const a=()=>{const l=self.performance.now();s.stats.buffering.end=l,r&&(r.stats.buffering.end=l);const c=r?r.stats:s.stats;this.hls.trigger(P.FRAG_BUFFERED,{frag:s,part:r,stats:c,id:s.type})};i.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers(a,i).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var s;this.sourceBuffers.forEach(([o])=>{if(o){const a=this.tracks[o];(!t.type||t.type===o)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${o} buffer reached EOS`)))}});const r=((s=this.overrides)==null?void 0:s.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var a;return o&&!((a=this.tracks[o])!=null&&a.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(P.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(P.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===W.BUFFER_APPEND_ERROR&&t.frag){var s;const r=(s=t.errorAction)==null?void 0:s.nextAutoLevel;le(r)&&r!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:s}=this;if(!s||t===null||!this.sourceBufferCount)return;const r=e.config,i=s.currentTime,o=t.levelTargetDuration,a=t.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if(le(a)&&a>=0){const c=Math.max(a,o),d=Math.floor(i/o)*o-c;this.flushBackBuffer(i,o,d)}const l=r.frontBufferFlushThreshold;if(le(l)&&l>0){const c=Math.max(r.maxBufferLength,l),d=Math.max(c,o),h=Math.floor(i/o)*o+d;this.flushFrontBuffer(i,o,h)}}flushBackBuffer(e,t,s){this.sourceBuffers.forEach(([r,i])=>{if(i){const a=Ue.getBuffered(i);if(a.length>0&&s>a.start(0)){var o;this.hls.trigger(P.BACK_BUFFER_REACHED,{bufferEnd:s});const l=this.tracks[r];if((o=this.details)!=null&&o.live)this.hls.trigger(P.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(l!=null&&l.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(P.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:r})}}})}flushFrontBuffer(e,t,s){this.sourceBuffers.forEach(([r,i])=>{if(i){const o=Ue.getBuffered(i),a=o.length;if(a<2)return;const l=o.start(a-1),c=o.end(a-1);if(s>l||e>=l&&e<=c)return;this.hls.trigger(P.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;const{details:t,mediaSource:s}=this;if(!t||!this.media||(s==null?void 0:s.readyState)!=="open")return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&s.setLiveSeekableRange){const c=Math.max(0,t.fragmentStart),d=Math.max(c,r);return{duration:1/0,start:c,end:d}}return{duration:1/0}}const i=(e=this.overrides)==null?void 0:e.duration;if(i)return le(i)?{duration:i}:null;const o=this.media.duration,a=le(s.duration)?s.duration:0;return r>a&&r>o||!le(o)?{duration:r}:null}updateMediaSource({duration:e,start:t,end:s}){const r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==e&&(le(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),t!==void 0&&s!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${t}-${s}.`),r.setLiveSeekableRange(t,s)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${St(s)}`),this.tracksReady){var r;const i=(r=this.transferData)==null?void 0:r.tracks;i&&Object.keys(i).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,s])=>{if(t){const r=this.tracks[t];e[t]={buffer:s,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(P.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(P.ERROR,{type:Te.MEDIA_ERROR,details:W.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const i in e){const o=i,a=e[o];if(this.isPending(a)){const l=this.getTrackCodec(a,o),c=`${a.container};codecs=${l}`;a.codec=l,this.log(`creating sourceBuffer(${c})${this.currentOp(o)?" Queued":""} ${St(a)}`);try{const d=s.addSourceBuffer(c),h=Gx(o),f=[o,d];t[h]=f,a.buffer=d}catch(d){var r;this.error(`error while trying to add sourceBuffer: ${d.message}`),this.shiftAndExecuteNext(o),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[o],this.hls.trigger(P.ERROR,{type:Te.MEDIA_ERROR,details:W.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:d,sourceBufferName:o,mimeType:c,parent:a.id});return}this.trackSourceBuffer(o,a)}}this.bufferCreated()}getTrackCodec(e,t){const s=e.supplemental;let r=e.codec;s&&(t==="video"||t==="audiovideo")&&Mf(s,"video")&&(r=Mre(r,s));const i=mg(r,e.levelCodec);return i?t.slice(0,5)==="audio"?A0(i,this.appendSource):i:""}trackSourceBuffer(e,t){const s=t.buffer;if(!s)return;const r=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(i,o)=>{const a=o.removedRanges;a!=null&&a.length&&this.hls.trigger(P.BUFFER_FLUSHED,{type:i})})}get mediaSrc(){var e,t;const s=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return s==null?void 0:s.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const s=this.currentOp(e);s&&(s.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var s;const r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(s=this.mediaSource)==null?void 0:s.readyState}`);this.error(`${r}`,t),this.hls.trigger(P.ERROR,{type:Te.MEDIA_ERROR,details:W.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const i=this.currentOp(e);i&&i.onError(r)}updateTimestampOffset(e,t,s,r,i,o){const a=t-e.timestampOffset;Math.abs(a)>=s&&(this.log(`Updating ${r} SourceBuffer timestampOffset to ${t} (sn: ${i} cc: ${o})`),e.timestampOffset=t)}removeExecutor(e,t,s){const{media:r,mediaSource:i}=this,o=this.tracks[e],a=o==null?void 0:o.buffer;if(!r||!i||!a){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=le(r.duration)?r.duration:1/0,c=le(i.duration)?i.duration:1/0,d=Math.max(0,t),h=Math.min(s,l,c);h>d&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${d},${h}] from the ${e} SourceBuffer`),a.remove(d,h)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const s=this.tracks[t],r=s==null?void 0:s.buffer;if(!r)throw new Koe(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:s}=this,r=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(o=>{s===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var s;const r=(s=this.tracks[t])==null?void 0:s.buffer;!r||r.updating||this.shiftAndExecuteNext(t)})}append(e,t,s){this.operationQueue&&this.operationQueue.append(e,t,s)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,s){const r=this.tracks[e];if(!r)return;const i=r.buffer;if(!i)return;const o=s.bind(this,e);r.listeners.push({event:t,listener:o}),i.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const s=t.buffer;s&&(t.listeners.forEach(r=>{s.removeEventListener(r.event,r.listener)}),t.listeners.length=0)}}function dk(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function Woe(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function Gx(n){return n==="audio"?1:0}class d_{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(P.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(P.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(P.MANIFEST_PARSED,this.onManifestParsed,this),e.on(P.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(P.BUFFER_CODECS,this.onBufferCodecs,this),e.on(P.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(P.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(P.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(P.MANIFEST_PARSED,this.onManifestParsed,this),e.off(P.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(P.BUFFER_CODECS,this.onBufferCodecs,this),e.off(P.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&le(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${s}: ${e[s].height}p@${e[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=s,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter((r,i)=>this.isLevelAllowed(r)&&i<=e);return this.clientRect=null,d_.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,!t.width&&!t.height&&(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(s=>e.bitrate===s.bitrate&&e.width===s.width&&e.height===s.height)}static getMaxLevelByMediaSize(e,t,s){if(!(e!=null&&e.length))return-1;const r=(a,l)=>l?a.width!==l.width||a.height!==l.height:!0;let i=e.length-1;const o=Math.max(t,s);for(let a=0;a<e.length;a+=1){const l=e[a];if((l.width>=o||l.height>=o)&&r(l,e[a+1])){i=a;break}}return i}}const zoe={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},xs=zoe,qoe={HLS:"h"},Yoe=qoe;class Ri{constructor(e,t){Array.isArray(e)&&(e=e.map(s=>s instanceof Ri?s:new Ri(s))),this.value=e,this.params=t}}const Qoe="Dict";function Xoe(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function Joe(n,e,t,s){return new Error(`failed to ${n} "${Xoe(e)}" as ${t}`,{cause:s})}function Ci(n,e,t){return Joe("serialize",n,e,t)}class CV{constructor(e){this.description=e}}const hk="Bare Item",Zoe="Boolean";function eae(n){if(typeof n!="boolean")throw Ci(n,Zoe);return n?"?1":"?0"}function tae(n){return btoa(String.fromCharCode(...n))}const nae="Byte Sequence";function sae(n){if(ArrayBuffer.isView(n)===!1)throw Ci(n,nae);return`:${tae(n)}:`}const rae="Integer";function iae(n){return n<-999999999999999||999999999999999<n}function PV(n){if(iae(n))throw Ci(n,rae);return n.toString()}function oae(n){return`@${PV(n.getTime()/1e3)}`}function kV(n,e){if(n<0)return-kV(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const r=Math.floor(n*t);return(r%2===0?r:r+1)/t}else return Math.round(n*t)/t}const aae="Decimal";function lae(n){const e=kV(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Ci(n,aae);const t=e.toString();return t.includes(".")?t:`${t}.0`}const cae="String",uae=/[\x00-\x1f\x7f]+/;function dae(n){if(uae.test(n))throw Ci(n,cae);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function hae(n){return n.description||n.toString().slice(7,-1)}const fae="Token";function fk(n){const e=hae(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Ci(e,fae);return e}function ST(n){switch(typeof n){case"number":if(!le(n))throw Ci(n,hk);return Number.isInteger(n)?PV(n):lae(n);case"string":return dae(n);case"symbol":return fk(n);case"boolean":return eae(n);case"object":if(n instanceof Date)return oae(n);if(n instanceof Uint8Array)return sae(n);if(n instanceof CV)return fk(n);default:throw Ci(n,hk)}}const mae="Key";function _T(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw Ci(n,mae);return n}function h_(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${_T(e)}`:`;${_T(e)}=${ST(t)}`).join("")}function NV(n){return n instanceof Ri?`${ST(n.value)}${h_(n.params)}`:ST(n)}function pae(n){return`(${n.value.map(NV).join(" ")})${h_(n.params)}`}function gae(n,e={whitespace:!0}){if(typeof n!="object"||n==null)throw Ci(n,Qoe);const t=n instanceof Map?n.entries():Object.entries(n),s=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([r,i])=>{i instanceof Ri||(i=new Ri(i));let o=_T(r);return i.value===!0?o+=h_(i.params):(o+="=",Array.isArray(i.value)?o+=pae(i):o+=NV(i)),o}).join(`,${s}`)}function LV(n,e){return gae(n,e)}const Xr="CMCD-Object",Wt="CMCD-Request",fl="CMCD-Session",zo="CMCD-Status",yae={br:Xr,ab:Xr,d:Xr,ot:Xr,tb:Xr,tpb:Xr,lb:Xr,tab:Xr,lab:Xr,url:Xr,pb:Wt,bl:Wt,tbl:Wt,dl:Wt,ltc:Wt,mtp:Wt,nor:Wt,nrr:Wt,rc:Wt,sn:Wt,sta:Wt,su:Wt,ttfb:Wt,ttfbb:Wt,ttlb:Wt,cmsdd:Wt,cmsds:Wt,smrt:Wt,df:Wt,cs:Wt,ts:Wt,cid:fl,pr:fl,sf:fl,sid:fl,st:fl,v:fl,msd:fl,bs:zo,bsd:zo,cdn:zo,rtp:zo,bg:zo,pt:zo,ec:zo,e:zo},vae={REQUEST:Wt};function xae(n){return Object.keys(n).reduce((e,t)=>{var s;return(s=n[t])===null||s===void 0||s.forEach(r=>e[r]=t),e},{})}function Eae(n,e){const t={};if(!n)return t;const s=Object.keys(n),r=e?xae(e):{};return s.reduce((i,o)=>{var a;const l=yae[o]||r[o]||vae.REQUEST,c=(a=i[l])!==null&&a!==void 0?a:i[l]={};return c[o]=n[o],i},t)}function wae(n){return["ot","sf","st","e","sta"].includes(n)}function Tae(n){return typeof n=="number"?le(n):n!=null&&n!==""&&n!==!1}const DV="event";function bae(n,e){const t=new URL(n),s=new URL(e);if(t.origin!==s.origin)return n;const r=t.pathname.split("/").slice(1),i=s.pathname.split("/").slice(1,-1);for(;r[0]===i[0];)r.shift(),i.shift();for(;i.length;)i.shift(),r.unshift("..");return r.join("/")+t.search+t.hash}const xg=n=>Math.round(n),AT=(n,e)=>Array.isArray(n)?n.map(t=>AT(t,e)):n instanceof Ri&&typeof n.value=="string"?new Ri(AT(n.value,e),n.params):(e.baseUrl&&(n=bae(n,e.baseUrl)),e.version===1?encodeURIComponent(n):n),Ip=n=>xg(n/100)*100,Sae=(n,e)=>{let t=n;return e.version>=2&&(n instanceof Ri&&typeof n.value=="string"?t=new Ri([n]):typeof n=="string"&&(t=[n])),AT(t,e)},_ae={br:xg,d:xg,bl:Ip,dl:Ip,mtp:Ip,nor:Sae,rtp:Ip,tb:xg},MV="request",OV="response",f_=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],Aae=["e"],Iae=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function lv(n){return Iae.test(n)}function Rae(n){return f_.includes(n)||Aae.includes(n)||lv(n)}const jV=["d","dl","nor","ot","rtp","su"];function Cae(n){return f_.includes(n)||jV.includes(n)||lv(n)}const Pae=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function kae(n){return f_.includes(n)||jV.includes(n)||Pae.includes(n)||lv(n)}const Nae=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function Lae(n){return Nae.includes(n)||lv(n)}const Dae={[OV]:kae,[DV]:Rae,[MV]:Cae};function FV(n,e={}){const t={};if(n==null||typeof n!="object")return t;const s=e.version||n.v||1,r=e.reportingMode||MV,i=s===1?Lae:Dae[r];let o=Object.keys(n).filter(i);const a=e.filter;typeof a=="function"&&(o=o.filter(a));const l=r===OV||r===DV;l&&!o.includes("ts")&&o.push("ts"),s>1&&!o.includes("v")&&o.push("v");const c=Et({},_ae,e.formatters),d={version:s,reportingMode:r,baseUrl:e.baseUrl};return o.sort().forEach(h=>{let f=n[h];const m=c[h];if(typeof m=="function"&&(f=m(f,d)),h==="v"){if(s===1)return;f=s}h=="pr"&&f===1||(l&&h==="ts"&&!le(f)&&(f=Date.now()),Tae(f)&&(wae(h)&&typeof f=="string"&&(f=new CV(f)),t[h]=f))}),t}function Mae(n,e={}){const t={};if(!n)return t;const s=FV(n,e),r=Eae(s,e==null?void 0:e.customHeaderMap);return Object.entries(r).reduce((i,[o,a])=>{const l=LV(a,{whitespace:!1});return l&&(i[o]=l),i},t)}function Oae(n,e,t){return Et(n,Mae(e,t))}const jae="CMCD";function Fae(n,e={}){return n?LV(FV(n,e),{whitespace:!1}):""}function Uae(n,e={}){if(!n)return"";const t=Fae(n,e);return encodeURIComponent(t)}function Vae(n,e={}){if(!n)return"";const t=Uae(n,e);return`${jae}=${t}`}const mk=/CMCD=[^&#]+/;function $ae(n,e,t){const s=Vae(e,t);if(!s)return n;if(mk.test(n))return n.replace(mk,s);const r=n.includes("?")?"&":"?";return`${n}${r}${s}`}class Bae{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:xs.MANIFEST,su:!this.initialized})}catch(i){this.hls.logger.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=r=>{try{const{frag:i,part:o}=r,a=this.hls.levels[i.level],l=this.getObjectType(i),c={d:(o||i).duration*1e3,ot:l};(l===xs.VIDEO||l===xs.AUDIO||l==xs.MUXED)&&(c.br=a.bitrate/1e3,c.tb=this.getTopBandwidth(l)/1e3,c.bl=this.getBufferLength(l));const d=o?this.getNextPart(o):this.getNextFrag(i);d!=null&&d.url&&d.url!==i.url&&(c.nor=d.url),this.apply(r,c)}catch(i){this.hls.logger.warn("Could not generate segment CMCD data.",i)}},this.hls=e;const t=this.config=e.config,{cmcd:s}=t;s!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||e.sessionId,this.cid=s.contentId,this.useHeaders=s.useHeaders===!0,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(P.MEDIA_DETACHED,this.onMediaDetached,this),e.on(P.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(P.MEDIA_DETACHED,this.onMediaDetached,this),e.off(P.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var s,r;this.audioBuffer=(s=t.tracks.audio)==null?void 0:s.buffer,this.videoBuffer=(r=t.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:1,sf:Yoe.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Et(t,this.createData());const s=t.ot===xs.INIT||t.ot===xs.VIDEO||t.ot===xs.MUXED;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((o,a)=>(r.includes(a)&&(o[a]=t[a]),o),{}));const i={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),Oae(e.headers,t,i)):e.url=$ae(e.url,t,i)}getNextFrag(e){var t;const s=(t=this.hls.levels[e.level])==null?void 0:t.details;if(s){const r=e.sn-s.startSN;return s.fragments[r+1]}}getNextPart(e){var t;const{index:s,fragment:r}=e,i=(t=this.hls.levels[r.level])==null||(t=t.details)==null?void 0:t.partList;if(i){const{sn:o}=r;for(let a=i.length-1;a>=0;a--){const l=i[a];if(l.index===s&&l.fragment.sn===o)return i[a+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return xs.TIMED_TEXT;if(e.sn==="initSegment")return xs.INIT;if(t==="audio")return xs.AUDIO;if(t==="main")return this.hls.audioTracks.length?xs.VIDEO:xs.MUXED}getTopBandwidth(e){let t=0,s;const r=this.hls;if(e===xs.AUDIO)s=r.audioTracks;else{const i=r.maxAutoLevel,o=i>-1?i+1:r.levels.length;s=r.levels.slice(0,o)}return s.forEach(i=>{i.bitrate>t&&(t=i.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,s=e===xs.AUDIO?this.audioBuffer:this.videoBuffer;return!s||!t?NaN:Ue.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new s(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,a){t(i),this.loader.load(i,o,a)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new s(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,a){t(i),this.loader.load(i,o,a)}}}}const Gae=3e5;class Kae extends Tr{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(P.MANIFEST_PARSED,this.onManifestParsed,this),e.on(P.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(P.MANIFEST_PARSED,this.onManifestParsed,this),e.off(P.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(s=>s!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:s}=t;s!==null&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:s}=t;if((s==null?void 0:s.action)===Ln.SendAlternateToPenaltyBox&&s.flags===Vs.MoveAllAlternatesMatchingHost){const r=this.levels;let i=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:a,pathwayId:l,type:c}=t.context;a&&r?o=this.getPathwayForGroupId(a,c,o):l&&(o=l)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!i&&r&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),s.resolved=this.pathwayId!==o),t.details===W.BUFFER_APPEND_ERROR&&!t.fatal?s.resolved=!0:s.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${r&&r.length} priorities: ${St(i)} penalized: ${St(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const s=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const s=this.penalizedPathways,r=performance.now();Object.keys(s).forEach(i=>{r-s[i]>Gae&&delete s[i]});for(let i=0;i<e.length;i++){const o=e[i];if(o in s)continue;if(o===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,rV(t),this.hls.trigger(P.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[a];l&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,s){const r=this.getLevelsForPathway(s).concat(this.levels||[]);for(let i=0;i<r.length;i++)if(t===We.AUDIO_TRACK&&r[i].hasAudioGroup(e)||t===We.SUBTITLE_TRACK&&r[i].hasSubtitleGroup(e))return r[i].pathwayId;return s}clonePathways(e){const t=this.levels;if(!t)return;const s={},r={};e.forEach(i=>{const{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=i;if(t.some(d=>d.pathwayId===o))return;const c=this.getLevelsForPathway(a).map(d=>{const h=new Mt(d.attrs);h["PATHWAY-ID"]=o;const f=h.AUDIO&&`${h.AUDIO}_clone_${o}`,m=h.SUBTITLES&&`${h.SUBTITLES}_clone_${o}`;f&&(s[h.AUDIO]=f,h.AUDIO=f),m&&(r[h.SUBTITLES]=m,h.SUBTITLES=m);const p=UV(d.uri,h["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),y=new jf({attrs:h,audioCodec:d.audioCodec,bitrate:d.bitrate,height:d.height,name:d.name,url:p,videoCodec:d.videoCodec,width:d.width});if(d.audioGroups)for(let v=1;v<d.audioGroups.length;v++)y.addGroupId("audio",`${d.audioGroups[v]}_clone_${o}`);if(d.subtitleGroups)for(let v=1;v<d.subtitleGroups.length;v++)y.addGroupId("text",`${d.subtitleGroups[v]}_clone_${o}`);return y});t.push(...c),pk(this.audioTracks,s,l,o),pk(this.subtitleTracks,r,l,o)})}loadSteeringManifest(e){const t=this.hls.config,s=t.loader;this.loader&&this.loader.destroy(),this.loader=new s(t);let r;try{r=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){const d=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+d)}const i={responseType:"json",url:r.href},o=t.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},c={onSuccess:(d,h,f,m)=>{this.log(`Loaded steering manifest: "${r}"`);const p=d.data;if((p==null?void 0:p.VERSION)!==1){this.log(`Steering VERSION ${p.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=p.TTL;const{"RELOAD-URI":y,"PATHWAY-CLONES":v,"PATHWAY-PRIORITY":x}=p;if(y)try{this.uri=new self.URL(y,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${y}`);return}this.scheduleRefresh(this.uri||f.url),v&&this.clonePathways(v);const E={steeringManifest:p,url:r.toString()};this.hls.trigger(P.STEERING_MANIFEST_LOADED,E),x&&this.updatePathwayPriority(x)},onError:(d,h,f,m)=>{if(this.log(`Error loading steering manifest: ${d.code} ${d.text} (${h.url})`),this.stopLoad(),d.code===410){this.enabled=!1,this.log(`Steering manifest ${h.url} no longer available`);return}let p=this.timeToLoad*1e3;if(d.code===429){const y=this.loader;if(typeof(y==null?void 0:y.getResponseHeader)=="function"){const v=y.getResponseHeader("Retry-After");v&&(p=parseFloat(v)*1e3)}this.log(`Steering manifest ${h.url} rate limited`);return}this.scheduleRefresh(this.uri||h.url,p)},onTimeout:(d,h,f)=>{this.log(`Timeout loading steering manifest (${h.url})`),this.scheduleRefresh(this.uri||h.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(i,l,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var s;const r=(s=this.hls)==null?void 0:s.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function pk(n,e,t,s){n&&Object.keys(e).forEach(r=>{const i=n.filter(o=>o.groupId===r).map(o=>{const a=Et({},o);return a.details=void 0,a.attrs=new Mt(a.attrs),a.url=a.attrs.URI=UV(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),a.groupId=a.attrs["GROUP-ID"]=e[r],a.attrs["PATHWAY-ID"]=s,a});n.push(...i)})}function UV(n,e,t,s){const{HOST:r,PARAMS:i,[t]:o}=s;let a;e&&(a=o==null?void 0:o[e],a&&(n=a));const l=new self.URL(n);return r&&!a&&(l.host=r),i&&Object.keys(i).sort().forEach(c=>{c&&l.searchParams.set(c,i[c])}),l.href}class Au extends Tr{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Au.CDMCleanupPromise?[Au.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:s,initData:r}=t,i=`"${t.type}" event: init data type: "${s}"`;if(this.debug(i),r!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=Ch(this.config));const a=o.map(Mx).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(a)}this.keyFormatPromise.then(o=>{const a=gg(o);if(s!=="sinf"||a!==Ft.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${s}" for selected key-system ${a}`);return}let l;try{const m=yn(new Uint8Array(r)),p=t_(JSON.parse(m).sinf),y=LU(p);if(!y)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(y.subarray(8,24))}catch(m){this.warn(`${i} Failed to parse sinf: ${m}`);return}const c=Mn(l),{keyIdToKeySessionPromise:d,mediaKeySessions:h}=this;let f=d[c];for(let m=0;m<h.length;m++){const p=h[m],y=p.decryptdata;if(!y.keyId)continue;const v=Mn(y.keyId);if(k0(l,y.keyId)||y.uri.replace(/-/g,"").indexOf(c)!==-1){if(f=d[v],!f)continue;if(y.pssh)break;delete d[v],y.pssh=new Uint8Array(r),y.keyId=l,f=d[c]=f.then(()=>this.generateRequestWithPreferredKeySession(p,s,r,"encrypted-event-key-match")),f.catch(x=>this.handleError(x));break}}f||this.handleError(new Error(`Key ID ${c} not encountered in playlist. Key-system sessions ${h.length}.`))}).catch(o=>this.handleError(o))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(P.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(P.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(P.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(P.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(P.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(P.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(P.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(P.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(P.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(P.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:s}=this.config,r=t==null?void 0:t[e];if(r)return r.licenseUrl;if(e===Ft.WIDEVINE&&s)return s}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,s=t==null?void 0:t[e];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,s=(o,a,l)=>!!o&&l.indexOf(o)===a,r=t.map(o=>o.audioCodec).filter(s),i=t.map(o=>o.videoCodec).filter(s);return r.length+i.length===0&&i.push("avc1.42e01e"),new Promise((o,a)=>{const l=c=>{const d=c.shift();this.getMediaKeysPromise(d,r,i).then(h=>o({keySystem:d,mediaKeys:h})).catch(h=>{c.length?l(c):h instanceof Us?a(h):a(new Us({type:Te.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_NO_ACCESS,error:h,fatal:!0},h.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:s}=this.config;if(typeof s!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${s}`;return QU===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return s(e,t)}getMediaKeysPromise(e,t,s){var r;const i=Sie(e,t,s,this.config.drmSystemOptions||{});let o=this.keySystemAccessPromises[e],a=(r=o)==null?void 0:r.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${St(i)}`),a=this.requestMediaKeySystemAccess(e,i);const l=o=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(c=>{this.log(`Failed to obtain access to key-system "${e}": ${c}`)}),a.then(c=>{this.log(`Access for key-system "${c.keySystem}" obtained`);const d=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const h=l.mediaKeys=c.createMediaKeys().then(f=>(this.log(`Media-keys created for "${e}"`),l.hasMediaKeys=!0,d.then(m=>m?this.setMediaKeysServerCertificate(f,e,m):f)));return h.catch(f=>{this.error(`Failed to create media-keys for "${e}"}: ${f}`)}),h})}return a.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:s}){this.log(`Creating key-system session "${t}" keyId: ${Mn(e.keyId||[])} keyUri: ${e.uri}`);const r=s.createSession(),i={decryptdata:e,keySystem:t,mediaKeys:s,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),r=Rp(t),i="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(s,i,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyId ${Mn(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),s.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Mx(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:s})=>this.attemptSetMediaKeys(t,s))}selectKeySystem(e){return new Promise((t,s)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:r})=>{const i=Mx(r);i?t(i):s(new Error(`Unable to find format for key-system "${r}"`))}).catch(s)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Ch(this.config),s=e.map(gg).filter(r=>!!r&&t.indexOf(r)!==-1);return this.selectKeySystem(s)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let s=0;s<t.length;s++){const r=Hae(e,t[s]);if(r)return r}}loadKey(e){const t=e.keyInfo.decryptdata,s=Rp(t),r=this.bannedKeyIds[s];if(r||this.getKeyStatus(t)==="internal-error"){const a=gk(r||"internal-error",t);return this.handleError(a,e.frag),Promise.reject(a)}const i=`(keyId: ${s} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);const o=this.keyIdToKeySessionPromise[s];if(!o){const a=this.getKeySystemForKeyPromise(t).then(({keySystem:l,mediaKeys:c})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(l,c).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:l,mediaKeys:c,decryptdata:t}))))).then(l=>{const c="cenc",d=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(l,c,d,"playlist-key")});return a.catch(l=>this.handleError(l,e.frag)),this.keyIdToKeySessionPromise[s]=a,a}return o.catch(a=>{if(a instanceof Us){const l=ft({},a.data);this.getKeyStatus(t)==="internal-error"&&(l.decryptdata=t);const c=new Us(l,a.message);this.handleError(c,e.frag)}}),o}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Us){t&&(e.data.frag=t);const s=e.data.decryptdata;this.error(`${e.message}${s?` (${Mn(s.keyId||[])})`:""}`),this.hls.trigger(P.ERROR,e.data)}else this.error(e.message),this.hls.trigger(P.ERROR,{type:Te.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Rp(e),s=this.keyIdToKeySessionPromise[t];if(!s){const r=gg(e.keyFormat),i=r?[r]:Ch(this.config);return this.attemptKeySystemAccess(i)}return s}getKeySystemSelectionPromise(e){if(e.length||(e=Ch(this.config)),e.length===0)throw new Us({type:Te.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${St({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(s).then(()=>this.media?this.media.setMediaKeys(t):new Promise((i,o)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return o(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(i).catch(o)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),s.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(i=>s.indexOf(i)===-1)})}generateRequestWithPreferredKeySession(e,t,s,r){var i;const o=(i=this.config.drmSystems)==null||(i=i[e.keySystem])==null?void 0:i.generateRequest;if(o)try{const p=o.call(this.hls,t,s,e);if(!p)throw new Error("Invalid response from configured generateRequest filter");t=p.initDataType,s=p.initData?p.initData:null,e.decryptdata.pssh=s?new Uint8Array(s):null}catch(p){if(this.warn(p.message),this.hls&&this.hls.config.debug)throw p}if(s===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const a=Rp(e.decryptdata),l=e.decryptdata.uri;this.log(`Generating key-session request for "${r}" keyId: ${a} URI: ${l} (init data type: ${t} length: ${s.byteLength})`);const c=new s_,d=e._onmessage=p=>{const y=e.mediaKeysSession;if(!y){c.emit("error",new Error("invalid state"));return}const{messageType:v,message:x}=p;this.log(`"${v}" message event for session "${y.sessionId}" message size: ${x.byteLength}`),v==="license-request"||v==="license-renewal"?this.renewLicense(e,x).catch(E=>{c.eventNames().length?c.emit("error",E):this.handleError(E)}):v==="license-release"?e.keySystem===Ft.FAIRPLAY&&this.updateKeySession(e,vT("acknowledged")).then(()=>this.removeSession(e)).catch(E=>this.handleError(E)):this.warn(`unhandled media key message type "${v}"`)},h=(p,y)=>{y.keyStatus=p;let v;p.startsWith("usable")?c.emit("resolved"):p==="internal-error"||p==="output-restricted"||p==="output-downscaled"?v=gk(p,y.decryptdata):p==="expired"?v=new Error(`key expired (keyId: ${a})`):p==="released"?v=new Error("key released"):p==="status-pending"||this.warn(`unhandled key status change "${p}" (keyId: ${a})`),v&&(c.eventNames().length?c.emit("error",v):this.handleError(v))},f=e._onkeystatuseschange=p=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}const v=this.getKeyStatuses(e);if(!Object.keys(v).some(b=>v[b]!=="status-pending"))return;if(v[a]==="expired"){this.log(`Expired key ${St(v)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let E=v[a];if(E)h(E,e);else{var w;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(w=e.keyStatusTimeouts)[a]||(w[a]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const C=this.getKeyStatus(e.decryptdata);if(C&&C!=="status-pending")return this.log(`No status for keyId ${a} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${C} from other session.`),h(C,e);this.log(`key status for ${a} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),E="internal-error",h(E,e)},1e3)),this.log(`No status for keyId ${a} (${St(v)}).`)}};ds(e.mediaKeysSession,"message",d),ds(e.mediaKeysSession,"keystatuseschange",f);const m=new Promise((p,y)=>{c.on("error",y),c.on("resolved",p)});return e.mediaKeysSession.generateRequest(t,s).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${a} URI: ${l}`)}).catch(p=>{throw new Us({type:Te.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_NO_SESSION,error:p,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${p}`)}).then(()=>m).catch(p=>(c.removeAllListeners(),this.removeSession(e).then(()=>{throw p}))).then(()=>(c.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((s,r)=>{if(typeof r=="string"&&typeof s=="object"){const a=r;r=s,s=a}const i="buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r);if(e.keySystem===Ft.PLAYREADY&&i.length===16){const a=Mn(i);t[a]=s,qU(i)}const o=Mn(i);s==="internal-error"&&(this.bannedKeyIds[o]=s),this.log(`key status change "${s}" for keyStatuses keyId: ${o} key-session "${e.mediaKeysSession.sessionId}"`),t[o]=s}),t}fetchServerCertificate(e){const t=this.config,s=t.loader,r=new s(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,a)=>{const l={responseType:"arraybuffer",url:i},c=t.certLoadPolicy.default,d={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(f,m,p,y)=>{o(f.data)},onError:(f,m,p,y)=>{a(new Us({type:Te.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:ft({url:l.url,data:void 0},f)},`"${e}" certificate request failed (${i}). Status: ${f.code} (${f.text})`))},onTimeout:(f,m,p)=>{a(new Us({type:Te.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(f,m,p)=>{a(new Error("aborted"))}};r.load(l,d,h)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,s){return new Promise((r,i)=>{e.setServerCertificate(s).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${s.byteLength}) on "${t}"`),r(e)}).catch(o=>{i(new Us({type:Te.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(s=>this.updateKeySession(e,new Uint8Array(s)).catch(r=>{throw new Us({type:Te.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:r,fatal:!1},r.message)}))}unpackPlayReadyKeyMessage(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=new DOMParser().parseFromString(s,"application/xml"),i=r.querySelectorAll("HttpHeader");if(i.length>0){let d;for(let h=0,f=i.length;h<f;h++){var o,a;d=i[h];const m=(o=d.querySelector("name"))==null?void 0:o.textContent,p=(a=d.querySelector("value"))==null?void 0:a.textContent;m&&p&&e.setRequestHeader(m,p)}}const l=r.querySelector("Challenge"),c=l==null?void 0:l.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return vT(atob(c))}setupLicenseXHR(e,t,s,r){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then(()=>{if(!s.decryptdata)throw new Error("Key removed");return i.call(this.hls,e,t,s,r)}).catch(o=>{if(!s.decryptdata)throw o;return e.open("POST",t,!0),i.call(this.hls,e,t,s,r)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||r})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const s=this.config.keyLoadPolicy.default;return new Promise((r,i)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return i(new Error("invalid state"));if(a.readyState===4)if(a.status===200){this._requestLicenseFailureCount=0;let l=a.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const c=this.config.licenseResponseCallback;if(c)try{l=c.call(this.hls,a,o,e)}catch(d){this.error(d)}r(l)}else{const l=s.errorRetry,c=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||a.status>=400&&a.status<500)i(new Us({type:Te.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:a,response:{url:o,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${o}). Status: ${a.status} (${a.statusText})`));else{const d=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${d} attempts left`),this.requestLicense(e,t).then(r,i)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,o,e,t).then(({xhr:l,licenseChallenge:c})=>{e.keySystem==Ft.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(l,c)),l.send(c)}).catch(i)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,ds(s,"encrypted",this.onMediaEncrypted),ds(s,"waitingforkey",this.onWaitingForKey);const r=this.mediaResolved;r?r():this.mediaKeys=s.mediaKeys}onMediaDetached(){const e=this.media;e&&(_s(e,"encrypted",this.onMediaEncrypted),_s(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const s=this.media,r=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Na.clearKeyUriToKeyIdMap();const i=r.length;Au.CDMCleanupPromise=Promise.all(r.map(o=>this.removeSession(o)).concat((s==null||(e=s.setMediaKeys(null))==null?void 0:e.catch(o=>{this.log(`Could not clear media keys: ${o}`),this.hls&&this.hls.trigger(P.ERROR,{type:Te.OTHER_ERROR,details:W.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${o}`)})}))||Promise.resolve())).catch(o=>{this.log(`Could not close sessions and clear media keys: ${o}`),this.hls&&this.hls.trigger(P.ERROR,{type:Te.OTHER_ERROR,details:W.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${o}`)})}).then(()=>{i&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const s=t.reduce((r,i)=>(r.indexOf(i.keyFormat)===-1&&r.push(i.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:s,decryptdata:r}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Mn((r==null?void 0:r.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{keyStatusTimeouts:o}=e;o&&Object.keys(o).forEach(c=>self.clearTimeout(o[c]));const{drmSystemOptions:a}=this.config;return(Aie(a)?new Promise((c,d)=>{self.setTimeout(()=>d(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(c).catch(d)}):Promise.resolve()).catch(c=>{this.log(`Could not remove session: ${c}`),this.hls&&this.hls.trigger(P.ERROR,{type:Te.OTHER_ERROR,details:W.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${c}`)})}).then(()=>t.close()).catch(c=>{this.log(`Could not close session: ${c}`),this.hls&&this.hls.trigger(P.ERROR,{type:Te.OTHER_ERROR,details:W.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${c}`)})})}return Promise.resolve()}}Au.CDMCleanupPromise=void 0;function Rp(n){if(!n)throw new Error("Could not read keyId of undefined decryptdata");if(n.keyId===null)throw new Error("keyId is null");return Mn(n.keyId)}function Hae(n,e){if(n.keyId&&e.mediaKeysSession.keyStatuses.has(n.keyId))return e.mediaKeysSession.keyStatuses.get(n.keyId);if(n.matches(e.decryptdata))return e.keyStatus}class Us extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function gk(n,e){const t=n==="output-restricted",s=t?W.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:W.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Us({type:Te.KEY_SYSTEM_ERROR,details:s,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${n}"`)}class Wae{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(P.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(P.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(P.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(P.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,s){const r=performance.now();if(t){if(this.lastTime){const i=r-this.lastTime,o=s-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*o/i,c=this.hls;if(c.trigger(P.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:s}),l>0&&o>c.config.fpsDroppedMonitoringThreshold*a){let d=c.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=d)&&(d=d-1,c.trigger(P.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:c.currentLevel}),c.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function VV(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function $V(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(s){mt.debug(`[texttrack-utils]: ${s}`);try{const r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,n.addCue(r)}catch(r){mt.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}t==="disabled"&&(n.mode=t)}function su(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let s=n.cues.length;s--;)e&&n.cues[s].removeEventListener("enter",e),n.removeCue(n.cues[s]);t==="disabled"&&(n.mode=t)}function IT(n,e,t,s){const r=n.mode;if(r==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const i=qae(n.cues,e,t);for(let o=0;o<i.length;o++)(!s||s(i[o]))&&n.removeCue(i[o])}r==="disabled"&&(n.mode=r)}function zae(n,e){if(e<=n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let s=0,r=t,i;for(;s<=r;)if(i=Math.floor((r+s)/2),e<n[i].startTime)r=i-1;else if(e>n[i].startTime&&s<t)s=i+1;else return i;return n[s].startTime-e<e-n[r].startTime?s:r}function qae(n,e,t){const s=[],r=zae(n,e);if(r>-1)for(let i=r,o=n.length;i<o;i++){const a=n[i];if(a.startTime>=e&&a.endTime<=t)s.push(a);else if(a.startTime>t)return s}return s}function Eg(n){const e=[];for(let t=0;t<n.length;t++){const s=n[t];(s.kind==="subtitles"||s.kind==="captions")&&s.label&&e.push(n[t])}return e}class Yae extends u_{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const s=Eg(this.media.textTracks);for(let i=0;i<s.length;i++)if(s[i].mode==="hidden")t=s[i];else if(s[i].mode==="showing"){t=s[i];break}const r=this.findTrackForTextTrack(t);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.MANIFEST_PARSED,this.onManifestParsed,this),e.on(P.LEVEL_LOADING,this.onLevelLoading,this),e.on(P.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(P.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(P.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.MANIFEST_PARSED,this.onManifestParsed,this),e.off(P.LEVEL_LOADING,this.onLevelLoading,this),e.off(P.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(P.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(P.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const s=this.media;if(!s)return;const r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;Eg(s.textTracks).forEach(o=>{su(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:s,groupId:r,details:i}=t,o=this.tracksInGroup[s];if(!o||o.groupId!==r){this.warn(`Subtitle track with id:${s} and group:${r} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Subtitle track ${s} "${o.name}" lang:${o.lang} group:${r} loaded [${i.startSN}-${i.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,r=this.groupIds;let i=this.currentTrack;if(!s||(r==null?void 0:r.length)!==(s==null?void 0:s.length)||s!=null&&s.some(o=>(r==null?void 0:r.indexOf(o))===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(d=>!s||s.indexOf(d.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(d=>d.default)&&(this.selectDefaultTrack=!1),o.forEach((d,h)=>{d.id=h});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const a=this.hls.config.subtitlePreference;if(!i&&a){this.selectDefaultTrack=!1;const d=ci(a,o);if(d>-1)i=o[d];else{const h=ci(a,this.tracks);i=this.tracks[h]}}let l=this.findTrackId(i);l===-1&&i&&(l=this.findTrackId(null));const c={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${s==null?void 0:s.join(",")}" group-id`),this.hls.trigger(P.SUBTITLE_TRACKS_UPDATED,c),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const i=t[r];if(!(s&&!i.default||!s&&!e)&&(!e||Bl(i,e)))return r}if(e){for(let r=0;r<t.length;r++){const i=t[r];if($f(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const i=t[r];if($f(e.attrs,i.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const r=t[s];if(bT(r,e))return s}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===We.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&Bl(e,s))return s;const r=ci(e,this.tracksInGroup);if(r>-1){const i=this.tracksInGroup[r];return this.setSubtitleTrack(r),i}else{if(s)return null;{const i=ci(e,t);if(i>-1)return t[i]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,r=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading subtitle ${s} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(P.SUBTITLE_TRACK_LOADING,{url:i,id:s,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Eg(e.textTracks),s=this.currentTrack;let r;if(s&&(r=t.filter(i=>bT(s,i))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(t).forEach(i=>{i.mode!=="disabled"&&i!==r&&(i.mode="disabled")}),r){const i=this.subtitleDisplay?"showing":"hidden";r.mode!==i&&(r.mode=i)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!le(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(P.SUBTITLE_TRACK_SWITCH,{id:e});return}const i=!!r.details&&!r.details.live;if(e===this.trackId&&r===s&&i)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:o,groupId:a="",name:l,type:c,url:d}=r;this.hls.trigger(P.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:c,url:d});const h=this.switchParams(r.url,s==null?void 0:s.details,r.details);this.loadPlaylist(h)}}function Qae(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const i=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(r=="x"?i:i&3|8).toString(16)})}}}function Xh(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}const Iu=.025;let M0=function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n}({});function Xae(n,e,t){return`${n.identifier}-${t+1}-${Xh(e)}`}class Jae{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const s=this.playoutLimit;return e<=0||isNaN(s)?!1:s===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>s}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Kx(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,s=Kx(t,e);return t-s<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=le(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Kx(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Iu))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?M0.Range:M0.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return Zae(this)}}function Kx(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<Iu)?e.start:e.start+e.duration}function BV(n,e,t){const s=new self.URL(n,t);return s.protocol!=="data:"&&s.searchParams.set("_HLS_primary_id",e),s}function Hx(n,e){for(;(t=n.assetList[++e])!=null&&t.error;)var t;return e}function Zae(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function Gc(n){const e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class ele{constructor(e,t,s,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(P.PLAYOUT_LIMIT_REACHED,{})};const i=this.hls=new e(t);this.interstitial=s,this.assetItem=r;const o=()=>{this.hasDetails=!0};i.once(P.LEVEL_LOADED,o),i.once(P.AUDIO_TRACK_LOADED,o),i.once(P.SUBTITLE_TRACK_LOADED,o),i.on(P.MEDIA_ATTACHING,(a,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&i.on(P.BUFFER_APPENDED,()=>{const d=this.bufferedEnd;this.reachedPlayout(d)&&(this._bufferedEosTime=d,i.trigger(P.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=BV(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const s=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,i=Ue.bufferInfo(e,r,0);return this.getAssetTime(i.end)>=s-.02}reachedPlayout(e){const s=this.interstitial.playoutLimit;return this.startOffset+e>=s}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Ue.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const s=t-this.startOffset;if(s>0&&s<e)return s}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const s=e-t;if(Math.abs(s)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,e-t),s)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=s=>delete s.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,s){var r;(r=this.hls)==null||r.on(e,t)}once(e,t,s){var r;(r=this.hls)==null||r.once(e,t)}off(e,t,s){var r;(r=this.hls)==null||r.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Gc(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const yk=.033;class tle extends Tr{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((s,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,s+1):s,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let s=-1;e.nextEvent?s=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(s=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[s]||(t===void 0&&(t=e.start),s=this.findItemIndexAtTime(t));s>=0&&(i=r[s])!=null&&i.event;){var i;s--}return s}findItemIndexAtTime(e,t){const s=this.items;if(s)for(let r=0;r<s.length;r++){let i=s[r];if(t&&t!=="primary"&&(i=i[t]),e===i.start||e>i.start&&e<i.end)return r}return-1}findJumpRestrictedIndex(e,t){const s=this.items;if(s)for(let r=e;r<=t&&s[r];r++){const i=s[r].event;if(i!=null&&i.restrictions.jump&&!i.appendInPlace)return r}return-1}findEventIndex(e){const t=this.items;if(t)for(let r=t.length;r--;){var s;if(((s=t[r].event)==null?void 0:s.identifier)===e)return r}return-1}findAssetIndex(e,t){const s=e.assetList,r=s.length;if(r>1)for(let i=0;i<r;i++){const o=s[i];if(!o.error){const a=o.timelineStart;if(t===a||t>a&&(t<a+(o.duration||0)||i===r-1))return i}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const s=t.assetList,r=s[s.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(e,t){const s=e.main.details,{dateRanges:r}=s,i=this.events,o=this.parseDateRanges(r,{url:s.url},t),a=Object.keys(r),l=i?i.filter(c=>!a.includes(c.identifier)):[];o.length&&o.sort((c,d)=>{const h=c.cue.pre,f=c.cue.post,m=d.cue.pre,p=d.cue.post;if(h&&!m)return-1;if(m&&!h||f&&!p)return 1;if(p&&!f)return-1;if(!h&&!m&&!f&&!p){const y=c.startTime,v=d.startTime;if(y!==v)return y-v}return c.dateRange.tagOrder-d.dateRange.tagOrder}),this.events=o,l.forEach(c=>{this.removeEvent(c)}),this.updateSchedule(e,l)}updateSchedule(e,t=[],s=!1){const r=this.events||[];if(r.length||t.length||this.length<2){const i=this.items,o=this.parseSchedule(r,e);(s||t.length||(i==null?void 0:i.length)!==o.length||o.some((l,c)=>Math.abs(l.playout.start-i[c].playout.start)>.005||Math.abs(l.playout.end-i[c].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,s){const r=[],i=Object.keys(e);for(let o=0;o<i.length;o++){const a=i[o],l=e[a];if(l.isInterstitial){let c=this.eventMap[a];c?c.setDateRange(l):(c=new Jae(l,t),this.eventMap[a]=c,s===!1&&(c.appendInPlace=s)),r.push(c)}}return r}parseSchedule(e,t){const s=[],r=t.main.details,i=r.live?1/0:r.edge;let o=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,c=0;if(e.forEach((d,h)=>{const f=d.cue.pre,m=d.cue.post,p=e[h-1]||null,y=d.appendInPlace,v=m?i:d.startOffset,x=d.duration,E=d.timelineOccupancy===M0.Range?x:0,w=d.resumptionOffset,b=(p==null?void 0:p.startTime)===v,C=v+d.cumulativeDuration;let D=y?C+x:v+w;if(f||!m&&v<=0){const S=c;c+=E,d.timelineStart=C;const I=o;o+=x,s.push({event:d,start:C,end:D,playout:{start:I,end:o},integrated:{start:S,end:c}})}else if(v<=i){if(!b){const R=v-l;if(R>yk){const N=l,L=c;c+=R;const M=o;o+=R;const G={previousEvent:e[h-1]||null,nextEvent:d,start:N,end:N+R,playout:{start:M,end:o},integrated:{start:L,end:c}};s.push(G)}else R>0&&p&&(p.cumulativeDuration+=R,s[s.length-1].end=v)}m&&(D=C),d.timelineStart=C;const S=c;c+=E;const I=o;o+=x,s.push({event:d,start:C,end:D,playout:{start:I,end:o},integrated:{start:S,end:c}})}else return;const _=d.resumeTime;m||_>i?l=i:l=_}),l<i){var a;const d=l,h=c,f=i-l;c+=f;const m=o;o+=f,s.push({previousEvent:((a=s[s.length-1])==null?void 0:a.event)||null,nextEvent:null,start:l,end:d+f,playout:{start:m,end:o},integrated:{start:h,end:c}})}this.setDurations(i,o,c)}else s.push({previousEvent:null,nextEvent:null,start:0,end:i,playout:{start:0,end:i},integrated:{start:0,end:i}}),this.setDurations(i,i,i);return s}setDurations(e,t,s){this.durations={primary:e,playout:t,integrated:s}}resolveOffsets(e,t){const s=t.main.details,r=s.live?1/0:s.edge;let i=0,o=-1;e.forEach((a,l)=>{const c=a.cue.pre,d=a.cue.post,h=c?0:d?r:a.startTime;this.updateAssetDurations(a),o===h?a.cumulativeDuration=i:(i=0,o=h),!d&&a.snapOptions.in&&(a.resumeAnchor=sc(null,s.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)),!a.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<yk&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${a}`));const m=le(a.resumeOffset)?a.resumeOffset:a.duration;i+=m})}primaryCanResumeInPlaceAt(e,t){const s=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(s-r)>Iu?(this.log(`"${e.identifier}" resumption ${s} not aligned with estimated timeline end ${r}`),!1):!Object.keys(t).some(o=>{const a=t[o].details,l=a.edge;if(s>=l)return this.log(`"${e.identifier}" resumption ${s} past ${o} playlist end ${l}`),!1;const c=sc(null,a.fragments,s);if(!c)return this.log(`"${e.identifier}" resumption ${s} does not align with any fragments in ${o} playlist (${a.fragStart}-${a.fragmentEnd})`),!0;const d=o==="audio"?.175:0;return Math.abs(c.start-s)<Iu+d||Math.abs(c.end-s)<Iu+d?!1:(this.log(`"${e.identifier}" resumption ${s} not aligned with ${o} fragment bounds (${c.start}-${c.end} sn: ${c.sn} cc: ${c.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let s=0,r=!1,i=!1;for(let o=0;o<e.assetList.length;o++){const a=e.assetList[o],l=t+s;a.startOffset=s,a.timelineStart=l,r||(r=a.duration===null),i||(i=!!a.error);const c=a.error?0:a.duration||0;s+=c}r&&!i?e.duration=Math.max(s,e.duration):e.duration=s}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Ir(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}class nle{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const s=e.assetListUrl;let r;try{r=BV(s,this.hls.sessionId,e.baseUrl)}catch(f){const m=this.assignAssetListError(e,W.ASSET_LIST_LOAD_ERROR,f,s);this.hls.trigger(P.ERROR,m);return}t&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+t);const i=this.hls.config,o=i.loader,a=new o(i),l={responseType:"json",url:r.href},c=i.interstitialAssetListLoadPolicy.default,d={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(f,m,p,y)=>{const v=f.data,x=v==null?void 0:v.ASSETS;if(!Array.isArray(x)){const E=this.assignAssetListError(e,W.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),p.url,m,y);this.hls.trigger(P.ERROR,E);return}e.assetListResponse=v,this.hls.trigger(P.ASSET_LIST_LOADED,{event:e,assetListResponse:v,networkDetails:y})},onError:(f,m,p,y)=>{const v=this.assignAssetListError(e,W.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${f.code} ${f.text} (${m.url})`),m.url,y,p);this.hls.trigger(P.ERROR,v)},onTimeout:(f,m,p)=>{const y=this.assignAssetListError(e,W.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${m.url})`),m.url,f,p);this.hls.trigger(P.ERROR,y)}};return a.load(l,d,h),this.hls.trigger(P.ASSET_LIST_LOADING,{event:e}),a}assignAssetListError(e,t,s,r,i,o){return e.error=s,{type:Te.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:s,networkDetails:o,stats:i}}}function vk(n){var e;n==null||(e=n.play())==null||e.catch(()=>{})}function Cp(n,e){return`[${n}] Advancing timeline position to ${e}`}class sle extends Tr{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled||!this.schedule)return;const r=s-this.timelinePos;if(Math.abs(r)<1/7056e5)return;const o=r<=-.01;this.timelinePos=s,this.bufferedPos=s;const a=this.playingItem;if(!a){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(s,s-r)&&this.updateSchedule(!0),this.checkBuffer(),o&&s<a.start||s>=a.end){var l;const m=this.findItemIndex(a);let p=this.schedule.findItemIndexAtTime(s);if(p===-1&&(p=m+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${s} (resolving from ${m} to ${p})`)),!this.isInterstitial(a)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!o&&p>m){const y=this.schedule.findJumpRestrictedIndex(m+1,p);if(y>m){this.setSchedulePosition(y);return}}this.setSchedulePosition(p);return}const c=this.playingAsset;if(!c){if(this.playingLastItem&&this.isInterstitial(a)){const m=a.event.assetList[0];m&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(s,m))}return}const d=c.timelineStart,h=c.duration||0;if(o&&s<d||s>=d+h){var f;(f=a.event)!=null&&f.appendInPlace&&(this.clearAssetPlayers(a.event,a),this.flushFrontBuffer(s)),this.setScheduleToAssetAtTime(s,c)}},this.onTimeupdate=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled)return;if(s>this.timelinePos)this.timelinePos=s,s>this.bufferedPos&&this.checkBuffer();else return;const r=this.playingItem;if(!r||this.playingLastItem)return;if(s>=r.end){this.timelinePos=r.end;const a=this.findItemIndex(r);this.setSchedulePosition(a+1)}const i=this.playingAsset;if(!i)return;const o=i.timelineStart+(i.duration||0);s>=o&&this.setScheduleToAssetAtTime(s,i)},this.onScheduleUpdate=(s,r)=>{const i=this.schedule;if(!i)return;const o=this.playingItem,a=i.events||[],l=i.items||[],c=i.durations,d=s.map(y=>y.identifier),h=!!(a.length||d.length);(h||r)&&this.log(`INTERSTITIALS_UPDATED (${a.length}): ${a}
Schedule: ${l.map(y=>Ir(y))} pos: ${this.timelinePos}`),d.length&&this.log(`Removed events ${d}`);let f=null,m=null;o&&(f=this.updateItem(o,this.timelinePos),this.itemsMatch(o,f)?this.playingItem=f:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const p=this.bufferingItem;if(p&&(m=this.updateItem(p,this.bufferedPos),this.itemsMatch(p,m)?this.bufferingItem=m:p.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(p.event,null))),s.forEach(y=>{y.assetList.forEach(v=>{this.clearAssetPlayer(v.identifier,null)})}),this.playerQueue.forEach(y=>{if(y.interstitial.appendInPlace){const v=y.assetItem.timelineStart,x=y.timelineOffset-v;if(x)try{y.timelineOffset=v}catch(E){Math.abs(x)>Iu&&this.warn(`${E} ("${y.assetId}" ${y.timelineOffset}->${v})`)}}}),h||r){if(this.hls.trigger(P.INTERSTITIALS_UPDATED,{events:a.slice(0),schedule:l.slice(0),durations:c,removedIds:d}),this.isInterstitial(o)&&d.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(f,o),p&&m!==f&&this.trimInPlace(m,p),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new nle(e),this.schedule=new tle(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(P.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(P.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(P.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(P.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(P.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(P.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(P.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(P.BUFFER_APPENDED,this.onBufferAppended,this),e.on(P.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(P.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(P.MEDIA_ENDED,this.onMediaEnded,this),e.on(P.ERROR,this.onError,this),e.on(P.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(P.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(P.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(P.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(P.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(P.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(P.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(P.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(P.BUFFER_CODECS,this.onBufferCodecs,this),e.off(P.BUFFER_APPENDED,this.onBufferAppended,this),e.off(P.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(P.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(P.MEDIA_ENDED,this.onMediaEnded,this),e.off(P.ERROR,this.onError,this),e.off(P.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){_s(e,"play",this.onPlay),_s(e,"pause",this.onPause),_s(e,"seeking",this.onSeeking),_s(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const s=this.media=t.media;ds(s,"seeking",this.onSeeking),ds(s,"timeupdate",this.onTimeupdate),ds(s,"play",this.onPlay),ds(s,"pause",this.onPause)}onMediaAttached(e,t){const s=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,s===null)this.checkStart();else if(!r){this.clearScheduleState();const i=this.findItemIndex(s);this.setSchedulePosition(i)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const s=!!t.transferMedia,r=this.media;if(this.media=null,!s&&(r&&this.removeMediaListeners(r),this.detachedData)){const i=this.getBufferingPlayer();i&&(this.log(`Removing schedule state for detachedData and ${i}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,i.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,s=h=>h&&e.getAssetPlayer(h.identifier),r=(h,f,m,p,y)=>{if(h){let v=h[f].start;const x=h.event;if(x){if(f==="playout"||x.timelineOccupancy!==M0.Point){const E=s(m);(E==null?void 0:E.interstitial)===x&&(v+=E.assetItem.startOffset+E[y])}}else{const E=p==="bufferedPos"?o():e[p];v+=E-h.start}return v}return 0},i=(h,f)=>{var m;if(h!==0&&f!=="primary"&&(m=e.schedule)!=null&&m.length){var p;const y=e.schedule.findItemIndexAtTime(h),v=(p=e.schedule.items)==null?void 0:p[y];if(v){const x=v[f].start-v.start;return h+x}}return h},o=()=>{const h=e.bufferedPos;return h===Number.MAX_VALUE?a("primary"):Math.max(h,0)},a=h=>{var f,m;return(f=e.primaryDetails)!=null&&f.live?e.primaryDetails.edge:((m=e.schedule)==null?void 0:m.durations[h])||0},l=(h,f)=>{var m,p;const y=e.effectivePlayingItem;if(y!=null&&(m=y.event)!=null&&m.restrictions.skip||!e.schedule)return;e.log(`seek to ${h} "${f}"`);const v=e.effectivePlayingItem,x=e.schedule.findItemIndexAtTime(h,f),E=(p=e.schedule.items)==null?void 0:p[x],w=e.getBufferingPlayer(),b=w==null?void 0:w.interstitial,C=b==null?void 0:b.appendInPlace,D=v&&e.itemsMatch(v,E);if(v&&(C||D)){const _=s(e.playingAsset),S=(_==null?void 0:_.media)||e.primaryMedia;if(S){const I=f==="primary"?S.currentTime:r(v,f,e.playingAsset,"timelinePos","currentTime"),R=h-I,N=(C?I:S.currentTime)+R;if(N>=0&&(!_||C||N<=_.duration)){S.currentTime=N;return}}}if(E){let _=h;if(f!=="primary"){const I=E[f].start,R=h-I;_=E.start+R}const S=!e.isInterstitial(E);if((!e.isInterstitial(v)||v.event.appendInPlace)&&(S||E.event.appendInPlace)){const I=e.media||(C?w==null?void 0:w.media:null);I&&(I.currentTime=_)}else if(v){const I=e.findItemIndex(v);if(x>I){const N=e.schedule.findJumpRestrictedIndex(I+1,x);if(N>I){e.setSchedulePosition(N);return}}let R=0;if(S)e.timelinePos=_,e.checkBuffer();else{const N=E.event.assetList,L=h-(E[f]||E).start;for(let M=N.length;M--;){const G=N[M];if(G.duration&&L>=G.startOffset&&L<G.startOffset+G.duration){R=M;break}}}e.setSchedulePosition(x,R)}}},c=()=>{const h=e.effectivePlayingItem;if(e.isInterstitial(h))return h;const f=t();return e.isInterstitial(f)?f:null},d={get bufferedEnd(){const h=t(),f=e.bufferingItem;if(f&&f===h){var m;return r(f,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-f.playout.start||((m=e.bufferingAsset)==null?void 0:m.startOffset)||0}return 0},get currentTime(){const h=c(),f=e.effectivePlayingItem;return f&&f===h?r(f,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-f.playout.start:0},set currentTime(h){const f=c(),m=e.effectivePlayingItem;m&&m===f&&l(h+m.playout.start,"playout")},get duration(){const h=c();return h?h.playout.end-h.playout.start:0},get assetPlayers(){var h;const f=(h=c())==null?void 0:h.event.assetList;return f?f.map(m=>e.getAssetPlayer(m.identifier)):[]},get playingIndex(){var h;const f=(h=c())==null?void 0:h.event;return f&&e.effectivePlayingAsset?f.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return c()}};return this.manager={get events(){var h;return((h=e.schedule)==null||(h=h.events)==null?void 0:h.slice(0))||[]},get schedule(){var h;return((h=e.schedule)==null||(h=h.items)==null?void 0:h.slice(0))||[]},get interstitialPlayer(){return c()?d:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const h=t();return e.findItemIndex(h)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const h=e.effectivePlayingItem;return e.findItemIndex(h)},primary:{get bufferedEnd(){return o()},get currentTime(){const h=e.timelinePos;return h>0?h:0},set currentTime(h){l(h,"primary")},get duration(){return a("primary")},get seekableStart(){var h;return((h=e.primaryDetails)==null?void 0:h.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(h){l(h,"integrated")},get duration(){return a("integrated")},get seekableStart(){var h;return i(((h=e.primaryDetails)==null?void 0:h.fragmentStart)||0,"integrated")}},skip:()=>{const h=e.effectivePlayingItem,f=h==null?void 0:h.event;if(f&&!f.restrictions.skip){const m=e.findItemIndex(h);if(f.appendInPlace){const p=h.playout.start+h.event.duration;l(p+.001,"playout")}else e.advanceAfterAssetEnded(f,m,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,s=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!s?!1:this.findItemIndex(t)===s.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let r=this.media;!r&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(r=this.primaryMedia);const i=(t=r)==null?void 0:t.currentTime;if(!(i===void 0||!le(i)))return i}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const s=this.getAssetPlayer(e);s&&this.transferMediaFromPlayer(s,t)}transferMediaFromPlayer(e,t){const s=e.interstitial.appendInPlace,r=e.media;if(s&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r){this.detachedData={media:r};return}const i=e.transferMedia();this.log(`transfer MediaSource from ${e} ${St(i)}`),this.detachedData=i}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var s,r;if(e.media===t)return;let i=null;const o=this.hls,a=e!==o,l=a&&e.interstitial.appendInPlace,c=(s=this.detachedData)==null?void 0:s.mediaSource;let d;if(o.media)l&&(i=o.transferMedia(),this.detachedData=i),d="Primary";else if(c){const p=this.getBufferingPlayer();p?(i=p.transferMedia(),d=`${p}`):d="detached MediaSource"}else d="detached media";if(!i){if(c)i=this.detachedData,this.log(`using detachedData: MediaSource ${St(i)}`);else if(!this.detachedData||o.media===t){const p=this.playerQueue;p.length>1&&p.forEach(y=>{if(a&&y.interstitial.appendInPlace!==l){const v=y.interstitial;this.clearInterstitial(y.interstitial,null),v.appendInPlace=!1,v.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${v}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const h=i&&"mediaSource"in i&&((r=i.mediaSource)==null?void 0:r.readyState)!=="closed",f=h&&i?i:t;this.log(`${h?"transfering MediaSource":"attaching media"} to ${a?e:"Primary"} from ${d} (media.currentTime: ${t.currentTime})`);const m=this.schedule;if(f===i&&m){const p=a&&e.assetId===m.assetIdAtEnd;f.overrides={duration:m.duration,endOfStream:!a||p,cueRemoval:!a}}e.attachMedia(f)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const s=this.timelinePos,r=this.effectivePlayingItem;if(s===-1){const i=this.hls.startPosition;if(this.log(Cp("checkStart",i)),this.timelinePos=i,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(i>=0||!this.primaryLive){const o=this.timelinePos=i>0?i:0,a=e.findItemIndexAtTime(o);this.setSchedulePosition(a)}}else if(r&&!this.playingItem){const i=e.findItemIndex(r);this.setSchedulePosition(i)}}advanceAssetBuffering(e,t){const s=e.event,r=s.findAssetIndex(t),i=Hx(s,r);if(!s.isAssetPastPlayoutLimit(i))this.bufferedToEvent(e,i);else if(this.schedule){var o;const a=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(e)+1];a&&this.bufferedToItem(a)}}advanceAfterAssetEnded(e,t,s){const r=Hx(e,s);if(e.isAssetPastPlayoutLimit(r)){if(this.schedule){const i=this.schedule.items;if(i){const o=t+1,a=i.length;if(o>=a){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.log(Cp("advanceAfterAssetEnded",l)),this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(o)}}}else{if(e.appendInPlace){const i=e.assetList[r];i&&this.advanceInPlace(i.timelineStart)}this.setSchedulePosition(t,r)}}setScheduleToAssetAtTime(e,t){const s=this.schedule;if(!s)return;const r=t.parentIdentifier,i=s.getEvent(r);if(i){const o=s.findEventIndex(r),a=s.findAssetIndex(i,e);this.advanceAfterAssetEnded(i,o,a-1)}}setSchedulePosition(e,t){var s;const r=(s=this.schedule)==null?void 0:s.items;if(!r||this.playbackDisabled)return;const i=e>=0?r[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${i&&Ir(i)}) pos: ${this.timelinePos}`);const o=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(o)){const d=o.event,h=this.playingAsset,f=h==null?void 0:h.identifier,m=f?this.getAssetPlayer(f):null;if(m&&f&&(!this.eventItemsMatch(o,i)||t!==void 0&&f!==d.assetList[t].identifier)){var l;const p=d.findAssetIndex(h);if(this.log(`INTERSTITIAL_ASSET_ENDED ${p+1}/${d.assetList.length} ${Gc(h)}`),this.endedAsset=h,this.playingAsset=null,this.hls.trigger(P.INTERSTITIAL_ASSET_ENDED,{asset:h,assetListIndex:p,event:d,schedule:r.slice(0),scheduleIndex:e,player:m}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(d,this.findItemIndex(this.playingItem),p);return}this.retreiveMediaSource(f,i),m.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&m.detachMedia()}if(!this.eventItemsMatch(o,i)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${d} ${Ir(o)}`),d.hasPlayed=!0,this.hls.trigger(P.INTERSTITIAL_ENDED,{event:d,schedule:r.slice(0),scheduleIndex:e}),d.cue.once)){var c;this.updateSchedule();const p=(c=this.schedule)==null?void 0:c.items;if(i&&p){const y=this.findItemIndex(i);this.advanceSchedule(y,p,t,o,a)}return}}this.advanceSchedule(e,r,t,o,a)}advanceSchedule(e,t,s,r,i){const o=this.schedule;if(!o)return;const a=t[e]||null,l=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(d=>{const h=d.interstitial,f=o.findEventIndex(h.identifier);(f<e||f>e+1)&&this.clearInterstitial(h,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const d=a.event;if(s===void 0){s=o.findAssetIndex(d,this.timelinePos);const p=Hx(d,s-1);if(d.isAssetPastPlayoutLimit(p)||d.appendInPlace&&this.timelinePos===a.end){this.advanceAfterAssetEnded(d,e,s);return}s=p}const h=this.waitingItem;this.assetsBuffered(a,l)||this.setBufferingItem(a);let f=this.preloadAssets(d,s);if(this.eventItemsMatch(a,h||r)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${Ir(a)} ${d.appendInPlace?"append in place":""}`),this.hls.trigger(P.INTERSTITIAL_STARTED,{event:d,schedule:t.slice(0),scheduleIndex:e})),!d.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${d}`);return}if(d.assetListLoader&&(d.assetListLoader.destroy(),d.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${d}`);return}this.waitingItem=this.endedItem=null,this.playingItem=a;const m=d.assetList[s];if(!m){this.advanceAfterAssetEnded(d,e,s||0);return}if(f||(f=this.getAssetPlayer(m.identifier)),f===null||f.destroyed){const p=d.assetList.length;this.warn(`asset ${s+1}/${p} player destroyed ${d}`),f=this.createAssetPlayer(d,m,s),f.loadSource()}if(!this.eventItemsMatch(a,this.bufferingItem)&&d.appendInPlace&&this.isAssetBuffered(m))return;this.startAssetPlayer(f,s,t,e,l),this.shouldPlay&&vk(f.media)}else a?(this.resumePrimary(a,e,r),this.shouldPlay&&vk(this.hls.media)):i&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,s){var r,i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Ir(e)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let a=this.timelinePos;(a<e.start||a>=e.end)&&(a=this.getPrimaryResumption(e,t),this.log(Cp("resumePrimary",a)),this.timelinePos=a),this.attachPrimary(a,e)}if(!s)return;const o=(i=this.schedule)==null?void 0:i.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Ir(e)}`),this.hls.trigger(P.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const s=e.start;if(this.primaryLive){const r=this.primaryDetails;if(t===0)return this.hls.startPosition;if(r&&(s<r.fragmentStart||s>r.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Ue.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,s){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const i=this.hls;i.media?this.checkBuffer():(this.transferMediaTo(i,r),s&&this.startLoadingPrimaryAt(e,s)),s||(this.log(Cp("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,s))}startLoadingPrimaryAt(e,t){var s;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((s=r.mainForwardBufferInfo)==null?void 0:s.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(P.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(P.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const s=this.hls.levels[t.level];if(!s.details)return;const r=ft(ft({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const s=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=ft(ft({},this.altSelection),{},{audio:s});return}const i=ft(ft({},r),{},{audio:s});this.mediaSelection=i}onSubtitleTrackUpdated(e,t){const s=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=ft(ft({},this.altSelection),{},{subtitles:s});return}const i=ft(ft({},r),{},{subtitles:s});this.mediaSelection=i}onAudioTrackSwitching(e,t){const s=IP(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setAudioOption(t)||r.setAudioOption(s)))}onSubtitleTrackSwitch(e,t){const s=IP(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setSubtitleOption(t)||t.id!==-1&&r.setSubtitleOption(s)))}onBufferCodecs(e,t){const s=t.tracks;s&&(this.requiredTracks=s)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let r=0;r<t.length;r++){const i=t[r];if(i.cue.post){var s;const o=this.schedule.findEventIndex(i.identifier),a=(s=this.schedule.items)==null?void 0:s[o];this.isInterstitial(a)&&this.eventItemsMatch(a,this.bufferingItem)&&this.bufferedToItem(a,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const s=this.findItemIndex(t);this.setSchedulePosition(s+1)}else this.shouldPlay=!1}updateItem(e,t){var s;const r=(s=this.schedule)==null?void 0:s.items;if(e&&r){const i=this.findItemIndex(e,t);return r[i]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((i,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(i.identifier,null)});const s=e.end+.25,r=Ue.bufferInfo(this.primaryMedia,s,0);(r.end>s||(r.nextStart||0)>s)&&(this.log(`trim buffered interstitial ${Ir(e)} (was ${Ir(t)})`),this.attachPrimary(s,null,!0),this.flushFrontBuffer(s))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var s;return!!t&&(e===t||e.event.identifier===((s=t.event)==null?void 0:s.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const s=this.mediaSelection;s&&((t=this.schedule)==null||t.updateSchedule(s,[],e))}checkBuffer(e){var t;const s=(t=this.schedule)==null?void 0:t.items;if(!s)return;const r=Ue.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,s,e)}updateBufferedPos(e,t,s){const r=this.schedule,i=this.bufferingItem;if(this.bufferedPos>e||!r)return;if(t.length===1&&this.itemsMatch(t[0],i)){this.bufferedPos=e;return}const o=this.playingItem,a=this.findItemIndex(o);let l=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var c;const d=this.findItemIndex(i),h=Math.min(d+1,t.length-1),f=t[h];if((l===-1&&i&&e>=i.end||(c=f.event)!=null&&c.appendInPlace&&e+.01>=f.start)&&(l=h),this.isInterstitial(i)){const m=i.event;if(h-a>1&&m.appendInPlace===!1||m.assetList.length===0&&m.assetListLoader)return}if(this.bufferedPos=e,l>d&&l>a)this.bufferedToItem(f);else{const m=this.primaryDetails;this.primaryLive&&m&&e>m.edge-m.targetduration&&f.start<m.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(f)&&this.preloadAssets(f.event,0)}}else s&&o&&!this.itemsMatch(o,i)&&(l===a?this.bufferedToItem(o):l===a+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(r=>{const i=this.getAssetPlayer(r.identifier);return!(i!=null&&i.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,s=this.schedule;if(!this.itemsMatch(e,t)&&s){const{items:r,events:i}=s;if(!r||!i)return t;const o=this.isInterstitial(e),a=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=a?a.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Ir(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const c=s.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((d,h)=>{const f=this.getAssetPlayer(d.identifier);f&&(h===c&&f.loadSource(),f.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(c=>c.pauseBuffering());this.hls.trigger(P.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:i.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const s=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(s!==null){this.bufferingAsset=null;const r=this.detachedData;r?r.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),s=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(s)}bufferedToEvent(e,t){const s=e.event,r=s.assetList.length===0&&!s.assetListLoader,i=s.cue.once;if(r||!i){const o=this.preloadAssets(s,t);if(o!=null&&o.interstitial.appendInPlace){const a=this.primaryMedia;a&&this.bufferAssetPlayer(o,a)}}}preloadAssets(e,t){const s=e.assetUrl,r=e.assetList.length,i=r===0&&!e.assetListLoader,o=e.cue.once;if(i){const l=e.timelineStart;if(e.appendInPlace){var a;const f=this.playingItem;!this.isInterstitial(f)&&(f==null||(a=f.nextEvent)==null?void 0:a.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let c,d=0;if(!this.playingItem&&this.primaryLive&&(d=this.hls.startPosition,d===-1&&(d=this.hls.liveSyncPosition||0)),d&&!(e.cue.pre||e.cue.post)){const f=d-l;f>0&&(c=Math.round(f*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${s?1:r} ${e}${c?` live-start: ${d} start-offset: ${c}`:""}`),s)return this.createAsset(e,0,0,l,e.duration,s);const h=this.assetListLoader.loadAssetList(e,c);h&&(e.assetListLoader=h)}else if(!o&&r){for(let c=t;c<r;c++){const d=e.assetList[c],h=this.getAssetPlayerQueueIndex(d.identifier);(h===-1||this.playerQueue[h].destroyed)&&!d.error&&this.createAssetPlayer(e,d,c)}const l=e.assetList[t];if(l){const c=this.getAssetPlayer(l.identifier);return c&&c.loadSource(),c}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(r=>{this.hls.trigger(P.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let s=0;s<t.length;s++)if(e===t[s].assetId)return s;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let s=0;s<e.length;s++)if(e[s].media===t)return e[s]}return null}createAsset(e,t,s,r,i,o){const a={parentIdentifier:e.identifier,identifier:Xae(e,o,t),duration:i,startOffset:s,timelineStart:r,uri:o};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,s){const r=this.hls,i=r.userConfig;let o=i.videoPreference;const a=r.loadLevelObj||r.levels[r.currentLevel];(o||a)&&(o=Et({},o),a.videoCodec&&(o.videoCodec=a.videoCodec),a.videoRange&&(o.allowedVideoRanges=[a.videoRange]));const l=r.audioTracks[r.audioTrack],c=r.subtitleTracks[r.subtitleTrack];let d=0;if(this.primaryLive||e.appendInPlace){const b=this.timelinePos-t.timelineStart;if(b>1){const C=t.duration;C&&b<C&&(d=b)}}const h=t.identifier,f=ft(ft({},i),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:h,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:d,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:l||i.audioPreference,subtitlePreference:c||i.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(f.timelineOffset=t.timelineStart));const m=f.cmcd;m!=null&&m.sessionId&&m.contentId&&(f.cmcd=Et({},m,{contentId:Xh(t.uri)})),this.getAssetPlayer(h)&&this.warn(`Duplicate date range identifier ${e} and asset ${h}`);const p=new ele(this.HlsPlayerClass,f,e,t);this.playerQueue.push(p),e.assetList[s]=t;let y=!0;const v=b=>{if(b.live){var C;const S=new Error(`Interstitials MUST be VOD assets ${e}`),I={fatal:!0,type:Te.OTHER_ERROR,details:W.INTERSTITIAL_ASSET_ITEM_ERROR,error:S},R=((C=this.schedule)==null?void 0:C.findEventIndex(e.identifier))||-1;this.handleAssetItemError(I,e,R,s,S.message);return}const D=b.edge-b.fragmentStart,_=t.duration;(y||_===null||D>_)&&(y=!1,this.log(`Interstitial asset "${h}" duration change ${_} > ${D}`),t.duration=D,this.updateSchedule())};p.on(P.LEVEL_UPDATED,(b,{details:C})=>v(C)),p.on(P.LEVEL_PTS_UPDATED,(b,{details:C})=>v(C)),p.on(P.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const x=(b,C)=>{const D=this.getAssetPlayer(h);if(D&&C.tracks){D.off(P.BUFFER_CODECS,x),D.tracks=C.tracks;const _=this.primaryMedia;this.bufferingAsset===D.assetItem&&_&&!D.media&&this.bufferAssetPlayer(D,_)}};p.on(P.BUFFER_CODECS,x);const E=()=>{var b;const C=this.getAssetPlayer(h);if(this.log(`buffered to end of asset ${C}`),!C||!this.schedule)return;const D=this.schedule.findEventIndex(e.identifier),_=(b=this.schedule.items)==null?void 0:b[D];this.isInterstitial(_)&&this.advanceAssetBuffering(_,t)};p.on(P.BUFFERED_TO_END,E);const w=b=>()=>{if(!this.getAssetPlayer(h)||!this.schedule)return;this.shouldPlay=!0;const D=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,D,b)};return p.once(P.MEDIA_ENDED,w(s)),p.once(P.PLAYOUT_LIMIT_REACHED,w(1/0)),p.on(P.ERROR,(b,C)=>{if(!this.schedule)return;const D=this.getAssetPlayer(h);if(C.details===W.BUFFER_STALLED_ERROR){if(D!=null&&D.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(C,e,this.schedule.findEventIndex(e.identifier),s,`Asset player error ${C.error} ${e}`)}),p.on(P.DESTROYING,()=>{if(!this.getAssetPlayer(h)||!this.schedule)return;const C=new Error(`Asset player destroyed unexpectedly ${h}`),D={fatal:!0,type:Te.OTHER_ERROR,details:W.INTERSTITIAL_ASSET_ITEM_ERROR,error:C};this.handleAssetItemError(D,e,this.schedule.findEventIndex(e.identifier),s,C.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Gc(t)}`),this.hls.trigger(P.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:s,event:e,player:p}),p}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(s=>{this.clearAssetPlayer(s.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const s=this.playerQueue[t];this.transferMediaFromPlayer(s,null),s.resetDetails()}}clearAssetPlayer(e,t){const s=this.getAssetPlayerQueueIndex(e);if(s!==-1){const r=this.playerQueue[s];this.log(`clear ${r} toSegment: ${t&&Ir(t)}`),this.transferMediaFromPlayer(r,t),this.playerQueue.splice(s,1),r.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,s,r,i){const{interstitial:o,assetItem:a,assetId:l}=e,c=o.assetList.length,d=this.playingAsset;this.endedAsset=null,this.playingAsset=a,(!d||d.identifier!==l)&&(d&&(this.clearAssetPlayer(d.identifier,s[r]),delete d.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${c} ${Gc(a)}`),this.hls.trigger(P.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:o,schedule:s.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,i)}bufferAssetPlayer(e,t){var s,r;if(!this.schedule)return;const{interstitial:i,assetItem:o}=e,a=this.schedule.findEventIndex(i.identifier),l=(s=this.schedule.items)==null?void 0:s[a];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=o;const c=this.getBufferingPlayer();if(c===e)return;const d=i.appendInPlace;if(d&&(c==null?void 0:c.interstitial.appendInPlace)===!1)return;const h=(c==null?void 0:c.tracks)||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(d&&o!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(h&&!SU(h,e.tracks)){const f=new Error(`Asset ${Gc(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(h)}')`),m={fatal:!0,type:Te.OTHER_ERROR,details:W.INTERSTITIAL_ASSET_ITEM_ERROR,error:f},p=i.findAssetIndex(o);this.handleAssetItemError(m,i,a,p,f.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,s=this.primaryMedia;if(!t||!s)return;const r=s.currentTime,i=t.findAssetIndex(e,r),o=e.assetList[i];if(o){const a=this.getAssetPlayer(o.identifier);if(a){const l=a.currentTime||r-o.timelineStart,c=a.duration-l;if(this.warn(`Stalled at ${l} of ${l+c} in ${a} ${e} (media.currentTime: ${r})`),l&&(c/s.playbackRate<.5||a.bufferedInPlaceToEnd(s))&&a.hls){const d=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,d,i)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,s,r,i){if(e.details===W.BUFFER_STALLED_ERROR)return;const o=t.assetList[r]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&Gc(o)} ${e.error}`),!this.schedule)return;const a=(o==null?void 0:o.identifier)||"",l=this.getAssetPlayerQueueIndex(a),c=this.playerQueue[l]||null,d=this.schedule.items,h=Et({},e,{fatal:!1,errorAction:Su(!0),asset:o,assetListIndex:r,event:t,schedule:d,scheduleIndex:s,player:c});if(this.hls.trigger(P.INTERSTITIAL_ASSET_ERROR,h),!e.fatal)return;const f=this.playingAsset,m=this.bufferingAsset,p=new Error(i);if(o&&(this.clearAssetPlayer(a,null),o.error=p),!t.assetList.some(y=>!y.error))t.error=p;else for(let y=r;y<t.assetList.length;y++)this.resetAssetPlayer(t.assetList[y].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):f&&f.identifier===a?this.advanceAfterAssetEnded(t,s,r):m&&m.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,m)}primaryFallback(e){const t=e.timelineStart,s=this.effectivePlayingItem;let r=this.timelinePos;if(s){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${r} playing: ${Ir(s)} error: ${e.error}`),r===-1&&(r=this.hls.startPosition);const o=this.updateItem(s,r);this.itemsMatch(s,o)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(r===-1){this.checkStart();return}if(!this.schedule)return;const i=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(i)}onAssetListLoaded(e,t){var s,r;const i=t.event,o=i.identifier,a=t.assetListResponse.ASSETS;if(!((s=this.schedule)!=null&&s.hasEvent(o)))return;const l=i.timelineStart,c=i.duration;let d=0;a.forEach((y,v)=>{const x=parseFloat(y.DURATION);this.createAsset(i,v,d,l+d,x,y.URI),d+=x}),i.duration=d,this.log(`Loaded asset-list with duration: ${d} (was: ${c}) ${i}`);const h=this.waitingItem,f=(h==null?void 0:h.event.identifier)===o;this.updateSchedule();const m=(r=this.bufferingItem)==null?void 0:r.event;if(f){var p;const y=this.schedule.findEventIndex(o),v=(p=this.schedule.items)==null?void 0:p[y];if(v){if(!this.playingItem&&this.timelinePos>v.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==y){i.error=new Error(`Interstitial ${a.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${i}`),this.log(i.error.message),this.updateSchedule(!0),this.primaryFallback(i);return}this.setBufferingItem(v)}this.setSchedulePosition(y)}else if((m==null?void 0:m.identifier)===o){const y=i.assetList[0];if(y){const v=this.getAssetPlayer(y.identifier);if(m.appendInPlace){const x=this.primaryMedia;v&&x&&this.bufferAssetPlayer(v,x)}else v&&v.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case W.ASSET_LIST_PARSING_ERROR:case W.ASSET_LIST_LOAD_ERROR:case W.ASSET_LIST_LOAD_TIMEOUT:{const s=t.interstitial;s&&(this.updateSchedule(!0),this.primaryFallback(s));break}case W.BUFFER_STALLED_ERROR:{const s=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&s.event.appendInPlace){this.handleInPlaceStall(s.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const xk=500;class rle extends n_{constructor(e,t,s){super(e,t,s,"subtitle-stream-controller",de.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(P.LEVEL_LOADED,this.onLevelLoaded,this),e.on(P.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(P.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(P.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(P.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(P.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(P.LEVEL_LOADED,this.onLevelLoaded,this),e.off(P.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(P.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(P.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(P.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(P.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=Z.IDLE,this.setInterval(xk),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:s,success:r}=t;if(this.fragContextChanged(s)||(sn(s)&&(this.fragPrevious=s),this.state=Z.IDLE),!r)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let o;const a=s.start;for(let c=0;c<i.length;c++)if(a>=i[c].start&&a<=i[c].end){o=i[c];break}const l=s.start+s.duration;o?o.end=l:(o={start:a,end:l},i.push(o)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:s,endOffset:r}=t;if(s===0&&r!==Number.POSITIVE_INFINITY){const i=r-1;if(i<=0)return;t.endOffsetSubtitles=Math.max(0,i),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;){if(o[a].end<=i){o.shift();continue}else if(o[a].start<i)o[a].start=i;else break;a++}}),this.fragmentTracker.removeFragmentsInRange(s,i,de.SUBTITLE)}}onError(e,t){const s=t.frag;(s==null?void 0:s.type)===de.SUBTITLE&&(t.details===W.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Z.STOPPED&&(this.state=Z.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&IV(this.levels,t)){this.levels=t.map(s=>new jf(s));return}this.tracksBuffered=[],this.levels=t.map(s=>{const r=new jf(s);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,de.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var s;if(this.currentTrackId=t.id,!((s=this.levels)!=null&&s.length)||this.currentTrackId===-1){this.clearInterval();return}const r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==Z.STOPPED&&this.setInterval(xk)}onSubtitleTrackLoaded(e,t){var s;const{currentTrackId:r,levels:i}=this,{details:o,id:a}=t;if(!i){this.warn(`Subtitle tracks were reset while loading level ${a}`);return}const l=i[a];if(a>=i.length||!l)return;this.log(`Subtitle track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(o.live||(s=l.details)!=null&&s.live){if(o.deltaUpdateFailed)return;const h=this.mainDetails;if(!h){this.startFragRequested=!1;return}const f=h.fragments[0];if(!l.details)o.hasProgramDateTime&&h.hasProgramDateTime?(L0(o,h),c=o.fragmentStart):f&&(c=f.start,ET(o,c));else{var d;c=this.alignPlaylists(o,l.details,(d=this.levelLastLoaded)==null?void 0:d.details),c===0&&f&&(c=f.start,ET(o,c))}h&&!this.startFragRequested&&this.setStartPosition(h,c)}l.details=o,this.levelLastLoaded=l,a===r&&(this.hls.trigger(P.SUBTITLE_TRACK_UPDATED,{details:o,id:a,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===Z.IDLE&&(sc(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:s}=e,r=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&r!=null&&r.key&&r.iv&&_u(r.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(s),r.key.buffer,r.iv.buffer,e_(r.method)).catch(a=>{throw i.trigger(P.ERROR,{type:Te.MEDIA_ERROR,details:W.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{const l=performance.now();i.trigger(P.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=Z.IDLE})}}doTick(){if(!this.media){this.state=Z.IDLE;return}if(this.state===Z.IDLE){const{currentTrackId:e,levels:t}=this,s=t==null?void 0:t[e];if(!s||!t.length||!s.details||this.waitForLive(s))return;const{config:r}=this,i=this.getLoadPosition(),o=Ue.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,r.maxBufferHole),{end:a,len:l}=o,c=s.details,d=this.hls.maxBufferLength+c.levelTargetDuration;if(l>d)return;const h=c.fragments,f=h.length,m=c.edge;let p=null;const y=this.fragPrevious;if(a<m){const E=r.maxFragLookUpTolerance,w=a>m-E?0:E;p=sc(y,h,Math.max(h[0].start,a),w),!p&&y&&y.start<h[0].start&&(p=h[0])}else p=h[f-1];if(p=this.filterReplacedPrimary(p,s.details),!p)return;const v=p.sn-c.startSN,x=h[v-1];if(x&&x.cc===p.cc&&this.fragmentTracker.getState(x)===xn.NOT_LOADED&&(p=x),this.fragmentTracker.getState(p)===xn.NOT_LOADED){const E=this.mapToInitFragWhenRequired(p);E&&this.loadFragment(E,s,a)}}}loadFragment(e,t,s){sn(e)?super.loadFragment(e,t,s):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new ile(this.tracksBuffered[this.currentTrackId]||[])}}class ile{constructor(e){this.buffered=void 0;const t=(s,r,i)=>{if(r=r>>>0,r>i-1)throw new DOMException(`Failed to execute '${s}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${i})`);return e[r][s]};this.buffered={get length(){return e.length},end(s){return t("end",s,e.length)},start(s){return t("start",s,e.length)}}}}const ole={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},GV=n=>String.fromCharCode(ole[n]||n),Rr=15,Fi=100,ale={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},lle={17:2,18:4,21:6,22:8,23:10,19:13,20:15},cle={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},ule={25:2,26:4,29:6,30:8,31:10,27:13,28:15},dle=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class hle{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const s=typeof t=="function"?t():t;mt.log(`${this.time} [${e}] ${s}`)}}}const ml=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class KV{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const r=t[s];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class fle{constructor(){this.uchar=" ",this.penState=new KV}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class mle{constructor(e){this.chars=[],this.pos=0,this.currPenState=new KV,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Fi;t++)this.chars.push(new fle);this.logger=e}equals(e){for(let t=0;t<Fi;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Fi;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Fi;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Fi&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Fi)}moveCursor(e){const t=this.pos+e;if(e>1)for(let s=this.pos+1;s<t+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=GV(e);if(this.pos>=Fi){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Fi;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let s=0;s<Fi;s++){const r=this.chars[s].uchar;r!==" "&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Wx{constructor(e){this.rows=[],this.currRow=Rr-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Rr;t++)this.rows.push(new mle(e));this.logger=e}reset(){for(let e=0;e<Rr;e++)this.rows[e].clear();this.currRow=Rr-1}equals(e){let t=!0;for(let s=0;s<Rr;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}copy(e){for(let t=0;t<Rr;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Rr;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+St(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let a=0;a<Rr;a++)this.rows[a].clear();const i=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const a=o.rows[i].cueStartTime,l=this.logger.time;if(a!==null&&l!==null&&a<l)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(o.rows[i+c])}}this.currRow=t;const s=this.rows[this.currRow];if(e.indent!==null){const i=e.indent,o=Math.max(i-1,0);s.setCursor(e.indent),e.color=s.chars[o].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+St(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let s="",r=-1;for(let i=0;i<Rr;i++){const o=this.rows[i].getTextString();o&&(r=i+1,e?t.push("Row "+r+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?s="["+t.join(" | ")+"]":s=t.join(`
`)),s}getTextAndFormat(){return this.rows}}class Ek{constructor(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Wx(s),this.nonDisplayedMemory=new Wx(s),this.lastOutputScreen=new Wx(s),this.currRollUpRow=this.displayedMemory.rows[Rr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Rr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let s=0;s<e.length;s++)this.writeScreen.insertChar(e[s]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[s]}this.logger.log(2,"MIDROW: "+St(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class wk{constructor(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory=gle(),this.logger=void 0;const r=this.logger=new hle;this.channels=[null,new Ek(e,t,r),new Ek(e+1,s,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let s=0;s<t.length;s+=2){const r=t[s]&127,i=t[s+1]&127;let o=!1,a=null;if(r===0&&i===0)continue;this.logger.log(3,()=>"["+ml([t[s],t[s+1]])+"] -> ("+ml([r,i])+")");const l=this.cmdHistory;if(r>=16&&r<=31){if(ple(r,i,l)){Pp(null,null,l),this.logger.log(3,()=>"Repeated command ("+ml([r,i])+") is dropped");continue}Pp(r,i,this.cmdHistory),o=this.parseCmd(r,i),o||(o=this.parseMidrow(r,i)),o||(o=this.parsePAC(r,i)),o||(o=this.parseBackgroundAttributes(r,i))}else Pp(null,null,l);if(!o&&(a=this.parseChars(r,i),a)){const d=this.currentChannel;d&&d>0?this.channels[d].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+ml([r,i])+" orig: "+ml([t[s],t[s+1]]))}}parseCmd(e,t){const s=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=33&&t<=35;if(!(s||r))return!1;const i=e===20||e===21||e===23?1:2,o=this.channels[i];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=i,!0}parseMidrow(e,t){let s=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?s=1:s=2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[s];return r?(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+ml([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let s;const r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,i=(e===16||e===24)&&t>=64&&t<=95;if(!(r||i))return!1;const o=e<=23?1:2;t>=64&&t<=95?s=o===1?ale[e]:cle[e]:s=o===1?lle[e]:ule[e];const a=this.channels[o];return a?(a.setPAC(this.interpretPAC(s,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let s;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?s=t-96:s=t-64,r.underline=(s&1)===1,s<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((s-16)/2)*4,r}parseChars(e,t){let s,r=null,i=null;if(e>=25?(s=2,i=e-8):(s=1,i=e),i>=17&&i<=19){let o;i===17?o=t+80:i===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+GV(o)+"' in channel "+s),r=[o]}else e>=32&&e<=127&&(r=t===0?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+ml(r).join(",")),r}parseBackgroundAttributes(e,t){const s=(e===16||e===24)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=45&&t<=47;if(!(s||r))return!1;let i;const o={};e===16||e===24?(i=Math.floor((t-32)/2),o.background=dle[i],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const a=e<=23?1:2;return this.channels[a].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Pp(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function Pp(n,e,t){t.a=n,t.b=e}function ple(n,e,t){return t.a===n&&t.b===e}function gle(){return{a:null,b:null}}var m_=function(){if(N0!=null&&N0.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;const c=l.toLowerCase();return~a.indexOf(c)?c:!1}function s(a){return t(n,a)}function r(a){return t(e,a)}function i(a,...l){let c=1;for(;c<arguments.length;c++){const d=arguments[c];for(const h in d)a[h]=d[h]}return a}function o(a,l,c){const d=this,h={enumerable:!0};d.hasBeenReset=!1;let f="",m=!1,p=a,y=l,v=c,x=null,E="",w=!0,b="auto",C="start",D=50,_="middle",S=50,I="middle";Object.defineProperty(d,"id",i({},h,{get:function(){return f},set:function(R){f=""+R}})),Object.defineProperty(d,"pauseOnExit",i({},h,{get:function(){return m},set:function(R){m=!!R}})),Object.defineProperty(d,"startTime",i({},h,{get:function(){return p},set:function(R){if(typeof R!="number")throw new TypeError("Start time must be set to a number.");p=R,this.hasBeenReset=!0}})),Object.defineProperty(d,"endTime",i({},h,{get:function(){return y},set:function(R){if(typeof R!="number")throw new TypeError("End time must be set to a number.");y=R,this.hasBeenReset=!0}})),Object.defineProperty(d,"text",i({},h,{get:function(){return v},set:function(R){v=""+R,this.hasBeenReset=!0}})),Object.defineProperty(d,"region",i({},h,{get:function(){return x},set:function(R){x=R,this.hasBeenReset=!0}})),Object.defineProperty(d,"vertical",i({},h,{get:function(){return E},set:function(R){const N=s(R);if(N===!1)throw new SyntaxError("An invalid or illegal string was specified.");E=N,this.hasBeenReset=!0}})),Object.defineProperty(d,"snapToLines",i({},h,{get:function(){return w},set:function(R){w=!!R,this.hasBeenReset=!0}})),Object.defineProperty(d,"line",i({},h,{get:function(){return b},set:function(R){if(typeof R!="number"&&R!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");b=R,this.hasBeenReset=!0}})),Object.defineProperty(d,"lineAlign",i({},h,{get:function(){return C},set:function(R){const N=r(R);if(!N)throw new SyntaxError("An invalid or illegal string was specified.");C=N,this.hasBeenReset=!0}})),Object.defineProperty(d,"position",i({},h,{get:function(){return D},set:function(R){if(R<0||R>100)throw new Error("Position must be between 0 and 100.");D=R,this.hasBeenReset=!0}})),Object.defineProperty(d,"positionAlign",i({},h,{get:function(){return _},set:function(R){const N=r(R);if(!N)throw new SyntaxError("An invalid or illegal string was specified.");_=N,this.hasBeenReset=!0}})),Object.defineProperty(d,"size",i({},h,{get:function(){return S},set:function(R){if(R<0||R>100)throw new Error("Size must be between 0 and 100.");S=R,this.hasBeenReset=!0}})),Object.defineProperty(d,"align",i({},h,{get:function(){return I},set:function(R){const N=r(R);if(!N)throw new SyntaxError("An invalid or illegal string was specified.");I=N,this.hasBeenReset=!0}})),d.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class yle{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function HV(n){function e(s,r,i,o){return(s|0)*3600+(r|0)*60+(i|0)+parseFloat(o||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class vle{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,s){for(let r=0;r<s.length;++r)if(t===s[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}}function WV(n,e,t,s){const r=s?n.split(s):[n];for(const i in r){if(typeof r[i]!="string")continue;const o=r[i].split(t);if(o.length!==2)continue;const a=o[0],l=o[1];e(a,l)}}const RT=new m_(0,0,""),kp=RT.align==="middle"?"middle":"center";function xle(n,e,t){const s=n;function r(){const a=HV(n);if(a===null)throw new Error("Malformed timestamp: "+s);return n=n.replace(/^[^\sa-zA-Z-]+/,""),a}function i(a,l){const c=new vle;WV(a,function(f,m){let p;switch(f){case"region":for(let y=t.length-1;y>=0;y--)if(t[y].id===m){c.set(f,t[y].region);break}break;case"vertical":c.alt(f,m,["rl","lr"]);break;case"line":p=m.split(","),c.integer(f,p[0]),c.percent(f,p[0])&&c.set("snapToLines",!1),c.alt(f,p[0],["auto"]),p.length===2&&c.alt("lineAlign",p[1],["start",kp,"end"]);break;case"position":p=m.split(","),c.percent(f,p[0]),p.length===2&&c.alt("positionAlign",p[1],["start",kp,"end","line-left","line-right","auto"]);break;case"size":c.percent(f,m);break;case"align":c.alt(f,m,["start",kp,"end","left","right"]);break}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical","");let d=c.get("line","auto");d==="auto"&&RT.line===-1&&(d=-1),l.line=d,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",kp);let h=c.get("position","auto");h==="auto"&&RT.position===50&&(h=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=h}function o(){n=n.replace(/^\s+/,"")}if(o(),e.startTime=r(),o(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+s);n=n.slice(3),o(),e.endTime=r(),o(),i(n,e)}function zV(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class Ele{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new yle,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function s(){let i=t.buffer,o=0;for(i=zV(i);o<i.length&&i[o]!=="\r"&&i[o]!==`
`;)++o;const a=i.slice(0,o);return i[o]==="\r"&&++o,i[o]===`
`&&++o,t.buffer=i.slice(o),a}function r(i){WV(i,function(o,a){},/:/)}try{let i="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;i=s();const a=i.match(/^()?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:i=s(),t.state){case"HEADER":/:/.test(i)?r(i):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new m_(0,0,""),t.state="CUE",i.indexOf("-->")===-1){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{xle(i,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const a=i.indexOf("-->")!==-1;if(!i||a&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=i}continue;case"BADCUE":i||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const wle=/\r\n|\n\r|\n|\r/g,zx=function(e,t,s=0){return e.slice(s,s+t.length)===t},Tle=function(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!le(t)||!le(s)||!le(r)||!le(i))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*s,t+=60*1e3*r,t+=60*60*1e3*i,t};function p_(n,e,t){return Xh(n.toString())+Xh(e.toString())+Xh(t)}const ble=function(e,t,s){let r=e[t],i=e[r.prevCC];if(!i||!i.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(o=i)!=null&&o.new;){var o;e.ccOffset+=r.start-i.start,r.new=!1,r=i,i=e[r.prevCC]}e.presentationOffset=s};function Sle(n,e,t,s,r,i,o){const a=new Ele,l=Zs(new Uint8Array(n)).trim().replace(wle,`
`).split(`
`),c=[],d=e?Poe(e.baseTime,e.timescale):0;let h="00:00.000",f=0,m=0,p,y=!0;a.oncue=function(v){const x=t[s];let E=t.ccOffset;const w=(f-d)/9e4;if(x!=null&&x.new&&(m!==void 0?E=t.ccOffset=x.start:ble(t,s,w)),w){if(!e){p=new Error("Missing initPTS for VTT MPEGTS");return}E=w-t.presentationOffset}const b=v.endTime-v.startTime,C=Bs((v.startTime+E-m)*9e4,r*9e4)/9e4;v.startTime=Math.max(C,0),v.endTime=Math.max(C+b,0);const D=v.text.trim();v.text=decodeURIComponent(encodeURIComponent(D)),v.id||(v.id=p_(v.startTime,v.endTime,D)),v.endTime>0&&c.push(v)},a.onparsingerror=function(v){p=v},a.onflush=function(){if(p){o(p);return}i(c)},l.forEach(v=>{if(y)if(zx(v,"X-TIMESTAMP-MAP=")){y=!1,v.slice(16).split(",").forEach(x=>{zx(x,"LOCAL:")?h=x.slice(6):zx(x,"MPEGTS:")&&(f=parseInt(x.slice(7)))});try{m=Tle(h)/1e3}catch(x){p=x}return}else v===""&&(y=!1);a.parse(v+`
`)}),a.flush()}const qx="stpp.ttml.im1t",qV=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,YV=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,_le={left:"start",center:"center",right:"end",start:"start",end:"end"};function Tk(n,e,t,s){const r=He(new Uint8Array(n),["mdat"]);if(r.length===0){s(new Error("Could not parse IMSC1 mdat"));return}const i=r.map(a=>Zs(a)),o=Coe(e.baseTime,1,e.timescale);try{i.forEach(a=>t(Ale(a,o)))}catch(a){s(a)}}function Ale(n,e){const r=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(i).reduce((h,f)=>(h[f]=r.getAttribute(`ttp:${f}`)||i[f],h),{}),a=r.getAttribute("xml:space")!=="preserve",l=bk(Yx(r,"styling","style")),c=bk(Yx(r,"layout","region")),d=Yx(r,"body","[begin]");return[].map.call(d,h=>{const f=QV(h,a);if(!f||!h.hasAttribute("begin"))return null;const m=Xx(h.getAttribute("begin"),o),p=Xx(h.getAttribute("dur"),o);let y=Xx(h.getAttribute("end"),o);if(m===null)throw Sk(h);if(y===null){if(p===null)throw Sk(h);y=m+p}const v=new m_(m-e,y-e,f);v.id=p_(v.startTime,v.endTime,v.text);const x=c[h.getAttribute("region")],E=l[h.getAttribute("style")],w=Ile(x,E,l),{textAlign:b}=w;if(b){const C=_le[b];C&&(v.lineAlign=C),v.align=b}return Et(v,w),v}).filter(h=>h!==null)}function Yx(n,e,t){const s=n.getElementsByTagName(e)[0];return s?[].slice.call(s.querySelectorAll(t)):[]}function bk(n){return n.reduce((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e},{})}function QV(n,e){return[].slice.call(n.childNodes).reduce((t,s,r)=>{var i;return s.nodeName==="br"&&r?t+`
`:(i=s.childNodes)!=null&&i.length?QV(s,e):e?t+s.textContent.trim().replace(/\s+/g," "):t+s.textContent},"")}function Ile(n,e,t){const s="http://www.w3.org/ns/ttml#styling";let r=null;const i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(r=t[o]),i.reduce((a,l)=>{const c=Qx(e,s,l)||Qx(n,s,l)||Qx(r,s,l);return c&&(a[l]=c),a},{})}function Qx(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function Sk(n){return new Error(`Could not parse ttml timestamp ${n}`)}function Xx(n,e){if(!n)return null;let t=HV(n);return t===null&&(qV.test(n)?t=Rle(n,e):YV.test(n)&&(t=Cle(n,e))),t}function Rle(n,e){const t=qV.exec(n),s=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+s/e.frameRate}function Cle(n,e){const t=YV.exec(n),s=Number(t[1]);switch(t[2]){case"h":return s*3600;case"m":return s*60;case"ms":return s*1e3;case"f":return s/e.frameRate;case"t":return s/e.tickRate}return s}class Np{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,s){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class Ple{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Ak(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(P.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(P.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(P.FRAG_LOADING,this.onFragLoading,this),e.on(P.FRAG_LOADED,this.onFragLoaded,this),e.on(P.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(P.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(P.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(P.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(P.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(P.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(P.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(P.FRAG_LOADING,this.onFragLoading,this),e.off(P.FRAG_LOADED,this.onFragLoaded,this),e.off(P.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(P.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(P.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(P.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(P.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Np(this,"textTrack1"),t=new Np(this,"textTrack2"),s=new Np(this,"textTrack3"),r=new Np(this,"textTrack4");this.cea608Parser1=new wk(1,e,t),this.cea608Parser2=new wk(3,s,r)}addCues(e,t,s,r,i){let o=!1;for(let a=i.length;a--;){const l=i[a],c=kle(l[0],l[1],t,s);if(c>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],s),o=!0,c/(s-t)>.5))return}if(o||i.push([t,s]),this.config.renderTextTracksNatively){const a=this.captionsTracks[e];this.Cues.newCue(a,t,s,r)}else{const a=this.Cues.newCue(null,t,s,r);this.hls.trigger(P.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:s,initPTS:r,timescale:i,trackId:o}){const{unparsedVttFrags:a}=this;s===de.MAIN&&(this.initPTS[t.cc]={baseTime:r,timescale:i,trackId:o}),a.length&&(this.unparsedVttFrags=[],a.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(P.FRAG_LOADED,l):this.hls.trigger(P.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:s}=this;if(s)for(let r=0;r<s.textTracks.length;r++){const i=s.textTracks[r];if(_k(i,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:s,media:r}=this,{label:i,languageCode:o}=t[e],a=this.getExistingTrack(i,o);if(a)s[e]=a,su(s[e]),VV(s[e],r);else{const l=this.createTextTrack("captions",i,o);l&&(l[e]=!0,s[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s=t.label,r={_id:e,label:s,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(P.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,s){const r=this.media;if(r)return r.addTextTrack(e,t,s)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const s=!!t.transferMedia;if(this.media=null,s)return;const{captionsTracks:r}=this;Object.keys(r).forEach(i=>{su(r[i]),delete r[i]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Ak(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let s=0;s<t.length;s++)su(t[s])}onSubtitleTracksUpdated(e,t){const s=t.subtitleTracks||[],r=s.some(i=>i.textCodec===qx);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(IV(this.tracks,s)){this.tracks=s;return}if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const o=this.media,a=o?Eg(o.textTracks):null;if(this.tracks.forEach((l,c)=>{let d;if(a){let h=null;for(let f=0;f<a.length;f++)if(a[f]&&_k(a[f],l)){h=a[f],a[f]=null;break}h&&(d=h)}if(d)su(d);else{const h=XV(l);d=this.createTextTrack(h,l.name,l.lang),d&&(d.mode="disabled")}d&&this.textTracks.push(d)}),a!=null&&a.length){const l=a.filter(c=>c!==null).map(c=>c.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(P.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(s=>{const r=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(!r)return;const i=`textTrack${r[1]}`,o=this.captionsProperties[i];o&&(o.label=s.name,s.lang&&(o.languageCode=s.lang),o.media=s)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===de.MAIN){var s,r;const{cea608Parser1:i,cea608Parser2:o,lastSn:a}=this,{cc:l,sn:c}=t.frag,d=(s=(r=t.part)==null?void 0:r.index)!=null?s:-1;i&&o&&(c!==a+1||c===a&&d!==this.lastPartIndex+1||l!==this.lastCc)&&(i.reset(),o.reset()),this.lastCc=l,this.lastSn=c,this.lastPartIndex=d}}onFragLoaded(e,t){const{frag:s,payload:r}=t;if(s.type===de.SUBTITLE)if(r.byteLength){const i=s.decryptdata,o="stats"in t;if(i==null||!i.encrypted||o){const a=this.tracks[s.level],l=this.vttCCs;l[s.cc]||(l[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),a&&a.textCodec===qx?this._parseIMSC1(s,r):this._parseVTTs(t)}}else this.hls.trigger(P.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const s=this.hls;Tk(t,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),s.trigger(P.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{s.logger.log(`Failed to parse IMSC1: ${r}`),s.trigger(P.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var t;const{frag:s,payload:r}=e,{initPTS:i,unparsedVttFrags:o}=this,a=i.length-1;if(!i[s.cc]&&a===-1){o.push(e);return}const l=this.hls,c=(t=s.initSegment)!=null&&t.data?Er(s.initSegment.data,new Uint8Array(r)).buffer:r;Sle(c,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,d=>{this._appendCues(d,s.level),l.trigger(P.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},d=>{const h=d.message==="Missing initPTS for VTT MPEGTS";h?o.push(e):this._fallbackToIMSC1(s,r),l.logger.log(`Failed to parse VTT cue: ${d}`),!(h&&a>s.cc)&&l.trigger(P.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:d})})}_fallbackToIMSC1(e,t){const s=this.tracks[e.level];s.textCodec||Tk(t,this.initPTS[e.cc],()=>{s.textCodec=qx,this._parseIMSC1(e,t)},()=>{s.textCodec="wvtt"})}_appendCues(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||r.mode==="disabled")return;e.forEach(i=>$V(r,i))}else{const r=this.tracks[t];if(!r)return;const i=r.default?"default":"subtitles"+t;s.trigger(P.CUES_PARSED,{type:"subtitles",cues:e,track:i})}}onFragDecrypted(e,t){const{frag:s}=t;s.type===de.SUBTITLE&&this.onFragLoaded(P.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:r}=t;if(!(s.type===de.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let i=0;i<r.length;i++){const o=r[i].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const a=this.extractCea608Data(o);this.cea608Parser1.addData(r[i].pts,a[0]),this.cea608Parser2.addData(r[i].pts,a[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:s,endOffsetSubtitles:r,type:i}){const{media:o}=this;if(!(!o||o.currentTime<s)){if(!i||i==="video"){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>IT(a[l],t,s))}if(this.config.renderTextTracksNatively&&t===0&&r!==void 0){const{textTracks:a}=this;Object.keys(a).forEach(l=>IT(a[l],t,r))}}}extractCea608Data(e){const t=[[],[]],s=e[0]&31;let r=2;for(let i=0;i<s;i++){const o=e[r++],a=127&e[r++],l=127&e[r++];if(a===0&&l===0)continue;if((4&o)!==0){const d=3&o;(d===0||d===1)&&(t[d].push(a),t[d].push(l))}}return t}}function XV(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function _k(n,e){return!!n&&n.kind===XV(e)&&bT(e,n)}function kle(n,e,t,s){return Math.min(e,s)-Math.max(n,t)}function Ak(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const Nle=/\s/,Lle={newCue(n,e,t,s){const r=[];let i,o,a,l,c;const d=self.VTTCue||self.TextTrackCue;for(let f=0;f<s.rows.length;f++)if(i=s.rows[f],a=!0,l=0,c="",!i.isEmpty()){var h;for(let y=0;y<i.chars.length;y++)Nle.test(i.chars[y].uchar)&&a?l++:(c+=i.chars[y].uchar,a=!1);i.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const m=zV(c.trim()),p=p_(e,t,m);n!=null&&(h=n.cues)!=null&&h.getCueById(p)||(o=new d(e,t,m),o.id=p,o.line=f+1,o.align="left",o.position=10+Math.min(80,Math.floor(l*8/32)*10),r.push(o))}return n&&r.length&&(r.sort((f,m)=>f.line==="auto"||m.line==="auto"?0:f.line>8&&m.line>8?m.line-f.line:f.line-m.line),r.forEach(f=>$V(n,f))),r}};function Dle(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const Mle=/(\d+)-(\d+)\/(\d+)/;class Ik{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Ule,this.controller=new self.AbortController,this.stats=new z1}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,s){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const i=Ole(e,this.controller.signal),o=e.responseType==="arraybuffer",a=o?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=l&&le(l)?l:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout),(Vf(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(h=>{var f;this.response=this.loader=h;const m=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},c-(m-r.loading.start)),!h.ok){const{status:y,statusText:v}=h;throw new Vle(v||"fetch, bad network response",y,h)}r.loading.first=m,r.total=Fle(h.headers)||r.total;const p=(f=this.callbacks)==null?void 0:f.onProgress;return p&&le(t.highWaterMark)?this.loadProgressively(h,r,e,t.highWaterMark,p):o?h.arrayBuffer():e.responseType==="json"?h.json():h.text()}).then(h=>{var f,m;const p=this.response;if(!p)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const y=h[a];y&&(r.loaded=r.total=y);const v={url:p.url,data:h,code:p.status},x=(f=this.callbacks)==null?void 0:f.onProgress;x&&!le(t.highWaterMark)&&x(r,e,h,p),(m=this.callbacks)==null||m.onSuccess(v,r,e,p)}).catch(h=>{var f;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const m=h&&h.code||0,p=h?h.message:null;(f=this.callbacks)==null||f.onError({code:m,text:p},e,h?h.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,s,r=0,i){const o=new aV,a=e.body.getReader(),l=()=>a.read().then(c=>{if(c.done)return o.dataLength&&i(t,s,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const d=c.value,h=d.length;return t.loaded+=h,h<r||o.dataLength?(o.push(d),o.dataLength>=r&&i(t,s,o.flush().buffer,e)):i(t,s,d.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function Ole(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Et({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function jle(n){const e=Mle.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function Fle(n){const e=n.get("Content-Range");if(e){const s=jle(e);if(le(s))return s}const t=n.get("Content-Length");if(t)return parseInt(t)}function Ule(n,e){return new self.Request(n.url,e)}class Vle extends Error{constructor(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const $le=/^age:\s*[\d.]+\s*$/im;class JV{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new z1,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(!(this.loader!==s||this.stats.aborted))return i(s,t.url)}).catch(o=>{if(!(this.loader!==s||this.stats.aborted))return s.open("GET",t.url,!0),i(s,t.url)}).then(()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)}).catch(o=>{var a;(a=this.callbacks)==null||a.onError({code:s.status,text:o.message},t,s,r)}):this.openAndSendXhr(s,t,e)}openAndSendXhr(e,t,s){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:o}=s.loadPolicy;if(r)for(const a in r)e.setRequestHeader(a,r[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=i&&le(i)?i:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:s}=this;if(!e||!t)return;const r=t.readyState,i=this.config;if(!s.aborted&&r>=2&&(s.loading.first===0&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const c=t.status,d=t.responseType==="text"?t.responseText:null;if(c>=200&&c<300){const p=d??t.response;if(p!=null){var o,a;s.loading.end=Math.max(self.performance.now(),s.loading.first);const y=t.responseType==="arraybuffer"?p.byteLength:p.length;s.loaded=s.total=y,s.bwEstimate=s.total*8e3/(s.loading.end-s.loading.first);const v=(o=this.callbacks)==null?void 0:o.onProgress;v&&v(s,e,p,t);const x={url:t.responseURL,data:p,code:c};(a=this.callbacks)==null||a.onSuccess(x,s,e,t);return}}const h=i.loadPolicy.errorRetry,f=s.retry,m={url:e.url,data:void 0,code:c};if(P0(h,f,!1,m))this.retry(h);else{var l;mt.error(`${c} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:c,text:t.statusText},e,t,s)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(P0(e,t,!0))this.retry(e);else{var s;mt.warn(`timeout while loading ${(s=this.context)==null?void 0:s.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:s}=this;this.retryDelay=X1(e,s.retry),s.retry++,mt.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${s.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&$le.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const Ble={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},Gle=ft(ft({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:JV,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:tie,bufferController:Hoe,capLevelController:d_,errorController:oie,fpsController:Wae,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:QU,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:Ble},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},Kle()),{},{subtitleStreamController:rle,subtitleTrackController:Yae,timelineController:Ple,audioStreamController:$oe,audioTrackController:Boe,emeController:Au,cmcdController:Bae,contentSteeringController:Kae,interstitialsController:sle});function Kle(){return{cueHandler:Lle,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function Hle(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const s=CT(n),r=["manifest","level","frag"],i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(o=>{const a=`${o==="level"?"playlist":o}LoadPolicy`,l=e[a]===void 0,c=[];i.forEach(d=>{const h=`${o}Loading${d}`,f=e[h];if(f!==void 0&&l){c.push(h);const m=s[a].default;switch(e[a]={default:m},d){case"TimeOut":m.maxLoadTimeMs=f,m.maxTimeToFirstByteMs=f;break;case"MaxRetry":m.errorRetry.maxNumRetry=f,m.timeoutRetry.maxNumRetry=f;break;case"RetryDelay":m.errorRetry.retryDelayMs=f,m.timeoutRetry.retryDelayMs=f;break;case"MaxRetryTimeout":m.errorRetry.maxRetryDelayMs=f,m.timeoutRetry.maxRetryDelayMs=f;break}}}),c.length&&t.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${a}": ${St(e[a])}`)}),ft(ft({},s),e)}function CT(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(CT):Object.keys(n).reduce((e,t)=>(e[t]=CT(n[t]),e),{}):n}function Wle(n,e){const t=n.loader;t!==Ik&&t!==JV?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):Dle()&&(n.loader=Ik,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const wg=2,zle=.1,qle=.05,Yle=100;class Qle extends HU{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var s;(s=this.media)!=null&&s.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var s;this.ended=((s=this.media)==null?void 0:s.currentTime)||1,this.hls.trigger(P.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(P.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(P.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(Yle),this.mediaSource=t.mediaSource;const s=this.media=t.media;ds(s,"playing",this.onMediaPlaying),ds(s,"waiting",this.onMediaWaiting),ds(s,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:s}=this;s&&(_s(s,"playing",this.onMediaPlaying),_s(s,"waiting",this.onMediaWaiting),_s(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var s,r;const i=(s=this.hls)==null?void 0:s.config;if(!i)return;const o=this.media;if(!o)return;const{seeking:a}=o,l=this.seeking&&!a,c=!this.seeking&&a,d=o.paused&&!a||o.ended||o.playbackRate===0;if(this.seeking=a,e!==t){t&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,i.nudgeOnVideoHole&&!d&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||l){l&&this.stallResolved(e);return}if(d){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(P.MEDIA_ENDED,{stalled:!1}));return}if(!Ue.getBuffered(o).length){this.nudgeRetry=0;return}const h=Ue.bufferInfo(o,e,0),f=h.nextStart||0,m=this.fragmentTracker;if(a&&m&&this.hls){const D=Rk(this.hls.inFlightFragments,e),_=h.len>wg,S=!f||D||f-e>wg&&!m.getPartialFragment(e);if(_||S)return;this.moved=!1}const p=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&m){if(!(h.len>0)&&!f)return;const _=Math.max(f,h.start||0)-e,I=!!(p!=null&&p.live)?p.targetduration*2:wg,R=Lp(e,m);if(_>0&&(_<=I||R)){o.paused||this._trySkipBufferHole(R);return}}const y=i.detectStallWithCurrentTimeMs,v=self.performance.now(),x=this.waiting;let E=this.stalled;if(E===null)if(x>0&&v-x<y)E=this.stalled=x;else{this.stalled=v;return}const w=v-E;if(!a&&(w>=y||x)&&this.hls){var b;if(((b=this.mediaSource)==null?void 0:b.readyState)==="ended"&&!(p!=null&&p.live)&&Math.abs(e-((p==null?void 0:p.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(P.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(h),!this.media||!this.hls)return}const C=Ue.bufferInfo(o,e,i.maxBufferHole);this._tryFixBufferStall(C,w,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(P.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var s;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(s=this.buffered.audio)!=null&&s.length&&r&&r.length>1&&e>r.end(0)){const i=Ue.bufferedInfo(Ue.timeRangesToArray(this.buffered.audio),e,0);if(i.len>1&&t>=i.start){const o=Ue.timeRangesToArray(r),a=Ue.bufferedInfo(o,t,0).bufferedIndex;if(a>-1&&a<o.length-1){const l=Ue.bufferedInfo(o,e,0).bufferedIndex,c=o[a].end,d=o[a+1].start;if((l===-1||l>a)&&d-c<1&&e-c<2){const h=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${c} -> ${d} buffered index: ${l}`);this.warn(h.message),this.media.currentTime+=1e-6;let f=Lp(e,this.fragmentTracker);f&&"fragment"in f?f=f.fragment:f||(f=void 0);const m=Ue.bufferInfo(this.media,e,0);this.hls.trigger(P.ERROR,{type:Te.MEDIA_ERROR,details:W.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:h,reason:h.message,frag:f,buffer:m.len,bufferInfo:m})}}}}}_tryFixBufferStall(e,t,s){var r,i;const{fragmentTracker:o,media:a}=this,l=(r=this.hls)==null?void 0:r.config;if(!a||!o||!l)return;const c=(i=this.hls)==null?void 0:i.latestLevelDetails,d=Lp(s,o);if((d||c!=null&&c.live&&s<c.fragmentStart)&&(this._trySkipBufferHole(d)||!this.media))return;const h=e.buffered,f=this.adjacentTraversal(e,s);(h&&h.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-s<l.maxBufferHole||f))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const s=this.fragmentTracker,r=e.nextStart;if(s&&r){const i=s.getFragAtPos(t,de.MAIN),o=s.getFragAtPos(r,de.MAIN);if(i&&o)return o.sn-i.sn<2}return!1}_reportStall(e){const{hls:t,media:s,stallReported:r,stalled:i}=this;if(!r&&i!==null&&s&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${St(e)})`);this.warn(o.message),t.trigger(P.ERROR,{type:Te.MEDIA_ERROR,details:W.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:i}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:s,media:r}=this,i=(t=this.hls)==null?void 0:t.config;if(!r||!s||!i)return 0;const o=r.currentTime,a=Ue.bufferInfo(r,o,0),l=o<a.start?a.start:a.nextStart;if(l&&this.hls){const d=a.len<=i.maxBufferHole,h=a.len>0&&a.len<1&&r.readyState<3,f=l-o;if(f>0&&(d||h)){if(f>i.maxBufferHole){let p=!1;if(o===0){const y=s.getAppendedFrag(0,de.MAIN);y&&l<y.end&&(p=!0)}if(!p&&e){var c;if(!((c=this.hls.loadLevelObj)!=null&&c.details)||Rk(this.hls.inFlightFragments,l))return 0;let v=!1,x=e.end;for(;x<l;){const E=Lp(x,s);if(E)x+=E.duration;else{v=!0;break}}if(v)return 0}}const m=Math.max(l+qle,o+zle);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${m}`),this.moved=!0,r.currentTime=m,!(e!=null&&e.gap)){const p=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${m}`),y={type:Te.MEDIA_ERROR,details:W.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,buffer:a.len,bufferInfo:a};e&&("fragment"in e?y.part=e:y.frag=e),this.hls.trigger(P.ERROR,y)}return m}}return 0}_tryNudgeBuffer(e){const{hls:t,media:s,nudgeRetry:r}=this,i=t==null?void 0:t.config;if(!s||!i)return 0;const o=s.currentTime;if(this.nudgeRetry++,r<i.nudgeMaxRetry){const a=o+(r+1)*i.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${o} to ${a}`);this.warn(l.message),s.currentTime=a,t.trigger(P.ERROR,{type:Te.MEDIA_ERROR,details:W.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const a=new Error(`Playhead still not moving while enough data buffered @${o} after ${i.nudgeMaxRetry} nudges`);this.error(a.message),t.trigger(P.ERROR,{type:Te.MEDIA_ERROR,details:W.BUFFER_STALLED_ERROR,error:a,fatal:!0,buffer:e.len,bufferInfo:e})}}}function Rk(n,e){const t=Ck(n.main);if(t&&t.start<=e)return t;const s=Ck(n.audio);return s&&s.start<=e?s:null}function Ck(n){if(!n)return null;switch(n.state){case Z.IDLE:case Z.STOPPED:case Z.ENDED:case Z.ERROR:return null}return n.frag}function Lp(n,e){return e.getAppendedFrag(n,de.MAIN)||e.getPartialFragment(n)}const Xle=.25;function PT(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Jx(n,e,t,s,r){let i=new n(e,t,"");try{i.value=s,r&&(i.type=r)}catch{i=new n(e,t,St(r?ft({type:r},s):s))}return i}const Dp=(()=>{const n=PT();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class Jle{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(P.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(P.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(P.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(P.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(P.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(P.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(P.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(P.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(P.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var s;this.media=t.media,((s=t.overrides)==null?void 0:s.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&su(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if(s.kind==="metadata"&&s.label==="id3")return VV(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:s,enableID3MetadataCues:r}=this.hls.config;if(!s&&!r)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=PT();if(o)for(let a=0;a<i.length;a++){const l=i[a].type;if(l===Hs.emsg&&!s||!r)continue;const c=mV(i[a].data),d=i[a].pts;let h=d+i[a].duration;h>Dp&&(h=Dp),h-d<=0&&(h=d+Xle);for(let m=0;m<c.length;m++){const p=c[m];if(!pV(p)){this.updateId3CueEnds(d,l);const y=Jx(o,d,h,p,l);y&&this.id3Track.addCue(y)}}}}updateId3CueEnds(e,t){var s;const r=(s=this.id3Track)==null?void 0:s.cues;if(r)for(let i=r.length;i--;){const o=r[i];o.type===t&&o.startTime<e&&o.endTime===Dp&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:s,type:r}){const{id3Track:i,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(i&&(a||l)){let c;r==="audio"?c=d=>d.type===Hs.audioId3&&l:r==="video"?c=d=>d.type===Hs.emsg&&a:c=d=>d.type===Hs.audioId3&&l||d.type===Hs.emsg&&a,IT(i,t,s,c)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:s,timelineOffset:r,enableDateRangeMetadataCues:i,interstitialsController:o}=this.hls.config;if(!i)return;const a=PT();if(s&&r&&!o){const{fragmentStart:y,fragmentEnd:v}=e;let x=this.assetCue;x?(x.startTime=y,x.endTime=v):a&&(x=this.assetCue=Jx(a,y,v,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),x&&(x.id=s,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(x),x.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:c}=e,d=Object.keys(c);let h=this.dateRangeCuesAppended;if(l&&t){var f;if((f=l.cues)!=null&&f.length){const y=Object.keys(h).filter(v=>!d.includes(v));for(let v=y.length;v--;){var m;const x=y[v],E=(m=h[x])==null?void 0:m.cues;delete h[x],E&&Object.keys(E).forEach(w=>{const b=E[w];if(b){b.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(b)}catch{}}})}}else h=this.dateRangeCuesAppended={}}const p=e.fragments[e.fragments.length-1];if(!(d.length===0||!le(p==null?void 0:p.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let y=0;y<d.length;y++){const v=d[y],x=c[v],E=x.startTime,w=h[v],b=(w==null?void 0:w.cues)||{};let C=(w==null?void 0:w.durationKnown)||!1,D=Dp;const{duration:_,endDate:S}=x;if(S&&_!==null)D=E+_,C=!0;else if(x.endOnNext&&!C){const R=d.reduce((N,L)=>{if(L!==x.id){const M=c[L];if(M.class===x.class&&M.startDate>x.startDate&&(!N||x.startDate<N.startDate))return M}return N},null);R&&(D=R.startTime,C=!0)}const I=Object.keys(x.attr);for(let R=0;R<I.length;R++){const N=I[R];if(!xie(N))continue;const L=b[N];if(L)C&&!(w!=null&&w.durationKnown)?L.endTime=D:Math.abs(L.startTime-E)>.01&&(L.startTime=E,L.endTime=D);else if(a){let M=x.attr[N];Eie(N)&&(M=_U(M));const V=Jx(a,E,D,{key:N,data:M},Hs.dateRange);V&&(V.id=v,this.id3Track.addCue(V),b[N]=V,o&&(N==="X-ASSET-LIST"||N==="X-ASSET-URL")&&V.addEventListener("enter",this.onEventCueEnter))}}h[v]={cues:b,dateRange:x,durationKnown:C}}}}}class Zle{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,s=this.levelDetails;if(!t||!s)return;this.currentTime=t.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:o}=this.config;if(!i||o===1||!s.live)return;const a=this.targetLatency;if(a===null)return;const l=r-a,c=Math.min(this.maxLatency,a+s.targetduration);if(l<c&&l>.05&&this.forwardBufferLength>1){const h=Math.min(2,Math.max(1,o)),f=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,m=Math.min(h,Math.max(1,f));this.changeMediaPlaybackRate(t,m)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:s,targetduration:r}=e,{liveSyncDuration:i,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let c=a&&s||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||c===0)&&(c=i!==void 0?i:o*r);const d=r;return c+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,d)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const s=this.levelDetails;if(s===null)return null;const r=s.edge,i=e-t-this.edgeStalled,o=r-s.totalduration,a=r-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(o,i),a)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(P.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(P.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(P.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(P.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var s;t.details===W.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(s=this.levelDetails)!=null&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var s,r;e.playbackRate!==t&&((s=this.hls)==null||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class ece extends u_{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(P.LEVEL_LOADED,this.onLevelLoaded,this),e.on(P.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(P.FRAG_BUFFERED,this.onFragBuffered,this),e.on(P.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(P.LEVEL_LOADED,this.onLevelLoaded,this),e.off(P.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(P.FRAG_BUFFERED,this.onFragBuffered,this),e.off(P.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const s=this.hls.config.preferManagedMediaSource,r=[],i={},o={};let a=!1,l=!1,c=!1;t.levels.forEach(d=>{const h=d.attrs;let{audioCodec:f,videoCodec:m}=d;f&&(d.audioCodec=f=A0(f,s)||void 0),m&&(m=d.videoCodec=Ore(m));const{width:p,height:y,unknownCodecs:v}=d,x=(v==null?void 0:v.length)||0;if(a||(a=!!(p&&y)),l||(l=!!m),c||(c=!!f),x||f&&!this.isAudioSupported(f)||m&&!this.isVideoSupported(m)){this.log(`Some or all CODECS not supported "${h.CODECS}"`);return}const{CODECS:E,"FRAME-RATE":w,"HDCP-LEVEL":b,"PATHWAY-ID":C,RESOLUTION:D,"VIDEO-RANGE":_}=h,I=`${`${C||"."}-`}${d.bitrate}-${D}-${w}-${E}-${_}-${b}`;if(i[I])if(i[I].uri!==d.url&&!d.attrs["PATHWAY-ID"]){const R=o[I]+=1;d.attrs["PATHWAY-ID"]=new Array(R+1).join(".");const N=this.createLevel(d);i[I]=N,r.push(N)}else i[I].addGroupId("audio",h.AUDIO),i[I].addGroupId("text",h.SUBTITLES);else{const R=this.createLevel(d);i[I]=R,o[I]=1,r.push(R)}}),this.filterAndSortMediaOptions(r,t,a,l,c)}createLevel(e){const t=new jf(e),s=e.supplemental;if(s!=null&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const r=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(r.message),t.supportedResult=jU(r,[])}return t}isAudioSupported(e){return Mf(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Mf(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,s,r,i){var o;let a=[],l=[],c=e;const d=((o=t.stats)==null?void 0:o.parsing)||{};if((s||r)&&i&&(c=c.filter(({videoCodec:E,videoRange:w,width:b,height:C})=>(!!E||!!(b&&C))&&Wre(w))),c.length===0){Promise.resolve().then(()=>{if(this.hls){let E="no level with compatible codecs found in manifest",w=E;t.levels.length&&(w=`one or more CODECS in variant not supported: ${St(t.levels.map(C=>C.attrs.CODECS).filter((C,D,_)=>_.indexOf(C)===D))}`,this.warn(w),E+=` (${w})`);const b=new Error(E);this.hls.trigger(P.ERROR,{type:Te.MEDIA_ERROR,details:W.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:b,reason:w})}}),d.end=performance.now();return}t.audioTracks&&(a=t.audioTracks.filter(E=>!E.audioCodec||this.isAudioSupported(E.audioCodec)),Pk(a)),t.subtitles&&(l=t.subtitles,Pk(l));const h=c.slice(0);c.sort((E,w)=>{if(E.attrs["HDCP-LEVEL"]!==w.attrs["HDCP-LEVEL"])return(E.attrs["HDCP-LEVEL"]||"")>(w.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&E.height!==w.height)return E.height-w.height;if(E.frameRate!==w.frameRate)return E.frameRate-w.frameRate;if(E.videoRange!==w.videoRange)return I0.indexOf(E.videoRange)-I0.indexOf(w.videoRange);if(E.videoCodec!==w.videoCodec){const b=wP(E.videoCodec),C=wP(w.videoCodec);if(b!==C)return C-b}if(E.uri===w.uri&&E.codecSet!==w.codecSet){const b=_0(E.codecSet),C=_0(w.codecSet);if(b!==C)return C-b}return E.averageBitrate!==w.averageBitrate?E.averageBitrate-w.averageBitrate:0});let f=h[0];if(this.steering&&(c=this.steering.filterParsedLevels(c),c.length!==h.length)){for(let E=0;E<h.length;E++)if(h[E].pathwayId===c[0].pathwayId){f=h[E];break}}this._levels=c;for(let E=0;E<c.length;E++)if(c[E]===f){var m;this._firstLevel=E;const w=f.bitrate,b=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${c.length} level(s) found, first bitrate: ${w}`),((m=this.hls.userConfig)==null?void 0:m.abrEwmaDefaultEstimate)===void 0){const C=Math.min(w,this.hls.config.abrEwmaDefaultEstimateMax);C>b&&b===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=C)}break}const p=i&&!r,y=this.hls.config,v=!!(y.audioStreamController&&y.audioTrackController),x={levels:c,audioTracks:a,subtitleTracks:l,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:r,altAudio:v&&!p&&a.some(E=>!!E.url)};d.end=performance.now(),this.hls.trigger(P.MANIFEST_PARSED,x)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const d=new Error("invalid level idx"),h=e<0;if(this.hls.trigger(P.ERROR,{type:Te.OTHER_ERROR,details:W.LEVEL_SWITCH_ERROR,level:e,fatal:h,error:d,reason:d.message}),h)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,r=this.currentLevel,i=r?r.attrs["PATHWAY-ID"]:void 0,o=t[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,s===e&&r&&i===a)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${a?" with Pathway "+a:""} from level ${s}${i?" with Pathway "+i:""}`);const l={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(P.LEVEL_SWITCHING,l);const c=o.details;if(!c||c.live){const d=this.switchParams(o.uri,r==null?void 0:r.details,c);this.loadPlaylist(d)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),s=e.filter(r=>t.indexOf(r)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=s}}onError(e,t){t.fatal||!t.context||t.context.type===We.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===de.MAIN){const s=t.elementaryStreams;if(!Object.keys(s).some(i=>!!s[i]))return;const r=this._levels[t.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var s;const{level:r,details:i}=t,o=t.levelInfo;if(!o){var a;this.warn(`Invalid level index ${r}`),(a=t.deliveryDirectives)!=null&&a.skip&&(i.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let l=o.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(r,t,l)}else(s=t.deliveryDirectives)!=null&&s.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,i=e.attrs["PATHWAY-ID"],o=e.details,a=o==null?void 0:o.age;this.log(`Loading level index ${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${i?" Pathway "+i:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${s}`),this.hls.trigger(P.LEVEL_LOADING,{url:s,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const s=this._levels.filter((i,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(i),i===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,i.details&&i.details.fragments.forEach(a=>a.level=-1)),!1));rV(s),this._levels=s,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=s.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(P.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(P.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function Pk(n){const e={};n.forEach(t=>{const s=t.groupId||"";t.id=e[s]=e[s]||0,e[s]++})}function ZV(){return self.SourceBuffer||self.WebKitSourceBuffer}function e$(){if(!za())return!1;const e=ZV();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function tce(){if(!e$())return!1;const n=za();return typeof(n==null?void 0:n.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(Of(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(Of(e,"audio"))))}function nce(){var n;const e=ZV();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const sce=100;class rce extends n_{constructor(e,t,s){super(e,t,s,"stream-controller",de.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const r=this.media,i=r?r.currentTime:null;if(i===null||!le(i)||(this.log(`Media seeked to ${i.toFixed(3)}`),!this.getBufferedFrag(i)))return;const o=this.getFwdBufferInfoAtPos(r,i,de.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${i} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(P.MANIFEST_PARSED,this.onManifestParsed,this),e.on(P.LEVEL_LOADING,this.onLevelLoading,this),e.on(P.LEVEL_LOADED,this.onLevelLoaded,this),e.on(P.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(P.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(P.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(P.BUFFER_CREATED,this.onBufferCreated,this),e.on(P.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(P.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(P.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(P.MANIFEST_PARSED,this.onManifestParsed,this),e.off(P.LEVEL_LOADED,this.onLevelLoaded,this),e.off(P.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(P.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(P.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(P.BUFFER_CREATED,this.onBufferCreated,this),e.off(P.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(P.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(P.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:s,hls:r}=this;if(this.stopLoad(),this.setInterval(sce),this.level=-1,!this.startFragRequested){let i=r.startLevel;i===-1&&(r.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=r.firstAutoLevel),r.nextLoadLevel=i,this.level=r.loadLevel,this._hasEnoughToStart=!!t}s>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s),this.state=Z.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=Z.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case Z.WAITING_LEVEL:{const{levels:e,level:t}=this,s=e==null?void 0:e[t],r=s==null?void 0:s.details;if(r&&(!r.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(r))break;this.state=Z.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=Z.IDLE;break}break}case Z.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===Z.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:s,media:r}=this;if(t===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const i=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(s!=null&&s[i]))return;const o=s[i],a=this.getMainFwdBufferInfo();if(a===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){const y={};this.altAudio===2&&(y.type="video"),this.hls.trigger(P.BUFFER_EOS,y),this.state=Z.ENDED;return}if(!this.buffering)return;e.loadLevel!==i&&e.manualLevel===-1&&this.log(`Adapting to level ${i} from level ${this.level}`),this.level=e.nextLoadLevel=i;const c=o.details;if(!c||this.state===Z.WAITING_LEVEL||this.waitForLive(o)){this.level=i,this.state=Z.WAITING_LEVEL,this.startFragRequested=!1;return}const d=a.len,h=this.getMaxBufferLength(o.maxBitrate);if(d>=h)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:a.end;let m=this.getNextFragment(f,c);if(this.couldBacktrack&&!this.fragPrevious&&m&&sn(m)&&this.fragmentTracker.getState(m)!==xn.OK){var p;const v=((p=this.backtrackFragment)!=null?p:m).sn-c.startSN,x=c.fragments[v-1];x&&m.cc===x.cc&&(m=x,this.fragmentTracker.removeFragment(x))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(m&&this.isLoopLoading(m,f)){if(!m.gap){const v=this.audioOnly&&!this.altAudio?bt.AUDIO:bt.VIDEO,x=(v===bt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;x&&this.afterBufferFlushed(x,v,de.MAIN)}m=this.getNextFragmentLoopLoading(m,c,a,de.MAIN,h)}m&&(m.initSegment&&!m.initSegment.data&&!this.bitrateTest&&(m=m.initSegment),this.loadFragment(m,o,f))}loadFragment(e,t,s){const r=this.fragmentTracker.getState(e);r===xn.NOT_LOADED||r===xn.PARTIAL?sn(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,s):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,de.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let s;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const i=this.getLevelDetails();if(i!=null&&i.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<i.targetduration*2)return}if(!t.paused&&e){const a=this.hls.nextLoadLevel,l=e[a],c=this.fragLastKbps;c&&this.fragCurrent?s=this.fragCurrent.duration*l.maxBitrate/(1e3*c)+1:s=0}else s=0;const o=this.getBufferedFrag(t.currentTime+s);if(o){const a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();const l=a.maxStartPTS?a.maxStartPTS:a.start,c=a.duration,d=Math.max(o.end,l+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(d,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Z.KEY_LOADING:case Z.FRAG_LOADING:case Z.FRAG_LOADING_WAITING_RETRY:case Z.PARSING:case Z.PARSED:this.state=Z.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const s=t.media;ds(s,"playing",this.onMediaPlaying),ds(s,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:s}=this;s&&(_s(s,"playing",this.onMediaPlaying),_s(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(P.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let s=!1,r=!1;for(let i=0;i<t.levels.length;i++){const o=t.levels[i].audioCodec;o&&(s=s||o.indexOf("mp4a.40.2")!==-1,r=r||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=s&&r&&!nce(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:s}=this;if(!s||this.state!==Z.IDLE)return;const r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=Z.WAITING_LEVEL)}onLevelLoaded(e,t){var s;const{levels:r,startFragRequested:i}=this,o=t.level,a=t.details,l=a.totalduration;if(!r){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${l}`);const c=t.levelInfo,d=this.fragCurrent;d&&(this.state===Z.FRAG_LOADING||this.state===Z.FRAG_LOADING_WAITING_RETRY)&&d.level!==t.level&&d.loader&&this.abortCurrentFrag();let h=0;if(a.live||(s=c.details)!=null&&s.live){var f;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;h=this.alignPlaylists(a,c.details,(f=this.levelLastLoaded)==null?void 0:f.details)}if(c.details=a,this.levelLastLoaded=c,i||this.setStartPosition(a,h),this.hls.trigger(P.LEVEL_UPDATED,{details:a,level:o}),this.state===Z.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=Z.IDLE}i&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:s}=this;if(!s)return;const r=this.hls.liveSyncPosition,i=this.getLoadPosition(),o=e.fragmentStart,a=e.edge,l=i>=o-t.maxFragLookUpTolerance&&i<=a;if(r!==null&&s.duration>r&&(i<r||!l)){const d=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&s.readyState<4||i<a-d)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),s.readyState))if(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${r.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var c;const h=Ue.bufferInfo(s,r,0);if(!((c=h.buffered)!=null&&c.length)){s.currentTime=r;return}if(h.start<=i){s.currentTime=r;return}const{nextStart:m}=Ue.bufferedInfo(h.buffered,i,0);m&&(s.currentTime=m)}else s.currentTime=r}}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:r,payload:i}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const a=o[s.level];if(!a){this.warn(`Level ${s.level} not found on progress`);return}const l=a.details;if(!l){this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),this.fragmentTracker.removeFragment(s);return}const c=a.videoCodec,d=l.PTSKnown||!l.live,h=(t=s.initSegment)==null?void 0:t.data,f=this._getAudioCodec(a),m=this.transmuxer=this.transmuxer||new AV(this.hls,de.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=r?r.index:-1,y=p!==-1,v=new Z1(s.level,s.sn,s.stats.chunkCount,i.byteLength,p,y),x=this.initPTS[s.cc];m.push(i,h,f,c,s,r,l.totalduration,d,v,x)}onAudioTrackSwitching(e,t){const s=this.hls,r=this.altAudio!==0;if(R0(t.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.altAudio=0,this.fragmentTracker.removeAllFragments(),s.once(P.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(P.AUDIO_TRACK_SWITCHED,t)}),s.trigger(P.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}s.trigger(P.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=R0(t.url,this.hls);if(s){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=s?2:0,this.tick()}onBufferCreated(e,t){const s=t.tracks;let r,i,o=!1;for(const a in s){const l=s[a];if(l.id==="main"){if(i=a,r=l,a==="video"){const c=s[a];c&&(this.videoBuffer=c.buffer)}}else o=!0}o&&r?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:s,part:r}=t,i=s.type===de.MAIN;if(i){if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${r?" p: "+r.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),this.state===Z.PARSED&&(this.state=Z.IDLE);return}const a=r?r.stats:s.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),sn(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,r)}const o=this.media;o&&(!this._hasEnoughToStart&&Ue.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),i&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var s;if(t.fatal){this.state=Z.ERROR;return}switch(t.details){case W.FRAG_GAP:case W.FRAG_PARSING_ERROR:case W.FRAG_DECRYPT_ERROR:case W.FRAG_LOAD_ERROR:case W.FRAG_LOAD_TIMEOUT:case W.KEY_LOAD_ERROR:case W.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(de.MAIN,t);break;case W.LEVEL_LOAD_ERROR:case W.LEVEL_LOAD_TIMEOUT:case W.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===Z.WAITING_LEVEL&&((s=t.context)==null?void 0:s.type)===We.LEVEL&&(this.state=Z.IDLE);break;case W.BUFFER_ADD_CODEC_ERROR:case W.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case W.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case W.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=Z.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==bt.AUDIO||!this.altAudio){const s=(t===bt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;s&&(this.afterBufferFlushed(s,t,de.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking){this.log(`could not seek to ${s}, already seeking at ${t}`);return}const r=this.timelineOffset;r&&s&&(s+=r);const i=this.getLevelDetails(),o=Ue.getBuffered(e),a=o.length?o.start(0):0,l=a-s,c=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<c||this.loadingParts&&l<2*((i==null?void 0:i.partTarget)||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),s+=l,this.startPosition=s),t<s&&(this.log(`seek to target start position ${s} from current time ${t} buffer start ${a}`),e.currentTime=s)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(s=>{const{hls:r}=this,i=s==null?void 0:s.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=Z.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=i.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),r.trigger(P.FRAG_LOADED,s),i.bitrateTest=!1}).catch(s=>{this.state===Z.STOPPED||this.state===Z.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:s}=this,{remuxResult:r,chunkMeta:i}=e,o=this.getCurrentContext(i);if(!o){this.resetWhenMissingContext(i);return}const{frag:a,part:l,level:c}=o,{video:d,text:h,id3:f,initSegment:m}=r,{details:p}=c,y=this.altAudio?void 0:r.audio;if(this.fragContextChanged(a)){this.fragmentTracker.removeFragment(a);return}if(this.state=Z.PARSING,m){const v=m.tracks;if(v){const b=a.initSegment||a;if(this.unhandledEncryptionError(m,a))return;this._bufferInitSegment(c,v,b,i),s.trigger(P.FRAG_PARSING_INIT_SEGMENT,{frag:b,id:t,tracks:v})}const x=m.initPTS,E=m.timescale,w=this.initPTS[a.cc];if(le(x)&&(!w||w.baseTime!==x||w.timescale!==E)){const b=m.trackId;this.initPTS[a.cc]={baseTime:x,timescale:E,trackId:b},s.trigger(P.INIT_PTS_FOUND,{frag:a,id:t,initPTS:x,timescale:E,trackId:b})}}if(d&&p){y&&d.type==="audiovideo"&&this.logMuxedErr(a);const v=p.fragments[a.sn-1-p.startSN],x=a.sn===p.startSN,E=!v||a.cc>v.cc;if(r.independent!==!1){const{startPTS:w,endPTS:b,startDTS:C,endDTS:D}=d;if(l)l.elementaryStreams[d.type]={startPTS:w,endPTS:b,startDTS:C,endDTS:D};else if(d.firstKeyFrame&&d.independent&&i.id===1&&!E&&(this.couldBacktrack=!0),d.dropped&&d.independent){const _=this.getMainFwdBufferInfo(),S=(_?_.end:this.getLoadPosition())+this.config.maxBufferHole,I=d.firstKeyFramePTS?d.firstKeyFramePTS:w;if(!x&&S<I-this.config.maxBufferHole&&!E){this.backtrack(a);return}else E&&(a.gap=!0);a.setElementaryStreamInfo(d.type,a.start,b,a.start,D,!0)}else x&&w-(p.appliedTimelineOffset||0)>wg&&(a.gap=!0);a.setElementaryStreamInfo(d.type,w,b,C,D),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(d,a,l,i,x||E)}else if(x||E)a.gap=!0;else{this.backtrack(a);return}}if(y){const{startPTS:v,endPTS:x,startDTS:E,endDTS:w}=y;l&&(l.elementaryStreams[bt.AUDIO]={startPTS:v,endPTS:x,startDTS:E,endDTS:w}),a.setElementaryStreamInfo(bt.AUDIO,v,x,E,w),this.bufferFragmentData(y,a,l,i)}if(p&&f!=null&&f.samples.length){const v={id:t,frag:a,details:p,samples:f.samples};s.trigger(P.FRAG_PARSING_METADATA,v)}if(p&&h){const v={id:t,frag:a,details:p,samples:h.samples};s.trigger(P.FRAG_PARSING_USERDATA,v)}}logMuxedErr(e){this.warn(`${sn(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,s,r){if(this.state!==Z.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(s));const{audio:i,video:o,audiovideo:a}=t;if(i){const c=e.audioCodec;let d=mg(i.codec,c);d==="mp4a"&&(d="mp4a.40.5");const h=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){d&&(d.indexOf("mp4a.40.5")!==-1?d="mp4a.40.2":d="mp4a.40.5");const f=i.metadata;f&&"channelCount"in f&&(f.channelCount||1)!==1&&h.indexOf("firefox")===-1&&(d="mp4a.40.5")}d&&d.indexOf("mp4a.40.5")!==-1&&h.indexOf("android")!==-1&&i.container!=="audio/mpeg"&&(d="mp4a.40.2",this.log(`Android: force audio codec to ${d}`)),c&&c!==d&&this.log(`Swapping manifest audio codec "${c}" for "${d}"`),i.levelCodec=d,i.id=de.MAIN,this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${d||""}/${c||""}/${i.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=de.MAIN;const c=o.codec;if((c==null?void 0:c.length)===4)switch(c){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${c}]${o.codec!==c?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(P.BUFFER_CODECS,t),!this.hls)return;l.forEach(c=>{const h=t[c].initSegment;h!=null&&h.byteLength&&this.hls.trigger(P.BUFFER_APPENDING,{type:c,data:h,frag:s,part:null,chunkMeta:r,parent:s.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,de.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,s=e==null?void 0:e[t];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Z.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const s=e.currentTime;if(Ue.isBuffered(e,s)?t=this.getAppendedFrag(s):Ue.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const r=this.fragPlaying,i=t.level;(!r||t.sn!==r.sn||r.level!==i)&&(this.fragPlaying=t,this.hls.trigger(P.FRAG_CHANGED,{frag:t}),(!r||r.level!==i)&&this.hls.trigger(P.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return le(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(le(t)){const s=this.getLevelDetails(),r=this.currentFrag||(s?sc(null,s.fragments,t):null);if(r){const i=r.programDateTime;if(i!==null){const o=i+(t-r.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class ice extends Tr{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const s in this.keyIdToKeyInfo){const r=this.keyIdToKeyInfo[s].loader;if(r){var t;if(e&&e!==((t=r.context)==null?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=W.KEY_LOAD_ERROR,s,r,i){return new Ki({type:Te.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:s,networkDetails:r})}loadClear(e,t,s){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let r=0,i=t.length;r<i;r++){const o=t[r];if(e.cc<=o.cc&&(!sn(e)||!sn(o)||e.sn<o.sn)||!s&&r==i-1)return this.emeController.selectKeySystemFormat(o).then(a=>{if(!this.emeController)return;o.setKeyFormat(a);const l=gg(a);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const r=Ch(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var s,r;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,W.KEY_LOAD_ERROR,c))}const o=i.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,W.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));const a=Zx(i);let l=this.keyIdToKeyInfo[a];if((s=l)!=null&&s.decryptdata.key)return i.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(this.emeController&&(r=l)!=null&&r.keyLoadPromise)switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(d=>{const{keyInfo:h}=d;return i.key=h.decryptdata.key,{frag:e,keyInfo:h}})}switch(this.log(`${this.keyIdToKeyInfo[a]?"Rel":"L"}oading${i.keyId?" keyId: "+Mn(i.keyId):""} URI: ${i.uri} from ${e.type} ${e.level}`),l=this.keyIdToKeyInfo[a]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return i.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,W.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(e,t){const s={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var r;if(!e.decryptdata.keyId&&(r=t.initSegment)!=null&&r.data){const o=Sre(t.initSegment.data);if(o.length){let a=o[0];a.some(l=>l!==0)?(this.log(`Using keyId found in init segment ${Mn(a)}`),Na.setKeyIdForUri(e.decryptdata.uri,a)):(a=Na.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${Mn(a)}`)),e.decryptdata.keyId=a}}if(!e.decryptdata.keyId&&!sn(t))return Promise.resolve(s);const i=this.emeController.loadKey(s);return(e.keyLoadPromise=i.then(o=>(e.mediaKeySessionContext=o,s))).catch(o=>{throw e.keyLoadPromise=null,"data"in o&&(o.data.frag=t),o})}return Promise.resolve(s)}loadKeyHTTP(e,t){const s=this.config,r=s.loader,i=new r(s);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((o,a)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=s.keyLoadPolicy.default,d={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(f,m,p,y)=>{const{frag:v,keyInfo:x}=p,E=Zx(x.decryptdata);if(!v.decryptdata||x!==this.keyIdToKeyInfo[E])return a(this.createKeyLoadError(v,W.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),y));x.decryptdata.key=v.decryptdata.key=new Uint8Array(f.data),v.keyLoader=null,x.loader=null,o({frag:v,keyInfo:x})},onError:(f,m,p,y)=>{this.resetLoader(m),a(this.createKeyLoadError(t,W.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),p,ft({url:l.url,data:void 0},f)))},onTimeout:(f,m,p)=>{this.resetLoader(m),a(this.createKeyLoadError(t,W.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),p))},onAbort:(f,m,p)=>{this.resetLoader(m),a(this.createKeyLoadError(t,W.INTERNAL_ABORTED,new Error("key loading aborted"),p))}};i.load(l,d,h)})}resetLoader(e){const{frag:t,keyInfo:s,url:r}=e,i=s.loader;t.keyLoader===i&&(t.keyLoader=null,s.loader=null);const o=Zx(s.decryptdata)||r;delete this.keyIdToKeyInfo[o],i&&i.destroy()}}function Zx(n){if(n.keyFormat!==jn.FAIRPLAY){const e=n.keyId;if(e)return Mn(e)}return n.uri}function kk(n){const{type:e}=n;switch(e){case We.AUDIO_TRACK:return de.AUDIO;case We.SUBTITLE_TRACK:return de.SUBTITLE;default:return de.MAIN}}function eE(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class oce{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(P.MANIFEST_LOADING,this.onManifestLoading,this),e.on(P.LEVEL_LOADING,this.onLevelLoading,this),e.on(P.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(P.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(P.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(P.MANIFEST_LOADING,this.onManifestLoading,this),e.off(P.LEVEL_LOADING,this.onLevelLoading,this),e.off(P.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(P.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(P.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,s=t.pLoader,r=t.loader,i=s||r,o=new i(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:s}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:We.MANIFEST,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:s,level:r,pathwayId:i,url:o,deliveryDirectives:a,levelInfo:l}=t;this.load({id:s,level:r,pathwayId:i,responseType:"text",type:We.LEVEL,url:o,deliveryDirectives:a,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:s,groupId:r,url:i,deliveryDirectives:o,track:a}=t;this.load({id:s,groupId:r,level:null,responseType:"text",type:We.AUDIO_TRACK,url:i,deliveryDirectives:o,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:s,groupId:r,url:i,deliveryDirectives:o,track:a}=t;this.load({id:s,groupId:r,level:null,responseType:"text",type:We.SUBTITLE_TRACK,url:i,deliveryDirectives:o,levelOrTrack:a})}onLevelsUpdated(e,t){const s=this.loaders[We.LEVEL];if(s){const r=s.context;r&&!t.levels.some(i=>i===r.levelOrTrack)&&(s.abort(),delete this.loaders[We.LEVEL])}}load(e){var t;const s=this.hls.config;let r=this.getInternalLoader(e);if(r){const c=this.hls.logger,d=r.context;if(d&&d.levelOrTrack===e.levelOrTrack&&(d.url===e.url||d.deliveryDirectives&&!e.deliveryDirectives)){d.url===e.url?c.log(`[playlist-loader]: ignore ${e.url} ongoing request`):c.log(`[playlist-loader]: ignore ${e.url} in favor of ${d.url}`);return}c.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let i;if(e.type===We.MANIFEST?i=s.manifestLoadPolicy.default:i=Et({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),le((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===We.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===We.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===We.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const d=c.partTarget,h=c.targetduration;if(d&&h){const f=Math.max(d*3,h*.8)*1e3;i=Et({},i,{maxTimeToFirstByteMs:Math.min(f,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,i.maxTimeToFirstByteMs)})}}}const o=i.errorRetry||i.timeoutRetry||{},a={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(c,d,h,f)=>{const m=this.getInternalLoader(h);this.resetInternalLoader(h.type);const p=c.data;d.parsing.start=performance.now(),ui.isMediaPlaylist(p)||h.type!==We.MANIFEST?this.handleTrackOrLevelPlaylist(c,d,h,f||null,m):this.handleMasterPlaylist(c,d,h,f)},onError:(c,d,h,f)=>{this.handleNetworkError(d,h,!1,c,f)},onTimeout:(c,d,h)=>{this.handleNetworkError(d,h,!0,void 0,c)}};r.load(e,a,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:s}=this.hls;(e||s)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,s,r){const i=this.hls,o=e.data,a=eE(e,s),l=ui.parseMasterPlaylist(o,a);if(l.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,s,l.playlistParsingError,r,t);return}const{contentSteering:c,levels:d,sessionData:h,sessionKeys:f,startTimeOffset:m,variableList:p}=l;this.variableList=p,d.forEach(E=>{const{unknownCodecs:w}=E;if(w){const{preferManagedMediaSource:b}=this.hls.config;let{audioCodec:C,videoCodec:D}=E;for(let _=w.length;_--;){const S=w[_];Mf(S,"audio",b)?(E.audioCodec=C=C?`${C},${S}`:S,ld.audio[C.substring(0,4)]=2,w.splice(_,1)):Mf(S,"video",b)&&(E.videoCodec=D=D?`${D},${S}`:S,ld.video[D.substring(0,4)]=2,w.splice(_,1))}}});const{AUDIO:y=[],SUBTITLES:v,"CLOSED-CAPTIONS":x}=ui.parseMasterPlaylistMedia(o,a,l);y.length&&!y.some(w=>!w.url)&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),y.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Mt({}),bitrate:0,url:""})),i.trigger(P.MANIFEST_LOADED,{levels:d,audioTracks:y,subtitles:v,captions:x,contentSteering:c,url:a,stats:t,networkDetails:r,sessionData:h,sessionKeys:f,startTimeOffset:m,variableList:p})}handleTrackOrLevelPlaylist(e,t,s,r,i){const o=this.hls,{id:a,level:l,type:c}=s,d=eE(e,s),h=le(l)?l:le(a)?a:0,f=kk(s),m=ui.parseLevelPlaylist(e.data,d,h,f,0,this.variableList);if(c===We.MANIFEST){const p={attrs:new Mt({}),bitrate:0,details:m,name:"",url:d};m.requestScheduled=t.loading.start+tV(m,0),o.trigger(P.MANIFEST_LOADED,{levels:[p],audioTracks:[],url:d,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),s.levelDetails=m,this.handlePlaylistLoaded(m,e,t,s,r,i)}handleManifestParsingError(e,t,s,r,i){this.hls.trigger(P.ERROR,{type:Te.NETWORK_ERROR,details:W.MANIFEST_PARSING_ERROR,fatal:t.type===We.MANIFEST,url:e.url,err:s,error:s,reason:s.message,response:e,context:t,networkDetails:r,stats:i})}handleNetworkError(e,t,s=!1,r,i){let o=`A network ${s?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===We.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===We.AUDIO_TRACK||e.type===We.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let l=W.UNKNOWN,c=!1;const d=this.getInternalLoader(e);switch(e.type){case We.MANIFEST:l=s?W.MANIFEST_LOAD_TIMEOUT:W.MANIFEST_LOAD_ERROR,c=!0;break;case We.LEVEL:l=s?W.LEVEL_LOAD_TIMEOUT:W.LEVEL_LOAD_ERROR,c=!1;break;case We.AUDIO_TRACK:l=s?W.AUDIO_TRACK_LOAD_TIMEOUT:W.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case We.SUBTITLE_TRACK:l=s?W.SUBTITLE_TRACK_LOAD_TIMEOUT:W.SUBTITLE_LOAD_ERROR,c=!1;break}d&&this.resetInternalLoader(e.type);const h={type:Te.NETWORK_ERROR,details:l,fatal:c,url:e.url,loader:d,context:e,error:a,networkDetails:t,stats:i};if(r){const f=(t==null?void 0:t.url)||e.url;h.response=ft({url:f,data:void 0},r)}this.hls.trigger(P.ERROR,h)}handlePlaylistLoaded(e,t,s,r,i,o){const a=this.hls,{type:l,level:c,levelOrTrack:d,id:h,groupId:f,deliveryDirectives:m}=r,p=eE(t,r),y=kk(r);let v=typeof r.level=="number"&&y===de.MAIN?c:void 0;const x=e.playlistParsingError;if(x){if(this.hls.logger.warn(`${x} ${e.url}`),!a.config.ignorePlaylistParsingErrors){a.trigger(P.ERROR,{type:Te.NETWORK_ERROR,details:W.LEVEL_PARSING_ERROR,fatal:!1,url:p,error:x,reason:x.message,response:t,context:r,level:v,parent:y,networkDetails:i,stats:s});return}e.playlistParsingError=null}if(!e.fragments.length){const E=e.playlistParsingError=new Error("No Segments found in Playlist");a.trigger(P.ERROR,{type:Te.NETWORK_ERROR,details:W.LEVEL_EMPTY_ERROR,fatal:!1,url:p,error:E,reason:E.message,response:t,context:r,level:v,parent:y,networkDetails:i,stats:s});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case We.MANIFEST:case We.LEVEL:if(v){if(!d)v=0;else if(d!==a.levels[v]){const E=a.levels.indexOf(d);E>-1&&(v=E)}}a.trigger(P.LEVEL_LOADED,{details:e,levelInfo:d||a.levels[0],level:v||0,id:h||0,stats:s,networkDetails:i,deliveryDirectives:m,withoutMultiVariant:l===We.MANIFEST});break;case We.AUDIO_TRACK:a.trigger(P.AUDIO_TRACK_LOADED,{details:e,track:d,id:h||0,groupId:f||"",stats:s,networkDetails:i,deliveryDirectives:m});break;case We.SUBTITLE_TRACK:a.trigger(P.SUBTITLE_TRACK_LOADED,{details:e,track:d,id:h||0,groupId:f||"",stats:s,networkDetails:i,deliveryDirectives:m});break}}}class Ws{static get version(){return Ff}static isMSESupported(){return e$()}static isSupported(){return tce()}static getMediaSource(){return za()}static get Events(){return P}static get MetadataSchema(){return Hs}static get ErrorTypes(){return Te}static get ErrorDetails(){return W}static get DefaultConfig(){return Ws.defaultConfig?Ws.defaultConfig:Gle}static set DefaultConfig(e){Ws.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new s_,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=hre(e.debug||!1,"Hls instance",e.assetPlayerId),s=this.config=Hle(Ws.DefaultConfig,e,t);this.userConfig=e,s.progressive&&Wle(s,t);const{abrController:r,bufferController:i,capLevelController:o,errorController:a,fpsController:l}=s,c=new a(this),d=this.abrController=new r(this),h=new aie(this),f=s.interstitialsController,m=f?this.interstitialsController=new f(this,Ws):null,p=this.bufferController=new i(this,h),y=this.capLevelController=new o(this),v=new l(this),x=new oce(this),E=s.contentSteeringController,w=E?new E(this):null,b=this.levelController=new ece(this,w),C=new Jle(this),D=new ice(this.config,this.logger),_=this.streamController=new rce(this,h,D),S=this.gapController=new Qle(this,h);y.setStreamController(_),v.setStreamController(_);const I=[x,b,_];m&&I.splice(1,0,m),w&&I.splice(1,0,w),this.networkControllers=I;const R=[d,p,S,y,v,C,h];this.audioTrackController=this.createController(s.audioTrackController,I);const N=s.audioStreamController;N&&I.push(this.audioStreamController=new N(this,h,D)),this.subtitleTrackController=this.createController(s.subtitleTrackController,I);const L=s.subtitleStreamController;L&&I.push(this.subtititleStreamController=new L(this,h,D)),this.createController(s.timelineController,R),D.emeController=this.emeController=this.createController(s.emeController,R),this.cmcdController=this.createController(s.cmcdController,R),this.latencyController=this.createController(Zle,R),this.coreComponents=R,I.push(c);const M=c.onErrorOut;typeof M=="function"&&this.on(P.ERROR,M,c),this.on(P.MANIFEST_LOADED,x.onManifestLoaded,x)}createController(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}on(e,t,s=this){this._emitter.on(e,t,s)}once(e,t,s=this){this._emitter.once(e,t,s)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,s=this,r){this._emitter.off(e,t,s,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,s){return this._emitter.emit(e,t,s)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(s){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const r=e===P.ERROR;this.trigger(P.ERROR,{type:Te.OTHER_ERROR,details:W.INTERNAL_EXCEPTION,fatal:r,event:e,error:s}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(P.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const i=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(P.ERROR,{type:Te.OTHER_ERROR,details:W.ATTACH_MEDIA_ERROR,fatal:!0,error:i});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,s=t?e.media:e,r=t?e:{media:s};this._media=s,this.trigger(P.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(P.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(P.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,s=this._url,r=this._url=W1.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${r}`),t&&s&&(s!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(P.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(e,t),!(!this.started||!this.networkControllers));s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[de.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[de.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[de.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=Qae()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){Hre(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const s=e.length;for(let r=0;r<s;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:s}=this;let r;if(t===-1&&e!=null&&e.length?r=e.length-1:r=t,s)for(let i=r;i--;){const o=e[i].attrs["HDCP-LEVEL"];if(o&&o<=s)return i}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const s=VU(t);return FU(e,s,navigator.mediaCapabilities)}}Ws.defaultConfig=void 0;function ace({animeId:n,episodeId:e}){const{currentUser:t,userProfile:s}=Ms(),[r,i]=T.useState([]),[o,a]=T.useState(""),[l,c]=T.useState(null),[d,h]=T.useState(!1),[f,m]=T.useState([]);T.useEffect(()=>{(async()=>{if(t){const{getMutedUsers:x}=await pi(async()=>{const{getMutedUsers:w}=await Promise.resolve().then(()=>wi);return{getMutedUsers:w}},void 0),E=await x(t.uid);m(E)}})()},[t]),T.useEffect(()=>{const v=g3(n,e,x=>{i(x)});return()=>v()},[n,e]);const p=async v=>{if(v.preventDefault(),!(!t||!s||!o.trim())){h(!0);try{await p3(n,e,t.uid,s.username,s.avatarUrl,o,l||void 0),a(""),c(null)}catch(x){console.error("Error posting comment:",x)}finally{h(!1)}}},y=async v=>{try{await y3(n,e,v)}catch(x){console.error("Error liking comment:",x)}};return u.jsxs("div",{className:"space-y-6",children:[u.jsxs("h2",{className:"text-2xl font-bold",children:["Comments (",r.length,")"]}),u.jsx("div",{className:"space-y-4",children:r.filter(v=>!f.includes(v.userId)).map(v=>{var x,E;return u.jsx("div",{className:`p-4 rounded-lg bg-card border ${v.replyTo?"ml-12":""}`,children:u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsxs(Ps,{className:"h-8 w-8 cursor-pointer hover:ring-2 ring-primary transition-all",onClick:()=>window.location.href=`/profile/${v.username}`,children:[u.jsx(ks,{src:v.avatarUrl}),u.jsx(Ns,{children:v.username[0]})]}),u.jsxs("div",{className:"flex-1",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"font-medium text-sm cursor-pointer hover:text-primary transition-colors",onClick:()=>window.location.href=`/profile/${v.username}`,children:v.username}),u.jsx("span",{className:"text-xs text-muted-foreground",children:Wa(((E=(x=v.timestamp)==null?void 0:x.toDate)==null?void 0:E.call(x))||new Date,{addSuffix:!0})})]}),u.jsx("p",{className:"mt-1 text-sm",children:v.text}),u.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[u.jsxs(ne,{variant:"ghost",size:"sm",onClick:()=>y(v.id),className:"text-xs",children:[u.jsx(cc,{className:"mr-1 h-3 w-3"}),v.likes]}),t&&u.jsxs(ne,{variant:"ghost",size:"sm",onClick:()=>c(v.id),className:"text-xs",children:[u.jsx(yK,{className:"mr-1 h-3 w-3"}),"Reply"]})]})]})]})},v.id)})}),t?u.jsxs("form",{onSubmit:p,className:"space-y-4 mt-6",children:[l&&u.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:["Replying to comment",u.jsx(ne,{type:"button",variant:"ghost",size:"sm",onClick:()=>c(null),children:"Cancel"})]}),u.jsx(Ii,{placeholder:"Share your thoughts...",value:o,onChange:v=>a(v.target.value),className:"min-h-[100px]"}),u.jsx(ne,{type:"submit",disabled:d||!o.trim(),children:d?"Posting...":"Post Comment"})]}):u.jsx("div",{className:"text-center py-8 text-muted-foreground mt-6",children:"Please sign in to comment"})]})}function lce(){var Im,Rm,ll,Ud,Vd,Ec,No,Cm,Sr,$d,Bd,wc,Tc,Gd,Pm,Kd,km,cl,Hd,bc,Lo,zr,Sc,Nm,Wd,zd,qd,_c,Ac,Yd,Qd,Xd,Lm,_r,js,Do,Mo,Ic,yt;const{id:n}=pd(),e=l8(),[,t]=Ls(),r=new URLSearchParams(e).get("ep")||null,[i,o]=T.useState("hd-1"),[a,l]=T.useState("sub"),c=T.useRef(null),d=T.useRef(null),h=T.useRef(null),f=T.useRef(null),m=T.useRef(null),p=T.useRef(null),[y,v]=T.useState(!1),[x,E]=T.useState(!1),[w,b]=T.useState(1),[C,D]=T.useState(0),[_,S]=T.useState(0),[I,R]=T.useState(!1),[N,L]=T.useState(!0),[M,G]=T.useState(!1),[V,$]=T.useState(!1),[F,j]=T.useState(1),[U,X]=T.useState("speed"),[Y,J]=T.useState(null),[ae,he]=T.useState(!1),[ve,ge]=T.useState([]),[re,Ee]=T.useState("off"),[xe,Ne]=T.useState([]),[Le,qe]=T.useState(!0),[gt,Jt]=T.useState(!0),[ys,De]=T.useState(!0),[ct,Gt]=T.useState(!1),[rt,at]=T.useState(!1),[Kn,vs]=T.useState(null),[br,on]=T.useState(""),{currentUser:an}=Ms(),{data:q}=Zn({queryKey:["/api/anime",n],enabled:!!n}),{data:Pe}=Zn({queryKey:["/api/anime",n,"episodes"],enabled:!!n}),{data:Xe}=Zn({queryKey:["/api/episode/servers",r],queryFn:async()=>{const K=await fetch(`/api/episode/servers?animeEpisodeId=${r}`);if(!K.ok)throw new Error("Failed to fetch servers");return K.json()},enabled:!!r}),{data:$e}=Zn({queryKey:["/api/episode/sources",r,i,a],queryFn:async()=>{const K=new URLSearchParams({animeEpisodeId:r||"",server:i,category:a}),we=await fetch(`/api/episode/sources?${K.toString()}`);if(!we.ok)throw new Error("Failed to fetch streaming sources");return we.json()},enabled:!!r&&!!i,retry:2}),Os=(Rm=(Im=Pe==null?void 0:Pe.data)==null?void 0:Im.episodes)==null?void 0:Rm.find(K=>K.episodeId===r),rs=((Ud=(ll=Pe==null?void 0:Pe.data)==null?void 0:ll.episodes)==null?void 0:Ud.findIndex(K=>K.episodeId===r))??-1,Co=rs>0?(Vd=Pe==null?void 0:Pe.data)==null?void 0:Vd.episodes[rs-1]:null,pn=(Ec=Pe==null?void 0:Pe.data)!=null&&Ec.episodes&&rs<Pe.data.episodes.length-1?Pe.data.episodes[rs+1]:null,Ni=(Cm=(No=Pe==null?void 0:Pe.data)==null?void 0:No.episodes)==null?void 0:Cm.filter(K=>{var je;if(!br)return!0;const we=br.toLowerCase();return K.number.toString().includes(we)||((je=K.title)==null?void 0:je.toLowerCase().includes(we))});T.useEffect(()=>{if(Xe!=null&&Xe.data){const K=Xe.data[a];if(K&&K.length>0){const we=K.find(je=>je.serverName==="HD-1"||je.serverName==="hd-1")||K[0];o(we.serverName.toLowerCase())}}},[Xe,a]);const Od=K=>{if(K.trim().startsWith("WEBVTT"))return K;let we=`WEBVTT

`;const je=K.split(`
`);for(let Ye=0;Ye<je.length;Ye++){const wt=je[Ye].trim();/^\d+$/.test(wt)||(wt.includes("-->")?we+=wt.replace(/,/g,".")+`
`:wt?we+=wt+`
`:we+=`
`)}return we};T.useEffect(()=>{var Ye,wt,Pn;if(!c.current||!((Pn=(wt=(Ye=$e==null?void 0:$e.data)==null?void 0:Ye.sources)==null?void 0:wt[0])!=null&&Pn.url))return;const K=c.current,we=$e.data.sources[0].url;for(G(!0),Gt(!1),at(!1),d.current&&(d.current.destroy(),d.current=null);K.firstChild;)K.removeChild(K.firstChild);if(Ws.isSupported()){const Be=new Ws({enableWorker:!0,lowLatencyMode:!0,backBufferLength:90,maxBufferLength:30,maxMaxBufferLength:600,debug:!1});Be.loadSource(we),Be.attachMedia(K),Be.on(Ws.Events.MANIFEST_PARSED,async()=>{if(G(!1),an&&n&&r){const{getProgress:tt}=await pi(async()=>{const{getProgress:Dt}=await Promise.resolve().then(()=>wi);return{getProgress:Dt}},void 0),Zt=await tt(an.uid,n);Zt&&Zt.lastEpisodeId===r&&Zt.lastTimestamp>0&&(K.currentTime=Zt.lastTimestamp)}Le&&!rt&&K.play().then(()=>{at(!0)}).catch(()=>{})}),Be.on(Ws.Events.ERROR,(tt,Zt)=>{if(Zt.fatal)switch(Zt.type){case Ws.ErrorTypes.NETWORK_ERROR:Be.startLoad();break;case Ws.ErrorTypes.MEDIA_ERROR:Be.recoverMediaError();break;default:G(!1);break}}),d.current=Be}else K.canPlayType("application/vnd.apple.mpegurl")&&(K.src=we,K.addEventListener("loadedmetadata",async()=>{if(G(!1),an&&n&&r){const{getProgress:Be}=await pi(async()=>{const{getProgress:Zt}=await Promise.resolve().then(()=>wi);return{getProgress:Zt}},void 0),tt=await Be(an.uid,n);tt&&tt.lastEpisodeId===r&&tt.lastTimestamp>0&&(K.currentTime=tt.lastTimestamp)}Le&&!rt&&K.play().then(()=>{at(!0)}).catch(()=>{})}));const je=[];return $e.data.tracks&&$e.data.tracks.forEach((Be,tt)=>{var Zt;if(Be.file&&Be.file!=="/api/proxy/stream?url=undefined"&&Be.kind==="captions"){const Dt=document.createElement("track");Dt.kind="subtitles",Dt.src=Be.file,Dt.srclang=((Zt=Be.lang)==null?void 0:Zt.toLowerCase().replace(/\s+/g,"-"))||`lang-${tt}`,Dt.label=Be.label||Be.lang||`Subtitle ${tt+1}`,Dt.default=!1,K.appendChild(Dt),je.push({label:Be.label||Be.lang||`Subtitle ${tt+1}`,lang:Dt.srclang,src:Be.file})}}),ge(je),xe.forEach(Be=>{const tt=document.createElement("track");tt.kind="subtitles",tt.src=Be.src,tt.srclang=Be.lang,tt.label=Be.label,tt.default=!1,K.appendChild(tt)}),()=>{d.current&&(d.current.destroy(),d.current=null)}},[$e,Le]),T.useEffect(()=>{var je;if(!c.current||!((je=$e==null?void 0:$e.data)!=null&&je.tracks))return;const K=c.current;Array.from(K.textTracks).forEach(Ye=>{re==="off"?Ye.mode="hidden":Ye.label===re||Ye.language===re?Ye.mode="showing":Ye.mode="hidden"})},[re,(Sr=$e==null?void 0:$e.data)==null?void 0:Sr.tracks]);const Li=K=>{var wt;const we=(wt=K.target.files)==null?void 0:wt[0];if(!we||!c.current)return;const je=c.current,Ye=new FileReader;Ye.onload=Pn=>{var Oo;const Be=(Oo=Pn.target)==null?void 0:Oo.result,tt=Od(Be),Zt=new Blob([tt],{type:"text/vtt"}),Dt=URL.createObjectURL(Zt),Kt=document.createElement("track");Kt.kind="subtitles",Kt.src=Dt,Kt.srclang="custom-"+Date.now(),Kt.label=we.name.replace(/\.(srt|vtt|ass)$/i,""),Kt.default=!1,je.appendChild(Kt);const ul={label:Kt.label,src:Dt,lang:Kt.srclang};Ne(jo=>[...jo,ul]),Ee(Kt.label),$(!1),Kt.addEventListener("load",()=>{Array.from(je.textTracks).forEach(Di=>{Di.label===Kt.label?Di.mode="showing":Di.mode="hidden"})})},Ye.readAsText(we),p.current&&(p.current.value="")};T.useEffect(()=>{var Ye,wt,Pn,Be;if(!c.current||!ys||ct)return;const K=c.current,we=(wt=(Ye=$e==null?void 0:$e.data)==null?void 0:Ye.intro)==null?void 0:wt.start,je=(Be=(Pn=$e==null?void 0:$e.data)==null?void 0:Pn.intro)==null?void 0:Be.end;if(we!==void 0&&je!==void 0){const tt=()=>{K.currentTime>=we&&K.currentTime<je&&!ct&&(K.currentTime=je,Gt(!0))};return K.addEventListener("timeupdate",tt),()=>K.removeEventListener("timeupdate",tt)}},[$e,ys,ct]),T.useEffect(()=>{if(!c.current||!an||!n||!r||!Os||!q)return;const K=c.current;let we,je=K.currentTime;const Ye=async()=>{const{updateProgress:wt,updateWatchTime:Pn}=await pi(async()=>{const{updateProgress:Zt,updateWatchTime:Dt}=await Promise.resolve().then(()=>wi);return{updateProgress:Zt,updateWatchTime:Dt}},void 0),Be=K.currentTime,tt=Math.max(0,Be-je);await wt(an.uid,n,Os.number,Be,!1,q.data.anime.info.name,q.data.anime.info.poster,r),tt>0&&tt<15&&await Pn(an.uid,tt),je=Be};return we=setInterval(()=>{!K.paused&&K.currentTime>0&&Ye()},1e4),()=>{we&&clearInterval(we),!K.paused&&K.currentTime>0&&Ye()}},[an,n,r,Os,q]),T.useEffect(()=>{if(!c.current||!gt||!pn)return;const K=c.current,we=()=>{gt&&pn&&t(`/watch/${n}?ep=${pn.episodeId}`)};return K.addEventListener("ended",we),()=>K.removeEventListener("ended",we)},[gt,pn,n,t]),T.useEffect(()=>{const K=c.current;if(!K)return;const we=()=>v(!0),je=()=>v(!1),Ye=()=>D(K.currentTime),wt=()=>S(K.duration),Pn=()=>{b(K.volume),E(K.muted)},Be=()=>G(!0),tt=()=>G(!1);return K.addEventListener("play",we),K.addEventListener("pause",je),K.addEventListener("timeupdate",Ye),K.addEventListener("durationchange",wt),K.addEventListener("volumechange",Pn),K.addEventListener("waiting",Be),K.addEventListener("canplay",tt),()=>{K.removeEventListener("play",we),K.removeEventListener("pause",je),K.removeEventListener("timeupdate",Ye),K.removeEventListener("durationchange",wt),K.removeEventListener("volumechange",Pn),K.removeEventListener("waiting",Be),K.removeEventListener("canplay",tt)}},[]),T.useEffect(()=>{c.current&&(c.current.playbackRate=F)},[F]);const Sm=()=>{m.current&&clearTimeout(m.current),L(!0),y&&!ae&&(m.current=setTimeout(()=>{L(!1)},3e3))},Po=()=>{c.current&&(y?c.current.pause():c.current.play())},_m=()=>{c.current&&(c.current.muted=!x)},il=K=>{const we=K[0];c.current&&(c.current.volume=we,we>0&&x&&(c.current.muted=!1))},jd=K=>{c.current&&(c.current.currentTime=Math.max(0,Math.min(_,c.current.currentTime+K)))},Cn=K=>{if(c.current&&f.current){const we=f.current.getBoundingClientRect(),je="touches"in K?K.touches[0].clientX:K.clientX,Ye=Math.max(0,Math.min(1,(je-we.left)/we.width));c.current.currentTime=Ye*_}},Am=K=>{if(f.current){const we=f.current.getBoundingClientRect(),je=Math.max(0,Math.min(1,(K.clientX-we.left)/we.width));J(je*_)}},ol=K=>{he(!0),Cn(K)};T.useEffect(()=>{const K=je=>{if(ae&&f.current&&c.current){const Ye=f.current.getBoundingClientRect(),wt=Math.max(0,Math.min(1,(je.clientX-Ye.left)/Ye.width));c.current.currentTime=wt*_}},we=()=>{ae&&he(!1)};return ae&&(document.addEventListener("mousemove",K),document.addEventListener("mouseup",we)),()=>{document.removeEventListener("mousemove",K),document.removeEventListener("mouseup",we)}},[ae,_]);const al=()=>{h.current&&(I?document.exitFullscreen&&document.exitFullscreen():h.current.requestFullscreen&&h.current.requestFullscreen())};T.useEffect(()=>{const K=()=>{R(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",K),()=>document.removeEventListener("fullscreenchange",K)},[]);const Fd=K=>{if(!isFinite(K))return"0:00";const we=Math.floor(K/3600),je=Math.floor(K%3600/60),Ye=Math.floor(K%60);return we>0?`${we}:${je.toString().padStart(2,"0")}:${Ye.toString().padStart(2,"0")}`:`${je}:${Ye.toString().padStart(2,"0")}`},Ev=()=>{Co&&t(`/watch/${n}?ep=${Co.episodeId}`)},ko=()=>{pn&&t(`/watch/${n}?ep=${pn.episodeId}`)};return r?u.jsxs("div",{className:"min-h-screen bg-background",children:[u.jsx("div",{className:"container mx-auto px-4 py-6",children:u.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-6",children:[u.jsxs("div",{className:"xl:col-span-3 space-y-6",children:[u.jsx("div",{className:"relative rounded-2xl overflow-hidden shadow-2xl bg-black",children:u.jsxs("div",{ref:h,className:"relative aspect-video bg-black group",onMouseMove:Sm,onMouseLeave:()=>y&&!ae&&L(!1),children:[u.jsx("video",{ref:c,className:"w-full h-full",onClick:Po,crossOrigin:"anonymous"}),M&&u.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 z-10",children:u.jsx("div",{className:"w-16 h-16 border-4 border-purple-500/30 border-t-purple-500 rounded-full animate-spin"})}),!y&&!M&&u.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10",children:u.jsx("button",{onClick:Po,className:"w-20 h-20 rounded-full bg-gradient-to-br from-purple-600 to-purple-800 hover:from-purple-700 hover:to-purple-900 flex items-center justify-center transition-all hover:scale-110 shadow-2xl shadow-purple-500/50",children:u.jsx(fi,{className:"w-10 h-10 text-white ml-1",fill:"white"})})}),u.jsx("div",{className:`absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/90 via-black/60 to-transparent transition-opacity duration-200 z-20 ${N||!y?"opacity-100":"opacity-0 pointer-events-none"}`,children:u.jsxs("div",{className:"px-4 pb-4 pt-12",children:[u.jsxs("div",{ref:f,className:"w-full h-2 bg-white/10 backdrop-blur-sm rounded-full cursor-pointer mb-4 group/progress relative",onMouseDown:ol,onMouseMove:Am,onMouseLeave:()=>J(null),children:[u.jsx("div",{className:"h-full bg-gradient-to-r from-purple-600 to-purple-400 rounded-full relative",style:{width:`${C/_*100}%`},children:u.jsx("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 bg-white rounded-full shadow-lg shadow-purple-500/50"})}),Y!==null&&u.jsx("div",{className:"absolute bottom-full mb-2 -translate-x-1/2 bg-black/90 backdrop-blur-sm text-white text-xs px-2 py-1 rounded",style:{left:`${Y/_*100}%`},children:Fd(Y)})]}),u.jsxs("div",{className:"flex items-center justify-between text-white",children:[u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsx("button",{onClick:Po,className:"hover:text-purple-400 transition-colors",children:y?u.jsx(pK,{className:"w-6 h-6"}):u.jsx(fi,{className:"w-6 h-6"})}),u.jsx("button",{onClick:()=>jd(-10),className:"hover:text-purple-400 transition-colors",title:"Rewind 10 seconds",children:u.jsx(vK,{className:"w-5 h-5"})}),u.jsx("button",{onClick:()=>jd(10),className:"hover:text-purple-400 transition-colors",title:"Forward 10 seconds",children:u.jsx(xK,{className:"w-5 h-5"})}),u.jsxs("div",{className:"flex items-center gap-2 group/volume",children:[u.jsx("button",{onClick:_m,className:"hover:text-purple-400 transition-colors",children:x||w===0?u.jsx(bM,{className:"w-5 h-5"}):u.jsx(TM,{className:"w-5 h-5"})}),u.jsx("div",{className:"w-0 group-hover/volume:w-24 overflow-hidden transition-all duration-300",children:u.jsx(bU,{value:[x?0:w],max:1,step:.01,onValueChange:il,className:"w-24"})})]}),u.jsxs("div",{className:"text-sm font-medium",children:[Fd(C)," / ",Fd(_)]})]}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsxs("div",{className:"relative",children:[u.jsx("button",{onClick:()=>$(!V),className:"hover:text-purple-400 transition-colors",children:u.jsx(EM,{className:"w-5 h-5"})}),V&&u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"fixed inset-0 z-30",onClick:()=>$(!1)}),u.jsxs("div",{className:"absolute bottom-full right-0 mb-3 bg-black/80 backdrop-blur-xl rounded-lg overflow-hidden min-w-[280px] shadow-2xl border border-purple-500/30 z-40",children:[u.jsxs("div",{className:"flex border-b border-purple-500/20",children:[u.jsx("button",{onClick:()=>X("speed"),className:`flex-1 px-4 py-2.5 text-xs font-medium transition-colors ${U==="speed"?"bg-gradient-to-r from-purple-600 to-purple-700 text-white":"text-gray-400 hover:text-white hover:bg-white/5"}`,children:"Speed"}),u.jsx("button",{onClick:()=>X("quality"),className:`flex-1 px-4 py-2.5 text-xs font-medium transition-colors ${U==="quality"?"bg-gradient-to-r from-purple-600 to-purple-700 text-white":"text-gray-400 hover:text-white hover:bg-white/5"}`,children:"Quality"}),u.jsx("button",{onClick:()=>X("subtitles"),className:`flex-1 px-4 py-2.5 text-xs font-medium transition-colors ${U==="subtitles"?"bg-gradient-to-r from-purple-600 to-purple-700 text-white":"text-gray-400 hover:text-white hover:bg-white/5"}`,children:"Subtitles"})]}),u.jsxs("div",{className:"p-3 max-h-[350px] overflow-y-auto custom-scrollbar",children:[U==="speed"&&u.jsx("div",{className:"space-y-2",children:[.25,.5,.75,1,1.25,1.5,1.75,2].map(K=>u.jsx("button",{onClick:()=>j(K),className:`w-full px-3 py-2 rounded text-sm text-left transition-all ${F===K?"bg-gradient-to-r from-purple-600 to-purple-700 text-white":"text-gray-300 hover:bg-white/10"}`,children:K===1?"Normal":`${K}x`},K))}),U==="quality"&&u.jsxs("div",{className:"space-y-2",children:[u.jsx("button",{className:"w-full px-3 py-2 rounded text-sm text-left bg-gradient-to-r from-purple-600 to-purple-700 text-white",children:"Auto"}),u.jsx("button",{className:"w-full px-3 py-2 rounded text-sm text-left text-gray-300 hover:bg-white/10",children:"1080p"}),u.jsx("button",{className:"w-full px-3 py-2 rounded text-sm text-left text-gray-300 hover:bg-white/10",children:"720p"}),u.jsx("button",{className:"w-full px-3 py-2 rounded text-sm text-left text-gray-300 hover:bg-white/10",children:"480p"})]}),U==="subtitles"&&u.jsxs("div",{className:"space-y-2",children:[u.jsxs("button",{onClick:()=>{var K;return(K=p.current)==null?void 0:K.click()},className:"w-full flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 rounded text-sm text-white transition-all",children:[u.jsx(uR,{className:"w-4 h-4"}),"Upload Subtitle"]}),u.jsx("input",{ref:p,type:"file",accept:".srt,.vtt,.ass",onChange:Li,className:"hidden"}),u.jsxs("button",{onClick:()=>Ee("off"),className:`w-full px-3 py-2 rounded text-sm text-left transition-all flex items-center gap-2 ${re==="off"?"bg-gradient-to-r from-purple-600 to-purple-700 text-white":"text-gray-300 hover:bg-white/10"}`,children:[u.jsx(lr,{className:"w-4 h-4"}),"Off"]}),ve.map((K,we)=>u.jsxs("button",{onClick:()=>Ee(K.label),className:`w-full px-3 py-2 rounded text-sm text-left transition-all flex items-center gap-2 ${re===K.label?"bg-gradient-to-r from-purple-600 to-purple-700 text-white":"text-gray-300 hover:bg-white/10"}`,children:[u.jsx(JG,{className:"w-4 h-4"}),K.label]},we)),xe.map((K,we)=>u.jsxs("button",{onClick:()=>Ee(K.label),className:`w-full px-3 py-2 rounded text-sm text-left transition-all flex items-center gap-2 ${re===K.label?"bg-gradient-to-r from-purple-600 to-purple-700 text-white":"text-gray-300 hover:bg-white/10"}`,children:[u.jsx(uR,{className:"w-4 h-4"}),K.label]},`uploaded-${we}`))]})]})]})]})]}),u.jsx("button",{onClick:al,className:"hover:text-purple-400 transition-colors",children:I?u.jsx(mK,{className:"w-5 h-5"}):u.jsx(dK,{className:"w-5 h-5"})})]})]})]})})]})}),u.jsx("div",{className:"bg-black/40 backdrop-blur-xl rounded-xl p-4 border border-purple-500/20 shadow-lg",children:u.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[u.jsxs("div",{className:"flex items-center gap-5 flex-wrap",children:[u.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[u.jsx("span",{className:"text-sm text-gray-300 group-hover:text-purple-400 transition-colors",children:"Auto Play"}),u.jsxs("div",{className:"relative",children:[u.jsx("input",{type:"checkbox",checked:Le,onChange:K=>qe(K.target.checked),className:"sr-only peer"}),u.jsx("div",{className:"w-11 h-6 bg-gray-700 rounded-full peer peer-checked:bg-gradient-to-r peer-checked:from-purple-600 peer-checked:to-purple-700 transition-all duration-300"}),u.jsx("div",{className:"absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition-transform duration-300 peer-checked:translate-x-5 shadow-lg"})]})]}),u.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[u.jsx("span",{className:"text-sm text-gray-300 group-hover:text-purple-400 transition-colors",children:"Auto Next"}),u.jsxs("div",{className:"relative",children:[u.jsx("input",{type:"checkbox",checked:gt,onChange:K=>Jt(K.target.checked),className:"sr-only peer"}),u.jsx("div",{className:"w-11 h-6 bg-gray-700 rounded-full peer peer-checked:bg-gradient-to-r peer-checked:from-purple-600 peer-checked:to-purple-700 transition-all duration-300"}),u.jsx("div",{className:"absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition-transform duration-300 peer-checked:translate-x-5 shadow-lg"})]})]}),u.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[u.jsx("span",{className:"text-sm text-gray-300 group-hover:text-purple-400 transition-colors",children:"Skip Intro"}),u.jsxs("div",{className:"relative",children:[u.jsx("input",{type:"checkbox",checked:ys,onChange:K=>De(K.target.checked),className:"sr-only peer"}),u.jsx("div",{className:"w-11 h-6 bg-gray-700 rounded-full peer peer-checked:bg-gradient-to-r peer-checked:from-purple-600 peer-checked:to-purple-700 transition-all duration-300"}),u.jsx("div",{className:"absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition-transform duration-300 peer-checked:translate-x-5 shadow-lg"})]})]})]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsxs(ne,{variant:"secondary",size:"sm",onClick:Ev,disabled:!Co,className:"gap-1 bg-white/10 backdrop-blur-sm hover:bg-white/20 text-white border-purple-500/20 disabled:opacity-30",children:[u.jsx(uo,{className:"w-4 h-4"}),"Prev"]}),u.jsxs(ne,{variant:"default",size:"sm",onClick:ko,disabled:!pn,className:"gap-1 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white disabled:opacity-30 border-0",children:["Next",u.jsx(cs,{className:"w-4 h-4"})]})]})]})}),u.jsx("div",{className:"bg-black/40 backdrop-blur-xl rounded-xl p-5 border border-purple-500/20 shadow-lg",children:u.jsxs("div",{className:"space-y-5",children:[u.jsxs("div",{className:"flex items-center gap-3 pb-4 border-b border-purple-500/20",children:[u.jsx(_K,{className:"w-5 h-5 text-purple-500"}),u.jsxs("div",{children:[u.jsx("div",{className:"text-xs text-gray-500 mb-0.5",children:"You are watching"}),u.jsxs("div",{className:"text-lg font-bold text-white",children:["Episode ",Os==null?void 0:Os.number]})]})]}),(($d=Xe==null?void 0:Xe.data)==null?void 0:$d.sub)&&Xe.data.sub.length>0&&u.jsxs("div",{children:[u.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[u.jsx(qt,{className:"bg-purple-600/20 text-purple-400 border-purple-600/30",children:"SUB"}),u.jsxs("span",{className:"text-xs text-gray-500",children:[Xe.data.sub.length," available"]})]}),u.jsx("div",{className:"flex flex-wrap gap-2",children:Xe.data.sub.map(K=>u.jsx(ne,{size:"sm",onClick:()=>{l("sub"),o(K.serverName.toLowerCase())},className:`${i===K.serverName.toLowerCase()&&a==="sub"?"bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white border-0":"bg-white/10 backdrop-blur-sm hover:bg-white/20 text-gray-300 border-purple-500/20"}`,children:K.serverName},K.serverId))})]}),((Bd=Xe==null?void 0:Xe.data)==null?void 0:Bd.dub)&&Xe.data.dub.length>0&&u.jsxs("div",{children:[u.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[u.jsx(qt,{className:"bg-green-600/20 text-green-400 border-green-600/30",children:"DUB"}),u.jsxs("span",{className:"text-xs text-gray-500",children:[Xe.data.dub.length," available"]})]}),u.jsx("div",{className:"flex flex-wrap gap-2",children:Xe.data.dub.map(K=>u.jsx(ne,{size:"sm",onClick:()=>{l("dub"),o(K.serverName.toLowerCase())},className:`${i===K.serverName.toLowerCase()&&a==="dub"?"bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white border-0":"bg-white/10 backdrop-blur-sm hover:bg-white/20 text-gray-300 border-purple-500/20"}`,children:K.serverName},K.serverId))})]}),u.jsxs("div",{className:"pt-4 border-t border-purple-500/20",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[u.jsx(nK,{className:"w-4 h-4 text-gray-500"}),u.jsx("span",{className:"text-sm font-medium text-white",children:"Downloads"})]}),u.jsx("p",{className:"text-sm text-gray-500",children:"Download links are currently unavailable."})]})]})}),u.jsxs("div",{className:"bg-black/40 backdrop-blur-xl rounded-xl p-5 border border-purple-500/20 shadow-lg",children:[u.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[u.jsx("img",{src:(Gd=(Tc=(wc=q==null?void 0:q.data)==null?void 0:wc.anime)==null?void 0:Tc.info)==null?void 0:Gd.poster,alt:(km=(Kd=(Pm=q==null?void 0:q.data)==null?void 0:Pm.anime)==null?void 0:Kd.info)==null?void 0:km.name,className:"w-28 h-40 object-cover rounded-lg"}),u.jsxs("div",{className:"flex-1",children:[u.jsx("h2",{className:"text-xl font-bold text-white mb-2 line-clamp-2",children:(bc=(Hd=(cl=q==null?void 0:q.data)==null?void 0:cl.anime)==null?void 0:Hd.info)==null?void 0:bc.name}),u.jsxs("div",{className:"flex items-center gap-2 mb-3 flex-wrap",children:[((Nm=(Sc=(zr=(Lo=q==null?void 0:q.data)==null?void 0:Lo.anime)==null?void 0:zr.info)==null?void 0:Sc.stats)==null?void 0:Nm.rating)&&u.jsxs(qt,{className:"bg-yellow-600/20 text-yellow-400 border-yellow-600/30",children:[" ",q.data.anime.info.stats.rating]}),((_c=(qd=(zd=(Wd=q==null?void 0:q.data)==null?void 0:Wd.anime)==null?void 0:zd.info)==null?void 0:qd.stats)==null?void 0:_c.quality)&&u.jsx(qt,{className:"bg-green-600/20 text-green-400 border-green-600/30",children:q.data.anime.info.stats.quality}),((Xd=(Qd=(Yd=(Ac=q==null?void 0:q.data)==null?void 0:Ac.anime)==null?void 0:Yd.info)==null?void 0:Qd.stats)==null?void 0:Xd.type)&&u.jsx(qt,{className:"bg-purple-600/20 text-purple-400 border-purple-600/30",children:q.data.anime.info.stats.type})]}),u.jsx("p",{className:"text-sm text-gray-400 line-clamp-3 mb-3",children:(js=(_r=(Lm=q==null?void 0:q.data)==null?void 0:Lm.anime)==null?void 0:_r.info)==null?void 0:js.description}),u.jsxs("div",{className:"flex flex-wrap gap-2",children:[((Do=$e==null?void 0:$e.data)==null?void 0:Do.anilistID)&&u.jsxs("a",{href:`https://anilist.co/anime/${$e.data.anilistID}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-[#02a9ff]/10 border border-[#02a9ff]/30 text-[#02a9ff] text-xs font-medium hover:bg-[#02a9ff]/20 transition-all",children:[u.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:u.jsx("path",{d:"M6.361 2.943L0 21.056h4.942l1.077-3.133H11.4l1.052 3.133H22.9c.71 0 1.1-.392 1.1-1.101V17.53c0-.71-.39-1.101-1.1-1.101h-6.483V4.045c0-.71-.392-1.102-1.101-1.102h-2.422c-.71 0-1.101.392-1.101 1.102v1.064l-.758-2.166zm2.324 5.948l1.688 5.018H7.144z"})}),"AniList"]}),((Mo=$e==null?void 0:$e.data)==null?void 0:Mo.malID)&&u.jsxs("a",{href:`https://myanimelist.net/anime/${$e.data.malID}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-[#2e51a2]/10 border border-[#2e51a2]/30 text-[#2e51a2] text-xs font-medium hover:bg-[#2e51a2]/20 transition-all",children:[u.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:u.jsx("path",{d:"M8.273 7.247v8.423l-2.103-.003v-5.216l-2.03 5.219-2.045-5.219v5.216H0V7.247h2.135l2.07 5.240 2.068-5.240zm4.546 0v8.423H11.05V7.247zm3.812 0l2.035 5.239 2.069-5.239h2.103l.002 8.423h-1.879v-5.216l-2.047 5.219-2.031-5.219v5.216h-2.135V7.247zm-7.149 8.423h-2.135V7.247h2.135z"})}),"MAL"]})]})]})]}),pn&&u.jsxs("div",{className:"mt-5 pt-5 border-t border-purple-500/20",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[u.jsx(py,{className:"w-4 h-4 text-purple-500"}),u.jsx("span",{className:"text-sm font-medium text-white",children:"Next Episode"})]}),u.jsxs("div",{className:"text-sm text-gray-400",children:["Episode ",pn.number,pn.title&&` - ${pn.title}`]})]})]})]}),u.jsxs("div",{className:"xl:col-span-1 space-y-4",children:[u.jsxs("div",{className:"bg-black/40 backdrop-blur-xl rounded-xl p-4 border border-purple-500/20 shadow-lg",children:[u.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Episodes"}),u.jsx("div",{className:"relative mb-4",children:u.jsx("input",{type:"text",placeholder:"Search episodes...",value:br,onChange:K=>on(K.target.value),className:"w-full px-3 py-2 bg-white/5 border border-purple-500/20 rounded-lg text-white text-sm placeholder:text-gray-500 focus:outline-none focus:border-purple-500/50 focus:bg-white/10 transition-all"})}),u.jsx("div",{className:"grid grid-cols-5 xl:grid-cols-4 gap-2 max-h-[60vh] overflow-y-auto custom-scrollbar pr-1",children:Ni==null?void 0:Ni.map(K=>u.jsx(be,{href:`/watch/${n}?ep=${K.episodeId}`,children:u.jsxs("div",{className:`aspect-square rounded-lg cursor-pointer transition-all flex items-center justify-center relative group/episode ${K.episodeId===r?"bg-gradient-to-br from-purple-600 to-purple-800 shadow-lg shadow-purple-500/30":"bg-gradient-to-br from-gray-800/50 to-gray-900/50 hover:from-purple-900/30 hover:to-purple-800/30 border border-purple-500/10"}`,onMouseEnter:()=>vs(K.episodeId),onMouseLeave:()=>vs(null),children:[u.jsx("span",{className:`text-base font-bold transition-opacity ${K.episodeId===r?"text-white":"text-gray-300"} ${Kn===K.episodeId?"opacity-0":"opacity-100"}`,children:K.number}),Kn===K.episodeId&&K.episodeId!==r&&u.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-purple-600/20 backdrop-blur-sm rounded-lg",children:u.jsx(eK,{className:"w-8 h-8 text-purple-400"})}),K.isFiller&&u.jsx("div",{className:"absolute top-1 right-1 w-1.5 h-1.5 bg-orange-500 rounded-full shadow-lg"})]})},K.episodeId))})]}),((Ic=q==null?void 0:q.data)==null?void 0:Ic.relatedAnimes)&&q.data.relatedAnimes.length>0&&u.jsxs("div",{className:"hidden xl:block bg-black/40 backdrop-blur-xl rounded-xl p-4 border border-purple-500/20 shadow-lg",children:[u.jsxs("h2",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[u.jsx("span",{className:"w-1 h-5 bg-gradient-to-b from-purple-500 to-pink-500 rounded-full"}),"Related Anime"]}),u.jsx("div",{className:"flex flex-col gap-4 max-h-[500px] overflow-y-auto custom-scrollbar pr-1",children:q.data.relatedAnimes.slice(0,10).map(K=>{var we,je,Ye,wt,Pn,Be,tt,Zt,Dt,Kt,ul,Oo,jo,Di,Jd,Mi;return u.jsx(be,{href:`/anime/${K.id}`,className:"block",children:u.jsxs("div",{className:"group flex gap-3 rounded-lg bg-white/5 hover:bg-purple-900/20 border border-purple-500/10 hover:border-purple-500/40 transition-all duration-300 cursor-pointer p-2.5 hover:-translate-y-0.5",children:[u.jsxs("div",{className:"relative flex-shrink-0 w-10 h-14 rounded-md overflow-hidden ring-1 ring-white/10 group-hover:ring-purple-500/50 transition-all",children:[u.jsx("img",{src:K.poster,alt:K.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}),u.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent"})]}),u.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-between py-0.5",children:[u.jsx("h3",{className:"text-white text-xs font-semibold line-clamp-2 leading-tight group-hover:text-purple-400 transition-colors",children:K.name}),u.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap mt-1.5",children:[((we=K.stats)==null?void 0:we.type)&&u.jsx("span",{className:"px-1.5 py-0.5 rounded bg-purple-500/30 text-purple-200 text-[10px] font-medium border border-purple-400/30",children:K.stats.type}),((je=K.stats)==null?void 0:je.rating)&&u.jsxs("span",{className:"px-1.5 py-0.5 rounded bg-yellow-500/30 text-yellow-200 text-[10px] font-medium border border-yellow-400/30 flex items-center gap-0.5",children:[u.jsx("span",{children:""})," ",K.stats.rating]}),((Ye=K.stats)==null?void 0:Ye.quality)&&u.jsx("span",{className:"px-1.5 py-0.5 rounded bg-purple-600/30 text-purple-200 text-[10px] font-medium border border-purple-500/30",children:K.stats.quality})]}),u.jsxs("div",{className:"flex items-center gap-2 mt-1.5 text-[10px]",children:[((Pn=(wt=K.stats)==null?void 0:wt.episodes)==null?void 0:Pn.sub)>0&&u.jsxs("span",{className:"text-purple-300 font-medium",children:[u.jsx("span",{className:"text-purple-400",children:"SUB"})," ",K.stats.episodes.sub]}),((tt=(Be=K.stats)==null?void 0:Be.episodes)==null?void 0:tt.sub)>0&&((Dt=(Zt=K.stats)==null?void 0:Zt.episodes)==null?void 0:Dt.dub)>0&&u.jsx("span",{className:"text-gray-500",children:""}),((ul=(Kt=K.stats)==null?void 0:Kt.episodes)==null?void 0:ul.dub)>0&&u.jsxs("span",{className:"text-green-300 font-medium",children:[u.jsx("span",{className:"text-green-400",children:"DUB"})," ",K.stats.episodes.dub]}),((Oo=K.stats)==null?void 0:Oo.duration)&&u.jsxs(u.Fragment,{children:[(((Di=(jo=K.stats)==null?void 0:jo.episodes)==null?void 0:Di.sub)>0||((Mi=(Jd=K.stats)==null?void 0:Jd.episodes)==null?void 0:Mi.dub)>0)&&u.jsx("span",{className:"text-gray-500",children:""}),u.jsx("span",{className:"text-gray-400",children:K.stats.duration})]})]})]})]})},K.id)})})]})]}),((yt=q==null?void 0:q.data)==null?void 0:yt.relatedAnimes)&&q.data.relatedAnimes.length>0&&u.jsxs("div",{className:"xl:hidden bg-black/40 backdrop-blur-xl rounded-xl p-5 border border-purple-500/20 shadow-lg",children:[u.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Related Anime"}),u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:q.data.relatedAnimes.slice(0,4).map(K=>u.jsx(be,{href:`/anime/${K.id}`,children:u.jsxs("div",{className:"group relative aspect-[2/3] overflow-hidden rounded-xl cursor-pointer transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-primary/20",children:[u.jsx("img",{src:K.poster,alt:K.name,className:"w-full h-full object-cover transition-all duration-500 group-hover:scale-110"}),u.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all duration-500"}),u.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/95 via-black/40 to-transparent pointer-events-none"}),u.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300 z-10",children:u.jsx("div",{className:"bg-white/95 backdrop-blur-md border border-white/40 rounded-full p-3 shadow-2xl hover:scale-110 transition-transform duration-200",children:u.jsx(fi,{className:"w-6 h-6 text-black fill-current"})})}),u.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-3 z-10",children:u.jsx("h3",{className:"text-white font-bold text-sm line-clamp-2 drop-shadow-2xl tracking-tight leading-tight",children:K.name})})]})},K.id))})]}),u.jsx("div",{className:"xl:col-span-4 bg-black/40 backdrop-blur-xl rounded-xl p-6 border border-purple-500/20 shadow-lg mt-6",children:u.jsx(ace,{animeId:n||"",episodeId:r||""})})]})}),u.jsx("style",{children:`
        .custom-scrollbar::-webkit-scrollbar {
          width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: rgba(139, 92, 246, 0.1);
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: rgba(139, 92, 246, 0.5);
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: rgba(139, 92, 246, 0.7);
        }

        video::cue {
          background-color: rgba(0, 0, 0, 0.8);
          color: white;
          font-size: 1.2em;
          font-family: Arial, sans-serif;
        }
      `})]}):u.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:u.jsxs("div",{className:"bg-black/40 backdrop-blur-xl border border-purple-500/20 rounded-2xl p-8 text-center max-w-md shadow-2xl",children:[u.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"No Episode Selected"}),u.jsx("p",{className:"text-gray-400 mb-6",children:"Please select an episode to watch"}),u.jsx(be,{href:`/anime/${n}`,children:u.jsx(ne,{className:"bg-gradient-to-r from-purple-600 to-purple-800 hover:from-purple-700 hover:to-purple-900 text-white border-0",children:"Go to Anime Details"})})]})})}var g_="Collapsible",[cce,t$]=Ds(g_),[uce,y_]=cce(g_),n$=T.forwardRef((n,e)=>{const{__scopeCollapsible:t,open:s,defaultOpen:r,disabled:i,onOpenChange:o,...a}=n,[l=!1,c]=Br({prop:s,defaultProp:r,onChange:o});return u.jsx(uce,{scope:t,disabled:i,contentId:mr(),open:l,onOpenToggle:T.useCallback(()=>c(d=>!d),[c]),children:u.jsx(Se.div,{"data-state":E_(l),"data-disabled":i?"":void 0,...a,ref:e})})});n$.displayName=g_;var s$="CollapsibleTrigger",r$=T.forwardRef((n,e)=>{const{__scopeCollapsible:t,...s}=n,r=y_(s$,t);return u.jsx(Se.button,{type:"button","aria-controls":r.contentId,"aria-expanded":r.open||!1,"data-state":E_(r.open),"data-disabled":r.disabled?"":void 0,disabled:r.disabled,...s,ref:e,onClick:ie(n.onClick,r.onOpenToggle)})});r$.displayName=s$;var v_="CollapsibleContent",x_=T.forwardRef((n,e)=>{const{forceMount:t,...s}=n,r=y_(v_,n.__scopeCollapsible);return u.jsx(wr,{present:t||r.open,children:({present:i})=>u.jsx(dce,{...s,ref:e,present:i})})});x_.displayName=v_;var dce=T.forwardRef((n,e)=>{const{__scopeCollapsible:t,present:s,children:r,...i}=n,o=y_(v_,t),[a,l]=T.useState(s),c=T.useRef(null),d=ze(e,c),h=T.useRef(0),f=h.current,m=T.useRef(0),p=m.current,y=o.open||a,v=T.useRef(y),x=T.useRef(void 0);return T.useEffect(()=>{const E=requestAnimationFrame(()=>v.current=!1);return()=>cancelAnimationFrame(E)},[]),hn(()=>{const E=c.current;if(E){x.current=x.current||{transitionDuration:E.style.transitionDuration,animationName:E.style.animationName},E.style.transitionDuration="0s",E.style.animationName="none";const w=E.getBoundingClientRect();h.current=w.height,m.current=w.width,v.current||(E.style.transitionDuration=x.current.transitionDuration,E.style.animationName=x.current.animationName),l(s)}},[o.open,s]),u.jsx(Se.div,{"data-state":E_(o.open),"data-disabled":o.disabled?"":void 0,id:o.contentId,hidden:!y,...i,ref:d,style:{"--radix-collapsible-content-height":f?`${f}px`:void 0,"--radix-collapsible-content-width":p?`${p}px`:void 0,...n.style},children:y&&r})});function E_(n){return n?"open":"closed"}var i$=n$,hce=r$,fce=x_;const mce=i$,pce=x_;function gce(){var V,$;nv();const[n,e]=Ls(),t=new URLSearchParams(n.split("?")[1]),[s,r]=T.useState(t.get("q")||""),[i,o]=T.useState(Number(t.get("page")||"1")),[a,l]=T.useState(!1),[c,d]=T.useState(((V=t.get("genres"))==null?void 0:V.split(",").filter(Boolean))||[]),[h,f]=T.useState(t.get("type")||""),[m,p]=T.useState(t.get("season")||""),[y,v]=T.useState(t.get("language")||""),[x,E]=T.useState(t.get("status")||""),w=()=>{const F=new URLSearchParams;return s&&F.set("q",s),F.set("page",i.toString()),c.length>0&&F.set("genres",c.join(",")),h&&F.set("type",h),m&&F.set("season",m),y&&F.set("language",y),x&&F.set("status",x),F.toString()},{data:b,isLoading:C}=Zn({queryKey:["/api/search",s,i,c.join(","),h,m,y,x],queryFn:async()=>{const F=w(),j=await fetch(`/api/search?${F}`);if(!j.ok)throw new Error("Failed to search anime");return j.json()},enabled:s.length>0});T.useEffect(()=>{const F=w();e(`/search?${F}`,{replace:!0})},[i,s,c,h,m,y,x]);const D=F=>{F.preventDefault(),o(1)},_=F=>{d(j=>j.includes(F)?j.filter(U=>U!==F):[...j,F]),o(1)},S=()=>{d([]),f(""),p(""),v(""),E(""),o(1)},I=c.length>0||h||m||y||x,R=["Action","Adventure","Cars","Comedy","Dementia","Demons","Drama","Ecchi","Fantasy","Game","Harem","Historical","Horror","Josei","Kids","Magic","Martial Arts","Mecha","Military","Music","Mystery","Parody","Police","Psychological","Romance","Samurai","School","Sci-Fi","Seinen","Shoujo","Shounen","Slice of Life","Space","Sports","Super Power","Supernatural","Thriller","Vampire"],N=["movie","tv","ova","ona","special","music"],L=["winter","spring","summer","fall"],M=["sub","dub"],G=["finished-airing","currently-airing","not-yet-aired"];return u.jsxs("div",{className:"min-h-screen bg-background",children:[u.jsx(vm,{title:"Search Anime",description:"Search and discover anime series, movies, and shows. Advanced filters by genre, year, type, status, and more. Find your next anime to watch.",keywords:"anime search, find anime, search anime by genre, anime directory, anime catalog, discover anime",url:"https://animebite.cc/search"}),u.jsxs("div",{className:"container mx-auto px-4 py-8",children:[u.jsxs("div",{className:"mb-8",children:[u.jsx("h1",{className:"text-3xl font-bold text-foreground mb-6",children:"Search Anime"}),u.jsxs("form",{onSubmit:D,className:"flex gap-2 mb-6",children:[u.jsxs("div",{className:"relative flex-1",children:[u.jsx(gu,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),u.jsx(bn,{type:"search",placeholder:"Search for anime...",className:"pl-10 pr-4 h-12",value:s,onChange:F=>r(F.target.value),"data-testid":"input-search-query"})]}),u.jsxs(ne,{type:"submit",size:"lg",className:"md:px-8","data-testid":"button-search",children:[u.jsx(gu,{className:"w-5 h-5 md:mr-2"}),u.jsx("span",{className:"hidden md:inline",children:"Search"})]}),u.jsxs(ne,{type:"button",variant:"outline",size:"lg",onClick:()=>l(!a),"data-testid":"button-toggle-filters",className:`md:px-8 ${I?"border-primary":""}`,children:[u.jsx(rK,{className:"w-5 h-5 md:mr-2"}),u.jsx("span",{className:"hidden md:inline",children:"Filters"}),I&&u.jsx(qt,{className:"ml-2 h-5 px-1.5 min-w-[20px]",variant:"default",children:c.length+(h?1:0)+(m?1:0)+(y?1:0)+(x?1:0)})]})]}),u.jsx(mce,{open:a,onOpenChange:l,children:u.jsx(pce,{children:u.jsx(Oe,{className:"p-6 mb-6 bg-card/50 backdrop-blur-sm border-2",children:u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"flex items-center justify-between mb-3",children:[u.jsx("h3",{className:"text-sm font-bold text-foreground uppercase tracking-wide",children:"Genres"}),c.length>0&&u.jsx(ne,{variant:"ghost",size:"sm",onClick:()=>{d([]),o(1)},className:"h-7 text-xs",children:"Clear"})]}),u.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(F=>u.jsxs(qt,{variant:c.includes(F)?"default":"outline",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs font-medium ${c.includes(F)?"shadow-md scale-105":"hover:scale-105 hover:border-primary/50"}`,onClick:()=>_(F),"data-testid":`badge-genre-${F.toLowerCase()}`,children:[F,c.includes(F)&&u.jsx(lr,{className:"w-3 h-3 ml-1.5"})]},F))})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"flex items-center justify-between mb-3",children:[u.jsx("h3",{className:"text-sm font-bold text-foreground uppercase tracking-wide",children:"Type"}),h&&u.jsx(ne,{variant:"ghost",size:"sm",onClick:()=>f(""),className:"h-7 text-xs",children:"Clear"})]}),u.jsx("div",{className:"flex flex-wrap gap-2",children:N.map(F=>u.jsx(qt,{variant:h===F?"default":"outline",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs font-medium uppercase ${h===F?"shadow-md scale-105":"hover:scale-105 hover:border-primary/50"}`,onClick:()=>{f(h===F?"":F),o(1)},"data-testid":`badge-type-${F}`,children:F},F))})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex items-center justify-between mb-3",children:[u.jsx("h3",{className:"text-sm font-bold text-foreground uppercase tracking-wide",children:"Season"}),m&&u.jsx(ne,{variant:"ghost",size:"sm",onClick:()=>p(""),className:"h-7 text-xs",children:"Clear"})]}),u.jsx("div",{className:"flex flex-wrap gap-2",children:L.map(F=>u.jsx(qt,{variant:m===F?"default":"outline",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs font-medium capitalize ${m===F?"shadow-md scale-105":"hover:scale-105 hover:border-primary/50"}`,onClick:()=>{p(m===F?"":F),o(1)},"data-testid":`badge-season-${F}`,children:F},F))})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex items-center justify-between mb-3",children:[u.jsx("h3",{className:"text-sm font-bold text-foreground uppercase tracking-wide",children:"Language"}),y&&u.jsx(ne,{variant:"ghost",size:"sm",onClick:()=>v(""),className:"h-7 text-xs",children:"Clear"})]}),u.jsx("div",{className:"flex flex-wrap gap-2",children:M.map(F=>u.jsx(qt,{variant:y===F?"default":"outline",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs font-medium uppercase ${y===F?"shadow-md scale-105":"hover:scale-105 hover:border-primary/50"}`,onClick:()=>{v(y===F?"":F),o(1)},"data-testid":`badge-language-${F}`,children:F},F))})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex items-center justify-between mb-3",children:[u.jsx("h3",{className:"text-sm font-bold text-foreground uppercase tracking-wide",children:"Status"}),x&&u.jsx(ne,{variant:"ghost",size:"sm",onClick:()=>E(""),className:"h-7 text-xs",children:"Clear"})]}),u.jsx("div",{className:"flex flex-wrap gap-2",children:G.map(F=>u.jsx(qt,{variant:x===F?"default":"outline",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs font-medium ${x===F?"shadow-md scale-105":"hover:scale-105 hover:border-primary/50"}`,onClick:()=>{E(x===F?"":F),o(1)},"data-testid":`badge-status-${F}`,children:F.replace(/-/g," ")},F))})]})]}),I&&u.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[u.jsxs("div",{className:"text-sm text-muted-foreground",children:[c.length+(h?1:0)+(m?1:0)+(y?1:0)+(x?1:0)," filter(s) active"]}),u.jsxs(ne,{variant:"outline",size:"sm",onClick:S,"data-testid":"button-clear-filters",children:[u.jsx(lr,{className:"w-4 h-4 mr-2"}),"Clear All Filters"]})]})]})})})}),I&&u.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[c.map(F=>u.jsxs(qt,{variant:"default",className:"cursor-pointer px-3 py-1",onClick:()=>_(F),children:[F,u.jsx(lr,{className:"w-3 h-3 ml-1.5"})]},F)),h&&u.jsxs(qt,{variant:"default",className:"cursor-pointer px-3 py-1 uppercase",onClick:()=>f(""),children:[h,u.jsx(lr,{className:"w-3 h-3 ml-1.5"})]}),m&&u.jsxs(qt,{variant:"default",className:"cursor-pointer px-3 py-1 capitalize",onClick:()=>p(""),children:[m,u.jsx(lr,{className:"w-3 h-3 ml-1.5"})]}),y&&u.jsxs(qt,{variant:"default",className:"cursor-pointer px-3 py-1 uppercase",onClick:()=>v(""),children:[y,u.jsx(lr,{className:"w-3 h-3 ml-1.5"})]}),x&&u.jsxs(qt,{variant:"default",className:"cursor-pointer px-3 py-1",onClick:()=>E(""),children:[x.replace(/-/g," "),u.jsx(lr,{className:"w-3 h-3 ml-1.5"})]})]})]}),C?u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:Array.from({length:18}).map((F,j)=>u.jsx(sv,{},j))}):($=b==null?void 0:b.data)!=null&&$.animes&&b.data.animes.length>0?u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"mb-6",children:u.jsxs("p",{className:"text-muted-foreground",children:["Found ",u.jsx("span",{className:"text-foreground font-semibold",children:b.data.animes.length}),' results for "',u.jsx("span",{className:"text-foreground font-semibold",children:b.data.searchQuery}),'"',b.data.totalPages&&` - Page ${b.data.currentPage} of ${b.data.totalPages}`]})}),u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 mb-8",children:b.data.animes.map(F=>u.jsx(no,{...F},F.id))}),b.data.totalPages&&b.data.totalPages>1&&u.jsxs("div",{className:"flex justify-center gap-2",children:[u.jsxs(ne,{variant:"secondary",disabled:i===1,onClick:()=>o(F=>Math.max(1,F-1)),"data-testid":"button-prev-page",children:[u.jsx(uo,{className:"w-4 h-4 mr-1"}),"Previous"]}),u.jsx("div",{className:"flex items-center gap-2",children:u.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",i," of ",b.data.totalPages]})}),u.jsxs(ne,{variant:"secondary",disabled:!b.data.hasNextPage,onClick:()=>o(F=>F+1),"data-testid":"button-next-page",children:["Next",u.jsx(cs,{className:"w-4 h-4 ml-1"})]})]})]}):s?u.jsxs(Oe,{className:"p-12 text-center",children:[u.jsx("h2",{className:"text-xl font-bold text-foreground mb-2",children:"No Results Found"}),u.jsx("p",{className:"text-muted-foreground mb-4",children:"Try adjusting your search terms or filters"}),I&&u.jsx(ne,{variant:"outline",onClick:S,children:"Clear All Filters"})]}):u.jsxs(Oe,{className:"p-12 text-center",children:[u.jsx("h2",{className:"text-xl font-bold text-foreground mb-2",children:"Start Searching"}),u.jsx("p",{className:"text-muted-foreground",children:"Enter a search query above to find anime"})]})]})]})}function Nk(){var l,c,d;const{category:n}=pd(),[e,t]=T.useState(1),{data:s,isLoading:r}=Zn({queryKey:["/api/category",n,e],queryFn:async()=>{const h=await fetch(`/api/category/${n}?page=${e}`);if(!h.ok)throw new Error("Failed to fetch category");return h.json()}}),i=(n==null?void 0:n.split("-").map(h=>h.charAt(0).toUpperCase()+h.slice(1)).join(" "))||"",a={trending:{title:"Trending Anime - Most Popular Anime Right Now",description:"Watch trending anime online free. Stream the most popular and talked-about anime series and movies right now in HD.",keywords:"trending anime, popular anime, most watched anime, hot anime, viral anime"},"recently-updated":{title:"Recently Updated Anime - Latest Episodes Released",description:"Watch recently updated anime with latest episodes. Stream new anime episodes released today in HD with sub and dub.",keywords:"recently updated anime, latest anime episodes, new anime episodes, fresh anime"},"top-airing":{title:"Top Airing Anime - Currently Airing Anime Series",description:"Watch top airing anime series online free. Stream currently airing anime with latest episodes in HD.",keywords:"top airing anime, currently airing anime, ongoing anime, seasonal anime"},"top-upcoming":{title:"Upcoming Anime - New Anime Releases & Premieres",description:"Discover upcoming anime series and movies. Get updates on new anime releases and premieres coming soon.",keywords:"upcoming anime, new anime releases, anime premieres, future anime"}}[n||""]||{title:`${i} Anime - Watch Online Free in HD | AnimeBite`,description:`Watch ${i.toLowerCase()} anime online free in HD. Stream anime series and movies in this category.`,keywords:`${i.toLowerCase()} anime, watch ${i.toLowerCase()} anime`};return u.jsxs("div",{className:"min-h-screen bg-background",children:[u.jsx(vm,{title:a.title,description:a.description,keywords:a.keywords,url:`https://animebite.cc/category/${n}`}),u.jsxs("div",{className:"container mx-auto px-4 md:px-6 lg:px-8 py-8",children:[u.jsxs("div",{className:"flex items-center justify-between mb-8",children:[u.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-foreground flex items-center gap-2","data-testid":"text-category-title",children:[u.jsx("span",{className:"text-primary",children:"|"})," ",i]}),((l=s==null?void 0:s.data)==null?void 0:l.currentPage)&&((c=s==null?void 0:s.data)==null?void 0:c.totalPages)&&u.jsxs("p",{className:"text-sm text-muted-foreground",children:["Page ",s.data.currentPage," of ",s.data.totalPages]})]}),r?u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 2xl:grid-cols-7 gap-4",children:Array.from({length:21}).map((h,f)=>u.jsx(sv,{},f))}):(d=s==null?void 0:s.data)!=null&&d.animes&&s.data.animes.length>0?u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 2xl:grid-cols-7 gap-4 mb-8",children:s.data.animes.map(h=>u.jsx(no,{...h},h.id))}),u.jsxs("div",{className:"flex justify-center items-center gap-4 mt-8",children:[u.jsxs(ne,{variant:"secondary",disabled:e===1,onClick:()=>t(h=>Math.max(1,h-1)),"data-testid":"button-prev-page",className:"rounded-lg",children:[u.jsx(uo,{className:"w-4 h-4 mr-1"}),"Previous"]}),u.jsx("div",{className:"flex items-center gap-2 px-4 py-2 bg-accent rounded-lg",children:u.jsxs("span",{className:"text-sm font-medium text-foreground",children:[e," ",s.data.totalPages&&`/ ${s.data.totalPages}`]})}),u.jsxs(ne,{variant:"secondary",disabled:!s.data.hasNextPage,onClick:()=>t(h=>h+1),"data-testid":"button-next-page",className:"rounded-lg",children:["Next",u.jsx(cs,{className:"w-4 h-4 ml-1"})]})]})]}):u.jsx("div",{className:"text-center py-12",children:u.jsx("p",{className:"text-muted-foreground",children:"No anime found in this category"})})]})]})}const yce="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");function vce(){var c;const[n,e]=T.useState(1),[t,s]=T.useState("all"),[r,i]=T.useState(null),{data:o,isLoading:a}=Zn({queryKey:["/api/azlist",t,n],queryFn:async()=>{const d=await fetch(`/api/azlist/${t}?page=${n}`);if(!d.ok)throw new Error("Failed to fetch A-Z list");return d.json()}}),l=d=>{i(d),s(d.toLowerCase()),e(1)};return u.jsx("div",{className:"min-h-screen bg-background",children:u.jsxs("div",{className:"container mx-auto px-4 md:px-6 lg:px-8 py-8",children:[u.jsx("div",{className:"mb-6",children:u.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-foreground mb-6 flex items-center gap-2",children:[u.jsx("span",{className:"text-primary",children:"|"})," A-Z List"]})}),u.jsxs("div",{className:"mb-6",children:[u.jsx("h3",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Filter by Letter"}),u.jsx("div",{className:"flex flex-wrap gap-1.5 md:gap-2",children:yce.map(d=>u.jsx(ne,{variant:r===d?"default":"secondary",size:"sm",className:"w-8 h-8 md:w-10 md:h-10 p-0 rounded-lg text-xs md:text-sm font-semibold hover:bg-primary hover:text-primary-foreground transition-colors",onClick:()=>l(d),"data-testid":`button-letter-${d}`,children:d},d))})]}),a?u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 2xl:grid-cols-7 gap-4",children:Array.from({length:21}).map((d,h)=>u.jsx(rn,{className:"aspect-[2/3] rounded-xl"},h))}):(c=o==null?void 0:o.data)!=null&&c.animes&&o.data.animes.length>0?u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 2xl:grid-cols-7 gap-4 mb-8",children:o.data.animes.map(d=>u.jsx(no,{...d},d.id))}),u.jsxs("div",{className:"flex justify-center items-center gap-4 mt-8",children:[u.jsxs(ne,{variant:"secondary",disabled:n===1,onClick:()=>e(d=>Math.max(1,d-1)),"data-testid":"button-prev-page",className:"rounded-lg",children:[u.jsx(uo,{className:"w-4 h-4 mr-1"}),"Previous"]}),u.jsx("div",{className:"flex items-center gap-2 px-4 py-2 bg-accent rounded-lg",children:u.jsxs("span",{className:"text-sm font-medium text-foreground",children:[n," ",o.data.totalPages&&`/ ${o.data.totalPages}`]})}),u.jsxs(ne,{variant:"secondary",disabled:!o.data.hasNextPage,onClick:()=>e(d=>d+1),"data-testid":"button-next-page",className:"rounded-lg",children:["Next",u.jsx(cs,{className:"w-4 h-4 ml-1"})]})]})]}):u.jsx("div",{className:"text-center py-12",children:u.jsx("p",{className:"text-muted-foreground",children:"No anime found"})})]})})}var xce="Label",o$=T.forwardRef((n,e)=>u.jsx(Se.label,{...n,ref:e,onMouseDown:t=>{var r;t.target.closest("button, input, select, textarea")||((r=n.onMouseDown)==null||r.call(n,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));o$.displayName=xce;var a$=o$;const Ece=my("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),so=T.forwardRef(({className:n,...e},t)=>u.jsx(a$,{ref:t,className:Ae(Ece(),n),...e}));so.displayName=a$.displayName;var l$={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Lk=vt.createContext&&vt.createContext(l$),wce=["attr","size","title"];function Tce(n,e){if(n==null)return{};var t=bce(n,e),s,r;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(r=0;r<i.length;r++)s=i[r],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(n,s)&&(t[s]=n[s])}return t}function bce(n,e){if(n==null)return{};var t={};for(var s in n)if(Object.prototype.hasOwnProperty.call(n,s)){if(e.indexOf(s)>=0)continue;t[s]=n[s]}return t}function O0(){return O0=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},O0.apply(this,arguments)}function Dk(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})),t.push.apply(t,s)}return t}function j0(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Dk(Object(t),!0).forEach(function(s){Sce(n,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Dk(Object(t)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(t,s))})}return n}function Sce(n,e,t){return e=_ce(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function _ce(n){var e=Ace(n,"string");return typeof e=="symbol"?e:e+""}function Ace(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var s=t.call(n,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function c$(n){return n&&n.map((e,t)=>vt.createElement(e.tag,j0({key:t},e.attr),c$(e.child)))}function Ice(n){return e=>vt.createElement(Rce,O0({attr:j0({},n.attr)},e),c$(n.child))}function Rce(n){var e=t=>{var{attr:s,size:r,title:i}=n,o=Tce(n,wce),a=r||t.size||"1em",l;return t.className&&(l=t.className),n.className&&(l=(l?l+" ":"")+n.className),vt.createElement("svg",O0({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,s,o,{className:l,style:j0(j0({color:n.color||t.color},t.style),n.style),height:a,width:a,xmlns:"http://www.w3.org/2000/svg"}),i&&vt.createElement("title",null,i),n.children)};return Lk!==void 0?vt.createElement(Lk.Consumer,null,t=>e(t)):e(l$)}function Cce(n){return Ice({tag:"svg",attr:{version:"1.1",x:"0px",y:"0px",viewBox:"0 0 48 48",enableBackground:"new 0 0 48 48"},child:[{tag:"path",attr:{fill:"#FFC107",d:`M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12\r
	c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24\r
	c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z`},child:[]},{tag:"path",attr:{fill:"#FF3D00",d:`M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657\r
	C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z`},child:[]},{tag:"path",attr:{fill:"#4CAF50",d:`M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36\r
	c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z`},child:[]},{tag:"path",attr:{fill:"#1976D2",d:`M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571\r
	c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z`},child:[]}]})(n)}function Pce(){const[n,e]=T.useState(""),[t,s]=T.useState(""),[r,i]=T.useState(""),[o,a]=T.useState(!1),{login:l,googleSignIn:c}=Ms(),[,d]=Ls(),h=async m=>{m.preventDefault(),i(""),a(!0);try{await l(n,t),d("/")}catch(p){i(p.message||"Failed to sign in")}finally{a(!1)}},f=async()=>{i(""),a(!0);try{await c(),d("/")}catch(m){i(m.message||"Failed to sign in with Google")}finally{a(!1)}};return u.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:u.jsxs(Oe,{className:"w-full max-w-md",children:[u.jsxs(yc,{className:"space-y-1",children:[u.jsx(vc,{className:"text-2xl font-bold",children:"Welcome back"}),u.jsx(rv,{children:"Sign in to your AnimeBite account"})]}),u.jsxs(jt,{children:[r&&u.jsx("div",{className:"bg-destructive/10 text-destructive px-4 py-3 rounded-lg mb-4",children:r}),u.jsxs("form",{onSubmit:h,className:"space-y-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(so,{htmlFor:"email",children:"Email"}),u.jsx(bn,{id:"email",type:"email",placeholder:"you@example.com",value:n,onChange:m=>e(m.target.value),required:!0})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(so,{htmlFor:"password",children:"Password"}),u.jsx(bn,{id:"password",type:"password",placeholder:"",value:t,onChange:m=>s(m.target.value),required:!0})]}),u.jsx(ne,{type:"submit",className:"w-full",disabled:o,children:o?"Signing in...":"Sign in"})]}),u.jsxs("div",{className:"relative my-6",children:[u.jsx("div",{className:"absolute inset-0 flex items-center",children:u.jsx("span",{className:"w-full border-t"})}),u.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:u.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),u.jsxs(ne,{type:"button",variant:"outline",className:"w-full",onClick:f,disabled:o,children:[u.jsx(Cce,{className:"mr-2 h-5 w-5"}),"Google"]})]}),u.jsxs(z3,{className:"flex flex-col space-y-2",children:[u.jsx(be,{href:"/auth/reset",className:"text-sm text-muted-foreground hover:text-primary",children:"Forgot password?"}),u.jsxs("div",{className:"text-sm text-muted-foreground",children:["Don't have an account?"," ",u.jsx(be,{href:"/auth/signup",className:"text-primary hover:underline",children:"Sign up"})]})]})]})})}function kce(){const[,n]=Ls(),[e,t]=T.useState(""),[s,r]=T.useState(""),[i,o]=T.useState(""),{toast:a}=hb(),l=async c=>{if(c.preventDefault(),s!==i){a({title:"Error",description:"Passwords do not match",variant:"destructive"});return}a({title:"Coming Soon",description:"Sign up functionality will be available soon!"})};return u.jsx("div",{className:"container mx-auto px-4 py-16 flex items-center justify-center min-h-[80vh]",children:u.jsxs(Oe,{className:"w-full max-w-md",children:[u.jsxs(yc,{children:[u.jsx(vc,{children:"Create Account"}),u.jsx(rv,{children:"Sign up to start watching anime"})]}),u.jsx(jt,{children:u.jsxs("form",{onSubmit:l,className:"space-y-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(so,{htmlFor:"username",children:"Username"}),u.jsx(bn,{id:"username",type:"text",value:e,onChange:c=>t(c.target.value),required:!0})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(so,{htmlFor:"password",children:"Password"}),u.jsx(bn,{id:"password",type:"password",value:s,onChange:c=>r(c.target.value),required:!0})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(so,{htmlFor:"confirmPassword",children:"Confirm Password"}),u.jsx(bn,{id:"confirmPassword",type:"password",value:i,onChange:c=>o(c.target.value),required:!0})]}),u.jsx(ne,{type:"submit",className:"w-full",children:"Sign Up"}),u.jsx(ne,{type:"button",variant:"ghost",className:"w-full",onClick:()=>n("/auth/login"),children:"Already have an account? Log in"})]})})]})})}function Nce(){const[,n]=Ls(),[e,t]=T.useState(""),{toast:s}=hb(),r=async i=>{i.preventDefault(),s({title:"Coming Soon",description:"Password reset functionality will be available soon!"})};return u.jsx("div",{className:"container mx-auto px-4 py-16 flex items-center justify-center min-h-[80vh]",children:u.jsxs(Oe,{className:"w-full max-w-md",children:[u.jsxs(yc,{children:[u.jsx(vc,{children:"Reset Password"}),u.jsx(rv,{children:"Enter your email to reset your password"})]}),u.jsx(jt,{children:u.jsxs("form",{onSubmit:r,className:"space-y-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(so,{htmlFor:"email",children:"Email"}),u.jsx(bn,{id:"email",type:"email",value:e,onChange:i=>t(i.target.value),required:!0})]}),u.jsx(ne,{type:"submit",className:"w-full",children:"Send Reset Link"}),u.jsx(ne,{type:"button",variant:"ghost",className:"w-full",onClick:()=>n("/auth/login"),children:"Back to Login"})]})})]})})}function Lce(){const{currentUser:n}=Ms(),[e,t]=T.useState([]),[s,r]=T.useState(!0);T.useEffect(()=>{n?i():(t([]),r(!1))},[n]);const i=T.useCallback(async()=>{if(!n){t([]),r(!1);return}try{r(!0);const l=await O1(n.uid),c=await Promise.all(l.map(async d=>{try{const h=await fetch(`/api/anime/${d.animeId}`);if(h.ok){const f=await h.json();return{...d,title:f.data.anime.info.name,posterUrl:f.data.anime.info.poster}}}catch(h){console.error(`Error fetching anime ${d.animeId}:`,h)}return d}));t(c)}catch(l){console.error("Error loading continue watching:",l),t([])}finally{r(!1)}},[n]);return{continueWatching:e,loading:s,saveProgress:async(l,c,d,h=!1)=>{n&&(await d3(n.uid,l,c,d,h),await i())},getAnimeProgress:async l=>n?await h3(n.uid,l):null,refresh:i}}var w_="Dialog",[u$,Kpe]=Ds(w_),[Dce,Wr]=u$(w_),d$=n=>{const{__scopeDialog:e,children:t,open:s,defaultOpen:r,onOpenChange:i,modal:o=!0}=n,a=T.useRef(null),l=T.useRef(null),[c=!1,d]=Br({prop:s,defaultProp:r,onChange:i});return u.jsx(Dce,{scope:e,triggerRef:a,contentRef:l,contentId:mr(),titleId:mr(),descriptionId:mr(),open:c,onOpenChange:d,onOpenToggle:T.useCallback(()=>d(h=>!h),[d]),modal:o,children:t})};d$.displayName=w_;var h$="DialogTrigger",f$=T.forwardRef((n,e)=>{const{__scopeDialog:t,...s}=n,r=Wr(h$,t),i=ze(e,r.triggerRef);return u.jsx(Se.button,{type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":S_(r.open),...s,ref:i,onClick:ie(n.onClick,r.onOpenToggle)})});f$.displayName=h$;var T_="DialogPortal",[Mce,m$]=u$(T_,{forceMount:void 0}),p$=n=>{const{__scopeDialog:e,forceMount:t,children:s,container:r}=n,i=Wr(T_,e);return u.jsx(Mce,{scope:e,forceMount:t,children:T.Children.map(s,o=>u.jsx(wr,{present:t||i.open,children:u.jsx(nm,{asChild:!0,container:r,children:o})}))})};p$.displayName=T_;var F0="DialogOverlay",g$=T.forwardRef((n,e)=>{const t=m$(F0,n.__scopeDialog),{forceMount:s=t.forceMount,...r}=n,i=Wr(F0,n.__scopeDialog);return i.modal?u.jsx(wr,{present:s||i.open,children:u.jsx(jce,{...r,ref:e})}):null});g$.displayName=F0;var Oce=Ql("DialogOverlay.RemoveScroll"),jce=T.forwardRef((n,e)=>{const{__scopeDialog:t,...s}=n,r=Wr(F0,t);return u.jsx(Zy,{as:Oce,allowPinchZoom:!0,shards:[r.contentRef],children:u.jsx(Se.div,{"data-state":S_(r.open),...s,ref:e,style:{pointerEvents:"auto",...s.style}})})}),rc="DialogContent",y$=T.forwardRef((n,e)=>{const t=m$(rc,n.__scopeDialog),{forceMount:s=t.forceMount,...r}=n,i=Wr(rc,n.__scopeDialog);return u.jsx(wr,{present:s||i.open,children:i.modal?u.jsx(Fce,{...r,ref:e}):u.jsx(Uce,{...r,ref:e})})});y$.displayName=rc;var Fce=T.forwardRef((n,e)=>{const t=Wr(rc,n.__scopeDialog),s=T.useRef(null),r=ze(e,t.contentRef,s);return T.useEffect(()=>{const i=s.current;if(i)return I1(i)},[]),u.jsx(v$,{...n,ref:r,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ie(n.onCloseAutoFocus,i=>{var o;i.preventDefault(),(o=t.triggerRef.current)==null||o.focus()}),onPointerDownOutside:ie(n.onPointerDownOutside,i=>{const o=i.detail.originalEvent,a=o.button===0&&o.ctrlKey===!0;(o.button===2||a)&&i.preventDefault()}),onFocusOutside:ie(n.onFocusOutside,i=>i.preventDefault())})}),Uce=T.forwardRef((n,e)=>{const t=Wr(rc,n.__scopeDialog),s=T.useRef(!1),r=T.useRef(!1);return u.jsx(v$,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{var o,a;(o=n.onCloseAutoFocus)==null||o.call(n,i),i.defaultPrevented||(s.current||(a=t.triggerRef.current)==null||a.focus(),i.preventDefault()),s.current=!1,r.current=!1},onInteractOutside:i=>{var l,c;(l=n.onInteractOutside)==null||l.call(n,i),i.defaultPrevented||(s.current=!0,i.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const o=i.target;((c=t.triggerRef.current)==null?void 0:c.contains(o))&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&r.current&&i.preventDefault()}})}),v$=T.forwardRef((n,e)=>{const{__scopeDialog:t,trapFocus:s,onOpenAutoFocus:r,onCloseAutoFocus:i,...o}=n,a=Wr(rc,t),l=T.useRef(null),c=ze(e,l);return A1(),u.jsxs(u.Fragment,{children:[u.jsx(Yy,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:r,onUnmountAutoFocus:i,children:u.jsx(xd,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":S_(a.open),...o,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),u.jsxs(u.Fragment,{children:[u.jsx(Vce,{titleId:a.titleId}),u.jsx(Bce,{contentRef:l,descriptionId:a.descriptionId})]})]})}),b_="DialogTitle",x$=T.forwardRef((n,e)=>{const{__scopeDialog:t,...s}=n,r=Wr(b_,t);return u.jsx(Se.h2,{id:r.titleId,...s,ref:e})});x$.displayName=b_;var E$="DialogDescription",w$=T.forwardRef((n,e)=>{const{__scopeDialog:t,...s}=n,r=Wr(E$,t);return u.jsx(Se.p,{id:r.descriptionId,...s,ref:e})});w$.displayName=E$;var T$="DialogClose",b$=T.forwardRef((n,e)=>{const{__scopeDialog:t,...s}=n,r=Wr(T$,t);return u.jsx(Se.button,{type:"button",...s,ref:e,onClick:ie(n.onClick,()=>r.onOpenChange(!1))})});b$.displayName=T$;function S_(n){return n?"open":"closed"}var S$="DialogTitleWarning",[Hpe,_$]=nG(S$,{contentName:rc,titleName:b_,docsSlug:"dialog"}),Vce=({titleId:n})=>{const e=_$(S$),t=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return T.useEffect(()=>{n&&(document.getElementById(n)||console.error(t))},[t,n]),null},$ce="DialogDescriptionWarning",Bce=({contentRef:n,descriptionId:e})=>{const s=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${_$($ce).contentName}}.`;return T.useEffect(()=>{var i;const r=(i=n.current)==null?void 0:i.getAttribute("aria-describedby");e&&r&&(document.getElementById(e)||console.warn(s))},[s,n,e]),null},Gce=d$,Kce=f$,Hce=p$,A$=g$,I$=y$,R$=x$,C$=w$,Wce=b$;const El=Gce,Tg=Kce,zce=Hce,P$=T.forwardRef(({className:n,...e},t)=>u.jsx(A$,{ref:t,className:Ae("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...e}));P$.displayName=A$.displayName;const ta=T.forwardRef(({className:n,children:e,...t},s)=>u.jsxs(zce,{children:[u.jsx(P$,{}),u.jsxs(I$,{ref:s,className:Ae("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...t,children:[e,u.jsxs(Wce,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[u.jsx(lr,{className:"h-4 w-4"}),u.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ta.displayName=I$.displayName;const na=({className:n,...e})=>u.jsx("div",{className:Ae("flex flex-col space-y-1.5 text-center sm:text-left",n),...e});na.displayName="DialogHeader";const sa=T.forwardRef(({className:n,...e},t)=>u.jsx(R$,{ref:t,className:Ae("text-lg font-semibold leading-none tracking-tight",n),...e}));sa.displayName=R$.displayName;const kT=T.forwardRef(({className:n,...e},t)=>u.jsx(C$,{ref:t,className:Ae("text-sm text-muted-foreground",n),...e}));kT.displayName=C$.displayName;const qce=["/img1.jpg","/img2.png","/img3.jpg","/img6.jpg","/img7.jpg","/img8.jpg","/img9.png","/img10.png","/img11.jpg","/img12.jpg","/img13.png","/img14.jpg","/img15.jpg","/img16.jpg","/img17.jpg","/img18.jpg","/img19.jpg","/img20.jpg"],Yce=["/b1.jpg","/b2.jpg","/b3.jpg","/b4.jpg","/b5.jpg","/b6.png","/b7.png"];function Qce(){var an;const{currentUser:n,userProfile:e,logout:t,updateUserProfile:s}=Ms(),{watchlist:r,loading:i}=$1(),{continueWatching:o,loading:a}=Lce(),[,l]=Ls(),c=pd(),[d,h]=T.useState(!1),[f,m]=T.useState(!1),[p,y]=T.useState(!1),[v,x]=T.useState(!1),[E,w]=T.useState(!1),[b,C]=T.useState(!1),[D,_]=T.useState(!1),[S,I]=T.useState({username:"",bio:""}),[R,N]=T.useState(null),[L,M]=T.useState(!1),[G,V]=T.useState([]),[$,F]=T.useState([]),[j,U]=T.useState([]),[X,Y]=T.useState([]),[J,ae]=T.useState(!0),[he,ve]=T.useState([]),[ge,re]=T.useState([]),Ee=c==null?void 0:c.username,xe=!Ee||Ee===(e==null?void 0:e.username);T.useEffect(()=>{n||l("/auth/login")},[n,l]),T.useEffect(()=>{Ne()},[Ee,n,e]);const Ne=async()=>{ae(!0);try{let q;if(xe?q=e:Ee&&(q=await A3(Ee)),!q){ae(!1);return}if(n&&!xe&&q.uid&&await L3(n.uid,q.uid)){ae(!1);return}N(q);const Pe=await F1(q.uid),Xe=await U1(q.uid);if(V(Pe),F(Xe),n&&!xe&&q.uid){const $e=await _3(n.uid,q.uid);M($e)}if(xe&&e){I({username:e.username,bio:e.bio||""});const{getMutedUsers:$e,getBlockedUsers:Os}=await pi(async()=>{const{getMutedUsers:pn,getBlockedUsers:Ni}=await Promise.resolve().then(()=>wi);return{getMutedUsers:pn,getBlockedUsers:Ni}},void 0),rs=await $e(n.uid),Co=await Os(n.uid);ve(rs),re(Co)}}catch(q){console.error("Error loading profile:",q)}finally{ae(!1)}},Le=async()=>{if(!(R!=null&&R.uid))return;const q=await M3(R.uid);Y(q)},qe=async()=>{if(!(R!=null&&R.uid))return;const q=await D3(R.uid);U(q)},gt=async()=>{await t(),l("/")},Jt=async()=>{try{await s(S),h(!1)}catch(q){console.error("Error updating profile:",q)}},ys=async q=>{if(!(!n||!e))try{await s({avatarUrl:q}),m(!1)}catch(Pe){console.error("Error updating avatar:",Pe)}},De=async q=>{if(!(!n||!e))try{await s({bannerUrl:q}),y(!1)}catch(Pe){console.error("Error updating banner:",Pe)}},ct=async()=>{if(!(!n||!(R!=null&&R.uid)||xe))try{L?(await Df(n.uid,R.uid),M(!1),V(q=>q.filter(Pe=>Pe!==n.uid))):(await aT(n.uid,R.uid),M(!0),V(q=>[...q,n.uid]))}catch(q){console.error("Error following/unfollowing user:",q)}},Gt=async q=>{if(n)try{he.includes(q)?(await k3(n.uid,q),ve(Xe=>Xe.filter($e=>$e!==q))):(await P3(n.uid,q),ve(Xe=>[...Xe,q]))}catch(Pe){console.error("Error muting/unmuting user:",Pe)}},rt=async q=>{if(n)try{await N3(n.uid,q),re(Pe=>[...Pe,q]),await Le()}catch(Pe){console.error("Error blocking user:",Pe)}},at=async()=>{if(n)try{await I3(n.uid),alert("Watch history cleared successfully")}catch(q){console.error("Error clearing watch history:",q)}},Kn=async()=>{if(n)try{await R3(n.uid),alert("Watchlist cleared successfully")}catch(q){console.error("Error clearing watchlist:",q)}},vs=async()=>{if(n)try{await C3(n.uid),await t(),l("/")}catch(q){console.error("Error deleting account:",q)}},br=(q=0)=>{if(!q||q<0)return"0m";const Pe=Math.floor(q/3600),Xe=Math.floor(q%3600/60);return Pe>0?`${Pe}h ${Xe}m`:`${Xe}m`};if(J)return u.jsx("div",{className:"min-h-screen bg-background pb-20 flex items-center justify-center",children:u.jsx("div",{children:"Loading profile..."})});const on=xe?e:R;return on?u.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[u.jsxs("div",{className:"relative h-48 md:h-64 bg-cover bg-center",style:{backgroundImage:`url(${on.bannerUrl})`},children:[u.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/50 via-black/30 to-background"}),xe&&u.jsxs(El,{open:p,onOpenChange:y,children:[u.jsx(Tg,{asChild:!0,children:u.jsx(ne,{size:"icon",variant:"secondary",className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full h-10 w-10 md:h-12 md:w-12 bg-black/60 hover:bg-black/80 backdrop-blur-sm border border-white/20",children:u.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 md:h-6 md:w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})})}),u.jsxs(ta,{className:"max-w-2xl",children:[u.jsx(na,{children:u.jsx(sa,{children:"Choose Banner Image"})}),u.jsx("div",{className:"grid grid-cols-2 gap-4 max-h-96 overflow-y-auto",children:Yce.map(q=>u.jsx("button",{onClick:()=>De(q),className:`rounded-lg overflow-hidden border-2 transition-all hover:scale-105 ${on.bannerUrl===q?"border-primary ring-2 ring-primary":"border-transparent"}`,children:u.jsx("img",{src:q,alt:"Banner",className:"w-full aspect-[3/1] object-cover"})},q))})]})]})]}),u.jsxs("div",{className:"container mx-auto px-4 -mt-16 md:-mt-20 relative z-10",children:[u.jsxs("div",{className:"flex flex-col md:flex-row md:items-end gap-6",children:[u.jsxs("div",{className:"relative group w-28 h-28 md:w-32 md:h-32 flex-shrink-0",children:[u.jsxs(Ps,{className:"w-full h-full border-4 border-background ring-2 ring-primary/20",children:[u.jsx(ks,{src:on.avatarUrl}),u.jsx(Ns,{className:"text-3xl",children:(an=on.username[0])==null?void 0:an.toUpperCase()})]}),xe&&u.jsxs(El,{open:f,onOpenChange:m,children:[u.jsx(Tg,{asChild:!0,children:u.jsx(ne,{size:"icon",variant:"secondary",className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full h-10 w-10 md:h-12 md:w-12 bg-black/70 hover:bg-black/90 backdrop-blur-sm border border-white/30 shadow-lg md:opacity-0 md:group-hover:opacity-100 transition-opacity z-10",children:u.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 md:h-6 md:w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})})}),u.jsxs(ta,{className:"max-w-2xl",children:[u.jsx(na,{children:u.jsx(sa,{children:"Choose Profile Picture"})}),u.jsx("div",{className:"grid grid-cols-4 md:grid-cols-5 gap-4 max-h-96 overflow-y-auto",children:qce.map(q=>u.jsx("button",{onClick:()=>ys(q),className:`rounded-lg overflow-hidden border-2 transition-all hover:scale-105 ${on.avatarUrl===q?"border-primary ring-2 ring-primary":"border-transparent"}`,children:u.jsx("img",{src:q,alt:"Avatar",className:"w-full aspect-square object-cover"})},q))})]})]})]}),u.jsx("div",{className:"flex-1",children:u.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[u.jsxs("div",{children:[u.jsx("h1",{className:"text-3xl md:text-4xl font-bold",children:on.username}),xe&&u.jsx("p",{className:"text-muted-foreground mt-1",children:on.email}),on.bio&&u.jsx("p",{className:"text-sm mt-2 max-w-2xl",children:on.bio})]}),u.jsx("div",{className:"flex gap-2",children:xe?u.jsxs(u.Fragment,{children:[u.jsxs(ne,{variant:"outline",onClick:()=>h(!d),children:[u.jsx(gK,{className:"mr-2 h-4 w-4"}),d?"Cancel":"Edit Profile"]}),u.jsxs(El,{open:v,onOpenChange:x,children:[u.jsx(Tg,{asChild:!0,children:u.jsxs(ne,{variant:"outline",children:[u.jsx(EM,{className:"mr-2 h-4 w-4"}),"Settings"]})}),u.jsxs(ta,{children:[u.jsxs(na,{children:[u.jsx(sa,{children:"Account Settings"}),u.jsx(kT,{children:"Manage your account settings and preferences"})]}),u.jsxs("div",{className:"space-y-4 py-4",children:[u.jsxs("div",{className:"space-y-3 pb-4 border-b border-border",children:[u.jsx("h3",{className:"text-sm font-semibold",children:"Privacy Settings"}),u.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[u.jsx("span",{className:"text-sm text-muted-foreground",children:"Public Watchlist"}),u.jsxs("div",{className:"relative",children:[u.jsx("input",{type:"checkbox",checked:(e==null?void 0:e.isWatchlistPublic)??!0,onChange:async q=>{await s({isWatchlistPublic:q.target.checked})},className:"sr-only peer"}),u.jsx("div",{className:"w-11 h-6 bg-gray-700 rounded-full peer peer-checked:bg-gradient-to-r peer-checked:from-purple-600 peer-checked:to-purple-700 transition-all duration-300"}),u.jsx("div",{className:"absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition-transform duration-300 peer-checked:translate-x-5 shadow-lg"})]})]}),u.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[u.jsx("span",{className:"text-sm text-muted-foreground",children:"Public Continue Watching"}),u.jsxs("div",{className:"relative",children:[u.jsx("input",{type:"checkbox",checked:(e==null?void 0:e.isContinueWatchingPublic)??!0,onChange:async q=>{await s({isContinueWatchingPublic:q.target.checked})},className:"sr-only peer"}),u.jsx("div",{className:"w-11 h-6 bg-gray-700 rounded-full peer peer-checked:bg-gradient-to-r peer-checked:from-purple-600 peer-checked:to-purple-700 transition-all duration-300"}),u.jsx("div",{className:"absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition-transform duration-300 peer-checked:translate-x-5 shadow-lg"})]})]})]}),u.jsxs(ne,{variant:"outline",className:"w-full justify-start",onClick:gt,children:[u.jsx(cK,{className:"mr-2 h-4 w-4"}),"Logout"]}),u.jsxs(ne,{variant:"outline",className:"w-full justify-start",onClick:at,children:[u.jsx(oK,{className:"mr-2 h-4 w-4"}),"Clear Watch History"]}),u.jsxs(ne,{variant:"outline",className:"w-full justify-start",onClick:Kn,children:[u.jsx(Nr,{className:"mr-2 h-4 w-4"}),"Clear Watchlist"]}),u.jsxs(ne,{variant:"destructive",className:"w-full justify-start",onClick:()=>{x(!1),w(!0)},children:[u.jsx(bK,{className:"mr-2 h-4 w-4"}),"Delete Account"]})]})]})]}),u.jsx(El,{open:E,onOpenChange:w,children:u.jsxs(ta,{children:[u.jsxs(na,{children:[u.jsx(sa,{children:"Delete Account"}),u.jsx(kT,{children:"Are you sure you want to delete your account? This action cannot be undone."})]}),u.jsxs("div",{className:"flex gap-2 justify-end",children:[u.jsx(ne,{variant:"outline",onClick:()=>w(!1),children:"Cancel"}),u.jsx(ne,{variant:"destructive",onClick:vs,children:"Delete Account"})]})]})})]}):u.jsx(ne,{onClick:ct,variant:L?"outline":"default",children:L?u.jsxs(u.Fragment,{children:[u.jsx(AK,{className:"mr-2 h-4 w-4"}),"Unfollow"]}):u.jsxs(u.Fragment,{children:[u.jsx(IK,{className:"mr-2 h-4 w-4"}),"Follow"]})})})]})})]}),u.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mt-6",children:[u.jsx(Oe,{className:"cursor-pointer hover:bg-accent/50",onClick:()=>{qe(),_(!0)},children:u.jsxs(jt,{className:"p-4 text-center",children:[u.jsx(Aw,{className:"h-5 w-5 mx-auto mb-2 text-primary"}),u.jsx("div",{className:"text-2xl font-bold",children:G.length}),u.jsx("div",{className:"text-xs text-muted-foreground",children:"Followers"})]})}),u.jsx(Oe,{className:"cursor-pointer hover:bg-accent/50",onClick:()=>{Le(),C(!0)},children:u.jsxs(jt,{className:"p-4 text-center",children:[u.jsx(Aw,{className:"h-5 w-5 mx-auto mb-2 text-primary"}),u.jsx("div",{className:"text-2xl font-bold",children:$.length}),u.jsx("div",{className:"text-xs text-muted-foreground",children:"Following"})]})}),u.jsx(Oe,{children:u.jsxs(jt,{className:"p-4 text-center",children:[u.jsx(Nr,{className:"h-5 w-5 mx-auto mb-2 text-primary"}),u.jsx("div",{className:"text-2xl font-bold",children:r.length}),u.jsx("div",{className:"text-xs text-muted-foreground",children:"Watchlist"})]})}),u.jsx(Oe,{children:u.jsxs(jt,{className:"p-4 text-center",children:[u.jsx(Nr,{className:"h-5 w-5 mx-auto mb-2 text-primary"}),u.jsx("div",{className:"text-2xl font-bold",children:o.length}),u.jsx("div",{className:"text-xs text-muted-foreground",children:"Watching"})]})}),u.jsx(Oe,{children:u.jsxs(jt,{className:"p-4 text-center",children:[u.jsx(py,{className:"h-5 w-5 mx-auto mb-2 text-primary"}),u.jsx("div",{className:"text-2xl font-bold",children:br(on.totalWatchTime)}),u.jsx("div",{className:"text-xs text-muted-foreground",children:"Watch Time"})]})})]}),u.jsx(El,{open:b,onOpenChange:C,children:u.jsxs(ta,{className:"max-w-md",children:[u.jsx(na,{children:u.jsxs(sa,{children:["Following (",X.length,")"]})}),u.jsxs("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:[X.map(q=>{var Pe;return u.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-accent",children:[u.jsxs(Ps,{className:"h-10 w-10 cursor-pointer",onClick:()=>{C(!1),l(`/profile/${q.username}`)},children:[u.jsx(ks,{src:q.avatarUrl}),u.jsx(Ns,{children:(Pe=q.username[0])==null?void 0:Pe.toUpperCase()})]}),u.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>{C(!1),l(`/profile/${q.username}`)},children:[u.jsx("p",{className:"font-medium",children:q.username}),u.jsx("p",{className:"text-xs text-muted-foreground",children:q.email})]}),xe&&n&&u.jsxs("div",{className:"flex gap-1",children:[u.jsx(ne,{size:"sm",variant:"ghost",onClick:()=>Gt(q.uid),title:he.includes(q.uid)?"Unmute":"Mute",children:he.includes(q.uid)?u.jsx(TM,{className:"h-4 w-4"}):u.jsx(bM,{className:"h-4 w-4"})}),u.jsx(ne,{size:"sm",variant:"ghost",onClick:()=>rt(q.uid),title:"Block",children:u.jsx(qG,{className:"h-4 w-4"})})]})]},q.uid)}),X.length===0&&u.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Not following anyone yet"})]})]})}),u.jsx(El,{open:D,onOpenChange:_,children:u.jsxs(ta,{className:"max-w-md",children:[u.jsx(na,{children:u.jsxs(sa,{children:["Followers (",j.length,")"]})}),u.jsxs("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:[j.map(q=>{var Pe;return u.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-accent",children:[u.jsxs(Ps,{className:"h-10 w-10 cursor-pointer",onClick:()=>{_(!1),l(`/profile/${q.username}`)},children:[u.jsx(ks,{src:q.avatarUrl}),u.jsx(Ns,{children:(Pe=q.username[0])==null?void 0:Pe.toUpperCase()})]}),u.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>{_(!1),l(`/profile/${q.username}`)},children:[u.jsx("p",{className:"font-medium",children:q.username}),u.jsx("p",{className:"text-xs text-muted-foreground",children:q.email})]}),xe&&n&&u.jsx(ne,{size:"sm",variant:$.includes(q.uid)?"outline":"default",onClick:async()=>{$.includes(q.uid)?(await Df(n.uid,q.uid),F(Xe=>Xe.filter($e=>$e!==q.uid))):(await aT(n.uid,q.uid),F(Xe=>[...Xe,q.uid]))},children:$.includes(q.uid)?"Following":"Follow Back"})]},q.uid)}),j.length===0&&u.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No followers yet"})]})]})}),d&&xe&&u.jsxs(Oe,{className:"mt-6",children:[u.jsx(yc,{children:u.jsx(vc,{children:"Edit Profile"})}),u.jsxs(jt,{className:"space-y-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(so,{htmlFor:"username",children:"Username"}),u.jsx(bn,{id:"username",value:S.username,onChange:q=>I({...S,username:q.target.value})})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(so,{htmlFor:"bio",children:"Bio"}),u.jsx(Ii,{id:"bio",value:S.bio,onChange:q=>I({...S,bio:q.target.value}),placeholder:"Tell us about yourself...",rows:3})]}),u.jsx(ne,{onClick:Jt,children:"Save Changes"})]})]}),u.jsxs(aU,{defaultValue:"watchlist",className:"mt-6",children:[u.jsxs(K1,{className:"w-full md:w-auto",children:[u.jsxs(Rl,{value:"watchlist",children:["Watchlist (",r.length,")"]}),u.jsxs(Rl,{value:"continue",children:["Continue Watching (",o.length,")"]})]}),u.jsx(Cl,{value:"watchlist",className:"mt-6",children:!xe&&!((R==null?void 0:R.isWatchlistPublic)??!0)?u.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[u.jsx(Nr,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),u.jsx("p",{children:"This watchlist is private"})]}):i?u.jsx("div",{className:"text-center py-12",children:"Loading watchlist..."}):r.length===0?u.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[u.jsx(Nr,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),u.jsx("p",{children:"Watchlist is empty"}),xe&&u.jsx("p",{className:"text-sm mt-2",children:"Start adding anime!"})]}):u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:r.map(q=>u.jsxs("div",{className:"group cursor-pointer",onClick:()=>l(`/anime/${q.animeId}`),children:[u.jsxs("div",{className:"relative aspect-[2/3] rounded-lg overflow-hidden",children:[u.jsx("img",{src:q.posterUrl,alt:q.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}),u.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent opacity-0 group-hover:opacity-100 transition-opacity"})]}),u.jsx("h3",{className:"mt-2 text-sm font-medium line-clamp-2 group-hover:text-primary transition-colors",children:q.title})]},q.animeId))})}),u.jsx(Cl,{value:"continue",className:"mt-6",children:!xe&&!((R==null?void 0:R.isContinueWatchingPublic)??!0)?u.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[u.jsx(Nr,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),u.jsx("p",{children:"Continue watching is private"})]}):a?u.jsx("div",{className:"text-center py-12",children:"Loading..."}):o.length===0?u.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[u.jsx(Nr,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),u.jsx("p",{children:"No anime in progress"}),xe&&u.jsx("p",{className:"text-sm mt-2",children:"Start watching!"})]}):u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:o.map(q=>u.jsxs("div",{className:"group cursor-pointer",onClick:()=>l(`/watch/${q.animeId}?ep=${q.lastEpisode}`),children:[u.jsxs("div",{className:"relative aspect-[2/3] rounded-lg overflow-hidden",children:[q.posterUrl?u.jsx("img",{src:q.posterUrl,alt:q.title||q.animeId,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}):u.jsx("div",{className:"w-full h-full bg-accent flex items-center justify-center",children:u.jsx(Nr,{className:"h-12 w-12 opacity-50"})}),u.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),u.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black/90 to-transparent",children:[u.jsxs("p",{className:"text-xs text-white",children:["Episode ",q.lastEpisode]}),u.jsx("div",{className:"w-full bg-white/30 h-1 rounded-full mt-1",children:u.jsx("div",{className:"bg-primary h-full rounded-full",style:{width:"30%"}})})]})]}),u.jsx("h3",{className:"mt-2 text-sm font-medium line-clamp-2 group-hover:text-primary transition-colors",children:q.title||q.animeId})]},q.animeId))})})]})]})]}):u.jsx("div",{className:"min-h-screen bg-background pb-20 flex items-center justify-center",children:u.jsx("div",{children:"Profile not found or blocked"})})}var Xce="Separator",Mk="horizontal",Jce=["horizontal","vertical"],k$=T.forwardRef((n,e)=>{const{decorative:t,orientation:s=Mk,...r}=n,i=Zce(s)?s:Mk,a=t?{role:"none"}:{"aria-orientation":i==="vertical"?i:void 0,role:"separator"};return u.jsx(Se.div,{"data-orientation":i,...a,...r,ref:e})});k$.displayName=Xce;function Zce(n){return Jce.includes(n)}var N$=k$;const __=T.forwardRef(({className:n,orientation:e="horizontal",decorative:t=!0,...s},r)=>u.jsx(N$,{ref:r,decorative:t,orientation:e,className:Ae("shrink-0 bg-border",e==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",n),...s}));__.displayName=N$.displayName;var eue=[" ","Enter","ArrowUp","ArrowDown"],tue=[" ","Enter"],xm="Select",[cv,uv,nue]=vd(xm),[Dd,Wpe]=Ds(xm,[nue,bd]),dv=bd(),[sue,nl]=Dd(xm),[rue,iue]=Dd(xm),L$=n=>{const{__scopeSelect:e,children:t,open:s,defaultOpen:r,onOpenChange:i,value:o,defaultValue:a,onValueChange:l,dir:c,name:d,autoComplete:h,disabled:f,required:m,form:p}=n,y=dv(e),[v,x]=T.useState(null),[E,w]=T.useState(null),[b,C]=T.useState(!1),D=Nd(c),[_=!1,S]=Br({prop:s,defaultProp:r,onChange:i}),[I,R]=Br({prop:o,defaultProp:a,onChange:l}),N=T.useRef(null),L=v?p||!!v.closest("form"):!0,[M,G]=T.useState(new Set),V=Array.from(M).map($=>$.props.value).join(";");return u.jsx(nO,{...y,children:u.jsxs(sue,{required:m,scope:e,trigger:v,onTriggerChange:x,valueNode:E,onValueNodeChange:w,valueNodeHasChildren:b,onValueNodeHasChildrenChange:C,contentId:mr(),value:I,onValueChange:R,open:_,onOpenChange:S,dir:D,triggerPointerDownPosRef:N,disabled:f,children:[u.jsx(cv.Provider,{scope:e,children:u.jsx(rue,{scope:n.__scopeSelect,onNativeOptionAdd:T.useCallback($=>{G(F=>new Set(F).add($))},[]),onNativeOptionRemove:T.useCallback($=>{G(F=>{const j=new Set(F);return j.delete($),j})},[]),children:t})}),L?u.jsxs(r5,{"aria-hidden":!0,required:m,tabIndex:-1,name:d,autoComplete:h,value:I,onChange:$=>R($.target.value),disabled:f,form:p,children:[I===void 0?u.jsx("option",{value:""}):null,Array.from(M)]},V):null]})})};L$.displayName=xm;var D$="SelectTrigger",M$=T.forwardRef((n,e)=>{const{__scopeSelect:t,disabled:s=!1,...r}=n,i=dv(t),o=nl(D$,t),a=o.disabled||s,l=ze(e,o.onTriggerChange),c=uv(t),d=T.useRef("touch"),[h,f,m]=i5(y=>{const v=c().filter(w=>!w.disabled),x=v.find(w=>w.value===o.value),E=o5(v,y,x);E!==void 0&&o.onValueChange(E.value)}),p=y=>{a||(o.onOpenChange(!0),m()),y&&(o.triggerPointerDownPosRef.current={x:Math.round(y.pageX),y:Math.round(y.pageY)})};return u.jsx(wS,{asChild:!0,...i,children:u.jsx(Se.button,{type:"button",role:"combobox","aria-controls":o.contentId,"aria-expanded":o.open,"aria-required":o.required,"aria-autocomplete":"none",dir:o.dir,"data-state":o.open?"open":"closed",disabled:a,"data-disabled":a?"":void 0,"data-placeholder":s5(o.value)?"":void 0,...r,ref:l,onClick:ie(r.onClick,y=>{y.currentTarget.focus(),d.current!=="mouse"&&p(y)}),onPointerDown:ie(r.onPointerDown,y=>{d.current=y.pointerType;const v=y.target;v.hasPointerCapture(y.pointerId)&&v.releasePointerCapture(y.pointerId),y.button===0&&y.ctrlKey===!1&&y.pointerType==="mouse"&&(p(y),y.preventDefault())}),onKeyDown:ie(r.onKeyDown,y=>{const v=h.current!=="";!(y.ctrlKey||y.altKey||y.metaKey)&&y.key.length===1&&f(y.key),!(v&&y.key===" ")&&eue.includes(y.key)&&(p(),y.preventDefault())})})})});M$.displayName=D$;var O$="SelectValue",j$=T.forwardRef((n,e)=>{const{__scopeSelect:t,className:s,style:r,children:i,placeholder:o="",...a}=n,l=nl(O$,t),{onValueNodeHasChildrenChange:c}=l,d=i!==void 0,h=ze(e,l.onValueNodeChange);return hn(()=>{c(d)},[c,d]),u.jsx(Se.span,{...a,ref:h,style:{pointerEvents:"none"},children:s5(l.value)?u.jsx(u.Fragment,{children:o}):i})});j$.displayName=O$;var oue="SelectIcon",F$=T.forwardRef((n,e)=>{const{__scopeSelect:t,children:s,...r}=n;return u.jsx(Se.span,{"aria-hidden":!0,...r,ref:e,children:s||""})});F$.displayName=oue;var aue="SelectPortal",U$=n=>u.jsx(nm,{asChild:!0,...n});U$.displayName=aue;var ic="SelectContent",V$=T.forwardRef((n,e)=>{const t=nl(ic,n.__scopeSelect),[s,r]=T.useState();if(hn(()=>{r(new DocumentFragment)},[]),!t.open){const i=s;return i?lc.createPortal(u.jsx($$,{scope:n.__scopeSelect,children:u.jsx(cv.Slot,{scope:n.__scopeSelect,children:u.jsx("div",{children:n.children})})}),i):null}return u.jsx(B$,{...n,ref:e})});V$.displayName=ic;var Cr=10,[$$,sl]=Dd(ic),lue="SelectContentImpl",cue=Ql("SelectContent.RemoveScroll"),B$=T.forwardRef((n,e)=>{const{__scopeSelect:t,position:s="item-aligned",onCloseAutoFocus:r,onEscapeKeyDown:i,onPointerDownOutside:o,side:a,sideOffset:l,align:c,alignOffset:d,arrowPadding:h,collisionBoundary:f,collisionPadding:m,sticky:p,hideWhenDetached:y,avoidCollisions:v,...x}=n,E=nl(ic,t),[w,b]=T.useState(null),[C,D]=T.useState(null),_=ze(e,re=>b(re)),[S,I]=T.useState(null),[R,N]=T.useState(null),L=uv(t),[M,G]=T.useState(!1),V=T.useRef(!1);T.useEffect(()=>{if(w)return I1(w)},[w]),A1();const $=T.useCallback(re=>{const[Ee,...xe]=L().map(qe=>qe.ref.current),[Ne]=xe.slice(-1),Le=document.activeElement;for(const qe of re)if(qe===Le||(qe==null||qe.scrollIntoView({block:"nearest"}),qe===Ee&&C&&(C.scrollTop=0),qe===Ne&&C&&(C.scrollTop=C.scrollHeight),qe==null||qe.focus(),document.activeElement!==Le))return},[L,C]),F=T.useCallback(()=>$([S,w]),[$,S,w]);T.useEffect(()=>{M&&F()},[M,F]);const{onOpenChange:j,triggerPointerDownPosRef:U}=E;T.useEffect(()=>{if(w){let re={x:0,y:0};const Ee=Ne=>{var Le,qe;re={x:Math.abs(Math.round(Ne.pageX)-(((Le=U.current)==null?void 0:Le.x)??0)),y:Math.abs(Math.round(Ne.pageY)-(((qe=U.current)==null?void 0:qe.y)??0))}},xe=Ne=>{re.x<=10&&re.y<=10?Ne.preventDefault():w.contains(Ne.target)||j(!1),document.removeEventListener("pointermove",Ee),U.current=null};return U.current!==null&&(document.addEventListener("pointermove",Ee),document.addEventListener("pointerup",xe,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Ee),document.removeEventListener("pointerup",xe,{capture:!0})}}},[w,j,U]),T.useEffect(()=>{const re=()=>j(!1);return window.addEventListener("blur",re),window.addEventListener("resize",re),()=>{window.removeEventListener("blur",re),window.removeEventListener("resize",re)}},[j]);const[X,Y]=i5(re=>{const Ee=L().filter(Le=>!Le.disabled),xe=Ee.find(Le=>Le.ref.current===document.activeElement),Ne=o5(Ee,re,xe);Ne&&setTimeout(()=>Ne.ref.current.focus())}),J=T.useCallback((re,Ee,xe)=>{const Ne=!V.current&&!xe;(E.value!==void 0&&E.value===Ee||Ne)&&(I(re),Ne&&(V.current=!0))},[E.value]),ae=T.useCallback(()=>w==null?void 0:w.focus(),[w]),he=T.useCallback((re,Ee,xe)=>{const Ne=!V.current&&!xe;(E.value!==void 0&&E.value===Ee||Ne)&&N(re)},[E.value]),ve=s==="popper"?NT:G$,ge=ve===NT?{side:a,sideOffset:l,align:c,alignOffset:d,arrowPadding:h,collisionBoundary:f,collisionPadding:m,sticky:p,hideWhenDetached:y,avoidCollisions:v}:{};return u.jsx($$,{scope:t,content:w,viewport:C,onViewportChange:D,itemRefCallback:J,selectedItem:S,onItemLeave:ae,itemTextRefCallback:he,focusSelectedItem:F,selectedItemText:R,position:s,isPositioned:M,searchRef:X,children:u.jsx(Zy,{as:cue,allowPinchZoom:!0,children:u.jsx(Yy,{asChild:!0,trapped:E.open,onMountAutoFocus:re=>{re.preventDefault()},onUnmountAutoFocus:ie(r,re=>{var Ee;(Ee=E.trigger)==null||Ee.focus({preventScroll:!0}),re.preventDefault()}),children:u.jsx(xd,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:re=>re.preventDefault(),onDismiss:()=>E.onOpenChange(!1),children:u.jsx(ve,{role:"listbox",id:E.contentId,"data-state":E.open?"open":"closed",dir:E.dir,onContextMenu:re=>re.preventDefault(),...x,...ge,onPlaced:()=>G(!0),ref:_,style:{display:"flex",flexDirection:"column",outline:"none",...x.style},onKeyDown:ie(x.onKeyDown,re=>{const Ee=re.ctrlKey||re.altKey||re.metaKey;if(re.key==="Tab"&&re.preventDefault(),!Ee&&re.key.length===1&&Y(re.key),["ArrowUp","ArrowDown","Home","End"].includes(re.key)){let Ne=L().filter(Le=>!Le.disabled).map(Le=>Le.ref.current);if(["ArrowUp","End"].includes(re.key)&&(Ne=Ne.slice().reverse()),["ArrowUp","ArrowDown"].includes(re.key)){const Le=re.target,qe=Ne.indexOf(Le);Ne=Ne.slice(qe+1)}setTimeout(()=>$(Ne)),re.preventDefault()}})})})})})})});B$.displayName=lue;var uue="SelectItemAlignedPosition",G$=T.forwardRef((n,e)=>{const{__scopeSelect:t,onPlaced:s,...r}=n,i=nl(ic,t),o=sl(ic,t),[a,l]=T.useState(null),[c,d]=T.useState(null),h=ze(e,_=>d(_)),f=uv(t),m=T.useRef(!1),p=T.useRef(!0),{viewport:y,selectedItem:v,selectedItemText:x,focusSelectedItem:E}=o,w=T.useCallback(()=>{if(i.trigger&&i.valueNode&&a&&c&&y&&v&&x){const _=i.trigger.getBoundingClientRect(),S=c.getBoundingClientRect(),I=i.valueNode.getBoundingClientRect(),R=x.getBoundingClientRect();if(i.dir!=="rtl"){const Le=R.left-S.left,qe=I.left-Le,gt=_.left-qe,Jt=_.width+gt,ys=Math.max(Jt,S.width),De=window.innerWidth-Cr,ct=S0(qe,[Cr,Math.max(Cr,De-ys)]);a.style.minWidth=Jt+"px",a.style.left=ct+"px"}else{const Le=S.right-R.right,qe=window.innerWidth-I.right-Le,gt=window.innerWidth-_.right-qe,Jt=_.width+gt,ys=Math.max(Jt,S.width),De=window.innerWidth-Cr,ct=S0(qe,[Cr,Math.max(Cr,De-ys)]);a.style.minWidth=Jt+"px",a.style.right=ct+"px"}const N=f(),L=window.innerHeight-Cr*2,M=y.scrollHeight,G=window.getComputedStyle(c),V=parseInt(G.borderTopWidth,10),$=parseInt(G.paddingTop,10),F=parseInt(G.borderBottomWidth,10),j=parseInt(G.paddingBottom,10),U=V+$+M+j+F,X=Math.min(v.offsetHeight*5,U),Y=window.getComputedStyle(y),J=parseInt(Y.paddingTop,10),ae=parseInt(Y.paddingBottom,10),he=_.top+_.height/2-Cr,ve=L-he,ge=v.offsetHeight/2,re=v.offsetTop+ge,Ee=V+$+re,xe=U-Ee;if(Ee<=he){const Le=N.length>0&&v===N[N.length-1].ref.current;a.style.bottom="0px";const qe=c.clientHeight-y.offsetTop-y.offsetHeight,gt=Math.max(ve,ge+(Le?ae:0)+qe+F),Jt=Ee+gt;a.style.height=Jt+"px"}else{const Le=N.length>0&&v===N[0].ref.current;a.style.top="0px";const gt=Math.max(he,V+y.offsetTop+(Le?J:0)+ge)+xe;a.style.height=gt+"px",y.scrollTop=Ee-he+y.offsetTop}a.style.margin=`${Cr}px 0`,a.style.minHeight=X+"px",a.style.maxHeight=L+"px",s==null||s(),requestAnimationFrame(()=>m.current=!0)}},[f,i.trigger,i.valueNode,a,c,y,v,x,i.dir,s]);hn(()=>w(),[w]);const[b,C]=T.useState();hn(()=>{c&&C(window.getComputedStyle(c).zIndex)},[c]);const D=T.useCallback(_=>{_&&p.current===!0&&(w(),E==null||E(),p.current=!1)},[w,E]);return u.jsx(hue,{scope:t,contentWrapper:a,shouldExpandOnScrollRef:m,onScrollButtonChange:D,children:u.jsx("div",{ref:l,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:b},children:u.jsx(Se.div,{...r,ref:h,style:{boxSizing:"border-box",maxHeight:"100%",...r.style}})})})});G$.displayName=uue;var due="SelectPopperPosition",NT=T.forwardRef((n,e)=>{const{__scopeSelect:t,align:s="start",collisionPadding:r=Cr,...i}=n,o=dv(t);return u.jsx(TS,{...o,...i,ref:e,align:s,collisionPadding:r,style:{boxSizing:"border-box",...i.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});NT.displayName=due;var[hue,A_]=Dd(ic,{}),LT="SelectViewport",K$=T.forwardRef((n,e)=>{const{__scopeSelect:t,nonce:s,...r}=n,i=sl(LT,t),o=A_(LT,t),a=ze(e,i.onViewportChange),l=T.useRef(0);return u.jsxs(u.Fragment,{children:[u.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),u.jsx(cv.Slot,{scope:t,children:u.jsx(Se.div,{"data-radix-select-viewport":"",role:"presentation",...r,ref:a,style:{position:"relative",flex:1,overflow:"hidden auto",...r.style},onScroll:ie(r.onScroll,c=>{const d=c.currentTarget,{contentWrapper:h,shouldExpandOnScrollRef:f}=o;if(f!=null&&f.current&&h){const m=Math.abs(l.current-d.scrollTop);if(m>0){const p=window.innerHeight-Cr*2,y=parseFloat(h.style.minHeight),v=parseFloat(h.style.height),x=Math.max(y,v);if(x<p){const E=x+m,w=Math.min(p,E),b=E-w;h.style.height=w+"px",h.style.bottom==="0px"&&(d.scrollTop=b>0?b:0,h.style.justifyContent="flex-end")}}}l.current=d.scrollTop})})})]})});K$.displayName=LT;var H$="SelectGroup",[fue,mue]=Dd(H$),pue=T.forwardRef((n,e)=>{const{__scopeSelect:t,...s}=n,r=mr();return u.jsx(fue,{scope:t,id:r,children:u.jsx(Se.div,{role:"group","aria-labelledby":r,...s,ref:e})})});pue.displayName=H$;var W$="SelectLabel",z$=T.forwardRef((n,e)=>{const{__scopeSelect:t,...s}=n,r=mue(W$,t);return u.jsx(Se.div,{id:r.id,...s,ref:e})});z$.displayName=W$;var U0="SelectItem",[gue,q$]=Dd(U0),Y$=T.forwardRef((n,e)=>{const{__scopeSelect:t,value:s,disabled:r=!1,textValue:i,...o}=n,a=nl(U0,t),l=sl(U0,t),c=a.value===s,[d,h]=T.useState(i??""),[f,m]=T.useState(!1),p=ze(e,E=>{var w;return(w=l.itemRefCallback)==null?void 0:w.call(l,E,s,r)}),y=mr(),v=T.useRef("touch"),x=()=>{r||(a.onValueChange(s),a.onOpenChange(!1))};if(s==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return u.jsx(gue,{scope:t,value:s,disabled:r,textId:y,isSelected:c,onItemTextChange:T.useCallback(E=>{h(w=>w||((E==null?void 0:E.textContent)??"").trim())},[]),children:u.jsx(cv.ItemSlot,{scope:t,value:s,disabled:r,textValue:d,children:u.jsx(Se.div,{role:"option","aria-labelledby":y,"data-highlighted":f?"":void 0,"aria-selected":c&&f,"data-state":c?"checked":"unchecked","aria-disabled":r||void 0,"data-disabled":r?"":void 0,tabIndex:r?void 0:-1,...o,ref:p,onFocus:ie(o.onFocus,()=>m(!0)),onBlur:ie(o.onBlur,()=>m(!1)),onClick:ie(o.onClick,()=>{v.current!=="mouse"&&x()}),onPointerUp:ie(o.onPointerUp,()=>{v.current==="mouse"&&x()}),onPointerDown:ie(o.onPointerDown,E=>{v.current=E.pointerType}),onPointerMove:ie(o.onPointerMove,E=>{var w;v.current=E.pointerType,r?(w=l.onItemLeave)==null||w.call(l):v.current==="mouse"&&E.currentTarget.focus({preventScroll:!0})}),onPointerLeave:ie(o.onPointerLeave,E=>{var w;E.currentTarget===document.activeElement&&((w=l.onItemLeave)==null||w.call(l))}),onKeyDown:ie(o.onKeyDown,E=>{var b;((b=l.searchRef)==null?void 0:b.current)!==""&&E.key===" "||(tue.includes(E.key)&&x(),E.key===" "&&E.preventDefault())})})})})});Y$.displayName=U0;var Ph="SelectItemText",Q$=T.forwardRef((n,e)=>{const{__scopeSelect:t,className:s,style:r,...i}=n,o=nl(Ph,t),a=sl(Ph,t),l=q$(Ph,t),c=iue(Ph,t),[d,h]=T.useState(null),f=ze(e,x=>h(x),l.onItemTextChange,x=>{var E;return(E=a.itemTextRefCallback)==null?void 0:E.call(a,x,l.value,l.disabled)}),m=d==null?void 0:d.textContent,p=T.useMemo(()=>u.jsx("option",{value:l.value,disabled:l.disabled,children:m},l.value),[l.disabled,l.value,m]),{onNativeOptionAdd:y,onNativeOptionRemove:v}=c;return hn(()=>(y(p),()=>v(p)),[y,v,p]),u.jsxs(u.Fragment,{children:[u.jsx(Se.span,{id:l.textId,...i,ref:f}),l.isSelected&&o.valueNode&&!o.valueNodeHasChildren?lc.createPortal(i.children,o.valueNode):null]})});Q$.displayName=Ph;var X$="SelectItemIndicator",J$=T.forwardRef((n,e)=>{const{__scopeSelect:t,...s}=n;return q$(X$,t).isSelected?u.jsx(Se.span,{"aria-hidden":!0,...s,ref:e}):null});J$.displayName=X$;var DT="SelectScrollUpButton",Z$=T.forwardRef((n,e)=>{const t=sl(DT,n.__scopeSelect),s=A_(DT,n.__scopeSelect),[r,i]=T.useState(!1),o=ze(e,s.onScrollButtonChange);return hn(()=>{if(t.viewport&&t.isPositioned){let a=function(){const c=l.scrollTop>0;i(c)};const l=t.viewport;return a(),l.addEventListener("scroll",a),()=>l.removeEventListener("scroll",a)}},[t.viewport,t.isPositioned]),r?u.jsx(t5,{...n,ref:o,onAutoScroll:()=>{const{viewport:a,selectedItem:l}=t;a&&l&&(a.scrollTop=a.scrollTop-l.offsetHeight)}}):null});Z$.displayName=DT;var MT="SelectScrollDownButton",e5=T.forwardRef((n,e)=>{const t=sl(MT,n.__scopeSelect),s=A_(MT,n.__scopeSelect),[r,i]=T.useState(!1),o=ze(e,s.onScrollButtonChange);return hn(()=>{if(t.viewport&&t.isPositioned){let a=function(){const c=l.scrollHeight-l.clientHeight,d=Math.ceil(l.scrollTop)<c;i(d)};const l=t.viewport;return a(),l.addEventListener("scroll",a),()=>l.removeEventListener("scroll",a)}},[t.viewport,t.isPositioned]),r?u.jsx(t5,{...n,ref:o,onAutoScroll:()=>{const{viewport:a,selectedItem:l}=t;a&&l&&(a.scrollTop=a.scrollTop+l.offsetHeight)}}):null});e5.displayName=MT;var t5=T.forwardRef((n,e)=>{const{__scopeSelect:t,onAutoScroll:s,...r}=n,i=sl("SelectScrollButton",t),o=T.useRef(null),a=uv(t),l=T.useCallback(()=>{o.current!==null&&(window.clearInterval(o.current),o.current=null)},[]);return T.useEffect(()=>()=>l(),[l]),hn(()=>{var d;const c=a().find(h=>h.ref.current===document.activeElement);(d=c==null?void 0:c.ref.current)==null||d.scrollIntoView({block:"nearest"})},[a]),u.jsx(Se.div,{"aria-hidden":!0,...r,ref:e,style:{flexShrink:0,...r.style},onPointerDown:ie(r.onPointerDown,()=>{o.current===null&&(o.current=window.setInterval(s,50))}),onPointerMove:ie(r.onPointerMove,()=>{var c;(c=i.onItemLeave)==null||c.call(i),o.current===null&&(o.current=window.setInterval(s,50))}),onPointerLeave:ie(r.onPointerLeave,()=>{l()})})}),yue="SelectSeparator",n5=T.forwardRef((n,e)=>{const{__scopeSelect:t,...s}=n;return u.jsx(Se.div,{"aria-hidden":!0,...s,ref:e})});n5.displayName=yue;var OT="SelectArrow",vue=T.forwardRef((n,e)=>{const{__scopeSelect:t,...s}=n,r=dv(t),i=nl(OT,t),o=sl(OT,t);return i.open&&o.position==="popper"?u.jsx(bS,{...r,...s,ref:e}):null});vue.displayName=OT;function s5(n){return n===""||n===void 0}var r5=T.forwardRef((n,e)=>{const{value:t,...s}=n,r=T.useRef(null),i=ze(e,r),o=lU(t);return T.useEffect(()=>{const a=r.current,l=window.HTMLSelectElement.prototype,d=Object.getOwnPropertyDescriptor(l,"value").set;if(o!==t&&d){const h=new Event("change",{bubbles:!0});d.call(a,t),a.dispatchEvent(h)}},[o,t]),u.jsx(sm,{asChild:!0,children:u.jsx("select",{...s,ref:i,defaultValue:t})})});r5.displayName="BubbleSelect";function i5(n){const e=Bn(n),t=T.useRef(""),s=T.useRef(0),r=T.useCallback(o=>{const a=t.current+o;e(a),function l(c){t.current=c,window.clearTimeout(s.current),c!==""&&(s.current=window.setTimeout(()=>l(""),1e3))}(a)},[e]),i=T.useCallback(()=>{t.current="",window.clearTimeout(s.current)},[]);return T.useEffect(()=>()=>window.clearTimeout(s.current),[]),[t,r,i]}function o5(n,e,t){const r=e.length>1&&Array.from(e).every(c=>c===e[0])?e[0]:e,i=t?n.indexOf(t):-1;let o=xue(n,Math.max(i,0));r.length===1&&(o=o.filter(c=>c!==t));const l=o.find(c=>c.textValue.toLowerCase().startsWith(r.toLowerCase()));return l!==t?l:void 0}function xue(n,e){return n.map((t,s)=>n[(e+s)%n.length])}var Eue=L$,a5=M$,wue=j$,Tue=F$,bue=U$,l5=V$,Sue=K$,c5=z$,u5=Y$,_ue=Q$,Aue=J$,d5=Z$,h5=e5,f5=n5;const Iue=Eue,Rue=wue,m5=T.forwardRef(({className:n,children:e,...t},s)=>u.jsxs(a5,{ref:s,className:Ae("flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",n),...t,children:[e,u.jsx(Tue,{asChild:!0,children:u.jsx(lS,{className:"h-4 w-4 opacity-50"})})]}));m5.displayName=a5.displayName;const p5=T.forwardRef(({className:n,...e},t)=>u.jsx(d5,{ref:t,className:Ae("flex cursor-default items-center justify-center py-1",n),...e,children:u.jsx(ZG,{className:"h-4 w-4"})}));p5.displayName=d5.displayName;const g5=T.forwardRef(({className:n,...e},t)=>u.jsx(h5,{ref:t,className:Ae("flex cursor-default items-center justify-center py-1",n),...e,children:u.jsx(lS,{className:"h-4 w-4"})}));g5.displayName=h5.displayName;const y5=T.forwardRef(({className:n,children:e,position:t="popper",...s},r)=>u.jsx(bue,{children:u.jsxs(l5,{ref:r,className:Ae("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",n),position:t,...s,children:[u.jsx(p5,{}),u.jsx(Sue,{className:Ae("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:e}),u.jsx(g5,{})]})}));y5.displayName=l5.displayName;const Cue=T.forwardRef(({className:n,...e},t)=>u.jsx(c5,{ref:t,className:Ae("py-1.5 pl-8 pr-2 text-sm font-semibold",n),...e}));Cue.displayName=c5.displayName;const v5=T.forwardRef(({className:n,children:e,...t},s)=>u.jsxs(u5,{ref:s,className:Ae("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...t,children:[u.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:u.jsx(Aue,{children:u.jsx(aS,{className:"h-4 w-4"})})}),u.jsx(_ue,{children:e})]}));v5.displayName=u5.displayName;const Pue=T.forwardRef(({className:n,...e},t)=>u.jsx(f5,{ref:t,className:Ae("-mx-1 my-1 h-px bg-muted",n),...e}));Pue.displayName=f5.displayName;function kue(n){if(typeof Proxy>"u")return n;const e=new Map,t=(...s)=>n(...s);return new Proxy(t,{get:(s,r)=>r==="create"?n:(e.has(r)||e.set(r,n(r)),e.get(r))})}function hv(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const jT=n=>Array.isArray(n);function x5(n,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==n.length)return!1;for(let s=0;s<t;s++)if(e[s]!==n[s])return!1;return!0}function Bf(n){return typeof n=="string"||Array.isArray(n)}function Ok(n){const e=[{},{}];return n==null||n.values.forEach((t,s)=>{e[0][s]=t.get(),e[1][s]=t.getVelocity()}),e}function I_(n,e,t,s){if(typeof e=="function"){const[r,i]=Ok(s);e=e(t!==void 0?t:n.custom,r,i)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[r,i]=Ok(s);e=e(t!==void 0?t:n.custom,r,i)}return e}function fv(n,e,t){const s=n.getProps();return I_(s,e,t!==void 0?t:s.custom,n)}const R_=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],C_=["initial",...R_],Em=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],xc=new Set(Em),ro=n=>n*1e3,io=n=>n/1e3,Nue={type:"spring",stiffness:500,damping:25,restSpeed:10},Lue=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),Due={type:"keyframes",duration:.8},Mue={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Oue=(n,{keyframes:e})=>e.length>2?Due:xc.has(n)?n.startsWith("scale")?Lue(e[1]):Nue:Mue;function P_(n,e){return n?n[e]||n.default||n:void 0}const jue={skipAnimations:!1,useManualTiming:!1},Fue=n=>n!==null;function mv(n,{repeat:e,repeatType:t="loop"},s){const r=n.filter(Fue),i=e&&t!=="loop"&&e%2===1?0:r.length-1;return!i||s===void 0?r[i]:s}const ts=n=>n;let FT=ts;function Uue(n){let e=new Set,t=new Set,s=!1,r=!1;const i=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function a(c){i.has(c)&&(l.schedule(c),n()),c(o)}const l={schedule:(c,d=!1,h=!1)=>{const m=h&&s?e:t;return d&&i.add(c),m.has(c)||m.add(c),c},cancel:c=>{t.delete(c),i.delete(c)},process:c=>{if(o=c,s){r=!0;return}s=!0,[e,t]=[t,e],t.clear(),e.forEach(a),s=!1,r&&(r=!1,l.process(c))}};return l}const Mp=["read","resolveKeyframes","update","preRender","render","postRender"],Vue=40;function E5(n,e){let t=!1,s=!0;const r={delta:0,timestamp:0,isProcessing:!1},i=()=>t=!0,o=Mp.reduce((x,E)=>(x[E]=Uue(i),x),{}),{read:a,resolveKeyframes:l,update:c,preRender:d,render:h,postRender:f}=o,m=()=>{const x=performance.now();t=!1,r.delta=s?1e3/60:Math.max(Math.min(x-r.timestamp,Vue),1),r.timestamp=x,r.isProcessing=!0,a.process(r),l.process(r),c.process(r),d.process(r),h.process(r),f.process(r),r.isProcessing=!1,t&&e&&(s=!1,n(m))},p=()=>{t=!0,s=!0,r.isProcessing||n(m)};return{schedule:Mp.reduce((x,E)=>{const w=o[E];return x[E]=(b,C=!1,D=!1)=>(t||p(),w.schedule(b,C,D)),x},{}),cancel:x=>{for(let E=0;E<Mp.length;E++)o[Mp[E]].cancel(x)},state:r,steps:o}}const{schedule:xt,cancel:Ya,state:Nn,steps:tE}=E5(typeof requestAnimationFrame<"u"?requestAnimationFrame:ts,!0),w5=(n,e,t)=>(((1-3*t+3*e)*n+(3*t-6*e))*n+3*e)*n,$ue=1e-7,Bue=12;function Gue(n,e,t,s,r){let i,o,a=0;do o=e+(t-e)/2,i=w5(o,s,r)-n,i>0?t=o:e=o;while(Math.abs(i)>$ue&&++a<Bue);return o}function wm(n,e,t,s){if(n===e&&t===s)return ts;const r=i=>Gue(i,0,1,n,t);return i=>i===0||i===1?i:w5(r(i),e,s)}const T5=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,b5=n=>e=>1-n(1-e),S5=wm(.33,1.53,.69,.99),k_=b5(S5),_5=T5(k_),A5=n=>(n*=2)<1?.5*k_(n):.5*(2-Math.pow(2,-10*(n-1))),N_=n=>1-Math.sin(Math.acos(n)),I5=b5(N_),R5=T5(N_),C5=n=>/^0[^.\s]+$/u.test(n);function Kue(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||C5(n):!0}const P5=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),k5=n=>e=>typeof e=="string"&&e.startsWith(n),N5=k5("--"),Hue=k5("var(--"),L_=n=>Hue(n)?Wue.test(n.split("/*")[0].trim()):!1,Wue=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,zue=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function que(n){const e=zue.exec(n);if(!e)return[,];const[,t,s,r]=e;return[`--${t??s}`,r]}function L5(n,e,t=1){const[s,r]=que(n);if(!s)return;const i=window.getComputedStyle(e).getPropertyValue(s);if(i){const o=i.trim();return P5(o)?parseFloat(o):o}return L_(r)?L5(r,e,t+1):r}const wo=(n,e,t)=>t>e?e:t<n?n:t,Md={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},Gf={...Md,transform:n=>wo(0,1,n)},Op={...Md,default:1},Tm=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),Qo=Tm("deg"),Ti=Tm("%"),Ie=Tm("px"),Yue=Tm("vh"),Que=Tm("vw"),jk={...Ti,parse:n=>Ti.parse(n)/100,transform:n=>Ti.transform(n*100)},Xue=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),Fk=n=>n===Md||n===Ie,Uk=(n,e)=>parseFloat(n.split(", ")[e]),Vk=(n,e)=>(t,{transform:s})=>{if(s==="none"||!s)return 0;const r=s.match(/^matrix3d\((.+)\)$/u);if(r)return Uk(r[1],e);{const i=s.match(/^matrix\((.+)\)$/u);return i?Uk(i[1],n):0}},Jue=new Set(["x","y","z"]),Zue=Em.filter(n=>!Jue.has(n));function ede(n){const e=[];return Zue.forEach(t=>{const s=n.getValue(t);s!==void 0&&(e.push([t,s.get()]),s.set(t.startsWith("scale")?1:0))}),e}const ud={width:({x:n},{paddingLeft:e="0",paddingRight:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),height:({y:n},{paddingTop:e="0",paddingBottom:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:Vk(4,13),y:Vk(5,14)};ud.translateX=ud.x;ud.translateY=ud.y;const D5=n=>e=>e.test(n),tde={test:n=>n==="auto",parse:n=>n},M5=[Md,Ie,Ti,Qo,Que,Yue,tde],$k=n=>M5.find(D5(n)),Gl=new Set;let UT=!1,VT=!1;function O5(){if(VT){const n=Array.from(Gl).filter(s=>s.needsMeasurement),e=new Set(n.map(s=>s.element)),t=new Map;e.forEach(s=>{const r=ede(s);r.length&&(t.set(s,r),s.render())}),n.forEach(s=>s.measureInitialState()),e.forEach(s=>{s.render();const r=t.get(s);r&&r.forEach(([i,o])=>{var a;(a=s.getValue(i))===null||a===void 0||a.set(o)})}),n.forEach(s=>s.measureEndState()),n.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}VT=!1,UT=!1,Gl.forEach(n=>n.complete()),Gl.clear()}function j5(){Gl.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(VT=!0)})}function nde(){j5(),O5()}class D_{constructor(e,t,s,r,i,o=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=s,this.motionValue=r,this.element=i,this.isAsync=o}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Gl.add(this),UT||(UT=!0,xt.read(j5),xt.resolveKeyframes(O5))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:s,motionValue:r}=this;for(let i=0;i<e.length;i++)if(e[i]===null)if(i===0){const o=r==null?void 0:r.get(),a=e[e.length-1];if(o!==void 0)e[0]=o;else if(s&&t){const l=s.readValue(t,a);l!=null&&(e[0]=l)}e[0]===void 0&&(e[0]=a),r&&o===void 0&&r.set(e[0])}else e[i]=e[i-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Gl.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Gl.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const Jh=n=>Math.round(n*1e5)/1e5,M_=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function sde(n){return n==null}const rde=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,O_=(n,e)=>t=>!!(typeof t=="string"&&rde.test(t)&&t.startsWith(n)||e&&!sde(t)&&Object.prototype.hasOwnProperty.call(t,e)),F5=(n,e,t)=>s=>{if(typeof s!="string")return s;const[r,i,o,a]=s.match(M_);return{[n]:parseFloat(r),[e]:parseFloat(i),[t]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},ide=n=>wo(0,255,n),nE={...Md,transform:n=>Math.round(ide(n))},Pl={test:O_("rgb","red"),parse:F5("red","green","blue"),transform:({red:n,green:e,blue:t,alpha:s=1})=>"rgba("+nE.transform(n)+", "+nE.transform(e)+", "+nE.transform(t)+", "+Jh(Gf.transform(s))+")"};function ode(n){let e="",t="",s="",r="";return n.length>5?(e=n.substring(1,3),t=n.substring(3,5),s=n.substring(5,7),r=n.substring(7,9)):(e=n.substring(1,2),t=n.substring(2,3),s=n.substring(3,4),r=n.substring(4,5),e+=e,t+=t,s+=s,r+=r),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(s,16),alpha:r?parseInt(r,16)/255:1}}const $T={test:O_("#"),parse:ode,transform:Pl.transform},ru={test:O_("hsl","hue"),parse:F5("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:t,alpha:s=1})=>"hsla("+Math.round(n)+", "+Ti.transform(Jh(e))+", "+Ti.transform(Jh(t))+", "+Jh(Gf.transform(s))+")"},Yn={test:n=>Pl.test(n)||$T.test(n)||ru.test(n),parse:n=>Pl.test(n)?Pl.parse(n):ru.test(n)?ru.parse(n):$T.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?Pl.transform(n):ru.transform(n)},ade=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function lde(n){var e,t;return isNaN(n)&&typeof n=="string"&&(((e=n.match(M_))===null||e===void 0?void 0:e.length)||0)+(((t=n.match(ade))===null||t===void 0?void 0:t.length)||0)>0}const U5="number",V5="color",cde="var",ude="var(",Bk="${}",dde=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Kf(n){const e=n.toString(),t=[],s={color:[],number:[],var:[]},r=[];let i=0;const a=e.replace(dde,l=>(Yn.test(l)?(s.color.push(i),r.push(V5),t.push(Yn.parse(l))):l.startsWith(ude)?(s.var.push(i),r.push(cde),t.push(l)):(s.number.push(i),r.push(U5),t.push(parseFloat(l))),++i,Bk)).split(Bk);return{values:t,split:a,indexes:s,types:r}}function $5(n){return Kf(n).values}function B5(n){const{split:e,types:t}=Kf(n),s=e.length;return r=>{let i="";for(let o=0;o<s;o++)if(i+=e[o],r[o]!==void 0){const a=t[o];a===U5?i+=Jh(r[o]):a===V5?i+=Yn.transform(r[o]):i+=r[o]}return i}}const hde=n=>typeof n=="number"?0:n;function fde(n){const e=$5(n);return B5(n)(e.map(hde))}const Qa={test:lde,parse:$5,createTransformer:B5,getAnimatableNone:fde},mde=new Set(["brightness","contrast","saturate","opacity"]);function pde(n){const[e,t]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[s]=t.match(M_)||[];if(!s)return n;const r=t.replace(s,"");let i=mde.has(e)?1:0;return s!==t&&(i*=100),e+"("+i+r+")"}const gde=/\b([a-z-]*)\(.*?\)/gu,BT={...Qa,getAnimatableNone:n=>{const e=n.match(gde);return e?e.map(pde).join(" "):n}},yde={borderWidth:Ie,borderTopWidth:Ie,borderRightWidth:Ie,borderBottomWidth:Ie,borderLeftWidth:Ie,borderRadius:Ie,radius:Ie,borderTopLeftRadius:Ie,borderTopRightRadius:Ie,borderBottomRightRadius:Ie,borderBottomLeftRadius:Ie,width:Ie,maxWidth:Ie,height:Ie,maxHeight:Ie,top:Ie,right:Ie,bottom:Ie,left:Ie,padding:Ie,paddingTop:Ie,paddingRight:Ie,paddingBottom:Ie,paddingLeft:Ie,margin:Ie,marginTop:Ie,marginRight:Ie,marginBottom:Ie,marginLeft:Ie,backgroundPositionX:Ie,backgroundPositionY:Ie},vde={rotate:Qo,rotateX:Qo,rotateY:Qo,rotateZ:Qo,scale:Op,scaleX:Op,scaleY:Op,scaleZ:Op,skew:Qo,skewX:Qo,skewY:Qo,distance:Ie,translateX:Ie,translateY:Ie,translateZ:Ie,x:Ie,y:Ie,z:Ie,perspective:Ie,transformPerspective:Ie,opacity:Gf,originX:jk,originY:jk,originZ:Ie},Gk={...Md,transform:Math.round},j_={...yde,...vde,zIndex:Gk,size:Ie,fillOpacity:Gf,strokeOpacity:Gf,numOctaves:Gk},xde={...j_,color:Yn,backgroundColor:Yn,outlineColor:Yn,fill:Yn,stroke:Yn,borderColor:Yn,borderTopColor:Yn,borderRightColor:Yn,borderBottomColor:Yn,borderLeftColor:Yn,filter:BT,WebkitFilter:BT},F_=n=>xde[n];function G5(n,e){let t=F_(n);return t!==BT&&(t=Qa),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const Ede=new Set(["auto","none","0"]);function wde(n,e,t){let s=0,r;for(;s<n.length&&!r;){const i=n[s];typeof i=="string"&&!Ede.has(i)&&Kf(i).values.length&&(r=n[s]),s++}if(r&&t)for(const i of e)n[i]=G5(t,r)}class K5 extends D_{constructor(e,t,s,r,i){super(e,t,s,r,i,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:s}=this;if(!t||!t.current)return;super.readKeyframes();for(let l=0;l<e.length;l++){let c=e[l];if(typeof c=="string"&&(c=c.trim(),L_(c))){const d=L5(c,t.current);d!==void 0&&(e[l]=d),l===e.length-1&&(this.finalKeyframe=c)}}if(this.resolveNoneKeyframes(),!Xue.has(s)||e.length!==2)return;const[r,i]=e,o=$k(r),a=$k(i);if(o!==a)if(Fk(o)&&Fk(a))for(let l=0;l<e.length;l++){const c=e[l];typeof c=="string"&&(e[l]=parseFloat(c))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,s=[];for(let r=0;r<e.length;r++)Kue(e[r])&&s.push(r);s.length&&wde(e,s,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:s}=this;if(!e||!e.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=ud[s](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const r=t[t.length-1];r!==void 0&&e.getValue(s,r).jump(r,!1)}measureEndState(){var e;const{element:t,name:s,unresolvedKeyframes:r}=this;if(!t||!t.current)return;const i=t.getValue(s);i&&i.jump(this.measuredOrigin,!1);const o=r.length-1,a=r[o];r[o]=ud[s](t.measureViewportBox(),window.getComputedStyle(t.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([l,c])=>{t.getValue(l).set(c)}),this.resolveNoneKeyframes()}}function U_(n){return typeof n=="function"}let bg;function Tde(){bg=void 0}const bi={now:()=>(bg===void 0&&bi.set(Nn.isProcessing||jue.useManualTiming?Nn.timestamp:performance.now()),bg),set:n=>{bg=n,queueMicrotask(Tde)}},Kk=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(Qa.test(n)||n==="0")&&!n.startsWith("url("));function bde(n){const e=n[0];if(n.length===1)return!0;for(let t=0;t<n.length;t++)if(n[t]!==e)return!0}function Sde(n,e,t,s){const r=n[0];if(r===null)return!1;if(e==="display"||e==="visibility")return!0;const i=n[n.length-1],o=Kk(r,e),a=Kk(i,e);return!o||!a?!1:bde(n)||(t==="spring"||U_(t))&&s}const _de=40;class H5{constructor({autoplay:e=!0,delay:t=0,type:s="keyframes",repeat:r=0,repeatDelay:i=0,repeatType:o="loop",...a}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=bi.now(),this.options={autoplay:e,delay:t,type:s,repeat:r,repeatDelay:i,repeatType:o,...a},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>_de?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&nde(),this._resolved}onKeyframesResolved(e,t){this.resolvedAt=bi.now(),this.hasAttemptedResolve=!0;const{name:s,type:r,velocity:i,delay:o,onComplete:a,onUpdate:l,isGenerator:c}=this.options;if(!c&&!Sde(e,s,r,i))if(o)this.options.duration=0;else{l==null||l(mv(e,this.options,t)),a==null||a(),this.resolveFinishedPromise();return}const d=this.initPlayback(e,t);d!==!1&&(this._resolved={keyframes:e,finalKeyframe:t,...d},this.onPostResolved())}onPostResolved(){}then(e,t){return this.currentFinishedPromise.then(e,t)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const dd=(n,e,t)=>{const s=e-n;return s===0?1:(t-n)/s},W5=(n,e,t=10)=>{let s="";const r=Math.max(Math.round(e/t),2);for(let i=0;i<r;i++)s+=n(dd(0,r-1,i))+", ";return`linear(${s.substring(0,s.length-2)})`};function z5(n,e){return e?n*(1e3/e):0}const Ade=5;function q5(n,e,t){const s=Math.max(e-Ade,0);return z5(t-n(s),e-s)}const Yt={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},sE=.001;function Ide({duration:n=Yt.duration,bounce:e=Yt.bounce,velocity:t=Yt.velocity,mass:s=Yt.mass}){let r,i,o=1-e;o=wo(Yt.minDamping,Yt.maxDamping,o),n=wo(Yt.minDuration,Yt.maxDuration,io(n)),o<1?(r=c=>{const d=c*o,h=d*n,f=d-t,m=GT(c,o),p=Math.exp(-h);return sE-f/m*p},i=c=>{const h=c*o*n,f=h*t+t,m=Math.pow(o,2)*Math.pow(c,2)*n,p=Math.exp(-h),y=GT(Math.pow(c,2),o);return(-r(c)+sE>0?-1:1)*((f-m)*p)/y}):(r=c=>{const d=Math.exp(-c*n),h=(c-t)*n+1;return-sE+d*h},i=c=>{const d=Math.exp(-c*n),h=(t-c)*(n*n);return d*h});const a=5/n,l=Cde(r,i,a);if(n=ro(n),isNaN(l))return{stiffness:Yt.stiffness,damping:Yt.damping,duration:n};{const c=Math.pow(l,2)*s;return{stiffness:c,damping:o*2*Math.sqrt(s*c),duration:n}}}const Rde=12;function Cde(n,e,t){let s=t;for(let r=1;r<Rde;r++)s=s-n(s)/e(s);return s}function GT(n,e){return n*Math.sqrt(1-e*e)}const KT=2e4;function Y5(n){let e=0;const t=50;let s=n.next(e);for(;!s.done&&e<KT;)e+=t,s=n.next(e);return e>=KT?1/0:e}const Pde=["duration","bounce"],kde=["stiffness","damping","mass"];function Hk(n,e){return e.some(t=>n[t]!==void 0)}function Nde(n){let e={velocity:Yt.velocity,stiffness:Yt.stiffness,damping:Yt.damping,mass:Yt.mass,isResolvedFromDuration:!1,...n};if(!Hk(n,kde)&&Hk(n,Pde))if(n.visualDuration){const t=n.visualDuration,s=2*Math.PI/(t*1.2),r=s*s,i=2*wo(.05,1,1-n.bounce)*Math.sqrt(r);e={...e,mass:Yt.mass,stiffness:r,damping:i}}else{const t=Ide(n);e={...e,...t,mass:Yt.mass},e.isResolvedFromDuration=!0}return e}function Q5(n=Yt.visualDuration,e=Yt.bounce){const t=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:s,restDelta:r}=t;const i=t.keyframes[0],o=t.keyframes[t.keyframes.length-1],a={done:!1,value:i},{stiffness:l,damping:c,mass:d,duration:h,velocity:f,isResolvedFromDuration:m}=Nde({...t,velocity:-io(t.velocity||0)}),p=f||0,y=c/(2*Math.sqrt(l*d)),v=o-i,x=io(Math.sqrt(l/d)),E=Math.abs(v)<5;s||(s=E?Yt.restSpeed.granular:Yt.restSpeed.default),r||(r=E?Yt.restDelta.granular:Yt.restDelta.default);let w;if(y<1){const C=GT(x,y);w=D=>{const _=Math.exp(-y*x*D);return o-_*((p+y*x*v)/C*Math.sin(C*D)+v*Math.cos(C*D))}}else if(y===1)w=C=>o-Math.exp(-x*C)*(v+(p+x*v)*C);else{const C=x*Math.sqrt(y*y-1);w=D=>{const _=Math.exp(-y*x*D),S=Math.min(C*D,300);return o-_*((p+y*x*v)*Math.sinh(S)+C*v*Math.cosh(S))/C}}const b={calculatedDuration:m&&h||null,next:C=>{const D=w(C);if(m)a.done=C>=h;else{let _=0;y<1&&(_=C===0?ro(p):q5(w,C,D));const S=Math.abs(_)<=s,I=Math.abs(o-D)<=r;a.done=S&&I}return a.value=a.done?o:D,a},toString:()=>{const C=Math.min(Y5(b),KT),D=W5(_=>b.next(C*_).value,C,30);return C+"ms "+D}};return b}function Wk({keyframes:n,velocity:e=0,power:t=.8,timeConstant:s=325,bounceDamping:r=10,bounceStiffness:i=500,modifyTarget:o,min:a,max:l,restDelta:c=.5,restSpeed:d}){const h=n[0],f={done:!1,value:h},m=S=>a!==void 0&&S<a||l!==void 0&&S>l,p=S=>a===void 0?l:l===void 0||Math.abs(a-S)<Math.abs(l-S)?a:l;let y=t*e;const v=h+y,x=o===void 0?v:o(v);x!==v&&(y=x-h);const E=S=>-y*Math.exp(-S/s),w=S=>x+E(S),b=S=>{const I=E(S),R=w(S);f.done=Math.abs(I)<=c,f.value=f.done?x:R};let C,D;const _=S=>{m(f.value)&&(C=S,D=Q5({keyframes:[f.value,p(f.value)],velocity:q5(w,S,f.value),damping:r,stiffness:i,restDelta:c,restSpeed:d}))};return _(0),{calculatedDuration:null,next:S=>{let I=!1;return!D&&C===void 0&&(I=!0,b(S),_(S)),C!==void 0&&S>=C?D.next(S-C):(!I&&b(S),f)}}}const Lde=wm(.42,0,1,1),Dde=wm(0,0,.58,1),X5=wm(.42,0,.58,1),Mde=n=>Array.isArray(n)&&typeof n[0]!="number",V_=n=>Array.isArray(n)&&typeof n[0]=="number",zk={linear:ts,easeIn:Lde,easeInOut:X5,easeOut:Dde,circIn:N_,circInOut:R5,circOut:I5,backIn:k_,backInOut:_5,backOut:S5,anticipate:A5},qk=n=>{if(V_(n)){FT(n.length===4);const[e,t,s,r]=n;return wm(e,t,s,r)}else if(typeof n=="string")return FT(zk[n]!==void 0),zk[n];return n},Ode=(n,e)=>t=>e(n(t)),La=(...n)=>n.reduce(Ode),Ut=(n,e,t)=>n+(e-n)*t;function rE(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function jde({hue:n,saturation:e,lightness:t,alpha:s}){n/=360,e/=100,t/=100;let r=0,i=0,o=0;if(!e)r=i=o=t;else{const a=t<.5?t*(1+e):t+e-t*e,l=2*t-a;r=rE(l,a,n+1/3),i=rE(l,a,n),o=rE(l,a,n-1/3)}return{red:Math.round(r*255),green:Math.round(i*255),blue:Math.round(o*255),alpha:s}}function V0(n,e){return t=>t>0?e:n}const iE=(n,e,t)=>{const s=n*n,r=t*(e*e-s)+s;return r<0?0:Math.sqrt(r)},Fde=[$T,Pl,ru],Ude=n=>Fde.find(e=>e.test(n));function Yk(n){const e=Ude(n);if(!e)return!1;let t=e.parse(n);return e===ru&&(t=jde(t)),t}const Qk=(n,e)=>{const t=Yk(n),s=Yk(e);if(!t||!s)return V0(n,e);const r={...t};return i=>(r.red=iE(t.red,s.red,i),r.green=iE(t.green,s.green,i),r.blue=iE(t.blue,s.blue,i),r.alpha=Ut(t.alpha,s.alpha,i),Pl.transform(r))},HT=new Set(["none","hidden"]);function Vde(n,e){return HT.has(n)?t=>t<=0?n:e:t=>t>=1?e:n}function $de(n,e){return t=>Ut(n,e,t)}function $_(n){return typeof n=="number"?$de:typeof n=="string"?L_(n)?V0:Yn.test(n)?Qk:Kde:Array.isArray(n)?J5:typeof n=="object"?Yn.test(n)?Qk:Bde:V0}function J5(n,e){const t=[...n],s=t.length,r=n.map((i,o)=>$_(i)(i,e[o]));return i=>{for(let o=0;o<s;o++)t[o]=r[o](i);return t}}function Bde(n,e){const t={...n,...e},s={};for(const r in t)n[r]!==void 0&&e[r]!==void 0&&(s[r]=$_(n[r])(n[r],e[r]));return r=>{for(const i in s)t[i]=s[i](r);return t}}function Gde(n,e){var t;const s=[],r={color:0,var:0,number:0};for(let i=0;i<e.values.length;i++){const o=e.types[i],a=n.indexes[o][r[o]],l=(t=n.values[a])!==null&&t!==void 0?t:0;s[i]=l,r[o]++}return s}const Kde=(n,e)=>{const t=Qa.createTransformer(e),s=Kf(n),r=Kf(e);return s.indexes.var.length===r.indexes.var.length&&s.indexes.color.length===r.indexes.color.length&&s.indexes.number.length>=r.indexes.number.length?HT.has(n)&&!r.values.length||HT.has(e)&&!s.values.length?Vde(n,e):La(J5(Gde(s,r),r.values),t):V0(n,e)};function Z5(n,e,t){return typeof n=="number"&&typeof e=="number"&&typeof t=="number"?Ut(n,e,t):$_(n)(n,e)}function Hde(n,e,t){const s=[],r=t||Z5,i=n.length-1;for(let o=0;o<i;o++){let a=r(n[o],n[o+1]);if(e){const l=Array.isArray(e)?e[o]||ts:e;a=La(l,a)}s.push(a)}return s}function Wde(n,e,{clamp:t=!0,ease:s,mixer:r}={}){const i=n.length;if(FT(i===e.length),i===1)return()=>e[0];if(i===2&&n[0]===n[1])return()=>e[1];n[0]>n[i-1]&&(n=[...n].reverse(),e=[...e].reverse());const o=Hde(e,s,r),a=o.length,l=c=>{let d=0;if(a>1)for(;d<n.length-2&&!(c<n[d+1]);d++);const h=dd(n[d],n[d+1],c);return o[d](h)};return t?c=>l(wo(n[0],n[i-1],c)):l}function zde(n,e){const t=n[n.length-1];for(let s=1;s<=e;s++){const r=dd(0,e,s);n.push(Ut(t,1,r))}}function qde(n){const e=[0];return zde(e,n.length-1),e}function Yde(n,e){return n.map(t=>t*e)}function Qde(n,e){return n.map(()=>e||X5).splice(0,n.length-1)}function $0({duration:n=300,keyframes:e,times:t,ease:s="easeInOut"}){const r=Mde(s)?s.map(qk):qk(s),i={done:!1,value:e[0]},o=Yde(t&&t.length===e.length?t:qde(e),n),a=Wde(o,e,{ease:Array.isArray(r)?r:Qde(e,r)});return{calculatedDuration:n,next:l=>(i.value=a(l),i.done=l>=n,i)}}const Xde=n=>{const e=({timestamp:t})=>n(t);return{start:()=>xt.update(e,!0),stop:()=>Ya(e),now:()=>Nn.isProcessing?Nn.timestamp:bi.now()}},Jde={decay:Wk,inertia:Wk,tween:$0,keyframes:$0,spring:Q5},Zde=n=>n/100;class B_ extends H5{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:l}=this.options;l&&l()};const{name:t,motionValue:s,element:r,keyframes:i}=this.options,o=(r==null?void 0:r.KeyframeResolver)||D_,a=(l,c)=>this.onKeyframesResolved(l,c);this.resolver=new o(i,a,t,s,r),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:t="keyframes",repeat:s=0,repeatDelay:r=0,repeatType:i,velocity:o=0}=this.options,a=U_(t)?t:Jde[t]||$0;let l,c;a!==$0&&typeof e[0]!="number"&&(l=La(Zde,Z5(e[0],e[1])),e=[0,100]);const d=a({...this.options,keyframes:e});i==="mirror"&&(c=a({...this.options,keyframes:[...e].reverse(),velocity:-o})),d.calculatedDuration===null&&(d.calculatedDuration=Y5(d));const{calculatedDuration:h}=d,f=h+r,m=f*(s+1)-r;return{generator:d,mirroredGenerator:c,mapPercentToKeyframes:l,calculatedDuration:h,resolvedDuration:f,totalDuration:m}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,t=!1){const{resolved:s}=this;if(!s){const{keyframes:S}=this.options;return{done:!0,value:S[S.length-1]}}const{finalKeyframe:r,generator:i,mirroredGenerator:o,mapPercentToKeyframes:a,keyframes:l,calculatedDuration:c,totalDuration:d,resolvedDuration:h}=s;if(this.startTime===null)return i.next(0);const{delay:f,repeat:m,repeatType:p,repeatDelay:y,onUpdate:v}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-d/this.speed,this.startTime)),t?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const x=this.currentTime-f*(this.speed>=0?1:-1),E=this.speed>=0?x<0:x>d;this.currentTime=Math.max(x,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=d);let w=this.currentTime,b=i;if(m){const S=Math.min(this.currentTime,d)/h;let I=Math.floor(S),R=S%1;!R&&S>=1&&(R=1),R===1&&I--,I=Math.min(I,m+1),!!(I%2)&&(p==="reverse"?(R=1-R,y&&(R-=y/h)):p==="mirror"&&(b=o)),w=wo(0,1,R)*h}const C=E?{done:!1,value:l[0]}:b.next(w);a&&(C.value=a(C.value));let{done:D}=C;!E&&c!==null&&(D=this.speed>=0?this.currentTime>=d:this.currentTime<=0);const _=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&D);return _&&r!==void 0&&(C.value=mv(l,this.options,r)),v&&v(C.value),_&&this.finish(),C}get duration(){const{resolved:e}=this;return e?io(e.calculatedDuration):0}get time(){return io(this.currentTime)}set time(e){e=ro(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=io(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=Xde,onPlay:t,startTime:s}=this.options;this.driver||(this.driver=e(i=>this.tick(i))),t&&t();const r=this.driver.now();this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=r):this.startTime=s??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const ehe=new Set(["opacity","clipPath","filter","transform"]);function G_(n){let e;return()=>(e===void 0&&(e=n()),e)}const the={linearEasing:void 0};function nhe(n,e){const t=G_(n);return()=>{var s;return(s=the[e])!==null&&s!==void 0?s:t()}}const B0=nhe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing");function eB(n){return!!(typeof n=="function"&&B0()||!n||typeof n=="string"&&(n in WT||B0())||V_(n)||Array.isArray(n)&&n.every(eB))}const kh=([n,e,t,s])=>`cubic-bezier(${n}, ${e}, ${t}, ${s})`,WT={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:kh([0,.65,.55,1]),circOut:kh([.55,0,1,.45]),backIn:kh([.31,.01,.66,-.59]),backOut:kh([.33,1.53,.69,.99])};function tB(n,e){if(n)return typeof n=="function"&&B0()?W5(n,e):V_(n)?kh(n):Array.isArray(n)?n.map(t=>tB(t,e)||WT.easeOut):WT[n]}function she(n,e,t,{delay:s=0,duration:r=300,repeat:i=0,repeatType:o="loop",ease:a="easeInOut",times:l}={}){const c={[e]:t};l&&(c.offset=l);const d=tB(a,r);return Array.isArray(d)&&(c.easing=d),n.animate(c,{delay:s,duration:r,easing:Array.isArray(d)?"linear":d,fill:"both",iterations:i+1,direction:o==="reverse"?"alternate":"normal"})}function Xk(n,e){n.timeline=e,n.onfinish=null}const rhe=G_(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),G0=10,ihe=2e4;function ohe(n){return U_(n.type)||n.type==="spring"||!eB(n.ease)}function ahe(n,e){const t=new B_({...e,keyframes:n,repeat:0,delay:0,isGenerator:!0});let s={done:!1,value:n[0]};const r=[];let i=0;for(;!s.done&&i<ihe;)s=t.sample(i),r.push(s.value),i+=G0;return{times:void 0,keyframes:r,duration:i-G0,ease:"linear"}}const nB={anticipate:A5,backInOut:_5,circInOut:R5};function lhe(n){return n in nB}class Jk extends H5{constructor(e){super(e);const{name:t,motionValue:s,element:r,keyframes:i}=this.options;this.resolver=new K5(i,(o,a)=>this.onKeyframesResolved(o,a),t,s,r),this.resolver.scheduleResolve()}initPlayback(e,t){var s;let{duration:r=300,times:i,ease:o,type:a,motionValue:l,name:c,startTime:d}=this.options;if(!(!((s=l.owner)===null||s===void 0)&&s.current))return!1;if(typeof o=="string"&&B0()&&lhe(o)&&(o=nB[o]),ohe(this.options)){const{onComplete:f,onUpdate:m,motionValue:p,element:y,...v}=this.options,x=ahe(e,v);e=x.keyframes,e.length===1&&(e[1]=e[0]),r=x.duration,i=x.times,o=x.ease,a="keyframes"}const h=she(l.owner.current,c,e,{...this.options,duration:r,times:i,ease:o});return h.startTime=d??this.calcStartTime(),this.pendingTimeline?(Xk(h,this.pendingTimeline),this.pendingTimeline=void 0):h.onfinish=()=>{const{onComplete:f}=this.options;l.set(mv(e,this.options,t)),f&&f(),this.cancel(),this.resolveFinishedPromise()},{animation:h,duration:r,times:i,type:a,ease:o,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:t}=e;return io(t)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:t}=e;return io(t.currentTime||0)}set time(e){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.currentTime=ro(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:t}=e;return t.playbackRate}set speed(e){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:t}=e;return t.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:t}=e;return t.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:t}=this;if(!t)return ts;const{animation:s}=t;Xk(s,e)}return ts}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:t}=e;t.playState==="finished"&&this.updateFinishedPromise(),t.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:t}=e;t.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:t,keyframes:s,duration:r,type:i,ease:o,times:a}=e;if(t.playState==="idle"||t.playState==="finished")return;if(this.time){const{motionValue:c,onUpdate:d,onComplete:h,element:f,...m}=this.options,p=new B_({...m,keyframes:s,duration:r,type:i,ease:o,times:a,isGenerator:!0}),y=ro(this.time);c.setWithVelocity(p.sample(y-G0).value,p.sample(y).value,G0)}const{onStop:l}=this.options;l&&l(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:t,name:s,repeatDelay:r,repeatType:i,damping:o,type:a}=e;return rhe()&&s&&ehe.has(s)&&t&&t.owner&&t.owner.current instanceof HTMLElement&&!t.owner.getProps().onUpdate&&!r&&i!=="mirror"&&o!==0&&a!=="inertia"}}const che=G_(()=>window.ScrollTimeline!==void 0);class uhe{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}then(e,t){return Promise.all(this.animations).then(e).catch(t)}getAll(e){return this.animations[0][e]}setAll(e,t){for(let s=0;s<this.animations.length;s++)this.animations[s][e]=t}attachTimeline(e,t){const s=this.animations.map(r=>che()&&r.attachTimeline?r.attachTimeline(e):t(r));return()=>{s.forEach((r,i)=>{r&&r(),this.animations[i].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let t=0;t<this.animations.length;t++)e=Math.max(e,this.animations[t].duration);return e}runAll(e){this.animations.forEach(t=>t[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}function dhe({when:n,delay:e,delayChildren:t,staggerChildren:s,staggerDirection:r,repeat:i,repeatType:o,repeatDelay:a,from:l,elapsed:c,...d}){return!!Object.keys(d).length}const K_=(n,e,t,s={},r,i)=>o=>{const a=P_(s,n)||{},l=a.delay||s.delay||0;let{elapsed:c=0}=s;c=c-ro(l);let d={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-c,onUpdate:f=>{e.set(f),a.onUpdate&&a.onUpdate(f)},onComplete:()=>{o(),a.onComplete&&a.onComplete()},name:n,motionValue:e,element:i?void 0:r};dhe(a)||(d={...d,...Oue(n,d)}),d.duration&&(d.duration=ro(d.duration)),d.repeatDelay&&(d.repeatDelay=ro(d.repeatDelay)),d.from!==void 0&&(d.keyframes[0]=d.from);let h=!1;if((d.type===!1||d.duration===0&&!d.repeatDelay)&&(d.duration=0,d.delay===0&&(h=!0)),h&&!i&&e.get()!==void 0){const f=mv(d.keyframes,a);if(f!==void 0)return xt.update(()=>{d.onUpdate(f),d.onComplete()}),new uhe([])}return!i&&Jk.supports(d)?new Jk(d):new B_(d)},hhe=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),fhe=n=>jT(n)?n[n.length-1]||0:n;function H_(n,e){n.indexOf(e)===-1&&n.push(e)}function W_(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}class z_{constructor(){this.subscriptions=[]}add(e){return H_(this.subscriptions,e),()=>W_(this.subscriptions,e)}notify(e,t,s){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,t,s);else for(let i=0;i<r;i++){const o=this.subscriptions[i];o&&o(e,t,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Zk=30,mhe=n=>!isNaN(parseFloat(n));class phe{constructor(e,t={}){this.version="11.13.1",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(s,r=!0)=>{const i=bi.now();this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),r&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=bi.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=mhe(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new z_);const s=this.events[e].add(t);return e==="change"?()=>{s(),xt.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e,t=!0){!t||!this.passiveEffect?this.updateAndNotify(e,t):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,t,s){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-s}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=bi.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>Zk)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,Zk);return z5(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Hf(n,e){return new phe(n,e)}function ghe(n,e,t){n.hasValue(e)?n.getValue(e).set(t):n.addValue(e,Hf(t))}function yhe(n,e){const t=fv(n,e);let{transitionEnd:s={},transition:r={},...i}=t||{};i={...i,...s};for(const o in i){const a=fhe(i[o]);ghe(n,o,a)}}const q_=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),vhe="framerAppearId",sB="data-"+q_(vhe);function rB(n){return n.props[sB]}const es=n=>!!(n&&n.getVelocity);function xhe(n){return!!(es(n)&&n.add)}function zT(n,e){const t=n.getValue("willChange");if(xhe(t))return t.add(e)}function Ehe({protectedKeys:n,needsAnimating:e},t){const s=n.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,s}function iB(n,e,{delay:t=0,transitionOverride:s,type:r}={}){var i;let{transition:o=n.getDefaultTransition(),transitionEnd:a,...l}=e;s&&(o=s);const c=[],d=r&&n.animationState&&n.animationState.getState()[r];for(const h in l){const f=n.getValue(h,(i=n.latestValues[h])!==null&&i!==void 0?i:null),m=l[h];if(m===void 0||d&&Ehe(d,h))continue;const p={delay:t,...P_(o||{},h)};let y=!1;if(window.MotionHandoffAnimation){const x=rB(n);if(x){const E=window.MotionHandoffAnimation(x,h,xt);E!==null&&(p.startTime=E,y=!0)}}zT(n,h),f.start(K_(h,f,m,n.shouldReduceMotion&&xc.has(h)?{type:!1}:p,n,y));const v=f.animation;v&&c.push(v)}return a&&Promise.all(c).then(()=>{xt.update(()=>{a&&yhe(n,a)})}),c}function qT(n,e,t={}){var s;const r=fv(n,e,t.type==="exit"?(s=n.presenceContext)===null||s===void 0?void 0:s.custom:void 0);let{transition:i=n.getDefaultTransition()||{}}=r||{};t.transitionOverride&&(i=t.transitionOverride);const o=r?()=>Promise.all(iB(n,r,t)):()=>Promise.resolve(),a=n.variantChildren&&n.variantChildren.size?(c=0)=>{const{delayChildren:d=0,staggerChildren:h,staggerDirection:f}=i;return whe(n,e,d+c,h,f,t)}:()=>Promise.resolve(),{when:l}=i;if(l){const[c,d]=l==="beforeChildren"?[o,a]:[a,o];return c().then(()=>d())}else return Promise.all([o(),a(t.delay)])}function whe(n,e,t=0,s=0,r=1,i){const o=[],a=(n.variantChildren.size-1)*s,l=r===1?(c=0)=>c*s:(c=0)=>a-c*s;return Array.from(n.variantChildren).sort(The).forEach((c,d)=>{c.notify("AnimationStart",e),o.push(qT(c,e,{...i,delay:t+l(d)}).then(()=>c.notify("AnimationComplete",e)))}),Promise.all(o)}function The(n,e){return n.sortNodePosition(e)}function bhe(n,e,t={}){n.notify("AnimationStart",e);let s;if(Array.isArray(e)){const r=e.map(i=>qT(n,i,t));s=Promise.all(r)}else if(typeof e=="string")s=qT(n,e,t);else{const r=typeof e=="function"?fv(n,e,t.custom):e;s=Promise.all(iB(n,r,t))}return s.then(()=>{n.notify("AnimationComplete",e)})}const She=C_.length;function oB(n){if(!n)return;if(!n.isControllingVariants){const t=n.parent?oB(n.parent)||{}:{};return n.props.initial!==void 0&&(t.initial=n.props.initial),t}const e={};for(let t=0;t<She;t++){const s=C_[t],r=n.props[s];(Bf(r)||r===!1)&&(e[s]=r)}return e}const _he=[...R_].reverse(),Ahe=R_.length;function Ihe(n){return e=>Promise.all(e.map(({animation:t,options:s})=>bhe(n,t,s)))}function Rhe(n){let e=Ihe(n),t=eN(),s=!0;const r=l=>(c,d)=>{var h;const f=fv(n,d,l==="exit"?(h=n.presenceContext)===null||h===void 0?void 0:h.custom:void 0);if(f){const{transition:m,transitionEnd:p,...y}=f;c={...c,...y,...p}}return c};function i(l){e=l(n)}function o(l){const{props:c}=n,d=oB(n.parent)||{},h=[],f=new Set;let m={},p=1/0;for(let v=0;v<Ahe;v++){const x=_he[v],E=t[x],w=c[x]!==void 0?c[x]:d[x],b=Bf(w),C=x===l?E.isActive:null;C===!1&&(p=v);let D=w===d[x]&&w!==c[x]&&b;if(D&&s&&n.manuallyAnimateOnMount&&(D=!1),E.protectedKeys={...m},!E.isActive&&C===null||!w&&!E.prevProp||hv(w)||typeof w=="boolean")continue;const _=Che(E.prevProp,w);let S=_||x===l&&E.isActive&&!D&&b||v>p&&b,I=!1;const R=Array.isArray(w)?w:[w];let N=R.reduce(r(x),{});C===!1&&(N={});const{prevResolvedValues:L={}}=E,M={...L,...N},G=F=>{S=!0,f.has(F)&&(I=!0,f.delete(F)),E.needsAnimating[F]=!0;const j=n.getValue(F);j&&(j.liveStyle=!1)};for(const F in M){const j=N[F],U=L[F];if(m.hasOwnProperty(F))continue;let X=!1;jT(j)&&jT(U)?X=!x5(j,U):X=j!==U,X?j!=null?G(F):f.add(F):j!==void 0&&f.has(F)?G(F):E.protectedKeys[F]=!0}E.prevProp=w,E.prevResolvedValues=N,E.isActive&&(m={...m,...N}),s&&n.blockInitialAnimation&&(S=!1),S&&(!(D&&_)||I)&&h.push(...R.map(F=>({animation:F,options:{type:x}})))}if(f.size){const v={};f.forEach(x=>{const E=n.getBaseTarget(x),w=n.getValue(x);w&&(w.liveStyle=!0),v[x]=E??null}),h.push({animation:v})}let y=!!h.length;return s&&(c.initial===!1||c.initial===c.animate)&&!n.manuallyAnimateOnMount&&(y=!1),s=!1,y?e(h):Promise.resolve()}function a(l,c){var d;if(t[l].isActive===c)return Promise.resolve();(d=n.variantChildren)===null||d===void 0||d.forEach(f=>{var m;return(m=f.animationState)===null||m===void 0?void 0:m.setActive(l,c)}),t[l].isActive=c;const h=o(l);for(const f in t)t[f].protectedKeys={};return h}return{animateChanges:o,setActive:a,setAnimateFunction:i,getState:()=>t,reset:()=>{t=eN(),s=!0}}}function Che(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!x5(e,n):!1}function pl(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function eN(){return{animate:pl(!0),whileInView:pl(),whileHover:pl(),whileTap:pl(),whileDrag:pl(),whileFocus:pl(),exit:pl()}}class rl{constructor(e){this.isMounted=!1,this.node=e}update(){}}class Phe extends rl{constructor(e){super(e),e.animationState||(e.animationState=Rhe(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();hv(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let khe=0;class Nhe extends rl{constructor(){super(...arguments),this.id=khe++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const r=this.node.animationState.setActive("exit",!e);t&&!e&&r.then(()=>t(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const Lhe={animation:{Feature:Phe},exit:{Feature:Nhe}};function Dhe(n,e,t){var s;if(n instanceof Element)return[n];if(typeof n=="string"){let r=document;const i=(s=void 0)!==null&&s!==void 0?s:r.querySelectorAll(n);return i?Array.from(i):[]}return Array.from(n)}const Pr={x:!1,y:!1};function aB(){return Pr.x||Pr.y}function tN(n){return e=>{e.pointerType==="touch"||aB()||n(e)}}function Mhe(n,e,t={}){const s=new AbortController,r={passive:!0,...t,signal:s.signal},i=tN(o=>{const{target:a}=o,l=e(o);if(!l||!a)return;const c=tN(d=>{l(d),a.removeEventListener("pointerleave",c)});a.addEventListener("pointerleave",c,r)});return Dhe(n).forEach(o=>{o.addEventListener("pointerenter",i,r)}),()=>s.abort()}function Ohe(n){return n==="x"||n==="y"?Pr[n]?null:(Pr[n]=!0,()=>{Pr[n]=!1}):Pr.x||Pr.y?null:(Pr.x=Pr.y=!0,()=>{Pr.x=Pr.y=!1})}const lB=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1;function bm(n){return{point:{x:n.pageX,y:n.pageY}}}const jhe=n=>e=>lB(e)&&n(e,bm(e));function Ji(n,e,t,s={passive:!0}){return n.addEventListener(e,t,s),()=>n.removeEventListener(e,t)}function Da(n,e,t,s){return Ji(n,e,jhe(t),s)}const nN=(n,e)=>Math.abs(n-e);function Fhe(n,e){const t=nN(n.x,e.x),s=nN(n.y,e.y);return Math.sqrt(t**2+s**2)}class cB{constructor(e,t,{transformPagePoint:s,contextWindow:r,dragSnapToOrigin:i=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=aE(this.lastMoveEventInfo,this.history),f=this.startEvent!==null,m=Fhe(h.offset,{x:0,y:0})>=3;if(!f&&!m)return;const{point:p}=h,{timestamp:y}=Nn;this.history.push({...p,timestamp:y});const{onStart:v,onMove:x}=this.handlers;f||(v&&v(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),x&&x(this.lastMoveEvent,h)},this.handlePointerMove=(h,f)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=oE(f,this.transformPagePoint),xt.update(this.updatePoint,!0)},this.handlePointerUp=(h,f)=>{this.end();const{onEnd:m,onSessionEnd:p,resumeAnimation:y}=this.handlers;if(this.dragSnapToOrigin&&y&&y(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const v=aE(h.type==="pointercancel"?this.lastMoveEventInfo:oE(f,this.transformPagePoint),this.history);this.startEvent&&m&&m(h,v),p&&p(h,v)},!lB(e))return;this.dragSnapToOrigin=i,this.handlers=t,this.transformPagePoint=s,this.contextWindow=r||window;const o=bm(e),a=oE(o,this.transformPagePoint),{point:l}=a,{timestamp:c}=Nn;this.history=[{...l,timestamp:c}];const{onSessionStart:d}=t;d&&d(e,aE(a,this.history)),this.removeListeners=La(Da(this.contextWindow,"pointermove",this.handlePointerMove),Da(this.contextWindow,"pointerup",this.handlePointerUp),Da(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Ya(this.updatePoint)}}function oE(n,e){return e?{point:e(n.point)}:n}function sN(n,e){return{x:n.x-e.x,y:n.y-e.y}}function aE({point:n},e){return{point:n,delta:sN(n,uB(e)),offset:sN(n,Uhe(e)),velocity:Vhe(e,.1)}}function Uhe(n){return n[0]}function uB(n){return n[n.length-1]}function Vhe(n,e){if(n.length<2)return{x:0,y:0};let t=n.length-1,s=null;const r=uB(n);for(;t>=0&&(s=n[t],!(r.timestamp-s.timestamp>ro(e)));)t--;if(!s)return{x:0,y:0};const i=io(r.timestamp-s.timestamp);if(i===0)return{x:0,y:0};const o={x:(r.x-s.x)/i,y:(r.y-s.y)/i};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function iu(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}const dB=1e-4,$he=1-dB,Bhe=1+dB,hB=.01,Ghe=0-hB,Khe=0+hB;function tr(n){return n.max-n.min}function Hhe(n,e,t){return Math.abs(n-e)<=t}function rN(n,e,t,s=.5){n.origin=s,n.originPoint=Ut(e.min,e.max,n.origin),n.scale=tr(t)/tr(e),n.translate=Ut(t.min,t.max,n.origin)-n.originPoint,(n.scale>=$he&&n.scale<=Bhe||isNaN(n.scale))&&(n.scale=1),(n.translate>=Ghe&&n.translate<=Khe||isNaN(n.translate))&&(n.translate=0)}function Zh(n,e,t,s){rN(n.x,e.x,t.x,s?s.originX:void 0),rN(n.y,e.y,t.y,s?s.originY:void 0)}function iN(n,e,t){n.min=t.min+e.min,n.max=n.min+tr(e)}function Whe(n,e,t){iN(n.x,e.x,t.x),iN(n.y,e.y,t.y)}function oN(n,e,t){n.min=e.min-t.min,n.max=n.min+tr(e)}function ef(n,e,t){oN(n.x,e.x,t.x),oN(n.y,e.y,t.y)}function zhe(n,{min:e,max:t},s){return e!==void 0&&n<e?n=s?Ut(e,n,s.min):Math.max(n,e):t!==void 0&&n>t&&(n=s?Ut(t,n,s.max):Math.min(n,t)),n}function aN(n,e,t){return{min:e!==void 0?n.min+e:void 0,max:t!==void 0?n.max+t-(n.max-n.min):void 0}}function qhe(n,{top:e,left:t,bottom:s,right:r}){return{x:aN(n.x,t,r),y:aN(n.y,e,s)}}function lN(n,e){let t=e.min-n.min,s=e.max-n.max;return e.max-e.min<n.max-n.min&&([t,s]=[s,t]),{min:t,max:s}}function Yhe(n,e){return{x:lN(n.x,e.x),y:lN(n.y,e.y)}}function Qhe(n,e){let t=.5;const s=tr(n),r=tr(e);return r>s?t=dd(e.min,e.max-s,n.min):s>r&&(t=dd(n.min,n.max-r,e.min)),wo(0,1,t)}function Xhe(n,e){const t={};return e.min!==void 0&&(t.min=e.min-n.min),e.max!==void 0&&(t.max=e.max-n.min),t}const YT=.35;function Jhe(n=YT){return n===!1?n=0:n===!0&&(n=YT),{x:cN(n,"left","right"),y:cN(n,"top","bottom")}}function cN(n,e,t){return{min:uN(n,e),max:uN(n,t)}}function uN(n,e){return typeof n=="number"?n:n[e]||0}const dN=()=>({translate:0,scale:1,origin:0,originPoint:0}),ou=()=>({x:dN(),y:dN()}),hN=()=>({min:0,max:0}),en=()=>({x:hN(),y:hN()});function ir(n){return[n("x"),n("y")]}function fB({top:n,left:e,right:t,bottom:s}){return{x:{min:e,max:t},y:{min:n,max:s}}}function Zhe({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function efe(n,e){if(!e)return n;const t=e({x:n.left,y:n.top}),s=e({x:n.right,y:n.bottom});return{top:t.y,left:t.x,bottom:s.y,right:s.x}}function lE(n){return n===void 0||n===1}function QT({scale:n,scaleX:e,scaleY:t}){return!lE(n)||!lE(e)||!lE(t)}function wl(n){return QT(n)||mB(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function mB(n){return fN(n.x)||fN(n.y)}function fN(n){return n&&n!=="0%"}function K0(n,e,t){const s=n-t,r=e*s;return t+r}function mN(n,e,t,s,r){return r!==void 0&&(n=K0(n,r,s)),K0(n,t,s)+e}function XT(n,e=0,t=1,s,r){n.min=mN(n.min,e,t,s,r),n.max=mN(n.max,e,t,s,r)}function pB(n,{x:e,y:t}){XT(n.x,e.translate,e.scale,e.originPoint),XT(n.y,t.translate,t.scale,t.originPoint)}const pN=.999999999999,gN=1.0000000000001;function tfe(n,e,t,s=!1){const r=t.length;if(!r)return;e.x=e.y=1;let i,o;for(let a=0;a<r;a++){i=t[a],o=i.projectionDelta;const{visualElement:l}=i.options;l&&l.props.style&&l.props.style.display==="contents"||(s&&i.options.layoutScroll&&i.scroll&&i!==i.root&&lu(n,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,pB(n,o)),s&&wl(i.latestValues)&&lu(n,i.latestValues))}e.x<gN&&e.x>pN&&(e.x=1),e.y<gN&&e.y>pN&&(e.y=1)}function au(n,e){n.min=n.min+e,n.max=n.max+e}function yN(n,e,t,s,r=.5){const i=Ut(n.min,n.max,r);XT(n,e,t,i,s)}function lu(n,e){yN(n.x,e.x,e.scaleX,e.scale,e.originX),yN(n.y,e.y,e.scaleY,e.scale,e.originY)}function gB(n,e){return fB(efe(n.getBoundingClientRect(),e))}function nfe(n,e,t){const s=gB(n,t),{scroll:r}=e;return r&&(au(s.x,r.offset.x),au(s.y,r.offset.y)),s}const yB=({current:n})=>n?n.ownerDocument.defaultView:null,sfe=new WeakMap;class rfe{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=en(),this.visualElement=e}start(e,{snapToCursor:t=!1}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const r=d=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(bm(d).point)},i=(d,h)=>{const{drag:f,dragPropagation:m,onDragStart:p}=this.getProps();if(f&&!m&&(this.openDragLock&&this.openDragLock(),this.openDragLock=Ohe(f),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),ir(v=>{let x=this.getAxisMotionValue(v).get()||0;if(Ti.test(x)){const{projection:E}=this.visualElement;if(E&&E.layout){const w=E.layout.layoutBox[v];w&&(x=tr(w)*(parseFloat(x)/100))}}this.originPoint[v]=x}),p&&xt.postRender(()=>p(d,h)),zT(this.visualElement,"transform");const{animationState:y}=this.visualElement;y&&y.setActive("whileDrag",!0)},o=(d,h)=>{const{dragPropagation:f,dragDirectionLock:m,onDirectionLock:p,onDrag:y}=this.getProps();if(!f&&!this.openDragLock)return;const{offset:v}=h;if(m&&this.currentDirection===null){this.currentDirection=ife(v),this.currentDirection!==null&&p&&p(this.currentDirection);return}this.updateAxis("x",h.point,v),this.updateAxis("y",h.point,v),this.visualElement.render(),y&&y(d,h)},a=(d,h)=>this.stop(d,h),l=()=>ir(d=>{var h;return this.getAnimationState(d)==="paused"&&((h=this.getAxisMotionValue(d).animation)===null||h===void 0?void 0:h.play())}),{dragSnapToOrigin:c}=this.getProps();this.panSession=new cB(e,{onSessionStart:r,onStart:i,onMove:o,onSessionEnd:a,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:c,contextWindow:yB(this.visualElement)})}stop(e,t){const s=this.isDragging;if(this.cancel(),!s)return;const{velocity:r}=t;this.startAnimation(r);const{onDragEnd:i}=this.getProps();i&&xt.postRender(()=>i(e,t))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,s){const{drag:r}=this.getProps();if(!s||!jp(e,r,this.currentDirection))return;const i=this.getAxisMotionValue(e);let o=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(o=zhe(o,this.constraints[e],this.elastic[e])),i.set(o)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:s}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,i=this.constraints;t&&iu(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&r?this.constraints=qhe(r.layoutBox,t):this.constraints=!1,this.elastic=Jhe(s),i!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&ir(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=Xhe(r.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!iu(e))return!1;const s=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const i=nfe(s,r.root,this.visualElement.getTransformPagePoint());let o=Yhe(r.layout.layoutBox,i);if(t){const a=t(Zhe(o));this.hasMutatedConstraints=!!a,a&&(o=fB(a))}return o}startAnimation(e){const{drag:t,dragMomentum:s,dragElastic:r,dragTransition:i,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),l=this.constraints||{},c=ir(d=>{if(!jp(d,t,this.currentDirection))return;let h=l&&l[d]||{};o&&(h={min:0,max:0});const f=r?200:1e6,m=r?40:1e7,p={type:"inertia",velocity:s?e[d]:0,bounceStiffness:f,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...i,...h};return this.startAxisValueAnimation(d,p)});return Promise.all(c).then(a)}startAxisValueAnimation(e,t){const s=this.getAxisMotionValue(e);return zT(this.visualElement,e),s.start(K_(e,s,0,t,this.visualElement,!1))}stopAnimation(){ir(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){ir(e=>{var t;return(t=this.getAxisMotionValue(e).animation)===null||t===void 0?void 0:t.pause()})}getAnimationState(e){var t;return(t=this.getAxisMotionValue(e).animation)===null||t===void 0?void 0:t.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,s=this.visualElement.getProps(),r=s[t];return r||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){ir(t=>{const{drag:s}=this.getProps();if(!jp(t,s,this.currentDirection))return;const{projection:r}=this.visualElement,i=this.getAxisMotionValue(t);if(r&&r.layout){const{min:o,max:a}=r.layout.layoutBox[t];i.set(e[t]-Ut(o,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:s}=this.visualElement;if(!iu(t)||!s||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};ir(o=>{const a=this.getAxisMotionValue(o);if(a&&this.constraints!==!1){const l=a.get();r[o]=Qhe({min:l,max:l},this.constraints[o])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),ir(o=>{if(!jp(o,e,null))return;const a=this.getAxisMotionValue(o),{min:l,max:c}=this.constraints[o];a.set(Ut(l,c,r[o]))})}addListeners(){if(!this.visualElement.current)return;sfe.set(this.visualElement,this);const e=this.visualElement.current,t=Da(e,"pointerdown",l=>{const{drag:c,dragListener:d=!0}=this.getProps();c&&d&&this.start(l)}),s=()=>{const{dragConstraints:l}=this.getProps();iu(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,i=r.addEventListener("measure",s);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),xt.read(s);const o=Ji(window,"resize",()=>this.scalePositionWithinConstraints()),a=r.addEventListener("didUpdate",({delta:l,hasLayoutChanged:c})=>{this.isDragging&&c&&(ir(d=>{const h=this.getAxisMotionValue(d);h&&(this.originPoint[d]+=l[d].translate,h.set(h.get()+l[d].translate))}),this.visualElement.render())});return()=>{o(),t(),i(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:s=!1,dragPropagation:r=!1,dragConstraints:i=!1,dragElastic:o=YT,dragMomentum:a=!0}=e;return{...e,drag:t,dragDirectionLock:s,dragPropagation:r,dragConstraints:i,dragElastic:o,dragMomentum:a}}}function jp(n,e,t){return(e===!0||e===n)&&(t===null||t===n)}function ife(n,e=10){let t=null;return Math.abs(n.y)>e?t="y":Math.abs(n.x)>e&&(t="x"),t}class ofe extends rl{constructor(e){super(e),this.removeGroupControls=ts,this.removeListeners=ts,this.controls=new rfe(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||ts}unmount(){this.removeGroupControls(),this.removeListeners()}}const vN=n=>(e,t)=>{n&&xt.postRender(()=>n(e,t))};class afe extends rl{constructor(){super(...arguments),this.removePointerDownListener=ts}onPointerDown(e){this.session=new cB(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:yB(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:s,onPanEnd:r}=this.node.getProps();return{onSessionStart:vN(e),onStart:vN(t),onMove:s,onEnd:(i,o)=>{delete this.session,r&&xt.postRender(()=>r(i,o))}}}mount(){this.removePointerDownListener=Da(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const pv=T.createContext(null);function lfe(){const n=T.useContext(pv);if(n===null)return[!0,null];const{isPresent:e,onExitComplete:t,register:s}=n,r=T.useId();T.useEffect(()=>s(r),[]);const i=T.useCallback(()=>t&&t(r),[r,t]);return!e&&t?[!1,i]:[!0]}const Y_=T.createContext({}),vB=T.createContext({}),Sg={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function xN(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const gh={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(Ie.test(n))n=parseFloat(n);else return n;const t=xN(n,e.target.x),s=xN(n,e.target.y);return`${t}% ${s}%`}},cfe={correct:(n,{treeScale:e,projectionDelta:t})=>{const s=n,r=Qa.parse(n);if(r.length>5)return s;const i=Qa.createTransformer(n),o=typeof r[0]!="number"?1:0,a=t.x.scale*e.x,l=t.y.scale*e.y;r[0+o]/=a,r[1+o]/=l;const c=Ut(a,l,.5);return typeof r[2+o]=="number"&&(r[2+o]/=c),typeof r[3+o]=="number"&&(r[3+o]/=c),i(r)}},H0={};function ufe(n){Object.assign(H0,n)}const{schedule:Q_,cancel:zpe}=E5(queueMicrotask,!1);class dfe extends T.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s,layoutId:r}=this.props,{projection:i}=e;ufe(hfe),i&&(t.group&&t.group.add(i),s&&s.register&&r&&s.register(i),i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),Sg.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:s,drag:r,isPresent:i}=this.props,o=s.projection;return o&&(o.isPresent=i,r||e.layoutDependency!==t||t===void 0?o.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?o.promote():o.relegate()||xt.postRender(()=>{const a=o.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Q_.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s}=this.props,{projection:r}=e;r&&(r.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(r),s&&s.deregister&&s.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function xB(n){const[e,t]=lfe(),s=T.useContext(Y_);return u.jsx(dfe,{...n,layoutGroup:s,switchLayoutGroup:T.useContext(vB),isPresent:e,safeToRemove:t})}const hfe={borderRadius:{...gh,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:gh,borderTopRightRadius:gh,borderBottomLeftRadius:gh,borderBottomRightRadius:gh,boxShadow:cfe},EB=["TopLeft","TopRight","BottomLeft","BottomRight"],ffe=EB.length,EN=n=>typeof n=="string"?parseFloat(n):n,wN=n=>typeof n=="number"||Ie.test(n);function mfe(n,e,t,s,r,i){r?(n.opacity=Ut(0,t.opacity!==void 0?t.opacity:1,pfe(s)),n.opacityExit=Ut(e.opacity!==void 0?e.opacity:1,0,gfe(s))):i&&(n.opacity=Ut(e.opacity!==void 0?e.opacity:1,t.opacity!==void 0?t.opacity:1,s));for(let o=0;o<ffe;o++){const a=`border${EB[o]}Radius`;let l=TN(e,a),c=TN(t,a);if(l===void 0&&c===void 0)continue;l||(l=0),c||(c=0),l===0||c===0||wN(l)===wN(c)?(n[a]=Math.max(Ut(EN(l),EN(c),s),0),(Ti.test(c)||Ti.test(l))&&(n[a]+="%")):n[a]=c}(e.rotate||t.rotate)&&(n.rotate=Ut(e.rotate||0,t.rotate||0,s))}function TN(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const pfe=wB(0,.5,I5),gfe=wB(.5,.95,ts);function wB(n,e,t){return s=>s<n?0:s>e?1:t(dd(n,e,s))}function bN(n,e){n.min=e.min,n.max=e.max}function rr(n,e){bN(n.x,e.x),bN(n.y,e.y)}function SN(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function _N(n,e,t,s,r){return n-=e,n=K0(n,1/t,s),r!==void 0&&(n=K0(n,1/r,s)),n}function yfe(n,e=0,t=1,s=.5,r,i=n,o=n){if(Ti.test(e)&&(e=parseFloat(e),e=Ut(o.min,o.max,e/100)-o.min),typeof e!="number")return;let a=Ut(i.min,i.max,s);n===i&&(a-=e),n.min=_N(n.min,e,t,a,r),n.max=_N(n.max,e,t,a,r)}function AN(n,e,[t,s,r],i,o){yfe(n,e[t],e[s],e[r],e.scale,i,o)}const vfe=["x","scaleX","originX"],xfe=["y","scaleY","originY"];function IN(n,e,t,s){AN(n.x,e,vfe,t?t.x:void 0,s?s.x:void 0),AN(n.y,e,xfe,t?t.y:void 0,s?s.y:void 0)}function RN(n){return n.translate===0&&n.scale===1}function TB(n){return RN(n.x)&&RN(n.y)}function CN(n,e){return n.min===e.min&&n.max===e.max}function Efe(n,e){return CN(n.x,e.x)&&CN(n.y,e.y)}function PN(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function bB(n,e){return PN(n.x,e.x)&&PN(n.y,e.y)}function kN(n){return tr(n.x)/tr(n.y)}function NN(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class wfe{constructor(){this.members=[]}add(e){H_(this.members,e),e.scheduleRender()}remove(e){if(W_(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(r=>e===r);if(t===0)return!1;let s;for(let r=t;r>=0;r--){const i=this.members[r];if(i.isPresent!==!1){s=i;break}}return s?(this.promote(s),!0):!1}promote(e,t){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender(),e.resumeFrom=s,t&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;r===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:s}=e;t.onExitComplete&&t.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Tfe(n,e,t){let s="";const r=n.x.translate/e.x,i=n.y.translate/e.y,o=(t==null?void 0:t.z)||0;if((r||i||o)&&(s=`translate3d(${r}px, ${i}px, ${o}px) `),(e.x!==1||e.y!==1)&&(s+=`scale(${1/e.x}, ${1/e.y}) `),t){const{transformPerspective:c,rotate:d,rotateX:h,rotateY:f,skewX:m,skewY:p}=t;c&&(s=`perspective(${c}px) ${s}`),d&&(s+=`rotate(${d}deg) `),h&&(s+=`rotateX(${h}deg) `),f&&(s+=`rotateY(${f}deg) `),m&&(s+=`skewX(${m}deg) `),p&&(s+=`skewY(${p}deg) `)}const a=n.x.scale*e.x,l=n.y.scale*e.y;return(a!==1||l!==1)&&(s+=`scale(${a}, ${l})`),s||"none"}const bfe=(n,e)=>n.depth-e.depth;class Sfe{constructor(){this.children=[],this.isDirty=!1}add(e){H_(this.children,e),this.isDirty=!0}remove(e){W_(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(bfe),this.isDirty=!1,this.children.forEach(e)}}function _g(n){const e=es(n)?n.get():n;return hhe(e)?e.toValue():e}function _fe(n,e){const t=bi.now(),s=({timestamp:r})=>{const i=r-t;i>=e&&(Ya(s),n(i-e))};return xt.read(s,!0),()=>Ya(s)}function Afe(n){return n instanceof SVGElement&&n.tagName!=="svg"}function Ife(n,e,t){const s=es(n)?n:Hf(n);return s.start(K_("",s,e,t)),s.animation}const Tl={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Nh=typeof window<"u"&&window.MotionDebug!==void 0,cE=["","X","Y","Z"],Rfe={visibility:"hidden"},LN=1e3;let Cfe=0;function uE(n,e,t,s){const{latestValues:r}=e;r[n]&&(t[n]=r[n],e.setStaticValue(n,0),s&&(s[n]=0))}function SB(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const t=rB(e);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:r,layoutId:i}=n.options;window.MotionCancelOptimisedAnimation(t,"transform",xt,!(r||i))}const{parent:s}=n;s&&!s.hasCheckedOptimisedAppear&&SB(s)}function _B({attachResizeListener:n,defaultParent:e,measureScroll:t,checkIsScrollRoot:s,resetTransform:r}){return class{constructor(o={},a=e==null?void 0:e()){this.id=Cfe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Nh&&(Tl.totalNodes=Tl.resolvedTargetDeltas=Tl.recalculatedProjection=0),this.nodes.forEach(Nfe),this.nodes.forEach(jfe),this.nodes.forEach(Ffe),this.nodes.forEach(Lfe),Nh&&window.MotionDebug.record(Tl)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new Sfe)}addEventListener(o,a){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new z_),this.eventHandlers.get(o).add(a)}notifyListeners(o,...a){const l=this.eventHandlers.get(o);l&&l.notify(...a)}hasListeners(o){return this.eventHandlers.has(o)}mount(o,a=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=Afe(o),this.instance=o;const{layoutId:l,layout:c,visualElement:d}=this.options;if(d&&!d.current&&d.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),a&&(c||l)&&(this.isLayoutDirty=!0),n){let h;const f=()=>this.root.updateBlockedByResize=!1;n(o,()=>{this.root.updateBlockedByResize=!0,h&&h(),h=_fe(f,250),Sg.hasAnimatedSinceResize&&(Sg.hasAnimatedSinceResize=!1,this.nodes.forEach(MN))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&d&&(l||c)&&this.addEventListener("didUpdate",({delta:h,hasLayoutChanged:f,hasRelativeTargetChanged:m,layout:p})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const y=this.options.transition||d.getDefaultTransition()||Gfe,{onLayoutAnimationStart:v,onLayoutAnimationComplete:x}=d.getProps(),E=!this.targetLayout||!bB(this.targetLayout,p)||m,w=!f&&m;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||w||f&&(E||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(h,w);const b={...P_(y,"layout"),onPlay:v,onComplete:x};(d.shouldReduceMotion||this.options.layoutRoot)&&(b.delay=0,b.type=!1),this.startAnimation(b)}else f||MN(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=p})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Ya(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Ufe),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&SB(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let d=0;d<this.path.length;d++){const h=this.path[d];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:a,layout:l}=this.options;if(a===void 0&&!l)return;const c=this.getTransformTemplate();this.prevTransformTemplateValue=c?c(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(DN);return}this.isUpdating||this.nodes.forEach(Mfe),this.isUpdating=!1,this.nodes.forEach(Ofe),this.nodes.forEach(Pfe),this.nodes.forEach(kfe),this.clearAllSnapshots();const a=bi.now();Nn.delta=wo(0,1e3/60,a-Nn.timestamp),Nn.timestamp=a,Nn.isProcessing=!0,tE.update.process(Nn),tE.preRender.process(Nn),tE.render.process(Nn),Nn.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Q_.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Dfe),this.sharedNodes.forEach(Vfe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,xt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){xt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=en(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(a=!1),a){const l=s(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:l,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!r)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!TB(this.projectionDelta),l=this.getTransformTemplate(),c=l?l(this.latestValues,""):void 0,d=c!==this.prevTransformTemplateValue;o&&(a||wl(this.latestValues)||d)&&(r(this.instance,c),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const a=this.measurePageBox();let l=this.removeElementScroll(a);return o&&(l=this.removeTransform(l)),Kfe(l),{animationId:this.root.animationId,measuredBox:a,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){var o;const{visualElement:a}=this.options;if(!a)return en();const l=a.measureViewportBox();if(!(((o=this.scroll)===null||o===void 0?void 0:o.wasRoot)||this.path.some(Hfe))){const{scroll:d}=this.root;d&&(au(l.x,d.offset.x),au(l.y,d.offset.y))}return l}removeElementScroll(o){var a;const l=en();if(rr(l,o),!((a=this.scroll)===null||a===void 0)&&a.wasRoot)return l;for(let c=0;c<this.path.length;c++){const d=this.path[c],{scroll:h,options:f}=d;d!==this.root&&h&&f.layoutScroll&&(h.wasRoot&&rr(l,o),au(l.x,h.offset.x),au(l.y,h.offset.y))}return l}applyTransform(o,a=!1){const l=en();rr(l,o);for(let c=0;c<this.path.length;c++){const d=this.path[c];!a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&lu(l,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),wl(d.latestValues)&&lu(l,d.latestValues)}return wl(this.latestValues)&&lu(l,this.latestValues),l}removeTransform(o){const a=en();rr(a,o);for(let l=0;l<this.path.length;l++){const c=this.path[l];if(!c.instance||!wl(c.latestValues))continue;QT(c.latestValues)&&c.updateSnapshot();const d=en(),h=c.measurePageBox();rr(d,h),IN(a,c.latestValues,c.snapshot?c.snapshot.layoutBox:void 0,d)}return wl(this.latestValues)&&IN(a,this.latestValues),a}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Nn.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var a;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(o||c&&this.isSharedProjectionDirty||this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:h,layoutId:f}=this.options;if(!(!this.layout||!(h||f))){if(this.resolvedRelativeTargetAt=Nn.timestamp,!this.targetDelta&&!this.relativeTarget){const m=this.getClosestProjectingParent();m&&m.layout&&this.animationProgress!==1?(this.relativeParent=m,this.forceRelativeParentToResolveTarget(),this.relativeTarget=en(),this.relativeTargetOrigin=en(),ef(this.relativeTargetOrigin,this.layout.layoutBox,m.layout.layoutBox),rr(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=en(),this.targetWithTransforms=en()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Whe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):rr(this.target,this.layout.layoutBox),pB(this.target,this.targetDelta)):rr(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const m=this.getClosestProjectingParent();m&&!!m.resumingFrom==!!this.resumingFrom&&!m.options.layoutScroll&&m.target&&this.animationProgress!==1?(this.relativeParent=m,this.forceRelativeParentToResolveTarget(),this.relativeTarget=en(),this.relativeTargetOrigin=en(),ef(this.relativeTargetOrigin,this.target,m.target),rr(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Nh&&Tl.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||QT(this.parent.latestValues)||mB(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var o;const a=this.getLead(),l=!!this.resumingFrom||this!==a;let c=!0;if((this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===Nn.timestamp&&(c=!1),c)return;const{layout:d,layoutId:h}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||h))return;rr(this.layoutCorrected,this.layout.layoutBox);const f=this.treeScale.x,m=this.treeScale.y;tfe(this.layoutCorrected,this.treeScale,this.path,l),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=en());const{target:p}=a;if(!p){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(SN(this.prevProjectionDelta.x,this.projectionDelta.x),SN(this.prevProjectionDelta.y,this.projectionDelta.y)),Zh(this.projectionDelta,this.layoutCorrected,p,this.latestValues),(this.treeScale.x!==f||this.treeScale.y!==m||!NN(this.projectionDelta.x,this.prevProjectionDelta.x)||!NN(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",p)),Nh&&Tl.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){var a;if((a=this.options.visualElement)===null||a===void 0||a.scheduleRender(),o){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=ou(),this.projectionDelta=ou(),this.projectionDeltaWithTransform=ou()}setAnimationOrigin(o,a=!1){const l=this.snapshot,c=l?l.latestValues:{},d={...this.latestValues},h=ou();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const f=en(),m=l?l.source:void 0,p=this.layout?this.layout.source:void 0,y=m!==p,v=this.getStack(),x=!v||v.members.length<=1,E=!!(y&&!x&&this.options.crossfade===!0&&!this.path.some(Bfe));this.animationProgress=0;let w;this.mixTargetDelta=b=>{const C=b/1e3;ON(h.x,o.x,C),ON(h.y,o.y,C),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ef(f,this.layout.layoutBox,this.relativeParent.layout.layoutBox),$fe(this.relativeTarget,this.relativeTargetOrigin,f,C),w&&Efe(this.relativeTarget,w)&&(this.isProjectionDirty=!1),w||(w=en()),rr(w,this.relativeTarget)),y&&(this.animationValues=d,mfe(d,c,this.latestValues,C,E,x)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=C},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Ya(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=xt.update(()=>{Sg.hasAnimatedSinceResize=!0,this.currentAnimation=Ife(0,LN,{...o,onUpdate:a=>{this.mixTargetDelta(a),o.onUpdate&&o.onUpdate(a)},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(LN),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:a,target:l,layout:c,latestValues:d}=o;if(!(!a||!l||!c)){if(this!==o&&this.layout&&c&&AB(this.options.animationType,this.layout.layoutBox,c.layoutBox)){l=this.target||en();const h=tr(this.layout.layoutBox.x);l.x.min=o.target.x.min,l.x.max=l.x.min+h;const f=tr(this.layout.layoutBox.y);l.y.min=o.target.y.min,l.y.max=l.y.min+f}rr(a,l),lu(a,d),Zh(this.projectionDeltaWithTransform,this.layoutCorrected,a,d)}}registerSharedNode(o,a){this.sharedNodes.has(o)||this.sharedNodes.set(o,new wfe),this.sharedNodes.get(o).add(a);const c=a.options.initialPromotionConfig;a.promote({transition:c?c.transition:void 0,preserveFollowOpacity:c&&c.shouldPreserveFollowOpacity?c.shouldPreserveFollowOpacity(a):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var o;const{layoutId:a}=this.options;return a?((o=this.getStack())===null||o===void 0?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:a}=this.options;return a?(o=this.getStack())===null||o===void 0?void 0:o.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:a,preserveFollowOpacity:l}={}){const c=this.getStack();c&&c.promote(this,l),o&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let a=!1;const{latestValues:l}=o;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(a=!0),!a)return;const c={};l.z&&uE("z",o,c,this.animationValues);for(let d=0;d<cE.length;d++)uE(`rotate${cE[d]}`,o,c,this.animationValues),uE(`skew${cE[d]}`,o,c,this.animationValues);o.render();for(const d in c)o.setStaticValue(d,c[d]),this.animationValues&&(this.animationValues[d]=c[d]);o.scheduleRender()}getProjectionStyles(o){var a,l;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Rfe;const c={visibility:""},d=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,c.opacity="",c.pointerEvents=_g(o==null?void 0:o.pointerEvents)||"",c.transform=d?d(this.latestValues,""):"none",c;const h=this.getLead();if(!this.projectionDelta||!this.layout||!h.target){const y={};return this.options.layoutId&&(y.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,y.pointerEvents=_g(o==null?void 0:o.pointerEvents)||""),this.hasProjected&&!wl(this.latestValues)&&(y.transform=d?d({},""):"none",this.hasProjected=!1),y}const f=h.animationValues||h.latestValues;this.applyTransformsToTarget(),c.transform=Tfe(this.projectionDeltaWithTransform,this.treeScale,f),d&&(c.transform=d(f,c.transform));const{x:m,y:p}=this.projectionDelta;c.transformOrigin=`${m.origin*100}% ${p.origin*100}% 0`,h.animationValues?c.opacity=h===this?(l=(a=f.opacity)!==null&&a!==void 0?a:this.latestValues.opacity)!==null&&l!==void 0?l:1:this.preserveOpacity?this.latestValues.opacity:f.opacityExit:c.opacity=h===this?f.opacity!==void 0?f.opacity:"":f.opacityExit!==void 0?f.opacityExit:0;for(const y in H0){if(f[y]===void 0)continue;const{correct:v,applyTo:x}=H0[y],E=c.transform==="none"?f[y]:v(f[y],h);if(x){const w=x.length;for(let b=0;b<w;b++)c[x[b]]=E}else c[y]=E}return this.options.layoutId&&(c.pointerEvents=h===this?_g(o==null?void 0:o.pointerEvents)||"":"none"),c}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var a;return(a=o.currentAnimation)===null||a===void 0?void 0:a.stop()}),this.root.nodes.forEach(DN),this.root.sharedNodes.clear()}}}function Pfe(n){n.updateLayout()}function kfe(n){var e;const t=((e=n.resumeFrom)===null||e===void 0?void 0:e.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&t&&n.hasListeners("didUpdate")){const{layoutBox:s,measuredBox:r}=n.layout,{animationType:i}=n.options,o=t.source!==n.layout.source;i==="size"?ir(h=>{const f=o?t.measuredBox[h]:t.layoutBox[h],m=tr(f);f.min=s[h].min,f.max=f.min+m}):AB(i,t.layoutBox,s)&&ir(h=>{const f=o?t.measuredBox[h]:t.layoutBox[h],m=tr(s[h]);f.max=f.min+m,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[h].max=n.relativeTarget[h].min+m)});const a=ou();Zh(a,s,t.layoutBox);const l=ou();o?Zh(l,n.applyTransform(r,!0),t.measuredBox):Zh(l,s,t.layoutBox);const c=!TB(a);let d=!1;if(!n.resumeFrom){const h=n.getClosestProjectingParent();if(h&&!h.resumeFrom){const{snapshot:f,layout:m}=h;if(f&&m){const p=en();ef(p,t.layoutBox,f.layoutBox);const y=en();ef(y,s,m.layoutBox),bB(p,y)||(d=!0),h.options.layoutRoot&&(n.relativeTarget=y,n.relativeTargetOrigin=p,n.relativeParent=h)}}}n.notifyListeners("didUpdate",{layout:s,snapshot:t,delta:l,layoutDelta:a,hasLayoutChanged:c,hasRelativeTargetChanged:d})}else if(n.isLead()){const{onExitComplete:s}=n.options;s&&s()}n.options.transition=void 0}function Nfe(n){Nh&&Tl.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function Lfe(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function Dfe(n){n.clearSnapshot()}function DN(n){n.clearMeasurements()}function Mfe(n){n.isLayoutDirty=!1}function Ofe(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function MN(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function jfe(n){n.resolveTargetDelta()}function Ffe(n){n.calcProjection()}function Ufe(n){n.resetSkewAndRotation()}function Vfe(n){n.removeLeadSnapshot()}function ON(n,e,t){n.translate=Ut(e.translate,0,t),n.scale=Ut(e.scale,1,t),n.origin=e.origin,n.originPoint=e.originPoint}function jN(n,e,t,s){n.min=Ut(e.min,t.min,s),n.max=Ut(e.max,t.max,s)}function $fe(n,e,t,s){jN(n.x,e.x,t.x,s),jN(n.y,e.y,t.y,s)}function Bfe(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const Gfe={duration:.45,ease:[.4,0,.1,1]},FN=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),UN=FN("applewebkit/")&&!FN("chrome/")?Math.round:ts;function VN(n){n.min=UN(n.min),n.max=UN(n.max)}function Kfe(n){VN(n.x),VN(n.y)}function AB(n,e,t){return n==="position"||n==="preserve-aspect"&&!Hhe(kN(e),kN(t),.2)}function Hfe(n){var e;return n!==n.root&&((e=n.scroll)===null||e===void 0?void 0:e.wasRoot)}const Wfe=_B({attachResizeListener:(n,e)=>Ji(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),dE={current:void 0},IB=_B({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!dE.current){const n=new Wfe({});n.mount(window),n.setOptions({layoutScroll:!0}),dE.current=n}return dE.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),zfe={pan:{Feature:afe},drag:{Feature:ofe,ProjectionNode:IB,MeasureLayout:xB}};function $N(n,e,t){const{props:s}=n;n.animationState&&s.whileHover&&n.animationState.setActive("whileHover",t);const r=s[t?"onHoverStart":"onHoverEnd"];r&&xt.postRender(()=>r(e,bm(e)))}class qfe extends rl{mount(){const{current:e,props:t}=this.node;e&&(this.unmount=Mhe(e,s=>($N(this.node,s,!0),r=>$N(this.node,r,!1)),{passive:!t.onHoverStart&&!t.onHoverEnd}))}unmount(){}}class Yfe extends rl{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=La(Ji(this.node.current,"focus",()=>this.onFocus()),Ji(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const RB=(n,e)=>e?n===e?!0:RB(n,e.parentElement):!1;function hE(n,e){if(!e)return;const t=new PointerEvent("pointer"+n);e(t,bm(t))}class Qfe extends rl{constructor(){super(...arguments),this.removeStartListeners=ts,this.removeEndListeners=ts,this.removeAccessibleListeners=ts,this.startPointerPress=(e,t)=>{if(this.isPressing)return;this.removeEndListeners();const s=this.node.getProps(),i=Da(window,"pointerup",(a,l)=>{if(!this.checkPressEnd())return;const{onTap:c,onTapCancel:d,globalTapTarget:h}=this.node.getProps(),f=!h&&!RB(this.node.current,a.target)?d:c;f&&xt.update(()=>f(a,l))},{passive:!(s.onTap||s.onPointerUp)}),o=Da(window,"pointercancel",(a,l)=>this.cancelPress(a,l),{passive:!(s.onTapCancel||s.onPointerCancel)});this.removeEndListeners=La(i,o),this.startPress(e,t)},this.startAccessiblePress=()=>{const e=i=>{if(i.key!=="Enter"||this.isPressing)return;const o=a=>{a.key!=="Enter"||!this.checkPressEnd()||hE("up",(l,c)=>{const{onTap:d}=this.node.getProps();d&&xt.postRender(()=>d(l,c))})};this.removeEndListeners(),this.removeEndListeners=Ji(this.node.current,"keyup",o),hE("down",(a,l)=>{this.startPress(a,l)})},t=Ji(this.node.current,"keydown",e),s=()=>{this.isPressing&&hE("cancel",(i,o)=>this.cancelPress(i,o))},r=Ji(this.node.current,"blur",s);this.removeAccessibleListeners=La(t,r)}}startPress(e,t){this.isPressing=!0;const{onTapStart:s,whileTap:r}=this.node.getProps();r&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),s&&xt.postRender(()=>s(e,t))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!aB()}cancelPress(e,t){if(!this.checkPressEnd())return;const{onTapCancel:s}=this.node.getProps();s&&xt.postRender(()=>s(e,t))}mount(){const e=this.node.getProps(),t=Da(e.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(e.onTapStart||e.onPointerStart)}),s=Ji(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=La(t,s)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const JT=new WeakMap,fE=new WeakMap,Xfe=n=>{const e=JT.get(n.target);e&&e(n)},Jfe=n=>{n.forEach(Xfe)};function Zfe({root:n,...e}){const t=n||document;fE.has(t)||fE.set(t,{});const s=fE.get(t),r=JSON.stringify(e);return s[r]||(s[r]=new IntersectionObserver(Jfe,{root:n,...e})),s[r]}function eme(n,e,t){const s=Zfe(e);return JT.set(n,t),s.observe(n),()=>{JT.delete(n),s.unobserve(n)}}const tme={some:0,all:1};class nme extends rl{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:s,amount:r="some",once:i}=e,o={root:t?t.current:void 0,rootMargin:s,threshold:typeof r=="number"?r:tme[r]},a=l=>{const{isIntersecting:c}=l;if(this.isInView===c||(this.isInView=c,i&&!c&&this.hasEnteredView))return;c&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",c);const{onViewportEnter:d,onViewportLeave:h}=this.node.getProps(),f=c?d:h;f&&f(l)};return eme(this.node.current,o,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(sme(e,t))&&this.startObserver()}unmount(){}}function sme({viewport:n={}},{viewport:e={}}={}){return t=>n[t]!==e[t]}const rme={inView:{Feature:nme},tap:{Feature:Qfe},focus:{Feature:Yfe},hover:{Feature:qfe}},ime={layout:{ProjectionNode:IB,MeasureLayout:xB}},X_=T.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"}),gv=T.createContext({}),J_=typeof window<"u",CB=J_?T.useLayoutEffect:T.useEffect,PB=T.createContext({strict:!1});function ome(n,e,t,s,r){var i,o;const{visualElement:a}=T.useContext(gv),l=T.useContext(PB),c=T.useContext(pv),d=T.useContext(X_).reducedMotion,h=T.useRef();s=s||l.renderer,!h.current&&s&&(h.current=s(n,{visualState:e,parent:a,props:t,presenceContext:c,blockInitialAnimation:c?c.initial===!1:!1,reducedMotionConfig:d}));const f=h.current,m=T.useContext(vB);f&&!f.projection&&r&&(f.type==="html"||f.type==="svg")&&ame(h.current,t,r,m);const p=T.useRef(!1);T.useInsertionEffect(()=>{f&&p.current&&f.update(t,c)});const y=t[sB],v=T.useRef(!!y&&!(!((i=window.MotionHandoffIsComplete)===null||i===void 0)&&i.call(window,y))&&((o=window.MotionHasOptimisedAnimation)===null||o===void 0?void 0:o.call(window,y)));return CB(()=>{f&&(p.current=!0,window.MotionIsMounted=!0,f.updateFeatures(),Q_.render(f.render),v.current&&f.animationState&&f.animationState.animateChanges())}),T.useEffect(()=>{f&&(!v.current&&f.animationState&&f.animationState.animateChanges(),v.current&&(queueMicrotask(()=>{var x;(x=window.MotionHandoffMarkAsComplete)===null||x===void 0||x.call(window,y)}),v.current=!1))}),f}function ame(n,e,t,s){const{layoutId:r,layout:i,drag:o,dragConstraints:a,layoutScroll:l,layoutRoot:c}=e;n.projection=new t(n.latestValues,e["data-framer-portal-id"]?void 0:kB(n.parent)),n.projection.setOptions({layoutId:r,layout:i,alwaysMeasureLayout:!!o||a&&iu(a),visualElement:n,animationType:typeof i=="string"?i:"both",initialPromotionConfig:s,layoutScroll:l,layoutRoot:c})}function kB(n){if(n)return n.options.allowProjection!==!1?n.projection:kB(n.parent)}function lme(n,e,t){return T.useCallback(s=>{s&&n.mount&&n.mount(s),e&&(s?e.mount(s):e.unmount()),t&&(typeof t=="function"?t(s):iu(t)&&(t.current=s))},[e])}function yv(n){return hv(n.animate)||C_.some(e=>Bf(n[e]))}function NB(n){return!!(yv(n)||n.variants)}function cme(n,e){if(yv(n)){const{initial:t,animate:s}=n;return{initial:t===!1||Bf(t)?t:void 0,animate:Bf(s)?s:void 0}}return n.inherit!==!1?e:{}}function ume(n){const{initial:e,animate:t}=cme(n,T.useContext(gv));return T.useMemo(()=>({initial:e,animate:t}),[BN(e),BN(t)])}function BN(n){return Array.isArray(n)?n.join(" "):n}const GN={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},hd={};for(const n in GN)hd[n]={isEnabled:e=>GN[n].some(t=>!!e[t])};function dme(n){for(const e in n)hd[e]={...hd[e],...n[e]}}const hme=Symbol.for("motionComponentSymbol");function fme({preloadedFeatures:n,createVisualElement:e,useRender:t,useVisualState:s,Component:r}){n&&dme(n);function i(a,l){let c;const d={...T.useContext(X_),...a,layoutId:mme(a)},{isStatic:h}=d,f=ume(a),m=s(a,h);if(!h&&J_){pme();const p=gme(d);c=p.MeasureLayout,f.visualElement=ome(r,m,d,e,p.ProjectionNode)}return u.jsxs(gv.Provider,{value:f,children:[c&&f.visualElement?u.jsx(c,{visualElement:f.visualElement,...d}):null,t(r,a,lme(m,f.visualElement,l),m,h,f.visualElement)]})}const o=T.forwardRef(i);return o[hme]=r,o}function mme({layoutId:n}){const e=T.useContext(Y_).id;return e&&n!==void 0?e+"-"+n:n}function pme(n,e){T.useContext(PB).strict}function gme(n){const{drag:e,layout:t}=hd;if(!e&&!t)return{};const s={...e,...t};return{MeasureLayout:e!=null&&e.isEnabled(n)||t!=null&&t.isEnabled(n)?s.MeasureLayout:void 0,ProjectionNode:s.ProjectionNode}}const yme=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Z_(n){return typeof n!="string"||n.includes("-")?!1:!!(yme.indexOf(n)>-1||/[A-Z]/u.test(n))}function LB(n,{style:e,vars:t},s,r){Object.assign(n.style,e,r&&r.getProjectionStyles(s));for(const i in t)n.style.setProperty(i,t[i])}const DB=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function MB(n,e,t,s){LB(n,e,void 0,s);for(const r in e.attrs)n.setAttribute(DB.has(r)?r:q_(r),e.attrs[r])}function OB(n,{layout:e,layoutId:t}){return xc.has(n)||n.startsWith("origin")||(e||t!==void 0)&&(!!H0[n]||n==="opacity")}function eA(n,e,t){var s;const{style:r}=n,i={};for(const o in r)(es(r[o])||e.style&&es(e.style[o])||OB(o,n)||((s=t==null?void 0:t.getValue(o))===null||s===void 0?void 0:s.liveStyle)!==void 0)&&(i[o]=r[o]);return i}function jB(n,e,t){const s=eA(n,e,t);for(const r in n)if(es(n[r])||es(e[r])){const i=Em.indexOf(r)!==-1?"attr"+r.charAt(0).toUpperCase()+r.substring(1):r;s[i]=n[r]}return s}function tA(n){const e=T.useRef(null);return e.current===null&&(e.current=n()),e.current}function vme({scrapeMotionValuesFromProps:n,createRenderState:e,onMount:t},s,r,i){const o={latestValues:xme(s,r,i,n),renderState:e()};return t&&(o.mount=a=>t(s,a,o)),o}const FB=n=>(e,t)=>{const s=T.useContext(gv),r=T.useContext(pv),i=()=>vme(n,e,s,r);return t?i():tA(i)};function xme(n,e,t,s){const r={},i=s(n,{});for(const f in i)r[f]=_g(i[f]);let{initial:o,animate:a}=n;const l=yv(n),c=NB(n);e&&c&&!l&&n.inherit!==!1&&(o===void 0&&(o=e.initial),a===void 0&&(a=e.animate));let d=t?t.initial===!1:!1;d=d||o===!1;const h=d?a:o;if(h&&typeof h!="boolean"&&!hv(h)){const f=Array.isArray(h)?h:[h];for(let m=0;m<f.length;m++){const p=I_(n,f[m]);if(p){const{transitionEnd:y,transition:v,...x}=p;for(const E in x){let w=x[E];if(Array.isArray(w)){const b=d?w.length-1:0;w=w[b]}w!==null&&(r[E]=w)}for(const E in y)r[E]=y[E]}}}return r}const nA=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),UB=()=>({...nA(),attrs:{}}),VB=(n,e)=>e&&typeof n=="number"?e.transform(n):n,Eme={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},wme=Em.length;function Tme(n,e,t){let s="",r=!0;for(let i=0;i<wme;i++){const o=Em[i],a=n[o];if(a===void 0)continue;let l=!0;if(typeof a=="number"?l=a===(o.startsWith("scale")?1:0):l=parseFloat(a)===0,!l||t){const c=VB(a,j_[o]);if(!l){r=!1;const d=Eme[o]||o;s+=`${d}(${c}) `}t&&(e[o]=c)}}return s=s.trim(),t?s=t(e,r?"":s):r&&(s="none"),s}function sA(n,e,t){const{style:s,vars:r,transformOrigin:i}=n;let o=!1,a=!1;for(const l in e){const c=e[l];if(xc.has(l)){o=!0;continue}else if(N5(l)){r[l]=c;continue}else{const d=VB(c,j_[l]);l.startsWith("origin")?(a=!0,i[l]=d):s[l]=d}}if(e.transform||(o||t?s.transform=Tme(e,n.transform,t):s.transform&&(s.transform="none")),a){const{originX:l="50%",originY:c="50%",originZ:d=0}=i;s.transformOrigin=`${l} ${c} ${d}`}}function KN(n,e,t){return typeof n=="string"?n:Ie.transform(e+t*n)}function bme(n,e,t){const s=KN(e,n.x,n.width),r=KN(t,n.y,n.height);return`${s} ${r}`}const Sme={offset:"stroke-dashoffset",array:"stroke-dasharray"},_me={offset:"strokeDashoffset",array:"strokeDasharray"};function Ame(n,e,t=1,s=0,r=!0){n.pathLength=1;const i=r?Sme:_me;n[i.offset]=Ie.transform(-s);const o=Ie.transform(e),a=Ie.transform(t);n[i.array]=`${o} ${a}`}function rA(n,{attrX:e,attrY:t,attrScale:s,originX:r,originY:i,pathLength:o,pathSpacing:a=1,pathOffset:l=0,...c},d,h){if(sA(n,c,h),d){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:f,style:m,dimensions:p}=n;f.transform&&(p&&(m.transform=f.transform),delete f.transform),p&&(r!==void 0||i!==void 0||m.transform)&&(m.transformOrigin=bme(p,r!==void 0?r:.5,i!==void 0?i:.5)),e!==void 0&&(f.x=e),t!==void 0&&(f.y=t),s!==void 0&&(f.scale=s),o!==void 0&&Ame(f,o,a,l,!1)}const iA=n=>typeof n=="string"&&n.toLowerCase()==="svg",Ime={useVisualState:FB({scrapeMotionValuesFromProps:jB,createRenderState:UB,onMount:(n,e,{renderState:t,latestValues:s})=>{xt.read(()=>{try{t.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}),xt.render(()=>{rA(t,s,iA(e.tagName),n.transformTemplate),MB(e,t)})}})},Rme={useVisualState:FB({scrapeMotionValuesFromProps:eA,createRenderState:nA})};function $B(n,e,t){for(const s in e)!es(e[s])&&!OB(s,t)&&(n[s]=e[s])}function Cme({transformTemplate:n},e){return T.useMemo(()=>{const t=nA();return sA(t,e,n),Object.assign({},t.vars,t.style)},[e])}function Pme(n,e){const t=n.style||{},s={};return $B(s,t,n),Object.assign(s,Cme(n,e)),s}function kme(n,e){const t={},s=Pme(n,e);return n.drag&&n.dragListener!==!1&&(t.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(t.tabIndex=0),t.style=s,t}const Nme=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function W0(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||Nme.has(n)}let BB=n=>!W0(n);function Lme(n){n&&(BB=e=>e.startsWith("on")?!W0(e):n(e))}try{Lme(require("@emotion/is-prop-valid").default)}catch{}function Dme(n,e,t){const s={};for(const r in n)r==="values"&&typeof n.values=="object"||(BB(r)||t===!0&&W0(r)||!e&&!W0(r)||n.draggable&&r.startsWith("onDrag"))&&(s[r]=n[r]);return s}function Mme(n,e,t,s){const r=T.useMemo(()=>{const i=UB();return rA(i,e,iA(s),n.transformTemplate),{...i.attrs,style:{...i.style}}},[e]);if(n.style){const i={};$B(i,n.style,n),r.style={...i,...r.style}}return r}function Ome(n=!1){return(t,s,r,{latestValues:i},o)=>{const l=(Z_(t)?Mme:kme)(s,i,o,t),c=Dme(s,typeof t=="string",n),d=t!==T.Fragment?{...c,...l,ref:r}:{},{children:h}=s,f=T.useMemo(()=>es(h)?h.get():h,[h]);return T.createElement(t,{...d,children:f})}}function jme(n,e){return function(s,{forwardMotionProps:r}={forwardMotionProps:!1}){const o={...Z_(s)?Ime:Rme,preloadedFeatures:n,useRender:Ome(r),createVisualElement:e,Component:s};return fme(o)}}const ZT={current:null},GB={current:!1};function Fme(){if(GB.current=!0,!!J_)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>ZT.current=n.matches;n.addListener(e),e()}else ZT.current=!1}function Ume(n,e,t){for(const s in e){const r=e[s],i=t[s];if(es(r))n.addValue(s,r);else if(es(i))n.addValue(s,Hf(r,{owner:n}));else if(i!==r)if(n.hasValue(s)){const o=n.getValue(s);o.liveStyle===!0?o.jump(r):o.hasAnimated||o.set(r)}else{const o=n.getStaticValue(s);n.addValue(s,Hf(o!==void 0?o:r,{owner:n}))}}for(const s in t)e[s]===void 0&&n.removeValue(s);return e}const HN=new WeakMap,Vme=[...M5,Yn,Qa],$me=n=>Vme.find(D5(n)),WN=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Bme{scrapeMotionValuesFromProps(e,t,s){return{}}constructor({parent:e,props:t,presenceContext:s,reducedMotionConfig:r,blockInitialAnimation:i,visualState:o},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=D_,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const f=bi.now();this.renderScheduledAt<f&&(this.renderScheduledAt=f,xt.render(this.render,!1,!0))};const{latestValues:l,renderState:c}=o;this.latestValues=l,this.baseTarget={...l},this.initialValues=t.initial?{...l}:{},this.renderState=c,this.parent=e,this.props=t,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=a,this.blockInitialAnimation=!!i,this.isControllingVariants=yv(t),this.isVariantNode=NB(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:d,...h}=this.scrapeMotionValuesFromProps(t,{},this);for(const f in h){const m=h[f];l[f]!==void 0&&es(m)&&m.set(l[f],!1)}}mount(e){this.current=e,HN.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,s)=>this.bindToMotionValue(s,t)),GB.current||Fme(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:ZT.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){HN.delete(this.current),this.projection&&this.projection.unmount(),Ya(this.notifyUpdate),Ya(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const s=xc.has(e),r=t.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&xt.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0)}),i=t.on("renderRequest",this.scheduleRender);let o;window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{r(),i(),o&&o(),t.owner&&t.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in hd){const t=hd[e];if(!t)continue;const{isEnabled:s,Feature:r}=t;if(!this.features[e]&&r&&s(this.props)&&(this.features[e]=new r(this)),this.features[e]){const i=this.features[e];i.isMounted?i.update():(i.mount(),i.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):en()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let s=0;s<WN.length;s++){const r=WN[s];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const i="on"+r,o=e[i];o&&(this.propEventSubscriptions[r]=this.on(r,o))}this.prevMotionValues=Ume(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const s=this.values.get(e);t!==s&&(s&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return s===void 0&&t!==void 0&&(s=Hf(t===null?void 0:t,{owner:this}),this.addValue(e,s)),s}readValue(e,t){var s;let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(s=this.getBaseTargetFromProps(this.props,e))!==null&&s!==void 0?s:this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&(P5(r)||C5(r))?r=parseFloat(r):!$me(r)&&Qa.test(t)&&(r=G5(e,t)),this.setBaseTarget(e,es(r)?r.get():r)),es(r)?r.get():r}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:s}=this.props;let r;if(typeof s=="string"||typeof s=="object"){const o=I_(this.props,s,(t=this.presenceContext)===null||t===void 0?void 0:t.custom);o&&(r=o[e])}if(s&&r!==void 0)return r;const i=this.getBaseTargetFromProps(this.props,e);return i!==void 0&&!es(i)?i:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new z_),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}}class KB extends Bme{constructor(){super(...arguments),this.KeyframeResolver=K5}sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:s}){delete t[e],delete s[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;es(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}}function Gme(n){return window.getComputedStyle(n)}class Kme extends KB{constructor(){super(...arguments),this.type="html",this.renderInstance=LB}readValueFromInstance(e,t){if(xc.has(t)){const s=F_(t);return s&&s.default||0}else{const s=Gme(e),r=(N5(t)?s.getPropertyValue(t):s[t])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:t}){return gB(e,t)}build(e,t,s){sA(e,t,s.transformTemplate)}scrapeMotionValuesFromProps(e,t,s){return eA(e,t,s)}}class Hme extends KB{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=en}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(xc.has(t)){const s=F_(t);return s&&s.default||0}return t=DB.has(t)?t:q_(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,s){return jB(e,t,s)}build(e,t,s){rA(e,t,this.isSVGTag,s.transformTemplate)}renderInstance(e,t,s,r){MB(e,t,s,r)}mount(e){this.isSVGTag=iA(e.tagName),super.mount(e)}}const Wme=(n,e)=>Z_(n)?new Hme(e):new Kme(e,{allowProjection:n!==T.Fragment}),zme=jme({...Lhe,...rme,...zfe,...ime},Wme),ls=kue(zme);class qme extends T.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const s=this.props.sizeRef.current;s.height=t.offsetHeight||0,s.width=t.offsetWidth||0,s.top=t.offsetTop,s.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Yme({children:n,isPresent:e}){const t=T.useId(),s=T.useRef(null),r=T.useRef({width:0,height:0,top:0,left:0}),{nonce:i}=T.useContext(X_);return T.useInsertionEffect(()=>{const{width:o,height:a,top:l,left:c}=r.current;if(e||!s.current||!o||!a)return;s.current.dataset.motionPopId=t;const d=document.createElement("style");return i&&(d.nonce=i),document.head.appendChild(d),d.sheet&&d.sheet.insertRule(`
          [data-motion-pop-id="${t}"] {
            position: absolute !important;
            width: ${o}px !important;
            height: ${a}px !important;
            top: ${l}px !important;
            left: ${c}px !important;
          }
        `),()=>{document.head.removeChild(d)}},[e]),u.jsx(qme,{isPresent:e,childRef:s,sizeRef:r,children:T.cloneElement(n,{ref:s})})}const Qme=({children:n,initial:e,isPresent:t,onExitComplete:s,custom:r,presenceAffectsLayout:i,mode:o})=>{const a=tA(Xme),l=T.useId(),c=T.useCallback(h=>{a.set(h,!0);for(const f of a.values())if(!f)return;s&&s()},[a,s]),d=T.useMemo(()=>({id:l,initial:e,isPresent:t,custom:r,onExitComplete:c,register:h=>(a.set(h,!1),()=>a.delete(h))}),i?[Math.random(),c]:[t,c]);return T.useMemo(()=>{a.forEach((h,f)=>a.set(f,!1))},[t]),T.useEffect(()=>{!t&&!a.size&&s&&s()},[t]),o==="popLayout"&&(n=u.jsx(Yme,{isPresent:t,children:n})),u.jsx(pv.Provider,{value:d,children:n})};function Xme(){return new Map}const Fp=n=>n.key||"";function zN(n){const e=[];return T.Children.forEach(n,t=>{T.isValidElement(t)&&e.push(t)}),e}const qN=({children:n,exitBeforeEnter:e,custom:t,initial:s=!0,onExitComplete:r,presenceAffectsLayout:i=!0,mode:o="sync"})=>{const a=T.useMemo(()=>zN(n),[n]),l=a.map(Fp),c=T.useRef(!0),d=T.useRef(a),h=tA(()=>new Map),[f,m]=T.useState(a),[p,y]=T.useState(a);CB(()=>{c.current=!1,d.current=a;for(let E=0;E<p.length;E++){const w=Fp(p[E]);l.includes(w)?h.delete(w):h.get(w)!==!0&&h.set(w,!1)}},[p,l.length,l.join("-")]);const v=[];if(a!==f){let E=[...a];for(let w=0;w<p.length;w++){const b=p[w],C=Fp(b);l.includes(C)||(E.splice(w,0,b),v.push(b))}o==="wait"&&v.length&&(E=v),y(zN(E)),m(a);return}const{forceRender:x}=T.useContext(Y_);return u.jsx(u.Fragment,{children:p.map(E=>{const w=Fp(E),b=a===p||l.includes(w),C=()=>{if(h.has(w))h.set(w,!0);else return;let D=!0;h.forEach(_=>{_||(D=!1)}),D&&(x==null||x(),y(d.current),r&&r())};return u.jsx(Qme,{isPresent:b,initial:!c.current||s?void 0:!1,custom:b?void 0:t,presenceAffectsLayout:i,mode:o,onExitComplete:b?void 0:C,children:E},w)})})},Up=[{id:"all",name:"All Posts",color:"bg-gradient-to-r from-gray-500 to-gray-600",icon:""},{id:"discussions",name:"Discussions",color:"bg-gradient-to-r from-blue-500 to-blue-600",icon:""},{id:"bug-reports",name:"Bug Reports",color:"bg-gradient-to-r from-red-500 to-red-600",icon:""},{id:"suggestions",name:"Suggestions",color:"bg-gradient-to-r from-green-500 to-green-600",icon:""},{id:"feedbacks",name:"Feedbacks",color:"bg-gradient-to-r from-yellow-500 to-yellow-600",icon:""},{id:"off-topic",name:"Off Topic",color:"bg-gradient-to-r from-purple-500 to-purple-600",icon:""},{id:"help",name:"Help",color:"bg-gradient-to-r from-orange-500 to-orange-600",icon:""}];function Jme(){const{currentUser:n,userProfile:e}=Ms(),[,t]=Ls(),[s,r]=T.useState([]),[i,o]=T.useState([]),[a,l]=T.useState("all"),[c,d]=T.useState(""),[h,f]=T.useState(!1),[m,p]=T.useState(!1),[y,v]=T.useState("discussions"),[x,E]=T.useState(""),[w,b]=T.useState(""),[C,D]=T.useState(!1);T.useEffect(()=>{_()},[]),T.useEffect(()=>{S()},[s,a,c]);const _=async()=>{f(!0);try{const L=await j3();r(L)}catch(L){console.error("Error loading posts:",L)}finally{f(!1)}},S=async()=>{let L=s;if(a!=="all"&&(L=s.filter(M=>M.category===a)),c.trim()){const M=await W3(c),G=new Set(M.map(V=>V.id));L=L.filter(V=>G.has(V.id))}o(L)},I=async()=>{if(!(!n||!e||!x.trim()||!w.trim())){D(!0);try{await O3(n.uid,e.username,e.avatarUrl,y,x,w),E(""),b(""),v("discussions"),p(!1),await _()}catch(L){console.error("Error creating post:",L)}finally{D(!1)}}},R=L=>{var M;return((M=Up.find(G=>G.id===L))==null?void 0:M.color)||"bg-gray-500"},N=L=>{var M;return((M=Up.find(G=>G.id===L))==null?void 0:M.name)||L};return u.jsxs("div",{className:"min-h-screen bg-background",children:[u.jsx(vm,{title:"Anime Forum - Anime Discussions & Updates",description:"Join the AnimeBite community forum. Discuss anime, share recommendations, get help, and connect with fellow anime fans.",keywords:"anime forum, anime community, anime discussions, anime chat, anime recommendations",url:"https://animebite.cc/forum"}),u.jsx("main",{className:"flex-grow",children:u.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[u.jsxs("div",{className:"mb-10",children:[u.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-6 mb-8",children:[u.jsxs(ls.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.4},children:[u.jsxs("h1",{className:"text-3xl md:text-5xl font-bold mb-3 bg-gradient-to-r from-primary to-primary/60 bg-clip-text text-transparent flex items-center gap-3",children:[u.jsx(fK,{className:"w-10 h-10 text-primary"}),"Community Forum"]}),u.jsx("p",{className:"text-muted-foreground text-lg",children:"Share ideas, get help, and connect with fellow anime enthusiasts"})]}),n&&u.jsx(ls.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3,delay:.1},children:u.jsxs(El,{open:m,onOpenChange:p,children:[u.jsx(Tg,{asChild:!0,children:u.jsxs(ne,{size:"lg",className:"gap-2 shadow-lg hover:shadow-xl transition-all",children:[u.jsx(xM,{className:"w-5 h-5"}),"Create Post"]})}),u.jsxs(ta,{className:"max-w-2xl",children:[u.jsx(na,{children:u.jsx(sa,{children:"Create New Post"})}),u.jsxs("div",{className:"space-y-4 mt-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Category"}),u.jsxs(Iue,{value:y,onValueChange:v,children:[u.jsx(m5,{children:u.jsx(Rue,{})}),u.jsx(y5,{children:Up.filter(L=>L.id!=="all").map(L=>u.jsx(v5,{value:L.id,children:L.name},L.id))})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Title"}),u.jsx(bn,{placeholder:"Enter post title...",value:x,onChange:L=>E(L.target.value),maxLength:200})]}),u.jsxs("div",{children:[u.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Content"}),u.jsx(Ii,{placeholder:"Write your post content...",value:w,onChange:L=>b(L.target.value),className:"min-h-[200px]",maxLength:5e3})]}),u.jsxs("div",{className:"flex gap-2 justify-end",children:[u.jsx(ne,{variant:"outline",onClick:()=>p(!1),disabled:C,children:"Cancel"}),u.jsx(ne,{onClick:I,disabled:C||!x.trim()||!w.trim(),children:C?"Posting...":"Post"})]})]})]})]})})]}),u.jsxs(ls.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.2},className:"relative mb-8",children:[u.jsx(gu,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),u.jsx(bn,{placeholder:"Search posts by title or content...",value:c,onChange:L=>d(L.target.value),className:"pl-12 h-12 text-base shadow-sm border-2 focus:border-primary/50 transition-all"})]}),u.jsx(ls.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,delay:.3},className:"flex flex-wrap gap-3",children:Up.map((L,M)=>u.jsxs(ls.button,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.2,delay:.3+M*.05},whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>l(L.id),className:`px-5 py-2.5 rounded-full text-sm font-semibold transition-all shadow-sm ${a===L.id?`${L.color} text-white shadow-lg scale-105`:"bg-secondary text-secondary-foreground hover:bg-secondary/80"}`,children:[u.jsx("span",{className:"mr-2",children:L.icon}),L.name]},L.id))})]}),!n&&u.jsx(Oe,{className:"mb-6",children:u.jsxs(jt,{className:"py-8 text-center",children:[u.jsx("p",{className:"text-muted-foreground mb-4",children:"Sign in to create posts and participate in discussions"}),u.jsx(ne,{onClick:()=>t("/auth/login"),children:"Sign In"})]})}),h?u.jsxs("div",{className:"text-center py-16",children:[u.jsx("div",{className:"inline-block animate-spin rounded-full h-16 w-16 border-4 border-primary border-t-transparent mb-4"}),u.jsx("p",{className:"text-muted-foreground text-lg font-medium",children:"Loading posts..."})]}):i.length===0?u.jsx(Oe,{className:"border-2 border-dashed",children:u.jsxs(jt,{className:"py-16 text-center",children:[u.jsx(wK,{className:"w-16 h-16 text-muted-foreground/50 mx-auto mb-4"}),u.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No Posts Found"}),u.jsx("p",{className:"text-muted-foreground",children:c?"Try adjusting your search":"Be the first to start a discussion!"})]})}):u.jsx("div",{className:"space-y-5",children:i.map((L,M)=>{var G;return u.jsx(ls.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:M*.05},children:u.jsx(Oe,{onClick:()=>{t(`/forum/post/${L.id}`)},className:"cursor-pointer hover:shadow-xl hover:scale-[1.01] transition-all duration-300 border-2 overflow-hidden group",children:u.jsx(jt,{className:"p-6",children:u.jsxs("div",{className:"flex gap-5",children:[u.jsxs(Ps,{className:"h-14 w-14 flex-shrink-0 ring-2 ring-primary/20 group-hover:ring-primary/40 transition-all",children:[u.jsx(ks,{src:L.avatarUrl}),u.jsx(Ns,{className:"bg-primary/10 text-primary font-bold text-lg",children:(G=L.username[0])==null?void 0:G.toUpperCase()})]}),u.jsxs("div",{className:"flex-1 min-w-0",children:[u.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[u.jsx(qt,{className:`${R(L.category)} text-white border-0 px-3 py-1 shadow-sm`,children:N(L.category)}),u.jsxs("span",{className:"text-sm text-muted-foreground",children:["by"," ",u.jsx("span",{className:"font-semibold text-foreground hover:text-primary transition-colors",children:L.username})]}),u.jsx("span",{className:"text-sm text-muted-foreground",children:""}),u.jsx("span",{className:"text-sm text-muted-foreground",children:L.createdAt&&Wa(L.createdAt.toDate(),{addSuffix:!0})})]}),u.jsx("h3",{className:"text-xl md:text-2xl font-bold mb-2 line-clamp-2 group-hover:text-primary transition-colors",children:L.title}),u.jsx("p",{className:"text-muted-foreground line-clamp-2 mb-4 leading-relaxed",children:L.content}),u.jsx(__,{className:"my-4"}),u.jsxs("div",{className:"flex flex-wrap items-center gap-5 text-sm font-medium",children:[u.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground hover:text-primary transition-colors",children:[u.jsx(uS,{className:"w-4 h-4"}),u.jsx("span",{children:L.views||0})]}),u.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground hover:text-primary transition-colors",children:[u.jsx(li,{className:"w-4 h-4"}),u.jsx("span",{children:L.replies||0})]}),u.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground hover:text-destructive transition-colors",children:[u.jsx(cc,{className:"w-4 h-4"}),u.jsx("span",{children:L.likes||0})]}),L.reactions&&Object.keys(L.reactions).length>0&&u.jsx("div",{className:"flex items-center gap-2 ml-auto",children:Object.entries(L.reactions).slice(0,3).map(([V,$])=>u.jsxs("span",{className:"text-base bg-secondary/50 px-2 py-1 rounded-full",children:[V," ",$.length]},V))})]})]})]})})})},L.id)})})]})})]})}const YN=["","","","","","","",""],QN=[{id:"discussions",name:"Discussions",color:"bg-blue-500",textColor:"text-blue-500"},{id:"bug-reports",name:"Bug Reports",color:"bg-red-500",textColor:"text-red-500"},{id:"suggestions",name:"Suggestions",color:"bg-green-500",textColor:"text-green-500"},{id:"feedbacks",name:"Feedbacks",color:"bg-yellow-500",textColor:"text-yellow-500"},{id:"off-topic",name:"Off Topic",color:"bg-purple-500",textColor:"text-purple-500"},{id:"help",name:"Help",color:"bg-orange-500",textColor:"text-orange-500"}];function XN(){var G;const{id:n}=pd(),[,e]=Ls(),{currentUser:t,userProfile:s}=Ms(),[r,i]=T.useState(null),[o,a]=T.useState([]),[l,c]=T.useState(""),[d,h]=T.useState(!0),[f,m]=T.useState(null),[p,y]=T.useState(!1),[v,x]=T.useState(null),[E,w]=T.useState(!1),[b,C]=T.useState(new Set);T.useEffect(()=>{n?D():(m("No post ID provided"),h(!1))},[n]);const D=async()=>{if(!n){m("Invalid post ID"),h(!1);return}h(!0),m(null);try{const V=await F3(n);if(V){i(V),t&&V.likedBy&&w(V.likedBy.includes(t.uid)),await U3(n);const $=await G3(n);if(a($),t){const F=new Set;$.forEach(j=>{j.likedBy&&j.likedBy.includes(t.uid)&&F.add(j.id)}),C(F)}}else m("Post not found")}catch(V){console.error("Error loading post:",V),m(V instanceof Error?V.message:"Failed to load post")}finally{h(!1)}},_=async()=>{!n||!t||(w(!E),await V3(n,t.uid),await D())},S=async V=>{!n||!t||(await $3(n,t.uid,V),x(null),await D())},I=async()=>{if(!(!n||!t||!s||!l.trim())){y(!0);try{await B3(n,t.uid,s.username,s.avatarUrl,l),c(""),await D()}catch(V){console.error("Error adding reply:",V)}finally{y(!1)}}},R=async V=>{!n||!t||(C($=>{const F=new Set($);return F.has(V)?F.delete(V):F.add(V),F}),await K3(n,V,t.uid),await D())},N=async(V,$)=>{!n||!t||(await H3(n,V,t.uid,$),x(null),await D())},L=V=>{var $;return(($=QN.find(F=>F.id===V))==null?void 0:$.color)||"bg-gray-500"},M=V=>{var $;return(($=QN.find(F=>F.id===V))==null?void 0:$.name)||V};return d?u.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:u.jsxs("div",{className:"text-center space-y-4",children:[u.jsx("div",{className:"inline-block animate-spin rounded-full h-16 w-16 border-4 border-primary border-t-transparent"}),u.jsx("p",{className:"text-muted-foreground text-lg font-medium",children:"Loading post..."})]})}):f||!r?u.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:u.jsx(Oe,{className:"max-w-md w-full",children:u.jsxs(jt,{className:"pt-6 text-center space-y-4",children:[u.jsx("div",{className:"w-16 h-16 rounded-full bg-destructive/10 flex items-center justify-center mx-auto",children:u.jsx(cS,{className:"w-8 h-8 text-destructive"})}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-semibold text-lg mb-2",children:f?"Error Loading Post":"Post Not Found"}),u.jsx("p",{className:"text-muted-foreground text-sm",children:f||"This post may have been deleted or the link is incorrect."})]}),u.jsxs(ne,{onClick:()=>e("/forum"),className:"w-full",children:[u.jsx(iR,{className:"w-4 h-4 mr-2"}),"Back to Forum"]})]})})}):u.jsx("div",{className:"min-h-screen bg-background",children:u.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-5xl",children:[u.jsxs(ne,{variant:"ghost",onClick:()=>e("/forum"),className:"mb-6 hover:bg-accent transition-colors",children:[u.jsx(iR,{className:"w-4 h-4 mr-2"}),"Back to Forum"]}),u.jsxs(ls.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[u.jsx(Oe,{className:"mb-8 overflow-hidden border-2 shadow-lg",children:u.jsxs(jt,{className:"p-0",children:[u.jsx("div",{className:"bg-gradient-to-r from-primary/5 to-primary/10 p-6 border-b",children:u.jsxs("div",{className:"flex items-start gap-4",children:[u.jsxs(Ps,{className:"h-14 w-14 flex-shrink-0 cursor-pointer ring-2 ring-primary/20 transition-all hover:ring-primary/40",onClick:()=>e(`/profile/${r.username}`),children:[u.jsx(ks,{src:r.avatarUrl}),u.jsx(Ns,{className:"bg-primary/20 text-primary font-semibold",children:(G=r.username[0])==null?void 0:G.toUpperCase()})]}),u.jsxs("div",{className:"flex-1 min-w-0",children:[u.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[u.jsx(qt,{className:`${L(r.category)} text-white border-0 px-3 py-1`,children:M(r.category)}),u.jsxs("span",{className:"text-sm text-muted-foreground",children:["by"," ",u.jsx("span",{className:"font-semibold cursor-pointer hover:underline hover:text-primary transition-colors",onClick:()=>e(`/profile/${r.username}`),children:r.username})]}),u.jsx("span",{className:"text-sm text-muted-foreground",children:""}),u.jsx("span",{className:"text-sm text-muted-foreground",children:r.createdAt&&Wa(r.createdAt.toDate(),{addSuffix:!0})})]}),u.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2 text-foreground",children:r.title})]})]})}),u.jsxs("div",{className:"p-6",children:[u.jsx("p",{className:"text-foreground text-lg leading-relaxed whitespace-pre-wrap mb-6",children:r.content}),u.jsx(__,{className:"my-6"}),u.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground",children:[u.jsx(uS,{className:"w-4 h-4"}),u.jsx("span",{children:r.views||0})]}),u.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground",children:[u.jsx(li,{className:"w-4 h-4"}),u.jsx("span",{children:r.replies||0})]}),t&&u.jsxs(u.Fragment,{children:[u.jsx(ls.div,{whileTap:{scale:.95},children:u.jsxs(ne,{variant:E?"default":"outline",size:"sm",onClick:_,className:"gap-2",children:[u.jsx(cc,{className:`w-4 h-4 ${E?"fill-current":""}`}),r.likes||0]})}),u.jsxs("div",{className:"relative",children:[u.jsx(ne,{variant:"outline",size:"sm",onClick:V=>{V.stopPropagation(),x(v==="post"?null:"post")},className:"gap-2",children:"React"}),u.jsx(qN,{children:v==="post"&&u.jsx(ls.div,{initial:{opacity:0,scale:.9,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-10},transition:{duration:.2},className:"fixed md:absolute top-1/2 left-1/2 md:top-full md:left-0 -translate-x-1/2 -translate-y-1/2 md:translate-x-0 md:translate-y-0 md:mt-2 bg-popover border border-border rounded-xl p-3 shadow-2xl z-[9999] flex gap-2",onClick:V=>V.stopPropagation(),children:YN.map(V=>u.jsx(ls.button,{whileHover:{scale:1.3},whileTap:{scale:.9},onClick:$=>{$.stopPropagation(),S(V)},className:"text-2xl hover:bg-accent rounded-lg p-2 transition-colors",children:V},V))})})]})]}),r.reactions&&Object.keys(r.reactions).length>0&&u.jsx("div",{className:"flex items-center gap-2 ml-auto flex-wrap",children:Object.entries(r.reactions).map(([V,$])=>u.jsxs("span",{className:"text-sm bg-secondary/50 backdrop-blur px-3 py-1.5 rounded-full font-medium border border-border/50",children:[V," ",$.length]},V))})]})]})]})}),u.jsxs("div",{className:"mb-8",children:[u.jsx("div",{className:"flex items-center justify-between mb-6",children:u.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[u.jsx(li,{className:"w-6 h-6 text-primary"}),o.length," ",o.length===1?"Reply":"Replies"]})}),o.length===0?u.jsx(Oe,{className:"border-dashed",children:u.jsxs(jt,{className:"py-12 text-center",children:[u.jsx(li,{className:"w-12 h-12 text-muted-foreground/50 mx-auto mb-3"}),u.jsx("p",{className:"text-muted-foreground text-sm",children:"No replies yet. Be the first to share your thoughts!"})]})}):u.jsx("div",{className:"space-y-4",children:o.map((V,$)=>{var F;return u.jsx(ls.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:$*.05},children:u.jsx(Oe,{className:"hover:shadow-md transition-shadow border",children:u.jsx(jt,{className:"p-5",children:u.jsxs("div",{className:"flex gap-4",children:[u.jsxs(Ps,{className:"h-10 w-10 flex-shrink-0 cursor-pointer ring-2 ring-transparent hover:ring-primary/20 transition-all",onClick:()=>e(`/profile/${V.username}`),children:[u.jsx(ks,{src:V.avatarUrl}),u.jsx(Ns,{className:"bg-primary/10 text-primary font-medium",children:(F=V.username[0])==null?void 0:F.toUpperCase()})]}),u.jsxs("div",{className:"flex-1 min-w-0",children:[u.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[u.jsx("span",{className:"font-semibold cursor-pointer hover:underline hover:text-primary transition-colors",onClick:()=>e(`/profile/${V.username}`),children:V.username}),u.jsx("span",{className:"text-xs text-muted-foreground",children:V.createdAt&&Wa(V.createdAt.toDate(),{addSuffix:!0})})]}),u.jsx("p",{className:"text-foreground leading-relaxed whitespace-pre-wrap mb-3",children:V.content}),u.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[t&&u.jsxs(u.Fragment,{children:[u.jsx(ls.div,{whileTap:{scale:.95},children:u.jsxs(ne,{variant:b.has(V.id)?"default":"ghost",size:"sm",onClick:()=>R(V.id),className:"gap-1.5 h-8 text-xs",children:[u.jsx(wM,{className:`w-3.5 h-3.5 ${b.has(V.id)?"fill-current":""}`}),V.likes||0]})}),u.jsxs("div",{className:"relative",children:[u.jsx(ne,{variant:"ghost",size:"sm",onClick:j=>{j.stopPropagation(),x(v===V.id?null:V.id)},className:"h-8 text-xs",children:"React"}),u.jsx(qN,{children:v===V.id&&u.jsx(ls.div,{initial:{opacity:0,scale:.9,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-10},transition:{duration:.2},className:"fixed md:absolute top-1/2 left-1/2 md:top-full md:left-0 -translate-x-1/2 -translate-y-1/2 md:translate-x-0 md:translate-y-0 md:mt-2 bg-popover border border-border rounded-xl p-2 shadow-2xl z-[9999] flex gap-1",onClick:j=>j.stopPropagation(),children:YN.map(j=>u.jsx(ls.button,{whileHover:{scale:1.25},whileTap:{scale:.9},onClick:U=>{U.stopPropagation(),N(V.id,j)},className:"text-xl hover:bg-accent rounded-lg p-1.5 transition-colors",children:j},j))})})]})]}),V.reactions&&Object.keys(V.reactions).length>0&&u.jsx("div",{className:"flex items-center gap-1.5 ml-auto flex-wrap",children:Object.entries(V.reactions).map(([j,U])=>u.jsxs("span",{className:"text-xs bg-secondary/50 px-2 py-1 rounded-full font-medium",children:[j," ",U.length]},j))})]})]})]})})})},V.id)})})]}),t?u.jsx(ls.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.2},children:u.jsx(Oe,{className:"shadow-lg border-2",children:u.jsxs(jt,{className:"p-6",children:[u.jsxs("h3",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[u.jsx(cR,{className:"w-5 h-5 text-primary"}),"Add Your Reply"]}),u.jsx(Ii,{placeholder:"Share your thoughts...",value:l,onChange:V=>{const $=V.target.value;!$.includes("http://")&&!$.includes("https://")&&c($)},className:"mb-4 min-h-[140px] resize-none focus:ring-2 focus:ring-primary/20",maxLength:2e3}),u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("span",{className:"text-xs text-muted-foreground",children:[l.length,"/2000 characters"]}),u.jsx(ne,{onClick:I,disabled:p||!l.trim(),className:"gap-2",children:p?u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-background border-t-transparent"}),"Posting..."]}):u.jsxs(u.Fragment,{children:[u.jsx(cR,{className:"w-4 h-4"}),"Post Reply"]})})]})]})})}):u.jsx(Oe,{className:"shadow-lg border-2 border-dashed",children:u.jsxs(jt,{className:"py-12 text-center",children:[u.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4",children:u.jsx(li,{className:"w-8 h-8 text-primary"})}),u.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Join the Discussion"}),u.jsx("p",{className:"text-muted-foreground mb-6",children:"Sign in to reply to this post and engage with the community"}),u.jsx(ne,{onClick:()=>e("/auth/login"),size:"lg",className:"gap-2",children:"Sign In to Reply"})]})})]})]})})}function Zme(){var r,i,o;const[n,e]=T.useState(1),{data:t,isLoading:s}=Zn({queryKey:["/api/category/movie",n],queryFn:async()=>{const a=await fetch(`/api/category/movie?page=${n}`);if(!a.ok)throw new Error("Failed to fetch movies");return a.json()}});return u.jsxs("div",{className:"min-h-screen bg-background",children:[u.jsx(vm,{title:"Watch Latest Anime Movies Online Free in HD",description:"Watch anime movies online free in HD. Stream latest anime films, classic movies with English sub and dub. Updated daily with new anime movie releases.",keywords:"anime movies, watch anime movies, anime films, latest anime movies, popular anime movies, anime movie streaming, HD anime movies",url:"https://animebite.cc/movies"}),u.jsxs("div",{className:"container mx-auto px-4 md:px-6 lg:px-8 py-8",children:[u.jsxs("div",{className:"flex items-center justify-between mb-8",children:[u.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-foreground flex items-center gap-3",children:[u.jsx(Nr,{className:"w-8 h-8 text-primary"}),u.jsxs("span",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"text-primary",children:"|"})," Anime Movies"]})]}),((r=t==null?void 0:t.data)==null?void 0:r.currentPage)&&((i=t==null?void 0:t.data)==null?void 0:i.totalPages)&&u.jsxs("p",{className:"text-sm text-muted-foreground",children:["Page ",t.data.currentPage," of ",t.data.totalPages]})]}),s?u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 2xl:grid-cols-7 gap-4",children:Array.from({length:21}).map((a,l)=>u.jsx(sv,{},l))}):(o=t==null?void 0:t.data)!=null&&o.animes&&t.data.animes.length>0?u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 2xl:grid-cols-7 gap-4 mb-8",children:t.data.animes.map(a=>u.jsx(no,{...a},a.id))}),u.jsxs("div",{className:"flex justify-center items-center gap-4 mt-8",children:[u.jsxs(ne,{variant:"secondary",disabled:n===1,onClick:()=>e(a=>Math.max(1,a-1)),className:"rounded-lg",children:[u.jsx(uo,{className:"w-4 h-4 mr-1"}),"Previous"]}),u.jsx("div",{className:"flex items-center gap-2 px-4 py-2 bg-accent rounded-lg",children:u.jsxs("span",{className:"text-sm font-medium text-foreground",children:[n," ",t.data.totalPages&&`/ ${t.data.totalPages}`]})}),u.jsxs(ne,{variant:"secondary",disabled:!t.data.hasNextPage,onClick:()=>e(a=>a+1),className:"rounded-lg",children:["Next",u.jsx(cs,{className:"w-4 h-4 ml-1"})]})]})]}):u.jsx("div",{className:"text-center py-12",children:u.jsx("p",{className:"text-muted-foreground",children:"No movies found"})})]})]})}function epe(){var r,i,o;const[n,e]=T.useState(1),{data:t,isLoading:s}=Zn({queryKey:["/api/category/tv",n],queryFn:async()=>{const a=await fetch(`/api/category/tv?page=${n}`);if(!a.ok)throw new Error("Failed to fetch TV series");return a.json()}});return u.jsx("div",{className:"min-h-screen bg-background",children:u.jsxs("div",{className:"container mx-auto px-4 md:px-6 lg:px-8 py-8",children:[u.jsxs("div",{className:"flex items-center justify-between mb-8",children:[u.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-foreground flex items-center gap-3",children:[u.jsx(Xg,{className:"w-8 h-8 text-primary"}),u.jsxs("span",{className:"flex items-center gap-2",children:[u.jsx("span",{className:"text-primary",children:"|"})," TV Series"]})]}),((r=t==null?void 0:t.data)==null?void 0:r.currentPage)&&((i=t==null?void 0:t.data)==null?void 0:i.totalPages)&&u.jsxs("p",{className:"text-sm text-muted-foreground",children:["Page ",t.data.currentPage," of ",t.data.totalPages]})]}),s?u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 2xl:grid-cols-7 gap-4",children:Array.from({length:21}).map((a,l)=>u.jsx(rn,{className:"aspect-[2/3] rounded-xl"},l))}):(o=t==null?void 0:t.data)!=null&&o.animes&&t.data.animes.length>0?u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 2xl:grid-cols-7 gap-4 mb-8",children:t.data.animes.map(a=>u.jsx(no,{...a},a.id))}),u.jsxs("div",{className:"flex justify-center items-center gap-4 mt-8",children:[u.jsxs(ne,{variant:"secondary",disabled:n===1,onClick:()=>e(a=>Math.max(1,a-1)),className:"rounded-lg",children:[u.jsx(uo,{className:"w-4 h-4 mr-1"}),"Previous"]}),u.jsx("div",{className:"flex items-center gap-2 px-4 py-2 bg-accent rounded-lg",children:u.jsxs("span",{className:"text-sm font-medium text-foreground",children:[n," ",t.data.totalPages&&`/ ${t.data.totalPages}`]})}),u.jsxs(ne,{variant:"secondary",disabled:!t.data.hasNextPage,onClick:()=>e(a=>a+1),className:"rounded-lg",children:["Next",u.jsx(cs,{className:"w-4 h-4 ml-1"})]})]})]}):u.jsx("div",{className:"text-center py-12",children:u.jsx("p",{className:"text-muted-foreground",children:"No TV series found"})})]})})}function tpe(){const[n,e]=T.useState({name:"",email:"",subject:"",message:""}),t=s=>{s.preventDefault(),console.log("Form submitted:",n)};return u.jsx("div",{className:"min-h-screen bg-background py-12",children:u.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[u.jsxs("div",{className:"text-center mb-12",children:[u.jsx("h1",{className:"text-4xl font-bold text-white mb-4",children:"Contact Us"}),u.jsx("p",{className:"text-gray-400",children:"Have questions or feedback? We'd love to hear from you."})]}),u.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-12",children:[u.jsxs(Oe,{className:"bg-black/40 backdrop-blur-xl border-purple-500/20 p-6 text-center",children:[u.jsx("div",{className:"w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center mx-auto mb-4",children:u.jsx(uK,{className:"w-6 h-6 text-purple-400"})}),u.jsx("h3",{className:"text-white font-semibold mb-2",children:"Email"}),u.jsx("p",{className:"text-gray-400 text-sm",children:"support@animebite.com"})]}),u.jsxs(Oe,{className:"bg-black/40 backdrop-blur-xl border-purple-500/20 p-6 text-center",children:[u.jsx("div",{className:"w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center mx-auto mb-4",children:u.jsx(li,{className:"w-6 h-6 text-purple-400"})}),u.jsx("h3",{className:"text-white font-semibold mb-2",children:"Discord"}),u.jsx("p",{className:"text-gray-400 text-sm",children:"Join our community"})]}),u.jsxs(Oe,{className:"bg-black/40 backdrop-blur-xl border-purple-500/20 p-6 text-center",children:[u.jsx("div",{className:"w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center mx-auto mb-4",children:u.jsx(iK,{className:"w-6 h-6 text-purple-400"})}),u.jsx("h3",{className:"text-white font-semibold mb-2",children:"GitHub"}),u.jsx("p",{className:"text-gray-400 text-sm",children:"Report issues"})]})]}),u.jsx(Oe,{className:"bg-black/40 backdrop-blur-xl border-purple-500/20 p-8",children:u.jsxs("form",{onSubmit:t,className:"space-y-6",children:[u.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Name"}),u.jsx(bn,{value:n.name,onChange:s=>e({...n,name:s.target.value}),placeholder:"Your name",className:"bg-white/5 border-purple-500/20 text-white"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Email"}),u.jsx(bn,{type:"email",value:n.email,onChange:s=>e({...n,email:s.target.value}),placeholder:"your@email.com",className:"bg-white/5 border-purple-500/20 text-white"})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Subject"}),u.jsx(bn,{value:n.subject,onChange:s=>e({...n,subject:s.target.value}),placeholder:"How can we help?",className:"bg-white/5 border-purple-500/20 text-white"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Message"}),u.jsx(Ii,{value:n.message,onChange:s=>e({...n,message:s.target.value}),placeholder:"Tell us more...",rows:6,className:"bg-white/5 border-purple-500/20 text-white"})]}),u.jsx(ne,{type:"submit",className:"w-full bg-gradient-to-r from-purple-600 to-purple-800 hover:from-purple-700 hover:to-purple-900",children:"Send Message"})]})})]})})}function npe(){const[n,e]=T.useState({type:"",title:"Report",description:"report bugs or issues",url:""}),t=s=>{s.preventDefault(),console.log("Issue reported:",n)};return u.jsx("div",{className:"min-h-screen bg-background py-12",children:u.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[u.jsxs("div",{className:"text-center mb-12",children:[u.jsx("h1",{className:"text-4xl font-bold text-white mb-4",children:"Report an Issue"}),u.jsx("p",{className:"text-gray-400",children:"Help us improve by reporting bugs or issues you encounter."})]}),u.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-8",children:[u.jsxs(Oe,{className:"bg-black/40 backdrop-blur-xl border-purple-500/20 p-6 text-center",children:[u.jsx(XG,{className:"w-8 h-8 text-purple-400 mx-auto mb-3"}),u.jsx("h3",{className:"text-white font-semibold mb-2",children:"Bug Report"}),u.jsx("p",{className:"text-gray-400 text-sm",children:"Something not working?"})]}),u.jsxs(Oe,{className:"bg-black/40 backdrop-blur-xl border-purple-500/20 p-6 text-center",children:[u.jsx(cS,{className:"w-8 h-8 text-purple-400 mx-auto mb-3"}),u.jsx("h3",{className:"text-white font-semibold mb-2",children:"Playback Issues"}),u.jsx("p",{className:"text-gray-400 text-sm",children:"Video not loading?"})]}),u.jsxs(Oe,{className:"bg-black/40 backdrop-blur-xl border-purple-500/20 p-6 text-center",children:[u.jsx(sK,{className:"w-8 h-8 text-purple-400 mx-auto mb-3"}),u.jsx("h3",{className:"text-white font-semibold mb-2",children:"Content Issues"}),u.jsx("p",{className:"text-gray-400 text-sm",children:"Wrong info or missing?"})]})]}),u.jsx(Oe,{className:"bg-black/40 backdrop-blur-xl border-purple-500/20 p-8",children:u.jsxs("form",{onSubmit:t,className:"space-y-6",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Issue Type"}),u.jsxs("select",{value:n.type,onChange:s=>e({...n,type:s.target.value}),className:"w-full px-3 py-2 bg-white/5 border border-purple-500/20 rounded-lg text-white",children:[u.jsx("option",{value:"",children:"Select type..."}),u.jsx("option",{value:"bug",children:"Bug Report"}),u.jsx("option",{value:"playback",children:"Playback Issue"}),u.jsx("option",{value:"content",children:"Content Issue"}),u.jsx("option",{value:"other",children:"Other"})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Title"}),u.jsx(bn,{value:n.title,onChange:s=>e({...n,title:s.target.value}),placeholder:"Brief description of the issue",className:"bg-white/5 border-purple-500/20 text-white"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Page URL (if applicable)"}),u.jsx(bn,{value:n.url,onChange:s=>e({...n,url:s.target.value}),placeholder:"https://...",className:"bg-white/5 border-purple-500/20 text-white"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Description"}),u.jsx(Ii,{value:n.description,onChange:s=>e({...n,description:s.target.value}),placeholder:"Please describe the issue in detail...",rows:6,className:"bg-white/5 border-purple-500/20 text-white"})]}),u.jsx(ne,{type:"submit",className:"w-full bg-gradient-to-r from-purple-600 to-purple-800 hover:from-purple-700 hover:to-purple-900",children:"Submit Report"})]})})]})})}var Ro="Accordion",spe=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[oA,rpe,ipe]=vd(Ro),[vv,Ype]=Ds(Ro,[ipe,t$]),aA=t$(),HB=vt.forwardRef((n,e)=>{const{type:t,...s}=n,r=s,i=s;return u.jsx(oA.Provider,{scope:n.__scopeAccordion,children:t==="multiple"?u.jsx(cpe,{...i,ref:e}):u.jsx(lpe,{...r,ref:e})})});HB.displayName=Ro;var[WB,ope]=vv(Ro),[zB,ape]=vv(Ro,{collapsible:!1}),lpe=vt.forwardRef((n,e)=>{const{value:t,defaultValue:s,onValueChange:r=()=>{},collapsible:i=!1,...o}=n,[a,l]=Br({prop:t,defaultProp:s,onChange:r});return u.jsx(WB,{scope:n.__scopeAccordion,value:a?[a]:[],onItemOpen:l,onItemClose:vt.useCallback(()=>i&&l(""),[i,l]),children:u.jsx(zB,{scope:n.__scopeAccordion,collapsible:i,children:u.jsx(qB,{...o,ref:e})})})}),cpe=vt.forwardRef((n,e)=>{const{value:t,defaultValue:s,onValueChange:r=()=>{},...i}=n,[o=[],a]=Br({prop:t,defaultProp:s,onChange:r}),l=vt.useCallback(d=>a((h=[])=>[...h,d]),[a]),c=vt.useCallback(d=>a((h=[])=>h.filter(f=>f!==d)),[a]);return u.jsx(WB,{scope:n.__scopeAccordion,value:o,onItemOpen:l,onItemClose:c,children:u.jsx(zB,{scope:n.__scopeAccordion,collapsible:!0,children:u.jsx(qB,{...i,ref:e})})})}),[upe,xv]=vv(Ro),qB=vt.forwardRef((n,e)=>{const{__scopeAccordion:t,disabled:s,dir:r,orientation:i="vertical",...o}=n,a=vt.useRef(null),l=ze(a,e),c=rpe(t),h=Nd(r)==="ltr",f=ie(n.onKeyDown,m=>{var S;if(!spe.includes(m.key))return;const p=m.target,y=c().filter(I=>{var R;return!((R=I.ref.current)!=null&&R.disabled)}),v=y.findIndex(I=>I.ref.current===p),x=y.length;if(v===-1)return;m.preventDefault();let E=v;const w=0,b=x-1,C=()=>{E=v+1,E>b&&(E=w)},D=()=>{E=v-1,E<w&&(E=b)};switch(m.key){case"Home":E=w;break;case"End":E=b;break;case"ArrowRight":i==="horizontal"&&(h?C():D());break;case"ArrowDown":i==="vertical"&&C();break;case"ArrowLeft":i==="horizontal"&&(h?D():C());break;case"ArrowUp":i==="vertical"&&D();break}const _=E%x;(S=y[_].ref.current)==null||S.focus()});return u.jsx(upe,{scope:t,disabled:s,direction:r,orientation:i,children:u.jsx(oA.Slot,{scope:t,children:u.jsx(Se.div,{...o,"data-orientation":i,ref:l,onKeyDown:s?void 0:f})})})}),z0="AccordionItem",[dpe,lA]=vv(z0),YB=vt.forwardRef((n,e)=>{const{__scopeAccordion:t,value:s,...r}=n,i=xv(z0,t),o=ope(z0,t),a=aA(t),l=mr(),c=s&&o.value.includes(s)||!1,d=i.disabled||n.disabled;return u.jsx(dpe,{scope:t,open:c,disabled:d,triggerId:l,children:u.jsx(i$,{"data-orientation":i.orientation,"data-state":t6(c),...a,...r,ref:e,disabled:d,open:c,onOpenChange:h=>{h?o.onItemOpen(s):o.onItemClose(s)}})})});YB.displayName=z0;var QB="AccordionHeader",XB=vt.forwardRef((n,e)=>{const{__scopeAccordion:t,...s}=n,r=xv(Ro,t),i=lA(QB,t);return u.jsx(Se.h3,{"data-orientation":r.orientation,"data-state":t6(i.open),"data-disabled":i.disabled?"":void 0,...s,ref:e})});XB.displayName=QB;var eb="AccordionTrigger",JB=vt.forwardRef((n,e)=>{const{__scopeAccordion:t,...s}=n,r=xv(Ro,t),i=lA(eb,t),o=ape(eb,t),a=aA(t);return u.jsx(oA.ItemSlot,{scope:t,children:u.jsx(hce,{"aria-disabled":i.open&&!o.collapsible||void 0,"data-orientation":r.orientation,id:i.triggerId,...a,...s,ref:e})})});JB.displayName=eb;var ZB="AccordionContent",e6=vt.forwardRef((n,e)=>{const{__scopeAccordion:t,...s}=n,r=xv(Ro,t),i=lA(ZB,t),o=aA(t);return u.jsx(fce,{role:"region","aria-labelledby":i.triggerId,"data-orientation":r.orientation,...o,...s,ref:e,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...n.style}})});e6.displayName=ZB;function t6(n){return n?"open":"closed"}var hpe=HB,fpe=YB,mpe=XB,n6=JB,s6=e6;const ppe=hpe,Vi=T.forwardRef(({className:n,...e},t)=>u.jsx(fpe,{ref:t,className:Ae("border-b",n),...e}));Vi.displayName="AccordionItem";const $i=T.forwardRef(({className:n,children:e,...t},s)=>u.jsx(mpe,{className:"flex",children:u.jsxs(n6,{ref:s,className:Ae("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",n),...t,children:[e,u.jsx(lS,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));$i.displayName=n6.displayName;const Bi=T.forwardRef(({className:n,children:e,...t},s)=>u.jsx(s6,{ref:s,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...t,children:u.jsx("div",{className:Ae("pb-4 pt-0",n),children:e})}));Bi.displayName=s6.displayName;function gpe(){return u.jsx("div",{className:"min-h-screen bg-background py-12",children:u.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[u.jsxs("div",{className:"text-center mb-12",children:[u.jsx("h1",{className:"text-4xl font-bold text-white mb-4",children:"Frequently Asked Questions"}),u.jsx("p",{className:"text-gray-400",children:"Find answers to common questions about AnimeBite."})]}),u.jsx(Oe,{className:"bg-black/40 backdrop-blur-xl border-purple-500/20 p-8",children:u.jsxs(ppe,{type:"single",collapsible:!0,className:"space-y-4",children:[u.jsxs(Vi,{value:"item-1",className:"border-purple-500/20",children:[u.jsx($i,{className:"text-white hover:text-purple-400",children:"Is AnimeBite free to use?"}),u.jsx(Bi,{className:"text-gray-400",children:"Yes, AnimeBite is completely free to use. You can watch anime without any subscription fees."})]}),u.jsxs(Vi,{value:"item-2",className:"border-purple-500/20",children:[u.jsx($i,{className:"text-white hover:text-purple-400",children:"Do I need to create an account?"}),u.jsx(Bi,{className:"text-gray-400",children:"While you can browse and watch anime without an account, creating one allows you to save your watchlist, track progress, and participate in discussions."})]}),u.jsxs(Vi,{value:"item-3",className:"border-purple-500/20",children:[u.jsx($i,{className:"text-white hover:text-purple-400",children:"Why is a video not loading?"}),u.jsx(Bi,{className:"text-gray-400",children:"Try switching to a different server from the server selection menu. If the issue persists, please report it using our Report Issue page."})]}),u.jsxs(Vi,{value:"item-4",className:"border-purple-500/20",children:[u.jsx($i,{className:"text-white hover:text-purple-400",children:"How often is new content added?"}),u.jsx(Bi,{className:"text-gray-400",children:"New episodes are typically added shortly after they air in Japan. We update our library regularly to bring you the latest anime."})]}),u.jsxs(Vi,{value:"item-5",className:"border-purple-500/20",children:[u.jsx($i,{className:"text-white hover:text-purple-400",children:"Can I download episodes?"}),u.jsx(Bi,{className:"text-gray-400",children:"Currently, download functionality is not available. All content is streamed online."})]}),u.jsxs(Vi,{value:"item-6",className:"border-purple-500/20",children:[u.jsx($i,{className:"text-white hover:text-purple-400",children:"What quality options are available?"}),u.jsx(Bi,{className:"text-gray-400",children:"Most anime are available in multiple qualities including 1080p, 720p, and 480p. Quality depends on the source and your selected server."})]}),u.jsxs(Vi,{value:"item-7",className:"border-purple-500/20",children:[u.jsx($i,{className:"text-white hover:text-purple-400",children:"How do I request an anime?"}),u.jsx(Bi,{className:"text-gray-400",children:"You can use our Contact Us page to submit anime requests. We'll do our best to add them to our library."})]}),u.jsxs(Vi,{value:"item-8",className:"border-purple-500/20",children:[u.jsx($i,{className:"text-white hover:text-purple-400",children:"Are subtitles available?"}),u.jsx(Bi,{className:"text-gray-400",children:"Yes, most anime have English subtitles. Some also have dub versions available. You can also upload your own subtitle files."})]})]})})]})})}function ype(){return u.jsx("div",{className:"min-h-screen bg-background py-12",children:u.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[u.jsxs("div",{className:"text-center mb-12",children:[u.jsx("h1",{className:"text-4xl font-bold text-white mb-4",children:"Terms of Service"}),u.jsxs("p",{className:"text-gray-400",children:["Last updated: ",new Date().toLocaleDateString()]})]}),u.jsx(Oe,{className:"bg-black/40 backdrop-blur-xl border-purple-500/20 p-8",children:u.jsxs("div",{className:"prose prose-invert max-w-none",children:[u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"1. Acceptance of Terms"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"By accessing and using AnimeBite, you accept and agree to be bound by the terms and provision of this agreement."})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"2. Use License"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"Permission is granted to temporarily access the materials (information or software) on AnimeBite for personal, non-commercial transitory viewing only."}),u.jsx("p",{className:"text-gray-400 mb-4",children:"This license shall not allow you to:"}),u.jsxs("ul",{className:"list-disc list-inside text-gray-400 space-y-2 ml-4",children:[u.jsx("li",{children:"Modify or copy the materials"}),u.jsx("li",{children:"Use the materials for any commercial purpose"}),u.jsx("li",{children:"Attempt to decompile or reverse engineer any software"}),u.jsx("li",{children:"Remove any copyright or proprietary notations"})]})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"3. User Accounts"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"When you create an account, you must provide accurate and complete information. You are responsible for maintaining the security of your account."})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"4. Content"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"AnimeBite does not host any files on its servers. All content is provided by third-party services. We are not responsible for the content provided by these services."})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"5. Prohibited Uses"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"You may not use the site:"}),u.jsxs("ul",{className:"list-disc list-inside text-gray-400 space-y-2 ml-4",children:[u.jsx("li",{children:"In any way that violates any applicable law or regulation"}),u.jsx("li",{children:"To transmit any malicious code or harmful data"}),u.jsx("li",{children:"To impersonate another person or entity"}),u.jsx("li",{children:"To harass, abuse, or harm another person"})]})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"6. Limitation of Liability"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"AnimeBite shall not be held liable for any damages arising from the use or inability to use the materials on this site."})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"7. Changes to Terms"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"We reserve the right to modify these terms at any time. Continued use of the site constitutes acceptance of modified terms."})]})]})})]})})}function vpe(){return u.jsx("div",{className:"min-h-screen bg-background py-12",children:u.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[u.jsxs("div",{className:"text-center mb-12",children:[u.jsx("h1",{className:"text-4xl font-bold text-white mb-4",children:"Privacy Policy"}),u.jsxs("p",{className:"text-gray-400",children:["Last updated: ",new Date().toLocaleDateString()]})]}),u.jsx(Oe,{className:"bg-black/40 backdrop-blur-xl border-purple-500/20 p-8",children:u.jsxs("div",{className:"prose prose-invert max-w-none",children:[u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"1. Information We Collect"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"We collect information you provide directly to us when you create an account, including:"}),u.jsxs("ul",{className:"list-disc list-inside text-gray-400 space-y-2 ml-4",children:[u.jsx("li",{children:"Email address and username"}),u.jsx("li",{children:"Profile information"}),u.jsx("li",{children:"Watch history and preferences"}),u.jsx("li",{children:"Comments and forum posts"})]})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"2. How We Use Your Information"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"We use the information we collect to:"}),u.jsxs("ul",{className:"list-disc list-inside text-gray-400 space-y-2 ml-4",children:[u.jsx("li",{children:"Provide and maintain our services"}),u.jsx("li",{children:"Personalize your experience"}),u.jsx("li",{children:"Track your watch progress"}),u.jsx("li",{children:"Communicate with you about updates"}),u.jsx("li",{children:"Improve our services"})]})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"3. Cookies and Tracking"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"We use cookies and similar tracking technologies to track activity on our service and hold certain information to improve user experience."})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"4. Data Storage"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"Your data is stored securely using Firebase services. We implement appropriate security measures to protect your personal information."})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"5. Third-Party Services"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"We use third-party services for video streaming. These services may have their own privacy policies governing the use of information."})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"6. Your Rights"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"You have the right to:"}),u.jsxs("ul",{className:"list-disc list-inside text-gray-400 space-y-2 ml-4",children:[u.jsx("li",{children:"Access your personal data"}),u.jsx("li",{children:"Correct inaccurate data"}),u.jsx("li",{children:"Request deletion of your data"}),u.jsx("li",{children:"Export your data"})]})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"7. Children's Privacy"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"Our service is not directed to children under 13. We do not knowingly collect personal information from children under 13."})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"8. Changes to Privacy Policy"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"We may update our Privacy Policy from time to time. We will notify you of any changes by posting the new Privacy Policy on this page."})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"9. Contact Us"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"If you have any questions about this Privacy Policy, please contact us through our Contact page."})]})]})})]})})}function xpe(){return u.jsx("div",{className:"min-h-screen bg-background py-12",children:u.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[u.jsxs("div",{className:"text-center mb-12",children:[u.jsx("h1",{className:"text-4xl font-bold text-white mb-4",children:"DMCA Policy"}),u.jsx("p",{className:"text-gray-400",children:"Digital Millennium Copyright Act Notice"})]}),u.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4 mb-8 flex gap-3",children:[u.jsx(cS,{className:"w-5 h-5 text-yellow-500 flex-shrink-0 mt-0.5"}),u.jsx("p",{className:"text-yellow-200 text-sm",children:"AnimeBite respects the intellectual property rights of others and expects users to do the same."})]}),u.jsx(Oe,{className:"bg-black/40 backdrop-blur-xl border-purple-500/20 p-8",children:u.jsxs("div",{className:"prose prose-invert max-w-none",children:[u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Notice of Infringement"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"AnimeBite does not host any content on our servers. All video content is embedded from third-party sources. We act as a search engine and indexing service."})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Filing a DMCA Notice"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"If you believe that content available on our site infringes your copyright, please provide us with the following information:"}),u.jsxs("ul",{className:"list-disc list-inside text-gray-400 space-y-2 ml-4",children:[u.jsx("li",{children:"A physical or electronic signature of the copyright owner"}),u.jsx("li",{children:"Identification of the copyrighted work claimed to have been infringed"}),u.jsx("li",{children:"Identification of the material claimed to be infringing"}),u.jsx("li",{children:"Your contact information (address, telephone, email)"}),u.jsx("li",{children:"A statement of good faith belief that use is not authorized"}),u.jsx("li",{children:"A statement of accuracy under penalty of perjury"})]})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"How to Submit"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"DMCA notices should be sent to:"}),u.jsx("div",{className:"bg-white/5 border border-purple-500/20 rounded-lg p-4 mt-4",children:u.jsx("p",{className:"text-white font-mono text-sm",children:"Email: dmca@animebite.com"})})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Counter-Notice"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"If you believe that material you posted was removed by mistake or misidentification, you may file a counter-notice."})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Repeat Infringers"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"We will terminate the accounts of users who are repeat infringers of copyrights."})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Third-Party Content"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"Since we do not host content, removing links from our site does not remove the content from the internet. Copyright holders should also contact the actual content hosts."})]})]})})]})})}function Epe(){return u.jsx("div",{className:"min-h-screen bg-background py-12",children:u.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[u.jsxs("div",{className:"text-center mb-12",children:[u.jsx("h1",{className:"text-4xl font-bold text-white mb-4",children:"Disclaimer"}),u.jsx("p",{className:"text-gray-400",children:"Important information about our service"})]}),u.jsxs("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-4 mb-8 flex gap-3",children:[u.jsx(SK,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),u.jsx("p",{className:"text-red-200 text-sm",children:"Please read this disclaimer carefully before using AnimeBite."})]}),u.jsx(Oe,{className:"bg-black/40 backdrop-blur-xl border-purple-500/20 p-8",children:u.jsxs("div",{className:"prose prose-invert max-w-none",children:[u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"1. Content Hosting"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"AnimeBite does not host, upload, or store any video files on our servers. All content is embedded from third-party sources available publicly on the internet."})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"2. Copyright"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"We respect copyright and intellectual property rights. All trademarks, logos, and brand names are the property of their respective owners. All company, product, and service names used in this website are for identification purposes only."})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"3. Third-Party Links"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"AnimeBite contains links to third-party websites and services. We have no control over the content, privacy policies, or practices of these third-party sites and accept no responsibility for them."})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"4. Availability"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"We do not guarantee that our service will be available at all times. Content availability depends on third-party sources and may change without notice."})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"5. Accuracy of Information"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"While we strive to provide accurate information, we make no warranties about the completeness, reliability, or accuracy of the information on our site."})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"6. Use at Your Own Risk"}),u.jsx("p",{className:"text-gray-400 mb-4",children:'Your use of AnimeBite is at your sole risk. The service is provided "as is" and "as available" without any warranties of any kind.'})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"7. Limitation of Liability"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"AnimeBite and its operators shall not be liable for any indirect, incidental, special, consequential, or punitive damages resulting from your use or inability to use the service."})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"8. Legal Compliance"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"Users are responsible for ensuring their use of our service complies with all applicable laws and regulations in their jurisdiction."})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"9. Age Restriction"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"Some content may not be suitable for all audiences. Parental discretion is advised. Users under 13 should not use our service."})]})]})})]})})}function wpe(){return u.jsx("div",{className:"min-h-screen bg-background py-12",children:u.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[u.jsxs("div",{className:"text-center mb-12",children:[u.jsx("h1",{className:"text-4xl font-bold text-white mb-4",children:"About AnimeBite"}),u.jsx("p",{className:"text-gray-400 text-lg",children:"Your ultimate destination for streaming anime"})]}),u.jsx(Oe,{className:"bg-black/40 backdrop-blur-xl border-purple-500/20 p-8 mb-8",children:u.jsxs("div",{className:"prose prose-invert max-w-none",children:[u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Our Mission"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"AnimeBite was created with a simple mission: to provide anime fans with a seamless, high-quality streaming experience. We believe that everyone should have access to their favorite anime, anytime, anywhere."})]}),u.jsxs("section",{className:"mb-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"What We Offer"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"We aggregate anime content from various sources to provide you with the most comprehensive anime library. Our platform features:"}),u.jsxs("ul",{className:"list-disc list-inside text-gray-400 space-y-2 ml-4",children:[u.jsx("li",{children:"Thousands of anime titles with both sub and dub options"}),u.jsx("li",{children:"HD quality streaming"}),u.jsx("li",{children:"Multiple server options for reliable playback"}),u.jsx("li",{children:"User-friendly interface with advanced features"}),u.jsx("li",{children:"Active community forums and discussions"}),u.jsx("li",{children:"Personalized watchlists and progress tracking"})]})]})]})}),u.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[u.jsxs(Oe,{className:"bg-black/40 backdrop-blur-xl border-purple-500/20 p-6",children:[u.jsx("div",{className:"w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center mb-4",children:u.jsx(cc,{className:"w-6 h-6 text-purple-400"})}),u.jsx("h3",{className:"text-white font-semibold mb-2 text-lg",children:"Built for Fans"}),u.jsx("p",{className:"text-gray-400 text-sm",children:"Created by anime enthusiasts, for anime enthusiasts. We understand what you need."})]}),u.jsxs(Oe,{className:"bg-black/40 backdrop-blur-xl border-purple-500/20 p-6",children:[u.jsx("div",{className:"w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center mb-4",children:u.jsx(RK,{className:"w-6 h-6 text-purple-400"})}),u.jsx("h3",{className:"text-white font-semibold mb-2 text-lg",children:"Fast & Reliable"}),u.jsx("p",{className:"text-gray-400 text-sm",children:"Optimized for speed with multiple servers to ensure smooth streaming."})]}),u.jsxs(Oe,{className:"bg-black/40 backdrop-blur-xl border-purple-500/20 p-6",children:[u.jsx("div",{className:"w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center mb-4",children:u.jsx(Aw,{className:"w-6 h-6 text-purple-400"})}),u.jsx("h3",{className:"text-white font-semibold mb-2 text-lg",children:"Community Driven"}),u.jsx("p",{className:"text-gray-400 text-sm",children:"Join discussions, share reviews, and connect with fellow anime fans."})]}),u.jsxs(Oe,{className:"bg-black/40 backdrop-blur-xl border-purple-500/20 p-6",children:[u.jsx("div",{className:"w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center mb-4",children:u.jsx(EK,{className:"w-6 h-6 text-purple-400"})}),u.jsx("h3",{className:"text-white font-semibold mb-2 text-lg",children:"Always Improving"}),u.jsx("p",{className:"text-gray-400 text-sm",children:"We continuously update and improve our platform based on user feedback."})]})]}),u.jsxs(Oe,{className:"bg-black/40 backdrop-blur-xl border-purple-500/20 p-8",children:[u.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Contact & Support"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"Have questions, suggestions, or need help? We're here for you:"}),u.jsxs("ul",{className:"list-none text-gray-400 space-y-2",children:[u.jsx("li",{children:" Visit our FAQ page for quick answers"}),u.jsx("li",{children:" Use the Contact Us form to reach our team"}),u.jsx("li",{children:" Join our Discord community for real-time support"}),u.jsx("li",{children:" Report issues through our Report Issue page"})]})]})]})})}function Tpe(){return u.jsxs("div",{className:"container mx-auto px-4 py-16 flex flex-col items-center justify-center min-h-[60vh] text-center space-y-6",children:[u.jsx("h1",{className:"text-6xl font-bold",children:"404"}),u.jsx("h2",{className:"text-2xl font-semibold",children:"Page Not Found"}),u.jsx("p",{className:"text-muted-foreground max-w-md",children:"The page you're looking for doesn't exist or has been moved."}),u.jsx(be,{href:"/",children:u.jsxs(ne,{className:"gap-2",children:[u.jsx(Sw,{className:"w-4 h-4"}),"Back to Home"]})})]})}function bpe(){return u.jsxs(d8,{children:[u.jsx(It,{path:"/",component:kse}),u.jsx(It,{path:"/anime/:id",component:Use}),u.jsx(It,{path:"/watch/:id",component:lce}),u.jsx(It,{path:"/search",component:gce}),u.jsx(It,{path:"/category/:category",component:Nk}),u.jsx(It,{path:"/genre/:category",component:Nk}),u.jsx(It,{path:"/azlist",component:vce}),u.jsx(It,{path:"/auth/login",component:Pce}),u.jsx(It,{path:"/auth/signup",component:kce}),u.jsx(It,{path:"/auth/reset",component:Nce}),u.jsx(It,{path:"/profile/:username?",component:Qce}),u.jsx(It,{path:"/forum",component:Jme}),u.jsx(It,{path:"/forum/post/:id",component:XN}),u.jsx(It,{path:"/forum/:id",component:XN}),u.jsx(It,{path:"/movies",component:Zme}),u.jsx(It,{path:"/tv-series",component:epe}),u.jsx(It,{path:"/contact",component:tpe}),u.jsx(It,{path:"/report-issue",component:npe}),u.jsx(It,{path:"/faq",component:gpe}),u.jsx(It,{path:"/terms",component:ype}),u.jsx(It,{path:"/privacy",component:vpe}),u.jsx(It,{path:"/dmca",component:xpe}),u.jsx(It,{path:"/disclaimer",component:Epe}),u.jsx(It,{path:"/about",component:wpe}),u.jsx(It,{component:Tpe})]})}function Spe(){const[n]=Ls(),[e,t]=T.useState(void 0),{data:s}=Zn({queryKey:["/api/home"],enabled:n==="/"});return T.useEffect(()=>{var r,i;n==="/"&&((i=(r=s==null?void 0:s.data)==null?void 0:r.spotlightAnimes)!=null&&i[0])?t(s.data.spotlightAnimes[0].poster):t(void 0)},[n,s]),T.useEffect(()=>{const r=window.self!==window.top,i=/FB|FBAN|Instagram|Twitter|WhatsApp|Telegram|Discord|Reddit/i.test(navigator.userAgent),o=window.location.hostname.includes("replit");if(r||i||o)return;const a=h=>{const f=h.target;f.closest('iframe[src*="twitter.com"]')||f.closest('iframe[src*="facebook.com"]')||f.closest('iframe[src*="telegram.org"]')||f.closest('iframe[src*="whatsapp.com"]')||f.closest('iframe[src*="discord.com"]')||f.closest('iframe[src*="reddit.com"]')||f.closest('iframe[src*="x.com"]')||h.preventDefault()},l=h=>{const f=h.target;f.closest('iframe[src*="twitter.com"]')||f.closest('iframe[src*="facebook.com"]')||f.closest('iframe[src*="telegram.org"]')||f.closest('iframe[src*="whatsapp.com"]')||f.closest('iframe[src*="discord.com"]')||f.closest('iframe[src*="reddit.com"]')||f.closest('iframe[src*="x.com"]')||h.preventDefault()},c=h=>{const f=h.target;f.closest('iframe[src*="twitter.com"]')||f.closest('iframe[src*="facebook.com"]')||f.closest('iframe[src*="telegram.org"]')||f.closest('iframe[src*="whatsapp.com"]')||f.closest('iframe[src*="discord.com"]')||f.closest('iframe[src*="reddit.com"]')||f.closest('iframe[src*="x.com"]')||((h.ctrlKey||h.metaKey)&&(h.key==="c"||h.key==="C"||h.key==="u"||h.key==="U")&&h.preventDefault(),(h.key==="F12"||(h.ctrlKey||h.metaKey)&&h.shiftKey&&(h.key==="I"||h.key==="J"||h.key==="C"))&&h.preventDefault())},d=h=>{const f=h.target;f.tagName==="INPUT"||f.tagName==="TEXTAREA"||f.closest('iframe[src*="twitter.com"]')||f.closest('iframe[src*="facebook.com"]')||f.closest('iframe[src*="telegram.org"]')||f.closest('iframe[src*="whatsapp.com"]')||f.closest('iframe[src*="discord.com"]')||f.closest('iframe[src*="reddit.com"]')||f.closest('iframe[src*="x.com"]')||h.preventDefault()};return document.addEventListener("contextmenu",a),document.addEventListener("copy",l),document.addEventListener("keydown",c),document.addEventListener("selectstart",d),()=>{document.removeEventListener("contextmenu",a),document.removeEventListener("copy",l),document.removeEventListener("keydown",c),document.removeEventListener("selectstart",d)}},[]),u.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[u.jsx(_ne,{backgroundImage:n==="/"?e:void 0}),u.jsx("div",{className:"pt-20 flex-1",children:u.jsx(bpe,{})}),u.jsx(Ine,{})]})}function _pe(){return T.useEffect(()=>{document.documentElement.classList.add("dark")},[]),u.jsx(GL,{client:H8,children:u.jsx(VF,{children:u.jsxs(DW,{children:[u.jsx(Spe,{}),u.jsx(DM,{})]})})})}var tb={},JN=lc;tb.createRoot=JN.createRoot,tb.hydrateRoot=JN.hydrateRoot;const Ape=new VL({defaultOptions:{queries:{queryFn:async({queryKey:n})=>{const e=await fetch(n[0]);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()},staleTime:1e3*60*5,retry:1}}});tb.createRoot(document.getElementById("root")).render(u.jsx(vt.StrictMode,{children:u.jsx(GL,{client:Ape,children:u.jsx(Ane,{children:u.jsxs(VF,{children:[u.jsx(_pe,{}),u.jsx(DM,{})]})})})}));
